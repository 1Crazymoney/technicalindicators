(function(e){'use strict';function t(e,t){Fn[e]=t}function a(e){return Fn[e]}function r(e){let t=a('precision');return t?parseFloat(e.toPrecision(t)):e}function o(e){En.reverseInputs(e);var t=new In(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function n(e){En.reverseInputs(e);var t=new An(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function s(e){En.reverseInputs(e);var t=new Rn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function u(e){En.reverseInputs(e);var t=new Ln(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function p(e){En.reverseInputs(e);var t=new On(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function d(e){En.reverseInputs(e);var t=new jn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function c(e){En.reverseInputs(e);var t=new zn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function g(e){En.reverseInputs(e);var t=new Gn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function h(e){En.reverseInputs(e);var t=new Un(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function f(e){En.reverseInputs(e);var t=new qn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function m(e){En.reverseInputs(e);var t=new Bn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function _(e){En.reverseInputs(e);var t=new Wn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function y(e){En.reverseInputs(e);var t=new Yn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function x(e){En.reverseInputs(e);var t=new $n(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function v(e){En.reverseInputs(e);var t=new Kn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function b(e){En.reverseInputs(e);var t=new Zn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function S(e){En.reverseInputs(e);var t=new Qn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function T(e){En.reverseInputs(e);var t=new Jn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function P(e){En.reverseInputs(e);var t=new ei(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function w(e){En.reverseInputs(e);var t=new ti(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function C(e){En.reverseInputs(e);var t=new ai(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function F(e){En.reverseInputs(e);var t=new ri(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function k(e){En.reverseInputs(e);var t=new oi(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function M(e){En.reverseInputs(e);var t=new ni(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function D(e){En.reverseInputs(e);var t=new ii(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}function I(e){En.reverseInputs(e);var t=new si(e).result;return e.reversedInput&&(t.open.reverse(),t.high.reverse(),t.low.reverse(),t.close.reverse(),t.volume.reverse(),t.timestamp.reverse()),En.reverseInputs(e),t}function A(e){En.reverseInputs(e);var t=new ui(e).result;return e.reversedInput&&(t.open.reverse(),t.high.reverse(),t.low.reverse(),t.close.reverse(),t.volume.reverse(),t.timestamp.reverse()),En.reverseInputs(e),t}function R(e){return new pi().hasPattern(e)}function L(e){return new di().hasPattern(e)}function O(e){return new ci().hasPattern(e)}function z(e){return new gi().hasPattern(e)}function G(e){return new hi().hasPattern(e)}function N(e){return new fi().hasPattern(e)}function U(e){return new mi().hasPattern(e)}function q(e){return new _i().hasPattern(e)}function B(e){return new yi().hasPattern(e)}function V(e){return new xi().hasPattern(e)}function H(e){return new bi().hasPattern(e)}function W(e){return new Si().hasPattern(e)}function X(e){return new Ti().hasPattern(e)}function Y(e){return new Pi().hasPattern(e)}function $(e){return new wi().hasPattern(e)}function K(e){return new Ci().hasPattern(e)}function Z(e){return new Fi().hasPattern(e)}function Q(e){return new ki().hasPattern(e)}function J(e){return new Mi().hasPattern(e)}function ee(e){return new Di().hasPattern(e)}function te(e){return new Ii().hasPattern(e)}function ae(e){return new Ai().hasPattern(e)}function re(e){return new Ri().hasPattern(e)}function oe(e){return new Li().hasPattern(e)}function ne(e){return new Oi().hasPattern(e)}function ie(e,t){let a=[0,23.6,38.2,50,61.8,78.6,100,127.2,161.8,261.8,423.6],r;return r=e<t?a.map(function(a){let r=t-Sn(e-t)*a/100;return 0<r?r:0}):a.map(function(a){let r=t+Sn(e-t)*a/100;return 0<r?r:0}),r}function se(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,'default')?e['default']:e}function ue(e,t){return t={exports:{}},e(t,t.exports),t.exports}function le(e){return isFinite(e=+e)&&0!=e?0>e?-le(-e):fn(e+Tn(e*e+1)):e}function pe(e,t){var a=3>arguments.length?e:arguments[2],r,o;return Hi(e)===a?e[t]:(r=mu.f(e,t))?Ni(r,'value')?r.value:void 0===r.get?void 0:r.get.call(a):Vi(o=Zu(e))?pe(o,t,a):void 0}function de(e,t,a){var r=4>arguments.length?e:arguments[3],o=mu.f(Hi(e),t),n,i;if(!o){if(Vi(i=Zu(e)))return de(i,t,a,r);o=es(0)}return Ni(o,'value')?!1!==o.writable&&Vi(r)&&(n=mu.f(r,t)||es(0),n.value=a,Ji.f(r,t,n),!0):void 0!==o.set&&(o.set.call(r,a),!0)}function ce(e,t){for(var a=-1,r=Array(e);++a<e;)r[a]=t(a);return r}function ge(e){var t=Vf.call(e,Wf),a=e[Wf];try{e[Wf]=void 0}catch(t){}var r=Hf.call(e);return t?e[Wf]=a:delete e[Wf],r}function he(e){return $f.call(e)}function fe(e){return null==e?void 0===e?Qf:Zf:Jf&&Jf in Object(e)?Xf(e):Kf(e)}function me(e){return null!=e&&'object'==typeof e}function _e(e){return tm(e)&&em(e)==am}function ye(){return!1}function xe(e,t){return t=null==t?gm:t,!!t&&('number'==typeof e||hm.test(e))&&-1<e&&0==e%1&&e<t}function ve(e){return'number'==typeof e&&-1<e&&0==e%1&&e<=mm}function be(e){return tm(e)&&_m(e.length)&&!!qm[em(e)]}function Se(e){return function(t){return e(t)}}function Te(e,t){var a=pm(e),r=!a&&um(e),o=!a&&!r&&cm(e),n=!a&&!r&&!o&&Ym(e),i=a||r||o||n,s=i?Lf(e.length,String):[],u=s.length;for(var l in e)(t||Km.call(e,l))&&!(i&&('length'==l||o&&('offset'==l||'parent'==l)||n&&('buffer'==l||'byteLength'==l||'byteOffset'==l)||fm(l,u)))&&s.push(l);return s}function Pe(e){var t=e&&e.constructor,a='function'==typeof t&&t.prototype||Qm;return e===a}function we(e,t){return function(a){return e(t(a))}}function Ce(e){if(!Jm(e))return a_(e);var t=[];for(var a in Object(e))o_.call(e,a)&&'constructor'!=a&&t.push(a);return t}function Fe(e){var t=typeof e;return null!=e&&('object'==t||'function'==t)}function ke(e){if(!i_(e))return!1;var t=em(e);return t==u_||t==l_||t==s_||t==p_}function Ee(e){return null!=e&&_m(e.length)&&!d_(e)}function Me(e){return c_(e)?Zm(e):n_(e)}function De(){this.__data__=[],this.size=0}function Ie(e,t){return e===t||e!==e&&t!==t}function Ae(e,t){for(var a=e.length;a--;)if(f_(e[a][0],t))return a;return-1}function Re(e){var t=this.__data__,a=m_(t,e);if(0>a)return!1;var r=t.length-1;return a==r?t.pop():y_.call(t,a,1),--this.size,!0}function Le(e){var t=this.__data__,a=m_(t,e);return 0>a?void 0:t[a][1]}function Oe(e){return-1<m_(this.__data__,e)}function je(e,t){var a=this.__data__,r=m_(a,e);return 0>r?(++this.size,a.push([e,t])):a[r][1]=t,this}function ze(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function Ge(){this.__data__=new T_,this.size=0}function Ne(e){var t=this.__data__,a=t['delete'](e);return this.size=t.size,a}function Ue(e){return this.__data__.get(e)}function qe(e){return this.__data__.has(e)}function Be(e){return!!M_&&M_ in e}function Ve(e){if(null!=e){try{return A_.call(e)}catch(t){}try{return e+''}catch(t){}}return''}function He(e){if(!i_(e)||D_(e))return!1;var t=d_(e)?U_:O_;return t.test(R_(e))}function We(e,t){return null==e?void 0:e[t]}function Xe(e,t){var a=B_(e,t);return q_(a)?a:void 0}function Ye(){this.__data__=Y_?Y_(null):{},this.size=0}function $e(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Ke(e){var t=this.__data__;if(Y_){var a=t[e];return a===Z_?void 0:a}return J_.call(t,e)?t[e]:void 0}function Ze(e){var t=this.__data__;return Y_?t[e]!==void 0:ay.call(t,e)}function Qe(e,t){var a=this.__data__;return this.size+=this.has(e)?0:1,a[e]=Y_&&void 0===t?oy:t,this}function Je(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function et(){this.size=0,this.__data__={hash:new iy,map:new(W_||T_),string:new iy}}function tt(e){var t=typeof e;return'string'==t||'number'==t||'symbol'==t||'boolean'==t?'__proto__'!==e:null===e}function at(e,t){var a=e.__data__;return uy(t)?a['string'==typeof t?'string':'hash']:a.map}function rt(e){var t=ly(this,e)['delete'](e);return this.size-=t?1:0,t}function ot(e){return ly(this,e).get(e)}function nt(e){return ly(this,e).has(e)}function it(e,t){var a=ly(this,e),r=a.size;return a.set(e,t),this.size+=a.size==r?0:1,this}function st(e){var t=-1,a=null==e?0:e.length;for(this.clear();++t<a;){var r=e[t];this.set(r[0],r[1])}}function ut(e,t){var a=this.__data__;if(a instanceof T_){var r=a.__data__;if(!W_||r.length<fy-1)return r.push([e,t]),this.size=++a.size,this;a=this.__data__=new hy(r)}return a.set(e,t),this.size=a.size,this}function lt(e){var t=this.__data__=new T_(e);this.size=t.size}function pt(e){return this.__data__.set(e,yy),this}function dt(e){return this.__data__.has(e)}function ct(e){var t=-1,a=null==e?0:e.length;for(this.__data__=new hy;++t<a;)this.add(e[t])}function gt(e,t){for(var a=-1,r=null==e?0:e.length;++a<r;)if(t(e[a],a,e))return!0;return!1}function ht(e,t){return e.has(t)}function ft(e,t,a,r,o,n){var i=a&Py,s=e.length,u=t.length;if(s!=u&&!(i&&u>s))return!1;var l=n.get(e);if(l&&n.get(t))return l==t;var p=-1,d=!0,c=a&wy?new by:void 0;for(n.set(e,t),n.set(t,e);++p<s;){var g=e[p],h=t[p];if(r)var f=i?r(h,g,p,t,e,n):r(g,h,p,e,t,n);if(void 0!==f){if(f)continue;d=!1;break}if(c){if(!Sy(t,function(e,t){if(!Ty(c,t)&&(g===e||o(g,e,a,r,n)))return c.push(t)})){d=!1;break}}else if(!(g===h||o(g,h,a,r,n))){d=!1;break}}return n['delete'](e),n['delete'](t),d}function mt(e){var t=-1,a=Array(e.size);return e.forEach(function(e,r){a[++t]=[r,e]}),a}function _t(e){var t=-1,a=Array(e.size);return e.forEach(function(e){a[++t]=e}),a}function yt(e,t,a,r,o,n,i){switch(a){case By:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case qy:return e.byteLength==t.byteLength&&n(new ky(e),new ky(t));case Ay:case Ry:case jy:return f_(+e,+t);case Ly:return e.name==t.name&&e.message==t.message;case zy:case Ny:return e==t+'';case Oy:var s=Ey;case Gy:var u=r&Dy;if(s||(s=My),e.size!=t.size&&!u)return!1;var l=i.get(e);if(l)return l==t;r|=Iy,i.set(e,t);var p=Cy(s(e),s(t),r,o,n,i);return i['delete'](e),p;case Uy:if(Hy)return Hy.call(e)==Hy.call(t);}return!1}function xt(e,t){for(var a=-1,r=t.length,o=e.length;++a<r;)e[o+a]=t[a];return e}function vt(e,t,a){var r=t(e);return pm(e)?r:Xy(r,a(e))}function bt(e,t){for(var a=-1,r=null==e?0:e.length,o=0,n=[];++a<r;){var i=e[a];t(i,a,e)&&(n[o++]=i)}return n}function St(){return[]}function Tt(e){return Yy(e,g_,tx)}function Pt(e,t,a,r,o,n){var i=a&rx,s=ax(e),u=s.length,l=ax(t),p=l.length;if(u!=p&&!i)return!1;for(var d=u,c;d--;)if(c=s[d],i?!(c in t):!nx.call(t,c))return!1;var g=n.get(e);if(g&&n.get(t))return g==t;var h=!0;n.set(e,t),n.set(t,e);for(var f=i;++d<u;){c=s[d];var m=e[c],_=t[c];if(r)var y=i?r(_,m,c,t,e,n):r(m,_,c,e,t,n);if(void 0===y?!(m===_||o(m,_,a,r,n)):!y){h=!1;break}f||(f='constructor'==c)}if(h&&!f){var x=e.constructor,v=t.constructor;x!=v&&'constructor'in e&&'constructor'in t&&!('function'==typeof x&&x instanceof x&&'function'==typeof v&&v instanceof v)&&(h=!1)}return n['delete'](e),n['delete'](t),h}function wt(e,t,a,r,o,n){var i=pm(e),s=pm(t),u=i?Mx:Fx(e),l=s?Mx:Fx(t);u=u==Ex?Dx:u,l=l==Ex?Dx:l;var p=u==Dx,d=l==Dx,c=u==l;if(c&&cm(e)){if(!cm(t))return!1;i=!0,p=!1}if(c&&!p)return n||(n=new _y),i||Ym(e)?Cy(e,t,a,r,o,n):Wy(e,t,u,a,r,o,n);if(!(a&kx)){var g=p&&Ax.call(e,'__wrapped__'),h=d&&Ax.call(t,'__wrapped__');if(g||h){var f=g?e.value():e,m=h?t.value():t;return n||(n=new _y),o(f,m,a,r,n)}}return!!c&&(n||(n=new _y),ix(e,t,a,r,o,n))}function Ct(e,t,a,r,o){return!(e!==t)||(null!=e&&null!=t&&(tm(e)||tm(t))?Rx(e,t,a,r,Ct,o):e!==e&&t!==t)}function Ft(e,t){return Lx(e,t)}function kt(e,t){for(var a=-1,r=null==e?0:e.length,o=Array(r);++a<r;)o[a]=t(e[a],a,e);return o}function Et(e,t,a,r){var o=a.length,n=o,i=!r;if(null==e)return!n;for(e=Object(e);o--;){var s=a[o];if(i&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++o<n;){s=a[o];var u=s[0],l=e[u],p=s[1];if(!(i&&s[2])){var d=new _y;if(r)var c=r(l,p,u,e,t,d);if(void 0===c?!Lx(p,l,zx|Gx,r,d):!c)return!1}else if(void 0===l&&!(u in e))return!1}return!0}function Mt(e){return e===e&&!i_(e)}function Dt(e){for(var t=g_(e),a=t.length;a--;){var r=t[a],o=e[r];t[a]=[r,o,Ux(o)]}return t}function It(e,t){return function(a){return null!=a&&a[e]===t&&(t!==void 0||e in Object(a))}}function At(e){var t=qx(e);return 1==t.length&&t[0][2]?Bx(t[0][0],t[0][1]):function(a){return a===e||Nx(a,e,t)}}function Rt(e){return'symbol'==typeof e||tm(e)&&em(e)==Hx}function Lt(e,t){if(pm(e))return!1;var a=typeof e;return'number'==a||'symbol'==a||'boolean'==a||null==e||Wx(e)||Yx.test(e)||!Xx.test(e)||null!=t&&e in Object(t)}function Ot(e,t){if('function'!=typeof e||null!=t&&'function'!=typeof t)throw new TypeError(Kx);var a=function(){var r=arguments,o=t?t.apply(this,r):r[0],n=a.cache;if(n.has(o))return n.get(o);var i=e.apply(this,r);return a.cache=n.set(o,i)||n,i};return a.cache=new(Ot.Cache||hy),a}function jt(e){var t=Zx(e,function(e){return a.size===Qx&&a.clear(),e}),a=t.cache;return t}function zt(e){if('string'==typeof e)return e;if(pm(e))return jx(e,zt)+'';if(Wx(e))return sv?sv.call(e):'';var t=e+'';return'0'==t&&1/e==-nv?'-0':t}function Gt(e){return null==e?'':uv(e)}function Nt(e,t){return pm(e)?e:$x(e,t)?[e]:ov(lv(e))}function Ut(e){if('string'==typeof e||Wx(e))return e;var t=e+'';return'0'==t&&1/e==-dv?'-0':t}function qt(e,t){t=pv(t,e);for(var a=0,r=t.length;null!=e&&a<r;)e=e[cv(t[a++])];return a&&a==r?e:void 0}function Bt(e,t,a){var r=null==e?void 0:gv(e,t);return r===void 0?a:r}function Vt(e,t){return null!=e&&t in Object(e)}function Ht(e,t,a){t=pv(t,e);for(var r=-1,o=t.length,n=!1,i;++r<o&&(i=cv(t[r]),!!(n=null!=e&&a(e,i)));)e=e[i];return n||++r!=o?n:(o=null==e?0:e.length,!!o&&_m(o)&&fm(i,o)&&(pm(e)||um(e)))}function Wt(e,t){return null!=e&&mv(e,t,fv)}function Xt(e,t){return $x(e)&&Ux(t)?Bx(cv(e),t):function(a){var r=hv(a,e);return r===void 0&&r===t?_v(a,e):Lx(t,r,yv|xv)}}function Yt(e){return e}function $t(e){return function(t){return null==t?void 0:t[e]}}function Kt(e){return function(t){return gv(t,e)}}function Zt(e){return $x(e)?Sv(cv(e)):Tv(e)}function Qt(e){return'function'==typeof e?e:null==e?bv:'object'==typeof e?pm(e)?vv(e[0],e[1]):Vx(e):Pv(e)}function Jt(e){return function(t,a,r){for(var o=-1,n=Object(t),i=r(t),s=i.length;s--;){var u=i[e?s:++o];if(!1===a(n[u],u,n))break}return t}}function ea(e,t){return e&&kv(e,t,g_)}function ta(e,t){return function(a,r){if(null==a)return a;if(!c_(a))return e(a,r);for(var o=a.length,n=t?o:-1,i=Object(a);(t?n--:++n<o)&&!(!1===r(i[n],n,i)););return a}}function aa(e,t){var a=-1,r=c_(e)?Array(e.length):[];return Iv(e,function(e,o,n){r[++a]=t(e,o,n)}),r}function ra(e,t){var a=pm(e)?jx:Av;return a(e,wv(t,3))}function oa(e,t){for(var a=-1,r=null==e?0:e.length;++a<r;)if(!t(e[a],a,e))return!1;return!0}function na(e,t){var a=!0;return Iv(e,function(e,r,o){return a=!!t(e,r,o),a}),a}function ia(e,t,a){if(!i_(a))return!1;var r=typeof t;return!('number'==r?!(c_(a)&&fm(t,a.length)):!('string'==r&&t in a))&&f_(a[t],e)}function sa(e,t,a){var r=pm(e)?Lv:Ov;return a&&jv(e,t,a)&&(t=void 0),r(e,wv(t,3))}function ua(e){return function(t,a,r){var o=Object(t);if(!c_(t)){var n=wv(a,3);t=g_(t),a=function(e){return n(o[e],e,o)}}var i=e(t,a,r);return-1<i?o[n?t[i]:i]:void 0}}function la(e,t,a,r){for(var o=e.length,n=a+(r?1:-1);r?n--:++n<o;)if(t(e[n],n,e))return n;return-1}function pa(e){if('number'==typeof e)return e;if(Wx(e))return Uv;if(i_(e)){var t='function'==typeof e.valueOf?e.valueOf():e;e=i_(t)?t+'':t}if('string'!=typeof e)return 0===e?e:+e;e=e.replace(qv,'');var a=Vv.test(e);return a||Hv.test(e)?Wv(e.slice(2),a?2:8):Bv.test(e)?Uv:+e}function da(e){if(!e)return 0===e?e:0;if(e=Xv(e),e===Yv||e===-Yv){var t=0>e?-1:1;return t*$v}return e===e?e:0}function ca(e){var t=Kv(e),a=t%1;return t===t?a?t-a:t:0}function ga(e,t,a){var r=null==e?0:e.length;if(!r)return-1;var o=null==a?0:Zv(a);return 0>o&&(o=Qv(r+o,0)),Nv(e,wv(t,3),o)}function ha(e,t,a){'__proto__'==t&&rb?rb(e,t,{configurable:!0,enumerable:!0,value:a,writable:!0}):e[t]=a}function fa(e,t,a){var r=e[t];ib.call(e,t)&&f_(r,a)&&(a!==void 0||t in e)||ob(e,t,a)}function ma(e,t,a,r){if(!i_(e))return e;t=pv(t,e);for(var o=-1,n=t.length,i=e;null!=i&&++o<n;){var s=cv(t[o]),u=a;if(o!=n-1){var l=i[s];u=r?r(l,s,i):void 0,u===void 0&&(u=i_(l)?l:fm(t[o+1])?[]:{})}sb(i,s,u),i=i[s]}return e}function _a(e,t,a){for(var r=-1,o=t.length,n={};++r<o;){var i=t[r],s=gv(e,i);a(s,i)&&ub(n,pv(i,e),s)}return n}function ya(e,t){return lb(e,t,function(t,a){return _v(e,a)})}function xa(e){return pm(e)||um(e)||!!(db&&e&&e[db])}function va(e,t,a,r,o){var n=-1,i=e.length;for(a||(a=cb),o||(o=[]);++n<i;){var s=e[n];0<t&&a(s)?1<t?va(s,t-1,a,r,o):Xy(o,s):!r&&(o[o.length]=s)}return o}function ba(e){var t=null==e?0:e.length;return t?gb(e,1):[]}function Sa(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2]);}return e.apply(t,a)}function Ta(e,t,a){return t=mb(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,n=mb(r.length-t,0),i=Array(n);++o<n;)i[o]=r[t+o];o=-1;for(var s=Array(t+1);++o<t;)s[o]=r[o];return s[t]=a(i),fb(e,this,s)}}function Pa(e){return function(){return e}}function wa(e){var t=0,a=0;return function(){var r=Tb(),o=Sb-(r-a);if(a=r,!(0<o))t=0;else if(++t>=bb)return arguments[0];return e.apply(void 0,arguments)}}function Ca(e){return Cb(_b(e,void 0,hb),e+'')}function Fa(e){return!!e.constructor&&'function'==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function ka(e){return'function'==typeof e.readFloatLE&&'function'==typeof e.slice&&Fa(e.slice(0,0))}function Ea(e){return'[object Array]'===Ab.call(e)}function Ma(e){return'[object ArrayBuffer]'===Ab.call(e)}function Da(e){return'undefined'!=typeof FormData&&e instanceof FormData}function Ia(e){var t;return t='undefined'!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer,t}function Aa(e){return'string'==typeof e}function Ra(e){return'number'==typeof e}function La(e){return'undefined'==typeof e}function Oa(e){return null!==e&&'object'==typeof e}function ja(e){return'[object Date]'===Ab.call(e)}function za(e){return'[object File]'===Ab.call(e)}function Ga(e){return'[object Blob]'===Ab.call(e)}function Na(e){return'[object Function]'===Ab.call(e)}function Ua(e){return Oa(e)&&Na(e.pipe)}function qa(e){return'undefined'!=typeof URLSearchParams&&e instanceof URLSearchParams}function Ba(e){return e.replace(/^\s*/,'').replace(/\s*$/,'')}function Va(){return'undefined'!=typeof navigator&&'ReactNative'===navigator.product?!1:'undefined'!=typeof window&&'undefined'!=typeof document}function Ha(e,t){if(null!==e&&'undefined'!=typeof e)if('object'!=typeof e&&(e=[e]),Ea(e))for(var a=0,r=e.length;a<r;a++)t.call(null,e[a],a,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}function Wa(){function e(e,a){t[a]='object'==typeof t[a]&&'object'==typeof e?Wa(t[a],e):e}for(var t={},a=0,r=arguments.length;a<r;a++)Ha(arguments[a],e);return t}function Xa(e,t,a){return Ha(t,function(t,r){e[r]=a&&'function'==typeof t?Db(t,a):t}),e}function Ya(e){return encodeURIComponent(e).replace(/%40/gi,'@').replace(/%3A/gi,':').replace(/%24/g,'$').replace(/%2C/gi,',').replace(/%20/g,'+').replace(/%5B/gi,'[').replace(/%5D/gi,']')}function $a(){this.message='String contains an invalid character'}function E(e){for(var t=e+'',a='',r=0,o=Bb,n,i;t.charAt(0|r)||(o='=',r%1);a+=o.charAt(63&n>>8-8*(r%1))){if(i=t.charCodeAt(r+=3/4),255<i)throw new $a;n=n<<8|i}return a}function Ka(e,t){!Rb.isUndefined(e)&&Rb.isUndefined(e['Content-Type'])&&(e['Content-Type']=t)}function Za(){var e;return'undefined'==typeof XMLHttpRequest?'undefined'!=typeof process&&(e=Xb):e=Xb,e}function Qa(){this.handlers=[]}function Ja(e){e.cancelToken&&e.cancelToken.throwIfRequested()}function er(e){this.defaults=e,this.interceptors={request:new Zb,response:new Zb}}function tr(e){this.message=e}function ar(e){if('function'!=typeof e)throw new TypeError('executor must be a function.');var t;this.promise=new Promise(function(e){t=e});var a=this;e(function(e){a.reason||(a.reason=new oS(e),t(a.reason))})}function rr(e){var t=new rS(e),a=Db(rS.prototype.request,t);return Rb.extend(a,rS.prototype,t),Rb.extend(a,t),a}function or(e,t,a,r){for(var o=-1,n=mS(fS((t-e)/(a||1)),0),i=Array(n);n--;)i[r?n:++o]=e,e+=a;return i}function nr(e){return function(t,a,r){return r&&'number'!=typeof r&&jv(t,a,r)&&(a=r=void 0),t=Kv(t),void 0===a?(a=t,t=0):a=Kv(a),r=void 0===r?t<a?1:-1:Kv(r),_S(t,a,r,e)}}function ir(e){for(var t=Array(e),a=0;a<e;++a)t[a]=a;return t}function sr(e,t){return e[0]-t[0]}function ur(){var e=this.stride,t=Array(e.length),a;for(a=0;a<t.length;++a)t[a]=[Sn(e[a]),a];t.sort(sr);var r=Array(t.length);for(a=0;a<r.length;++a)r[a]=t[a][1];return r}function lr(e,t){var a=['View',t,'d',e].join('');0>t&&(a='View_Nil'+e);var r='generic'===e;if(-1===t){var o='function '+a+'(a){this.data=a;};var proto='+a+'.prototype;proto.dtype=\''+e+'\';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new '+a+'(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_'+a+'(a){return new '+a+'(a);}',n=new Function(o);return n()}if(0===t){var o='function '+a+'(a,d) {this.data = a;this.offset = d};var proto='+a+'.prototype;proto.dtype=\''+e+'\';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function '+a+'_copy() {return new '+a+'(this.data,this.offset)};proto.pick=function '+a+'_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function '+a+'_get(){return '+(r?'this.data.get(this.offset)':'this.data[this.offset]')+'};proto.set=function '+a+'_set(v){return '+(r?'this.data.set(this.offset,v)':'this.data[this.offset]=v')+'};return function construct_'+a+'(a,b,c,d){return new '+a+'(a,d)}',n=new Function('TrivialArray',o);return n(TS[e][0])}var o=['\'use strict\''],s=bS(t),u=s.map(function(e){return'i'+e}),l='this.offset+'+s.map(function(e){return'this.stride['+e+']*i'+e}).join('+'),p=s.map(function(e){return'b'+e}).join(','),d=s.map(function(e){return'c'+e}).join(',');o.push('function '+a+'(a,'+p+','+d+',d){this.data=a','this.shape=['+p+']','this.stride=['+d+']','this.offset=d|0}','var proto='+a+'.prototype','proto.dtype=\''+e+'\'','proto.dimension='+t),o.push('Object.defineProperty(proto,\'size\',{get:function '+a+'_size(){return '+s.map(function(e){return'this.shape['+e+']'}).join('*'),'}})'),1===t?o.push('proto.order=[0]'):(o.push('Object.defineProperty(proto,\'order\',{get:'),4>t?(o.push('function '+a+'_order(){'),2===t?o.push('return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})'):3===t&&o.push('var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})')):o.push('ORDER})')),o.push('proto.set=function '+a+'_set('+u.join(',')+',v){'),r?o.push('return this.data.set('+l+',v)}'):o.push('return this.data['+l+']=v}'),o.push('proto.get=function '+a+'_get('+u.join(',')+'){'),r?o.push('return this.data.get('+l+')}'):o.push('return this.data['+l+']}'),o.push('proto.index=function '+a+'_index(',u.join(),'){return '+l+'}'),o.push('proto.hi=function '+a+'_hi('+u.join(',')+'){return new '+a+'(this.data,'+s.map(function(e){return['(typeof i',e,'!==\'number\'||i',e,'<0)?this.shape[',e,']:i',e,'|0'].join('')}).join(',')+','+s.map(function(e){return'this.stride['+e+']'}).join(',')+',this.offset)}');var c=s.map(function(e){return'a'+e+'=this.shape['+e+']'}),g=s.map(function(e){return'c'+e+'=this.stride['+e+']'});o.push('proto.lo=function '+a+'_lo('+u.join(',')+'){var b=this.offset,d=0,'+c.join(',')+','+g.join(','));for(var h=0;h<t;++h)o.push('if(typeof i'+h+'===\'number\'&&i'+h+'>=0){d=i'+h+'|0;b+=c'+h+'*d;a'+h+'-=d}');o.push('return new '+a+'(this.data,'+s.map(function(e){return'a'+e}).join(',')+','+s.map(function(e){return'c'+e}).join(',')+',b)}'),o.push('proto.step=function '+a+'_step('+u.join(',')+'){var '+s.map(function(e){return'a'+e+'=this.shape['+e+']'}).join(',')+','+s.map(function(e){return'b'+e+'=this.stride['+e+']'}).join(',')+',c=this.offset,d=0,ceil=Math.ceil');for(var h=0;h<t;++h)o.push('if(typeof i'+h+'===\'number\'){d=i'+h+'|0;if(d<0){c+=b'+h+'*(a'+h+'-1);a'+h+'=ceil(-a'+h+'/d)}else{a'+h+'=ceil(a'+h+'/d)}b'+h+'*=d}');o.push('return new '+a+'(this.data,'+s.map(function(e){return'a'+e}).join(',')+','+s.map(function(e){return'b'+e}).join(',')+',c)}');for(var i=Array(t),f=Array(t),h=0;h<t;++h)i[h]='a[i'+h+']',f[h]='b[i'+h+']';o.push('proto.transpose=function '+a+'_transpose('+u+'){'+u.map(function(e,t){return e+'=('+e+'===undefined?'+t+':'+e+'|0)'}).join(';'),'var a=this.shape,b=this.stride;return new '+a+'(this.data,'+i.join(',')+','+f.join(',')+',this.offset)}'),o.push('proto.pick=function '+a+'_pick('+u+'){var a=[],b=[],c=this.offset');for(var h=0;h<t;++h)o.push('if(typeof i'+h+'===\'number\'&&i'+h+'>=0){c=(c+this.stride['+h+']*i'+h+')|0}else{a.push(this.shape['+h+']);b.push(this.stride['+h+'])}');o.push('var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}'),o.push('return function construct_'+a+'(data,shape,stride,offset){return new '+a+'(data,'+s.map(function(e){return'shape['+e+']'}).join(',')+','+s.map(function(e){return'stride['+e+']'}).join(',')+',offset)}');var n=new Function('CTOR_LIST','ORDER',o.join('\n'));return n(TS[e],ur)}function pr(e){if(Ib(e))return'buffer';if(SS)switch(Object.prototype.toString.call(e)){case'[object Float64Array]':return'float64';case'[object Float32Array]':return'float32';case'[object Int8Array]':return'int8';case'[object Int16Array]':return'int16';case'[object Int32Array]':return'int32';case'[object Uint8Array]':return'uint8';case'[object Uint16Array]':return'uint16';case'[object Uint32Array]':return'uint32';case'[object Uint8ClampedArray]':return'uint8_clamped';}return Array.isArray(e)?'array':'generic'}function dr(e,t,a,r){if(e===void 0){var o=TS.array[0];return o([])}'number'==typeof e&&(e=[e]);t===void 0&&(t=[e.length]);var n=t.length;if(a===void 0){a=Array(n);for(var s=n-1,i=1;0<=s;--s)a[s]=i,i*=t[s]}if(void 0===r){r=0;for(var s=0;s<n;++s)0>a[s]&&(r-=(t[s]-1)*a[s])}for(var u=pr(e),l=TS[u];l.length<=n+1;)l.push(lr(u,l.length-1));var o=l[n+1];return o(e,t,a,r)}function cr(e,t){for(var r=1,o=e.length,n=e[0],a=e[0],s=1;s<o;++s)if(a=n,n=e[s],t(n,a)){if(s===r){r++;continue}e[r++]=n}return e.length=r,e}function gr(e){for(var t=1,r=e.length,o=e[0],a=e[0],n=1;n<r;++n,a=o)if(a=o,o=e[n],o!==a){if(n===t){t++;continue}e[t++]=o}return e.length=t,e}function hr(e,t,a){return 0===e.length?e:t?(a||e.sort(t),cr(e,t)):(a||e.sort(),gr(e))}function fr(e,t,a){var r=e.length,o=t.arrayArgs.length,n=0<t.indexArgs.length,s=[],u=[],l=0,p=0,d,i;for(d=0;d<r;++d)u.push(['i',d,'=0'].join(''));for(i=0;i<o;++i)for(d=0;d<r;++d)p=l,l=e[d],0===d?u.push(['d',i,'s',d,'=t',i,'p',l].join('')):u.push(['d',i,'s',d,'=(t',i,'p',l,'-s',p,'*t',i,'p',p,')'].join(''));for(0<u.length&&s.push('var '+u.join(',')),d=r-1;0<=d;--d)l=e[d],s.push(['for(i',d,'=0;i',d,'<s',l,';++i',d,'){'].join(''));for(s.push(a),d=0;d<r;++d){for(p=l,l=e[d],i=0;i<o;++i)s.push(['p',i,'+=d',i,'s',d].join(''));n&&(0<d&&s.push(['index[',p,']-=s',p].join('')),s.push(['++index[',l,']'].join(''))),s.push('}')}return s.join('\n')}function mr(e,t,a,r){for(var o=t.length,n=a.arrayArgs.length,s=a.blockSize,u=0<a.indexArgs.length,l=[],p=0;p<n;++p)l.push(['var offset',p,'=p',p].join(''));for(var p=e;p<o;++p)l.push(['for(var j'+p+'=SS[',t[p],']|0;j',p,'>0;){'].join('')),l.push(['if(j',p,'<',s,'){'].join('')),l.push(['s',t[p],'=j',p].join('')),l.push(['j',p,'=0'].join('')),l.push(['}else{s',t[p],'=',s].join('')),l.push(['j',p,'-=',s,'}'].join('')),u&&l.push(['index[',t[p],']=j',p].join(''));for(var p=0,i;p<n;++p){i=['offset'+p];for(var d=e;d<o;++d)i.push(['j',d,'*t',p,'p',t[d]].join(''));l.push(['p',p,'=(',i.join('+'),')'].join(''))}l.push(fr(t,a,r));for(var p=e;p<o;++p)l.push('}');return l.join('\n')}function _r(e){for(var t=0,a=e[0].length;t<a;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}function yr(e,t,a){for(var r=e.body,o=[],n=[],s=0,i;s<e.args.length;++s)if(i=e.args[s],!(0>=i.count)){var u=new RegExp(i.name,'g'),l='',p=t.arrayArgs.indexOf(s);switch(t.argTypes[s]){case'offset':var d=t.offsetArgIndex.indexOf(s),c=t.offsetArgs[d];p=c.array,l='+q'+d;case'array':l='p'+p+l;var g='l'+s,h='a'+p;if(0===t.arrayBlockIndices[p])1===i.count?'generic'===a[p]?i.lvalue?(o.push(['var ',g,'=',h,'.get(',l,')'].join('')),r=r.replace(u,g),n.push([h,'.set(',l,',',g,')'].join(''))):r=r.replace(u,[h,'.get(',l,')'].join('')):r=r.replace(u,[h,'[',l,']'].join('')):'generic'===a[p]?(o.push(['var ',g,'=',h,'.get(',l,')'].join('')),r=r.replace(u,g),i.lvalue&&n.push([h,'.set(',l,',',g,')'].join(''))):(o.push(['var ',g,'=',h,'[',l,']'].join('')),r=r.replace(u,g),i.lvalue&&n.push([h,'[',l,']=',g].join('')));else{for(var f=[i.name],m=[l],_=0;_<Sn(t.arrayBlockIndices[p]);_++)f.push('\\s*\\[([^\\]]+)\\]'),m.push('$'+(_+1)+'*t'+p+'b'+_);if(u=new RegExp(f.join(''),'g'),l=m.join('+'),'generic'===a[p])throw new Error('cwise: Generic arrays not supported in combination with blocks!');else r=r.replace(u,[h,'[',l,']'].join(''))}break;case'scalar':r=r.replace(u,'Y'+t.scalarArgs.indexOf(s));break;case'index':r=r.replace(u,'index');break;case'shape':r=r.replace(u,'shape');}}return[o.join('\n'),r,n.join('\n')].join('\n').trim()}function xr(e){for(var a=Array(e.length),r=!0,o=0;o<e.length;++o){var n=e[o],t=n.match(/\d+/);t=t?t[0]:'',a[o]=0===n.charAt(0)?'u'+n.charAt(1)+t:n.charAt(0)+t,0<o&&(r=r&&a[o]===a[o-1])}return r?a[0]:a.join('')}function vr(e,t){for(var a=0|t[1].length-Sn(e.arrayBlockIndices[0]),r=Array(e.arrayArgs.length),o=Array(e.arrayArgs.length),n=0;n<e.arrayArgs.length;++n)o[n]=t[2*n],r[n]=t[2*n+1];for(var i=[],s=[],u=[],l=[],p=[],n=0;n<e.arrayArgs.length;++n){0>e.arrayBlockIndices[n]?(u.push(0),l.push(a),i.push(a),s.push(a+e.arrayBlockIndices[n])):(u.push(e.arrayBlockIndices[n]),l.push(e.arrayBlockIndices[n]+a),i.push(0),s.push(e.arrayBlockIndices[n]));for(var d=[],c=0;c<r[n].length;c++)u[n]<=r[n][c]&&r[n][c]<l[n]&&d.push(r[n][c]-u[n]);p.push(d)}for(var g=['SS'],h=['\'use strict\''],m=[],c=0;c<a;++c)m.push(['s',c,'=SS[',c,']'].join(''));for(var n=0;n<e.arrayArgs.length;++n){g.push('a'+n),g.push('t'+n),g.push('p'+n);for(var c=0;c<a;++c)m.push(['t',n,'p',c,'=t',n,'[',u[n]+c,']'].join(''));for(var c=0;c<Sn(e.arrayBlockIndices[n]);++c)m.push(['t',n,'b',c,'=t',n,'[',i[n]+c,']'].join(''))}for(var n=0;n<e.scalarArgs.length;++n)g.push('Y'+n);if(0<e.shapeArgs.length&&m.push('shape=SS.slice(0)'),0<e.indexArgs.length){for(var _=Array(a),n=0;n<a;++n)_[n]='0';m.push(['index=[',_.join(','),']'].join(''))}for(var n=0;n<e.offsetArgs.length;++n){for(var y=e.offsetArgs[n],x=[],c=0;c<y.offset.length;++c)if(0===y.offset[c])continue;else 1===y.offset[c]?x.push(['t',y.array,'p',c].join('')):x.push([y.offset[c],'*t',y.array,'p',c].join(''));0===x.length?m.push('q'+n+'=0'):m.push(['q',n,'=',x.join('+')].join(''))}var v=wS([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));m=m.concat(v),0<m.length&&h.push('var '+m.join(','));for(var n=0;n<e.arrayArgs.length;++n)h.push('p'+n+'|=0');3<e.pre.body.length&&h.push(yr(e.pre,e,o));var b=yr(e.body,e,o),S=_r(p);S<a?h.push(mr(S,p[0],e,b)):h.push(fr(p[0],e,b)),3<e.post.body.length&&h.push(yr(e.post,e,o)),e.debug&&console.log('-----Generated cwise routine for ',t,':\n'+h.join('\n')+'\n----------');var T=[e.funcName||'unnamed','_cwise_loop_',r[0].join('s'),'m',S,xr(o)].join(''),P=new Function(['function ',T,'(',g.join(','),'){',h.join('\n'),'} return ',T].join(''));return P()}function br(e){var t=['\'use strict\'','var CACHED={}'],a=[],r=e.funcName+'_cwise_thunk';t.push(['return function ',r,'(',e.shimArgs.join(','),'){'].join(''));for(var o=[],n=[],s=[['array',e.arrayArgs[0],'.shape.slice(',bn(0,e.arrayBlockIndices[0]),0>e.arrayBlockIndices[0]?','+e.arrayBlockIndices[0]+')':')'].join('')],u=[],l=[],p=0,i;p<e.arrayArgs.length;++p)i=e.arrayArgs[p],a.push(['t',i,'=array',i,'.dtype,','r',i,'=array',i,'.order'].join('')),o.push('t'+i),o.push('r'+i),n.push('t'+i),n.push('r'+i+'.join()'),s.push('array'+i+'.data'),s.push('array'+i+'.stride'),s.push('array'+i+'.offset|0'),0<p&&(u.push('array'+e.arrayArgs[0]+'.shape.length===array'+i+'.shape.length+'+(Sn(e.arrayBlockIndices[0])-Sn(e.arrayBlockIndices[p]))),l.push('array'+e.arrayArgs[0]+'.shape[shapeIndex+'+bn(0,e.arrayBlockIndices[0])+']===array'+i+'.shape[shapeIndex+'+bn(0,e.arrayBlockIndices[p])+']'));1<e.arrayArgs.length&&(t.push('if (!('+u.join(' && ')+')) throw new Error(\'cwise: Arrays do not all have the same dimensionality!\')'),t.push('for(var shapeIndex=array'+e.arrayArgs[0]+'.shape.length-'+Sn(e.arrayBlockIndices[0])+'; shapeIndex-->0;) {'),t.push('if (!('+l.join(' && ')+')) throw new Error(\'cwise: Arrays do not all have the same shape!\')'),t.push('}'));for(var p=0;p<e.scalarArgs.length;++p)s.push('scalar'+e.scalarArgs[p]);a.push(['type=[',n.join(','),'].join()'].join('')),a.push('proc=CACHED[type]'),t.push('var '+a.join(',')),t.push(['if(!proc){','CACHED[type]=proc=compile([',o.join(','),'])}','return proc(',s.join(','),')}'].join('')),e.debug&&console.log('-----Generated thunk:\n'+t.join('\n')+'\n----------');var d=new Function('compile',t.join('\n'));return d(CS.bind(void 0,e))}function Sr(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName='',this.pre=null,this.body=null,this.post=null,this.debug=!1}function Tr(e){var t=new Sr;t.pre=e.pre,t.body=e.body,t.post=e.post;var a=e.args.slice(0);t.argTypes=a;for(var r=0,o;r<a.length;++r)if(o=a[r],'array'===o||'object'==typeof o&&o.blockIndices){if(t.argTypes[r]='array',t.arrayArgs.push(r),t.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),t.shimArgs.push('array'+r),r<t.pre.args.length&&0<t.pre.args[r].count)throw new Error('cwise: pre() block may not reference array args');if(r<t.post.args.length&&0<t.post.args[r].count)throw new Error('cwise: post() block may not reference array args')}else if('scalar'===o)t.scalarArgs.push(r),t.shimArgs.push('scalar'+r);else if('index'===o){if(t.indexArgs.push(r),r<t.pre.args.length&&0<t.pre.args[r].count)throw new Error('cwise: pre() block may not reference array index');if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error('cwise: body() block may not write to array index');if(r<t.post.args.length&&0<t.post.args[r].count)throw new Error('cwise: post() block may not reference array index')}else if('shape'===o){if(t.shapeArgs.push(r),r<t.pre.args.length&&t.pre.args[r].lvalue)throw new Error('cwise: pre() block may not write to array shape');if(r<t.body.args.length&&t.body.args[r].lvalue)throw new Error('cwise: body() block may not write to array shape');if(r<t.post.args.length&&t.post.args[r].lvalue)throw new Error('cwise: post() block may not write to array shape')}else if('object'==typeof o&&o.offset)t.argTypes[r]='offset',t.offsetArgs.push({array:o.array,offset:o.offset}),t.offsetArgIndex.push(r);else throw new Error('cwise: Unknown argument type '+a[r]);if(0>=t.arrayArgs.length)throw new Error('cwise: No array arguments specified');if(t.pre.args.length>a.length)throw new Error('cwise: Too many arguments in pre() block');if(t.body.args.length>a.length)throw new Error('cwise: Too many arguments in body() block');if(t.post.args.length>a.length)throw new Error('cwise: Too many arguments in post() block');return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||'cwise',t.blockSize=e.blockSize||64,FS(t)}function Pr(e,t){var a=[],r=[],o;if(t!==void 0&&!Array.isArray(t))throw new Error('axes must be an Array list of dimensions to squeeze');for(o=0;o<e.shape.length;o++)(1!==e.shape[o]||void 0!==t&&-1===t.indexOf(o))&&(a.push(e.shape[o]),r.push(e.stride[o]));return PS(e.data,a,r,e.offset)}function wr(e,t,a){this.name=e,this.lvalue=t,this.rvalue=a,this.count=0}function Cr(e,t,a,r){this.body=e,this.args=t,this.thisVars=a,this.localVars=r}function Fr(e){if('eval'===e)throw new Error('cwise-parser: eval() not allowed');return'undefined'==typeof window?'undefined'==typeof ji?'undefined'!=typeof self&&e in self:e in ji:e in window}function kr(e){for(var t=e.body[0].expression.callee.params,a=Array(t.length),r=0;r<t.length;++r)a[r]=t[r].name;return a}function Er(e){function t(e){var t=p+e.replace(/\_/g,'__');return n.push(t),t}function a(e){var t='this_'+e.replace(/\_/g,'__');return f.push(t),t}function r(e,t){for(var a=e.range[0],r=e.range[1],o=a+1;o<r;++o)h[o]='';h[a]=t}function o(e){return'\''+e.replace(/\_/g,'\\_').replace(/\'/g,'\'')+'\''}function s(e){return'AssignmentExpression'===e.parent.type&&e.parent.left===e?'='===e.parent.operator?m:m|_:'UpdateExpression'===e.parent.type?m|_:_}for(var u=['(',e,')()'].join(''),l=LS.parse(u,{range:!0}),p='_inline_'+OS++ +'_',d=kr(l),c=Array(d.length),g=0;g<d.length;++g)c[g]=new wr([p,'arg',g,'_'].join(''),!1,!1);for(var h=Array(u.length),g=0,i=u.length;g<i;++g)h[g]=u.charAt(g);var n=[],f=[],m=1,_=2;(function e(u,l){if(u.parent=l,'MemberExpression'===u.type)u.computed?(e(u.object,u),e(u.property,u)):'ThisExpression'===u.object.type?r(u,a(u.property.name)):e(u.object,u);else if('ThisExpression'===u.type)throw new Error('cwise-parser: Computed this is not allowed');else if('Identifier'===u.type){var p=u.name,g=d.indexOf(p);if(0<=g){var h=c[g],f=s(u);f&m&&(h.lvalue=!0),f&_&&(h.rvalue=!0),++h.count,r(u,h.name)}else if(Fr(p));else r(u,t(p))}else if('Literal'===u.type)'string'==typeof u.value&&r(u,o(u.value));else if('WithStatement'===u.type)throw new Error('cwise-parser: with() statements not allowed');else for(var y=Object.keys(u),x=0,i=y.length;x<i;++x)if('parent'!==y[x]){var n=u[y[x]];if(n)if(n instanceof Array)for(var v=0;v<n.length;++v)n[v]&&'string'==typeof n[v].type&&e(n[v],u);else'string'==typeof n.type&&e(n,u)}})(l.body[0].expression.callee.body,void 0),wS(n),wS(f);var y=new Cr(function(e){return h.slice(e.range[0],e.range[1]).join('')}(l.body[0].expression.callee.body),c,f,n);return y}function Mr(e){for(var t in e)0>zS.indexOf(t)&&0>GS.indexOf(t)&&console.warn('cwise: Unknown argument \''+t+'\' passed to expression compiler');for(var a=0;a<zS.length;++a)if(!e[zS[a]])throw new Error('cwise: Missing argument: '+zS[a]);return kS({args:e.args,pre:jS(e.pre||function(){}),body:jS(e.body),post:jS(e.post||function(){}),debug:!!e.printCode,funcName:e.funcName||e.body.name||'cwise',blockSize:e.blockSize||64})}function Dr(e,t,a){var r=-1,o=e.length;0>t&&(t=-t>o?0:o+t),a=a>o?o:a,0>a&&(a+=o),o=t>a?0:a-t>>>0,t>>>=0;for(var n=Array(o);++r<o;)n[r]=e[r+t];return n}function Ir(e,t,a){return e&&e.length?(t=a||void 0===t?1:Zv(t),oT(e,0,0>t?0:t)):[]}function Ar(e,t){for(var a=-1,r=e.length,o;++a<r;){var n=t(e[a]);n!==void 0&&(o=o==void 0?n:o+n)}return o}function Rr(e){return e&&e.length?iT(e,bv):0}function Lr(e,t){return'native'===t[1]?[e,'d0=',e,'.length,',e,'d1=',e,'[0].length,'].join(''):[e,'d0=',e,'.shape[0],',e,'d1=',e,'.shape[1],',e,'s0=',e,'.stride[0],',e,'s1=',e,'.stride[1],',e,'o=',e,'.offset,',e,'d=',e,'.data,'].join('')}function Or(e,t,a,r,o,n){var i=[];return'native'===a[1]?e[0]&&(r?i.push('var ',t,'p=',t,'[',r,'];'):i.push('var ',t,'p=',t,'[0];')):r&&o?n?i.push('var ',t,'t0=',t,'s',e[0],',',t,'t1=',t,'s',e[1],'-',t,'s',e[0],'*',n,',',t,'p=',t,'o+',r,'*',t,'s0+',o,'*',t,'s1;'):i.push('var ',t,'t0=',t,'s',e[0],',',t,'p=',t,'o+',r,'*',t,'s0+',o,'*',t,'s1;'):r?i.push('var ',t,'t0=',t,'s',e[0],',',t,'p=',t,'o+',r,'*',t,'s0;'):o?i.push('var ',t,'t0=',t,'s',e[0],',',t,'p=',t,'o+',o,'*',t,'s1;'):i.push('var ',t,'t0=',t,'s',e[0],',',t,'t1=',t,'s',e[1],'-',t,'s',e[0],'*',t,'d',e[0],',',t,'p=',t,'o;'),i}function jr(e,t,a,r,o){var n=[];return'native'===a[1]?e[0]&&1===r&&n.push(t,'p=',t,'[',o,'+1]'):n.push(t,'p+=',t,'t',r,';'),n}function zr(e,t,a,r,o,n){var i=[];return'native'===a[1]?e[0]?i.push(t,'p[',o,']=',n,';'):i.push(t,'[',r,'][',o,']=',n,';'):'generic'===a[1]?i.push(t,'d.set(',t,'p,',n,');'):i.push(t,'d[',t,'p]=',n,';'),i}function Gr(e,t,a,r,o){var n=[];return'native'===a[1]?e[0]?n.push(t,'p[',o,']'):n.push(t,'[',r,'][',o,']'):'generic'===a[1]?n.push(t,'d.get(',t,'p)'):n.push(t,'d[',t,'p]'),n.join('')}function Nr(e,t,a,r,o){var n=[],i='r'===e[0]?[1,0]:[0,1],s=[1,0],u=[0,1],l=['i','j'];return n.push.apply(n,Or(i,'o',e)),i[1]?(n.push('for(j=0;j<od1;++j){'),n.push('for(i=0;i<od0;++i){')):(n.push('for(i=0;i<od0;++i){'),n.push('for(j=0;j<od1;++j){')),n.push.apply(n,Or(s,'a',t,'i')),n.push.apply(n,Or(u,'b',a,void 0,'j')),n.push('var r=0.0;','for(k=0;k<ad1;++k){','r+=',Gr(s,'a',t,'i','k'),'*',Gr(u,'b',a,'k','j'),';'),n.push.apply(n,jr(s,'a',t,0,'k')),n.push.apply(n,jr(u,'b',a,0,'k')),n.push('}'),r&&n.push('r*=A;'),o&&n.push('r+=B*',Gr(i,'o',e,'i','j'),';'),n.push.apply(n,zr(i,'o',e,'i','j','r')),n.push.apply(n,jr(i,'o',e,0,l[1])),n.push('}'),n.push.apply(n,jr(i,'o',e,1,l[0])),n.push('}'),n}function Ur(e,t){var a=[],r='r'===e[0]?[1,0]:[0,1],o;return t&&a.push('if(B!==1.0){'),a.push.apply(a,Or(r,'o',e)),r[0]?(a.push('for(i=0;i<od0;++i){for(j=0;j<od1;++j){'),o=['i','j']):(a.push('for(j=0;j<od1;++j){for(i=0;i<od0;++i){'),o=['j','i']),t?a.push.apply(a,zr(r,'o',e,'i','j','B*'+Gr(r,'o',e,'i','j'))):a.push.apply(a,zr(r,'o',e,'i','j','0')),a.push.apply(a,jr(r,'o',e,0,o[1])),a.push('}'),a.push.apply(a,jr(r,'o',e,1,o[0])),a.push('}'),t&&a.push('}'),a}function qr(e,t,a,r,o){var n=[],s=['od0','od1','ad1'],u=[1,0],l=[1,0],p=[0,1];n.push.apply(n,Ur(e,o));for(var d=0;3>d;++d)n.push('for(var i',d,'=',s[d],';i',d,'>0;){','var w',d,'=',yT,';','if(i',d,'<',yT,'){','w',d,'=i',d,';','i',d,'=0;','}else{','i',d,'-=',yT,';','}');n.push.apply(n,Or(u,'o',e,'i0','i1','w1')),n.push('for(i=0;i<w0;++i){for(j=0;j<w1;++j){var r=0.0;'),n.push.apply(n,Or(l,'a',t,'(i0+i)','i2')),n.push.apply(n,Or(p,'b',a,'i2','(i1+j)')),n.push('for(k=0;k<w2;++k){'),n.push('r+=',Gr(l,'a',t,'(i0+i)','(i2+k)'),'*',Gr(p,'b',a,'(i2+k)','(i1+j)'),';'),n.push.apply(n,jr(l,'a',t,0,'(i2+k)')),n.push.apply(n,jr(p,'b',a,0,'(i2+k)')),n.push('}');var i='r';return r&&(i='A*r'),n.push.apply(n,zr(u,'o',e,'(i0+i)','(i1+j)',i+'+'+Gr(u,'o',e,'(i0+i)','(i1+j)'))),n.push.apply(n,jr(u,'o',e,0,'(i1+j)')),n.push('}'),n.push.apply(n,jr(u,'o',e,1,'(i0+i)')),n.push('}}}}'),n}function Br(e,t,a,r,o){var n=['gemm',e[0],e[1],'a',t[0],t[1],'b',a[0],a[1],r?'alpha':'',o?'beta':''].join(''),i=['function ',n,'(o,a,b,A,B){','var ',Lr('o',e),Lr('a',t),Lr('b',a),'i,j,k;'];'r'===t[0]&&'c'===a[0]?i.push.apply(i,Nr(e,t,a,r,o)):i.push.apply(i,qr(e,t,a,r,o)),i.push('}return ',n);var s=new Function(i.join(''));return s()}function Vr(e){return Array.isArray(e)?[e.length,e[0].length]:e.shape}function Hr(e,t,a){var r=Vr(e),o=Vr(t),n=Vr(a);if(r[0]!==o[0]||r[1]!==n[1]||o[1]!==n[0])throw new Error('Mismatched array shapes for matrix product')}function Wr(e){if(Array.isArray(e)){if(Array.isArray(e))return['r','native'];}else if(e.shape&&2===e.shape.length)return e.order[0]?['r',e.dtype]:['c',e.dtype];throw new Error('Unrecognized data type')}function Xr(e,t,a,r,o){void 0===r&&(r=1),void 0===o&&(o=0);var n=1!==r,i=0!==o,s=Wr(e),u=Wr(t),l=Wr(a);Hr(e,t,a);var p=[s,u,l,n,i].join(':'),d=vT[p];return d||(d=vT[p]=_T(s,u,l,n,i)),d(e,t,a,r,o)}function Yr(e,t){var a,r;if(void 0!==t&&(!Number.isFinite(t)||t%1!==t))throw new Error('axis of dimension to unsqueeze must be an integer');return t=void 0===t?e.shape.length:t,a=e.shape.slice(0),r=e.stride.slice(0),a.splice(t||0,0,1),r.splice(t||0,0,(r[t]||1)*(a[t+1]||1)),PS(e.data,a,r,e.offset)}function $r(e,t,a,r,o){for(var n=nP.dot,s=t.shape[0]-1;0<=s;s--)o.set(s,o.get(s)*r+e*n(t.pick(s,null),a));return!0}function Kr(e,t,a,o,s,u,l){for(var p=0,r=0,i=0,d=0,c=0,g=e.shape[0],h=e.shape[1],n=vn(t,g-1),f=vn(a,h-1),m=void 0===u?1:u,_=void 0===l?0:l;p<=n;){d=0;var y=vn(p+f,h-1);for(i=0;i<=y;i++)d+=e.get(p,i)*o.get(i);s.set(p,d*m+_*s.get(p)),p++}if(p<g)for(r=0;p+f<h;){for(d=0,i=0;i<=n+f;i++)c=r+i+1,d+=e.get(p,c)*o.get(c);if(s.set(p,d*m+_*s.get(p)),p++,r++,p===g)break}if(p<g)for(r++;p-n<h;){for(d=0,i=r;i<h;i++)d+=e.get(p,i)*o.get(i);if(s.set(p,d*m+_*s.get(p)),p++,r++,p===g)break}return!0}function Zr(e,t,a,r,o,s){var u=e.shape[0],n=r||!0,l=o===void 0?1:o,p=s===void 0?0:s,d=0,i=0,c=0,g=0;if(0===p)for(d=0;d<a.shape[0];++d)a.set(d,0);else 1!==p&&nP.scal(p,a);if(0===l)return!0;if(1===l){if(n)for(i=0;i<u;++i){for(c=t.get(i),g=0,a.set(i,a.get(i)+c*e.get(i,i)),d=i+1;d<u;++d)a.set(d,a.get(d)+c*e.get(d,i)),g+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+g)}else for(i=0;i<u;++i){for(c=t.get(i),g=0,d=0;d<=i-1;++d)a.set(d,a.get(d)+c*e.get(d,i)),g+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+c*e.get(i,i)+g)}}else if(n)for(i=0;i<u;++i){for(c=l*t.get(i),g=0,a.set(i,a.get(i)+c*e.get(i,i)),d=i+1;d<u;++d)a.set(d,a.get(d)+c*e.get(d,i)),g+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+l*g)}else for(i=0;i<u;++i){for(c=l*t.get(i),g=0,d=0;d<=i-1;++d)a.set(d,a.get(d)+c*e.get(d,i)),g+=e.get(d,i)*t.get(d);a.set(i,a.get(i)+c*e.get(i,i)+l*g)}return!0}function Qr(){console.error('SBMV (symmetric banded matrix vector multiply) not yet implemented')}function Jr(e,t,a){var r=nP.dot,o=e.shape[1],n=0;if(a)for(n=o-1;0<=n;n--)t.set(n,r(e.pick(n,null).hi(n+1),t.hi(n+1)));else for(n=0;n<o;n++)t.set(n,r(e.pick(n,null).lo(n),t.lo(n)));return!0}function eo(){console.error('TBMV (triangular banded matrix vector multiply) not yet implemented')}function to(e,t,a){var r=nP.dot,o=e.shape[1],n=0;if(a)for(t.set(0,t.get(0)/e.get(0,0)),n=1;n<o;n++)t.set(n,(t.get(n)-r(e.pick(n,null).hi(n),t.hi(n)))/e.get(n,n));else for(t.set(o-1,t.get(o-1)/e.get(o-1,o-1)),n=o-2;0<=n;n--)t.set(n,(t.get(n)-r(e.pick(n,null).lo(n+1),t.lo(n+1)))/e.get(n,n));return!0}function ao(){console.error('TPSV (triangular packed matrix solver) not yet implemented')}function ro(){console.error('GER (rank 1 operation A := alpha*x*y\' + A) not yet implemented')}function oo(){console.error('SYR (symmetric rank 1 operation A := alpha*x*y\' + A) not yet implemented')}function no(){console.error('SPR (symmetric packed rank 1 operation A := alpha*x*y\' + A) not yet implemented')}function io(){console.error('SYR (symmetric rank 2 operation A := alpha*x*y\' + alpha*y*x\' + A) not yet implemented')}function so(){console.error('SPR (symmetric packed rank 2 operation A := alpha*x*y\' + alpha*y*x\' + A) not yet implemented')}function uo(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}function lo(e){var t=32;return e&=-e,e&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}function po(e,t,a){var r=0|e[a];if(0>=r)return[];var o=Array(r),n;if(a===e.length-1)for(n=0;n<r;++n)o[n]=t;else for(n=0;n<r;++n)o[n]=po(e,t,a+1);return o}function co(e,t){var a,r;for(a=Array(e),r=0;r<e;++r)a[r]=t;return a}function go(e,t){switch('undefined'==typeof t&&(t=0),typeof e){case'number':if(0<e)return co(0|e,t);break;case'object':if('number'==typeof e.length)return po(e,t,0);}return[]}function ho(e){var t=e.dtype;('generic'===t||'array'===t)&&(t='double');var a=rw.malloc(e.size,t),r=PS(a,e.shape);return ES.assign(r,e),r}function fo(e,t){t||(t='double');for(var a=1,r=Array(e.length),o=e.length-1;0<=o;--o)r[o]=a,a*=e[o];return PS(rw.malloc(a,t),e,r,0)}function mo(e){'generic'===e.dtype||'array'===e.dtype||rw.free(e.data)}function _o(e,t){t||(t='double');for(var a=1,r=Array(e.length),o=e.length-1;0<=o;--o)r[o]=a,a*=e[o];for(var n=rw.malloc(a,t),o=0;o<a;++o)n[o]=0;return PS(n,e,r,0)}function yo(e,t){t||(t='double');for(var a=1,r=Array(e.length),o=e.length-1;0<=o;--o)r[o]=a,a*=e[o];for(var n=rw.malloc(a,t),o=0;o<a;++o)n[o]=1;return PS(n,e,r,0)}function xo(e,t){var a,r;t||(t='double');var o=1,n=Array(e.length);for(a=e.length-1;0<=a;--a)n[a]=o,o*=e[a];var i=rw.malloc(o,t);for(a=0;a<o;++a)i[a]=0;var s=Infinity,u=0;for(a=e.length-1;0<=a;a--)u+=n[a],s=vn(s,e[a]);for(a=0,r=0;a<s;a++,r+=u)i[r]=1;return PS(i,e,n,0)}function vo(){var e,t,a,r;if(2===arguments.length?(t=arguments[0],r=arguments[1]):3===arguments.length&&(a=arguments[0],t=arguments[1],r=arguments[2]),!Array.isArray(r))throw new Error('second argument of tile must be an array of repetition counts for each dimension');var o=t.shape.slice(0),n=o.slice(0),i=bn(n.length,r.length);for(e=0;e<i;e++)if(o[e]=void 0===o[e]?1:o[e],r[e]=void 0===r[e]?1:r[e],n[e]=(void 0===n[e]?1:n[e])*r[e],0===n[e])throw new Error('Number of tiles must be greater than zero');a||(a=pw.zeros(n,t.dtype));var s=1;for(e=0;e<r.length;e++)s*=r[e];var u=Array(r.length);for(e=0;e<r.length;e++)u[e]=0;var l=n.slice(0);for(c=0;c<n.length;c++)l[c]=c<t.dimension?null:0;for(e=0;e<s;e++){for(c=t.dimension;c<n.length;c++)l[c]=u[c];var p=a.pick.apply(a,l);if(p=p.lo.apply(p,u),p=p.hi.apply(p,t.shape),ES.assign(p,t),e===s-1)break;for(var c=i-1;0<=c&&(u[c]+=o[c],u[c]===n[c]);)u[c]=0,c--}return a}function bo(e,t){if(!t||'object'!=typeof t)return e;for(var a=Object.keys(t),r=a.length;r--;)e[a[r]]=t[a[r]];return e}function So(){var e,t,a,r,o,n,i,s,u,l;if(r=Tw({},ww),0===arguments.length)throw new Error('Array of ndarrays to concatenate must not be empty');if(Array.isArray(arguments[0])?(a=arguments[0],Tw(r,arguments[1]||{})):2===arguments.length&&(a=arguments[1],e=arguments[0],Tw(r,arguments[2]||{})),0===a.length)throw new Error('Array of ndarrays to concatenate must not be empty');for(o=0;o<a.length;o++)if(!i)i=a[o].shape.slice(0);else{if(a[o].dimension!==i.length)throw new Error('all arrays must have the same dimensionality');for(n=1;n<a[o].shape.length;n++)if(a[o].shape[n]!==i[n])throw new Error('last n-1 dimensions of concatenated rows must have the same size');i[0]+=a[o].shape[0]}if(!e)e=pw.zeros(i,r.dtype);else if(i[0]!==e.shape[0])throw new Error('first dimension of output array must match the total number of concatenated rows');for(n=0,s=0;n<a.length;n++)t=a[n],u=t.shape[0],l=e.lo(s).hi(u),ES.assign(l,t),s+=u;return e}function To(e,t){for(var a=Array(arguments.length-1),r=0,o=2,n=!0;o<arguments.length;)a[r++]=arguments[o++];return new Promise(function(o,i){a[r]=function(e){if(n)if(n=!1,e)i(e);else{for(var t=Array(arguments.length-1),a=0;a<t.length;)t[a++]=arguments[a];o.apply(null,t)}};try{e.apply(t||null,a)}catch(e){n&&(n=!1,i(e))}})}function Po(){this._listeners={}}function wo(e){return'undefined'==typeof Float32Array?function(){function t(e,t,a,r){var o=0>t?1:0;if(o&&(t=-t),0===t)e(0<1/t?0:2147483648,a,r);else if(isNaN(t))e(2143289344,a,r);else if(3.4028234663852886e38<t)e((2139095040|o<<31)>>>0,a,r);else if(1.1754943508222875e-38>t)e((o<<31|xn(t/1.401298464324817e-45))>>>0,a,r);else{var n=_n(fn(t)/hn),i=8388607&xn(8388608*(t*Pn(2,-n)));e((o<<31|n+127<<23|i)>>>0,a,r)}}function a(e,t,a){var r=e(t,a),o=2*(r>>31)+1,n=255&r>>>23,i=8388607&r;return 255==n?i?NaN:o*Infinity:0==n?1.401298464324817e-45*o*i:o*Pn(2,n-150)*(i+8388608)}e.writeFloatLE=t.bind(null,Co),e.writeFloatBE=t.bind(null,Fo),e.readFloatLE=a.bind(null,ko),e.readFloatBE=a.bind(null,Eo)}():function(){function t(e,t,a){n[0]=e,t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2],t[a+3]=i[3]}function a(e,t,a){n[0]=e,t[a]=i[3],t[a+1]=i[2],t[a+2]=i[1],t[a+3]=i[0]}function r(e,t){return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],n[0]}function o(e,t){return i[3]=e[t],i[2]=e[t+1],i[1]=e[t+2],i[0]=e[t+3],n[0]}var n=new Float32Array([0]),i=new Uint8Array(n.buffer),s=128===i[3];e.writeFloatLE=s?t:a,e.writeFloatBE=s?a:t,e.readFloatLE=s?r:o,e.readFloatBE=s?o:r}(),'undefined'==typeof Float64Array?function(){function t(e,t,a,r,o,n){var i=0>r?1:0;if(i&&(r=-r),0===r)e(0,o,n+t),e(0<1/r?0:2147483648,o,n+a);else if(isNaN(r))e(0,o,n+t),e(2146959360,o,n+a);else if(1.7976931348623157e308<r)e(0,o,n+t),e((2146435072|i<<31)>>>0,o,n+a);else{var s;if(2.2250738585072014e-308>r)s=r/5e-324,e(s>>>0,o,n+t),e((i<<31|s/4294967296)>>>0,o,n+a);else{var u=_n(fn(r)/hn);1024===u&&(u=1023),s=r*Pn(2,-u),e(4503599627370496*s>>>0,o,n+t),e((i<<31|u+1023<<20|1048575&1048576*s)>>>0,o,n+a)}}}function a(e,t,a,r,o){var n=e(r,o+t),i=e(r,o+a),s=2*(i>>31)+1,u=2047&i>>>20,l=4294967296*(1048575&i)+n;return 2047==u?l?NaN:s*Infinity:0==u?5e-324*s*l:s*Pn(2,u-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,Co,0,4),e.writeDoubleBE=t.bind(null,Fo,4,0),e.readDoubleLE=a.bind(null,ko,0,4),e.readDoubleBE=a.bind(null,Eo,4,0)}():function(){function t(e,t,a){n[0]=e,t[a]=i[0],t[a+1]=i[1],t[a+2]=i[2],t[a+3]=i[3],t[a+4]=i[4],t[a+5]=i[5],t[a+6]=i[6],t[a+7]=i[7]}function a(e,t,a){n[0]=e,t[a]=i[7],t[a+1]=i[6],t[a+2]=i[5],t[a+3]=i[4],t[a+4]=i[3],t[a+5]=i[2],t[a+6]=i[1],t[a+7]=i[0]}function r(e,t){return i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],i[3]=e[t+3],i[4]=e[t+4],i[5]=e[t+5],i[6]=e[t+6],i[7]=e[t+7],n[0]}function o(e,t){return i[7]=e[t],i[6]=e[t+1],i[5]=e[t+2],i[4]=e[t+3],i[3]=e[t+4],i[2]=e[t+5],i[1]=e[t+6],i[0]=e[t+7],n[0]}var n=new Float64Array([0]),i=new Uint8Array(n.buffer),s=128===i[7];e.writeDoubleLE=s?t:a,e.writeDoubleBE=s?a:t,e.readDoubleLE=s?r:o,e.readDoubleBE=s?o:r}(),e}function Co(e,t,a){t[a]=255&e,t[a+1]=255&e>>>8,t[a+2]=255&e>>>16,t[a+3]=e>>>24}function Fo(e,t,a){t[a]=e>>>24,t[a+1]=255&e>>>16,t[a+2]=255&e>>>8,t[a+3]=255&e}function ko(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function Eo(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function Mo(e){try{var t=eval('quire'.replace(/^/,'re'))(e);if(t&&(t.length||Object.keys(t).length))return t}catch(t){}return null}function Do(e,t,a){var r=a||8192,o=null,n=r;return function(a){if(1>a||a>r>>>1)return e(a);n+a>r&&(o=e(r),n=0);var i=t.call(o,n,n+=a);return 7&n&&(n=(7|n)+1),i}}function Io(e,t){this.lo=e>>>0,this.hi=t>>>0}function Ao(e,t,a){this.fn=e,this.len=t,this.next=void 0,this.val=a}function Ro(){}function Lo(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Oo(){this.len=0,this.head=new Ao(Ro,0,0),this.tail=this.head,this.states=null}function jo(e,t,a){t[a]=255&e}function zo(e,t,a){for(;127<e;)t[a++]=128|127&e,e>>>=7;t[a]=e}function Go(e,t){this.len=e,this.next=void 0,this.val=t}function No(e,t,a){for(;e.hi;)t[a++]=128|127&e.lo,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[a++]=128|127&e.lo,e.lo>>>=7;t[a++]=e.lo}function Uo(e,t,a){t[a]=255&e,t[a+1]=255&e>>>8,t[a+2]=255&e>>>16,t[a+3]=e>>>24}function qo(){bC.call(this)}function Bo(e,t,a){40>e.length?vC.utf8.write(e,t,a):t.utf8Write(e,a)}function Vo(e,t){return RangeError('index out of range: '+e.pos+' + '+(t||1)+' > '+e.len)}function Ho(e){this.buf=e,this.pos=0,this.len=e.length}function Wo(){var e=new DC(0,0),t=0;if(4<this.len-this.pos){for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;t=0}else{for(;3>t;++t){if(this.pos>=this.len)throw Vo(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e;}else for(;5>t;++t){if(this.pos>=this.len)throw Vo(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error('invalid varint encoding')}function Xo(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Yo(){if(this.pos+8>this.len)throw Vo(this,8);return new DC(Xo(this.buf,this.pos+=4),Xo(this.buf,this.pos+=4))}function $o(e){MC.call(this,e)}function Ko(e,t,a){if('function'!=typeof e)throw TypeError('rpcImpl must be a function');vC.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!a}function Zo(e){return'number'==typeof e&&WC(e)}function Qo(e){var t=null==e?0:e.length;return t?gb(e,YC):[]}function Jo(e,t){var a=function(e,t,a){return e+(t-e)*a},r=[],o=new Number((e.length-1)/(t-1));r[0]=e[0];for(var n=1;n<t-1;n++){var i=n*o,s=new Number(_n(i)).toFixed(),u=new Number(yn(i)).toFixed();r[n]=a(e[s],e[u],i-s)}return r[t-1]=e[e.length-1],r}function en(e){var t=e.reduce((e,t)=>e+t*t,0),a=Tn(t);return e.map((e)=>e/a)}function tn(t){return tF(this,void 0,void 0,function*(){200>t.values.length&&console.warn('Pattern detector requires atleast 250 data for a reliable prediction, received just ',t.values.length),yield oF.ready(),En.reverseInputs(t);var a=t.values,r=en(Jo(a,400));let o=yield oF.predict({input:new Float32Array(r)});var n=o.output.indexOf(bn(...o.output));return En.reverseInputs(t),{pattern:e.AvailablePatterns[n],patternId:n,probability:100*o.output[n]}})}function an(t){return tF(this,void 0,void 0,function*(){var a=yield tn(t);return a.patternId===e.AvailablePatterns.DB&&75<a.probability})}function rn(t){return tF(this,void 0,void 0,function*(){var a=yield tn(t);return a.patternId===e.AvailablePatterns.DT&&75<a.probability})}function on(t){return tF(this,void 0,void 0,function*(){var a=yield tn(t);return a.patternId===e.AvailablePatterns.HS&&75<a.probability})}function nn(t){return tF(this,void 0,void 0,function*(){var a=yield tn(t);return a.patternId===e.AvailablePatterns.IHS&&75<a.probability})}function sn(t){return tF(this,void 0,void 0,function*(){var a=yield tn(t);return a.patternId===e.AvailablePatterns.TU&&75<a.probability})}function un(t){return tF(this,void 0,void 0,function*(){var a=yield tn(t);return a.patternId===e.AvailablePatterns.TD&&75<a.probability})}function ln(){return['sma','ema','wma','wema','macd','rsi','bollingerbands','adx','atr','truerange','roc','kst','psar','stochastic','williamsr','adl','obv','trix','cci','forceindex','vwap','renko','heikinashi','averagegain','averageloss','sd','bullish','bearish','abandonedbaby','doji','bearishengulfingpattern','bullishengulfingpattern','darkcloudcover','downsidetasukigap','dragonflydoji','gravestonedoji','bullishharami','bearishharami','bullishharamicross','bearishharamicross','eveningdojistar','eveningstar','morningdojistar','morningstar','bullishmarubozu','bearishmarubozu','piercingline','bullishspinningtop','bearishspinningtop','threeblackcrows','threewhitesoldiers','predictPattern','hasDoubleBottom','hasDoubleTop','hasHeadAndShoulder','hasInverseHeadAndShoulder','isTrendingUp','isTrendingDown']}var pn=String.fromCharCode,dn=Math.expm1,cn=Math.exp,gn=Math.sign,hn=Math.LN2,fn=Math.log,mn=String.prototype,_n=Math.floor,yn=Math.ceil,xn=Math.round,vn=Math.min,bn=Math.max,Sn=Math.abs,Tn=Math.sqrt,Pn=Math.pow;class wn{}class Cn{constructor(){this.open=[],this.high=[],this.low=[],this.close=[],this.volume=[],this.timestamp=[]}}let Fn={};class kn{}class En{constructor(e){this.format=e.format||r}static reverseInputs(e){e.reversedInput&&(e.values?e.values.reverse():void 0,e.open?e.open.reverse():void 0,e.high?e.high.reverse():void 0,e.low?e.low.reverse():void 0,e.close?e.close.reverse():void 0,e.volume?e.volume.reverse():void 0,e.timestamp?e.timestamp.reverse():void 0)}getResult(){return this.result}}class Mn{constructor(e,t,a){this.next=a,a&&(a.prev=this),this.prev=t,t&&(t.next=this),this.data=e}}class Dn{constructor(){this._length=0}get head(){return this._head&&this._head.data}get tail(){return this._tail&&this._tail.data}get current(){return this._current&&this._current.data}get length(){return this._length}push(e){this._tail=new Mn(e,this._tail),0===this._length&&(this._head=this._tail,this._current=this._head,this._next=this._head),this._length++}pop(){var e=this._tail;if(0!==this._length)return(this._length--,0===this._length)?(this._head=this._tail=this._current=this._next=void 0,e.data):(this._tail=e.prev,this._tail.next=void 0,this._current===e&&(this._current=this._tail,this._next=void 0),e.data)}shift(){var e=this._head;if(0!==this._length)return(this._length--,0===this._length)?(this._head=this._tail=this._current=this._next=void 0,e.data):(this._head=this._head.next,this._current===e&&(this._current=this._head,this._next=this._current.next),e.data)}unshift(e){this._head=new Mn(e,void 0,this._head),0===this._length&&(this._tail=this._head,this._next=this._head),this._length++}unshiftCurrent(){var e=this._current;return e===this._head||2>this._length?e&&e.data:(e===this._tail?(this._tail=e.prev,this._tail.next=void 0,this._current=this._tail):(e.next.prev=e.prev,e.prev.next=e.next,this._current=e.prev),this._next=this._current.next,e.next=this._head,e.prev=void 0,this._head.prev=e,this._head=e,e.data)}removeCurrent(){var e=this._current;if(0!==this._length)return(this._length--,0===this._length)?(this._head=this._tail=this._current=this._next=void 0,e.data):(e===this._tail?(this._tail=e.prev,this._tail.next=void 0,this._current=this._tail):e===this._head?(this._head=e.next,this._head.prev=void 0,this._current=this._head):(e.next.prev=e.prev,e.prev.next=e.next,this._current=e.prev),this._next=this._current.next,e.data)}resetCursor(){return this._current=this._next=this._head,this}next(){var e=this._next;if(void 0!==e)return this._next=e.next,this._current=e,e.data}}class In extends En{constructor(e){super(e),this.period=e.period,this.price=e.values;this.generator=function*(e){var t=new Dn,a=0,r=1,o=yield,n;for(t.push(0);;)r<e?(r++,t.push(o),a+=o):(a=a-t.shift()+o,n=a/e,t.push(o)),o=yield n}(this.period),this.generator.next(),this.result=[],this.price.forEach((e)=>{var t=this.generator.next(e);t.value!==void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e).value;if(t!=void 0)return this.format(t)}}In.calculate=o;class An extends En{constructor(e){super(e);var t=e.period,a=e.values,r;this.result=[],r=new In({period:t,values:[]});this.generator=function*(){for(var e=yield,a;;)a&&e?(a=(e-a)*(2/(t+1))+a,e=yield a):(e=yield,a=r.nextValue(e),a&&(e=yield a))}(),this.generator.next(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e).value;if(t!=void 0)return this.format(t)}}An.calculate=n;class Rn extends En{constructor(e){super(e);var t=e.period,a=e.values;this.result=[],this.generator=function*(){for(let a=new Dn;;)if(a.length<t)a.push((yield));else{a.resetCursor();let r=0;for(let e=1;e<=t;e++)r+=a.next()*e/(t*(t+1)/2);var e=yield r;a.shift(),a.push(e)}}(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e).value;if(t!=void 0)return this.format(t)}}Rn.calculate=s;class Ln extends En{constructor(e){super(e);var t=e.period,a=e.values,r;this.result=[],r=new In({period:t,values:[]});this.generator=function*(){for(var e=yield,a;;)a&&void 0!=e?(a=(e-a)*(1/t)+a,e=yield a):(e=yield,a=r.nextValue(e),a&&(e=yield a))}(),this.generator.next(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e).value;if(t!=void 0)return this.format(t)}}Ln.calculate=u;class On extends En{constructor(e){super(e);var t=e.SimpleMAOscillator?In:An,a=e.SimpleMASignal?In:An,r=new t({period:e.fastPeriod,values:[],format:(e)=>e}),o=new t({period:e.slowPeriod,values:[],format:(e)=>e}),n=new a({period:e.signalPeriod,values:[],format:(e)=>e}),i=this.format;this.result=[],this.generator=function*(){for(var t=0,a,s,u,l,p,d;;){if(t<e.slowPeriod){a=yield,p=r.nextValue(a),d=o.nextValue(a),t++;continue}p&&d&&(s=p-d,u=n.nextValue(s)),l=s-u,a=yield{MACD:i(s),signal:u?i(u):void 0,histogram:isNaN(l)?void 0:i(l)},p=r.nextValue(a),d=o.nextValue(a)}}(),this.generator.next(),e.values.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(t.value)})}nextValue(e){var t=this.generator.next(e).value;return t}}On.calculate=p;class jn extends En{constructor(e){super(e);let t=e.values,a=e.period,r=this.format;this.generator=function*(e){for(var t=yield,a=1,o=0,n,i,s;;)i=s?t-s:0,i=i?i:0,0<i&&(o+=i),a<e+1?a++:n?n=(n*(e-1)+(0<i?i:0))/e:n=o/e,s=t,n=n?r(n):void 0,t=yield n}(a),this.generator.next(),this.result=[],t.forEach((e)=>{var t=this.generator.next(e);t.value!==void 0&&this.result.push(t.value)})}nextValue(e){return this.generator.next(e).value}}jn.calculate=d;class zn extends En{constructor(e){super(e);let t=e.values,a=e.period,r=this.format;this.generator=function*(e){for(var t=yield,a=1,o=0,n,i,s;;)i=s?s-t:0,i=i?i:0,0<i&&(o+=i),a<e+1?a++:n?n=(n*(e-1)+(0<i?i:0))/e:n=o/e,s=t,n=n?r(n):void 0,t=yield n}(a),this.generator.next(),this.result=[],t.forEach((e)=>{var t=this.generator.next(e);t.value!==void 0&&this.result.push(t.value)})}nextValue(e){return this.generator.next(e).value}}zn.calculate=c;class Gn extends En{constructor(e){super(e);var t=e.period,a=e.values,r=new jn({period:t,values:[]}),o=new zn({period:t,values:[]});let n=1;this.generator=function*(e){for(var t=yield,a,i,s,u;;)a=r.nextValue(t),i=o.nextValue(t),a&&i?0===i?u=100:(s=a/i,u=parseFloat((100-100/(1+s)).toFixed(2))):a&&!i?u=100:i&&!a?u=0:n>=e&&(u=0),n++,t=yield u}(t),this.generator.next(),this.result=[],a.forEach((e)=>{var t=this.generator.next(e);t.value!==void 0&&this.result.push(t.value)})}nextValue(e){return this.generator.next(e).value}}Gn.calculate=g;class Nn extends Dn{constructor(e,t,a){if(super(),this.size=e,this.maintainHigh=t,this.maintainLow=a,this.periodHigh=0,this.periodLow=Infinity,!e||'number'!=typeof e)throw'Size required and should be a number.';this._push=this.push,this.push=function(e){this.add(e)}}add(e){this.length===this.size?(this.lastShift=this.shift(),this._push(e),this.maintainHigh&&this.lastShift==this.periodHigh&&this.calculatePeriodHigh(),this.maintainLow&&this.lastShift==this.periodLow&&this.calculatePeriodLow()):this._push(e),this.maintainHigh&&this.periodHigh<=e&&(this.periodHigh=e),this.maintainLow&&this.periodLow>=e&&(this.periodLow=e)}*iterator(){for(this.resetCursor();this.next();)yield this.current}calculatePeriodHigh(){for(this.resetCursor(),this.next()&&(this.periodHigh=this.current);this.next();)this.periodHigh<=this.current&&(this.periodHigh=this.current)}calculatePeriodLow(){for(this.resetCursor(),this.next()&&(this.periodLow=this.current);this.next();)this.periodLow>=this.current&&(this.periodLow=this.current)}}class Un extends En{constructor(e){super(e);var t=e.period,a=e.values,r=new In({period:t,values:[],format:(e)=>e});this.result=[],this.generator=function*(){var e=new Nn(t),a,o;a=yield;for(var n;;){if(e.push(a),o=r.nextValue(a),o){let a=0;for(let t of e.iterator())a+=Pn(t-o,2);n=Tn(a/t)}a=yield n}}(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0)return this.format(t.value)}}Un.calculate=h;class qn extends En{constructor(e){super(e);var t=e.period,a=e.values,r=e.stdDev,o=this.format,n,i;this.result=[],n=new In({period:t,values:[],format:(e)=>e}),i=new Un({period:t,values:[],format:(e)=>e}),this.generator=function*(){var e,t,a,s;for(t=yield;;){if(a=n.nextValue(t),s=i.nextValue(t),a){let n=o(a),i=o(a+s*r),u=o(a-s*r),l=o((t-u)/(i-u));e={middle:n,upper:i,lower:u,pb:l}}t=yield e}}(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(t.value)})}nextValue(e){return this.generator.next(e).value}}qn.calculate=f;class Bn extends En{constructor(e){super(e),this.period=e.period,this.price=e.values;this.generator=function*(e){for(var t=new Dn,a=0,r=1,o=yield,n=0;;)r<e?(r++,a+=o,n=void 0):r==e?(r++,a+=o,n=a):n=n-n/e+o,o=yield n}(this.period),this.generator.next(),this.result=[],this.price.forEach((e)=>{var t=this.generator.next(e);t.value!=void 0&&this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e).value;if(t!=void 0)return this.format(t)}}Bn.calculate=m;class Vn extends En{constructor(e){super(e);var t=e.low,a=e.high,r=this.format;if(t.length!=a.length)throw'Inputs(low,high) not of equal size';this.result=[],this.generator=function*(){for(var e=yield,t,a;;){if(a){let o=e.high-a.high,n=a.low-e.low;t=r(n>o&&0<n?n:0)}a=e,e=yield t}}(),this.generator.next(),t.forEach((e,r)=>{var o=this.generator.next({high:a[r],low:t[r]});o.value!==void 0&&this.result.push(o.value)})}static calculate(e){En.reverseInputs(e);var t=new Vn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}nextValue(e){return this.generator.next(e).value}}class Hn extends En{constructor(e){super(e);var t=e.low,a=e.high,r=this.format;if(t.length!=a.length)throw'Inputs(low,high) not of equal size';this.result=[],this.generator=function*(){for(var e=yield,t,a;;){if(a){let o=e.high-a.high,n=a.low-e.low;t=r(o>n&&0<o?o:0)}a=e,e=yield t}}(),this.generator.next(),t.forEach((e,r)=>{var o=this.generator.next({high:a[r],low:t[r]});o.value!==void 0&&this.result.push(o.value)})}static calculate(e){En.reverseInputs(e);var t=new Hn(e).result;return e.reversedInput&&t.reverse(),En.reverseInputs(e),t}nextValue(e){return this.generator.next(e).value}}class Wn extends En{constructor(e){super(e);var t=e.low,a=e.high,r=e.close,o=this.format;if(t.length!=a.length)throw'Inputs(low,high) not of equal size';this.result=[],this.generator=function*(){for(var e=yield,t,a;;)void 0==t&&(t=e.close,e=yield a),a=bn(e.high-e.low,isNaN(Sn(e.high-t))?0:Sn(e.high-t),isNaN(Sn(e.low-t))?0:Sn(e.low-t)),t=e.close,void 0!=a&&(a=o(a)),e=yield a}(),this.generator.next(),t.forEach((e,o)=>{var n=this.generator.next({high:a[o],low:t[o],close:r[o]});n.value!=void 0&&this.result.push(n.value)})}nextValue(e){return this.generator.next(e).value}}Wn.calculate=_;class Xn extends kn{}class Yn extends En{constructor(e){super(e);var t=e.low,a=e.high,r=e.close,o=e.period,n=this.format,i=new Hn({high:[],low:[]}),s=new Vn({high:[],low:[]}),u=new Bn({period:o,values:[],format:(e)=>e}),l=new Bn({period:o,values:[],format:(e)=>e}),p=new Bn({period:o,values:[],format:(e)=>e}),d=new Ln({period:o,values:[],format:(e)=>e}),c=new Wn({low:[],high:[],close:[]});if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';this.result=[],Xn,this.generator=function*(){var e=yield,t,a,r,o,n,g,h;for(t=0,a=0,r=0;;){let t=c.nextValue(e),a=i.nextValue(e),r=s.nextValue(e);if(t===void 0){e=yield;continue}let f=p.nextValue(t),m=u.nextValue(a),_=l.nextValue(r);if(f!=void 0&&m!=void 0&&_!=void 0){o=100*m/f,n=100*_/f;let e=Sn(o-n),t=o+n;g=100*(e/t),h=d.nextValue(g)}e=yield{adx:h,pdi:o,mdi:n}}}(),this.generator.next(),t.forEach((e,o)=>{var i=this.generator.next({high:a[o],low:t[o],close:r[o]});i.value!=void 0&&i.value.adx!=void 0&&this.result.push({adx:n(i.value.adx),pdi:n(i.value.pdi),mdi:n(i.value.mdi)})})}nextValue(e){let t=this.generator.next(e).value;if(t!=void 0&&t.adx!=void 0)return{adx:this.format(t.adx),pdi:this.format(t.pdi),mdi:this.format(t.mdi)}}}Yn.calculate=y;class $n extends En{constructor(e){super(e);var t=e.low,a=e.high,r=e.close,o=e.period,n=this.format;if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';var i=new Wn({low:[],high:[],close:[]}),s=new Ln({period:o,values:[],format:(e)=>e});this.result=[],this.generator=function*(){for(var e=yield,t,a;;)a=i.nextValue({low:e.low,high:e.high,close:e.close}),t=void 0===a?void 0:s.nextValue(a),e=yield t}(),this.generator.next(),t.forEach((e,o)=>{var i=this.generator.next({high:a[o],low:t[o],close:r[o]});i.value!==void 0&&this.result.push(n(i.value))})}nextValue(e){return this.generator.next(e).value}}$n.calculate=x;class Kn extends En{constructor(e){super(e);var t=e.period,a=e.values;this.result=[],this.generator=function*(){let e=1;for(var a=new Nn(t),r=yield,o;;)a.push(r),e<t?e++:o=100*((r-a.lastShift)/a.lastShift),r=yield o}(),this.generator.next(),a.forEach((e)=>{var t=this.generator.next(e);t.value==void 0||isNaN(t.value)||this.result.push(this.format(t.value))})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0&&!isNaN(t.value))return this.format(t.value)}}Kn.calculate=v;class Zn extends En{constructor(e){super(e);let t=e.values,a=e.ROCPer1,r=e.ROCPer2,o=e.ROCPer3,n=e.ROCPer4,i=e.SMAROCPer1,s=e.SMAROCPer2,u=e.SMAROCPer3,l=e.SMAROCPer4,p=e.signalPeriod,d=new Kn({period:a,values:[]}),c=new Kn({period:r,values:[]}),g=new Kn({period:o,values:[]}),h=new Kn({period:n,values:[]}),f=new In({period:i,values:[],format:(e)=>e}),m=new In({period:s,values:[],format:(e)=>e}),_=new In({period:u,values:[],format:(e)=>e}),y=new In({period:l,values:[],format:(e)=>e}),x=new In({period:p,values:[],format:(e)=>e});var v=this.format;this.result=[];let b=bn(a+i,r+s,o+u,n+l);this.generator=function*(){for(let e=1,t=yield,a,r,o,n,i,s,u;;){let l=d.nextValue(t),p=c.nextValue(t),S=g.nextValue(t),T=h.nextValue(t);r=l===void 0?void 0:f.nextValue(l),o=p===void 0?void 0:m.nextValue(p),n=S===void 0?void 0:_.nextValue(S),i=T===void 0?void 0:y.nextValue(T),e<b?e++:a=1*r+2*o+3*n+4*i,s=a===void 0?void 0:x.nextValue(a),u=a===void 0?void 0:{kst:v(a),signal:s?v(s):void 0},t=yield u}}(),this.generator.next(),t.forEach((e)=>{let t=this.generator.next(e);t.value!=void 0&&this.result.push(t.value)})}nextValue(e){let t=this.generator.next(e);if(t.value!=void 0)return t.value}}Zn.calculate=b;class Qn extends En{constructor(e){super(e);let t=e.high||[],a=e.low||[];this.result=[],this.generator=function*(e,t){for(let a=!0,r=e,o=yield,n,i,s,u;;)n?(s+=r*(i-s),a?(s=vn(s,u.low,o.low),n.high>i&&(i=n.high,r=vn(r+e,t))):(s=bn(s,u.high,o.high),n.low<i&&(i=n.low,r=vn(r+e,t))),(a&&n.low<s||!a&&n.high>s)&&(r=e,s=i,a=!a,i=a?n.high:n.low)):(s=o.low,i=o.high),u=o,n&&(o=n),n=yield s}(e.step,e.max),this.generator.next(),a.forEach((e,r)=>{var o=this.generator.next({high:t[r],low:a[r]});o.value!==void 0&&this.result.push(o.value)})}nextValue(e){let t=this.generator.next(e);if(t.value!==void 0)return t.value}}Qn.calculate=S;class Jn extends En{constructor(e){super(e);let t=e.low,a=e.high,r=e.close,o=e.period,n=e.signalPeriod,i=this.format;if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';this.result=[],this.generator=function*(){let e=1,t=new Nn(o,!0,!1),a=new Nn(o,!1,!0),r=new In({period:n,values:[],format:(e)=>e}),s,u;for(var l=yield;;){if(t.push(l.high),a.push(l.low),e<o){e++,l=yield;continue}let n=a.periodLow;s=100*((l.close-n)/(t.periodHigh-n)),u=r.nextValue(s),l=yield{k:i(s),d:u?i(u):void 0}}}(),this.generator.next(),t.forEach((e,o)=>{var n=this.generator.next({high:a[o],low:t[o],close:r[o]});n.value!==void 0&&this.result.push(n.value)})}nextValue(e){let t=this.generator.next(e);if(t.value!==void 0)return t.value}}Jn.calculate=T;class ei extends En{constructor(e){super(e);let t=e.low,a=e.high,r=e.close,o=e.period,n=this.format;if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';this.result=[],this.generator=function*(){let e=1,t=new Nn(o,!0,!1),a=new Nn(o,!1,!0),r,i;var s=yield;for(let u;;){if(t.push(s.high),a.push(s.low),e<o){e++,s=yield;continue}r=a.periodLow,i=t.periodHigh,u=n(-100*((i-s.close)/(i-r))),s=yield u}}(),this.generator.next(),t.forEach((e,o)=>{var n=this.generator.next({high:a[o],low:t[o],close:r[o]});n.value!==void 0&&this.result.push(n.value)})}nextValue(e){var t=this.generator.next(e);if(t.value!=void 0)return this.format(t.value)}}ei.calculate=P;class ti extends En{constructor(e){super(e);var t=e.high,a=e.low,r=e.close,o=e.volume;if(a.length!==t.length||t.length!==r.length||t.length!==o.length)throw'Inputs(low,high, close, volumes) not of equal size';this.result=[],this.generator=function*(){var e=0,t;for(t=yield;;){let a=(t.close-t.low-(t.high-t.close))/(t.high-t.low),r=a*t.volume;e+=r,t=yield xn(e)}}(),this.generator.next(),t.forEach((e,t)=>{var n={high:e,low:a[t],close:r[t],volume:o[t]},i=this.generator.next(n);i.value!=void 0&&this.result.push(i.value)})}nextValue(e){return this.generator.next(e).value}}ti.calculate=w;class ai extends En{constructor(e){super(e);var t=e.close,a=e.volume;this.result=[],this.generator=function*(){var e=0,t,a;for(t=yield,t.close&&'number'==typeof t.close&&(a=t.close,t=yield);;)a<t.close?e+=t.volume:t.close<a&&(e-=t.volume),a=t.close,t=yield e}(),this.generator.next(),t.forEach((e,r)=>{let o={close:t[r],volume:a[r]},n=this.generator.next(o);n.value!=void 0&&this.result.push(n.value)})}nextValue(e){return this.generator.next(e).value}}ai.calculate=C;class ri extends En{constructor(e){super(e);let t=e.values,a=e.period,r=this.format,o=new An({period:a,values:[],format:(e)=>e}),n=new An({period:a,values:[],format:(e)=>e}),i=new An({period:a,values:[],format:(e)=>e}),s=new Kn({period:1,values:[],format:(e)=>e});this.result=[],this.generator=function*(){for(let e=yield;;){let t=o.nextValue(e),a=t?n.nextValue(t):void 0,u=a?i.nextValue(a):void 0,l=u?s.nextValue(u):void 0;e=yield l?r(l):void 0}}(),this.generator.next(),t.forEach((e)=>{let t=this.generator.next(e);t.value!==void 0&&this.result.push(t.value)})}nextValue(e){let t=this.generator.next(e);if(t.value!==void 0)return t.value}}ri.calculate=F;class oi extends En{constructor(e){super(e);var t=e.close,a=e.volume,r=e.period||1;if(a.length!==t.length)throw'Inputs(volume, close) not of equal size';let o=new An({values:[],period:r});this.result=[],this.generator=function*(){var e=yield,t=yield;for(let a;;)a=(t.close-e.close)*t.volume,e=t,t=yield o.nextValue(a)}(),this.generator.next(),a.forEach((e,r)=>{var o=this.generator.next({close:t[r],volume:a[r]});o.value!=void 0&&this.result.push(o.value)})}nextValue(e){let t=this.generator.next(e).value;if(t!=void 0)return t}}oi.calculate=k;class ni extends En{constructor(e){super(e);var t=e.low,a=e.high,r=e.close,o=e.period,n=this.format;var i=new Nn(o),s=new In({period:o,values:[],format:(e)=>e});if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';this.result=[],this.generator=function*(){for(var e=yield;;){let t=(e.high+e.low+e.close)/3;i.push(t);let a=s.nextValue(t),r=null,o=0,n;if(a!=void 0){for(let e of i.iterator())o+=Sn(e-a);r=o/20,n=(t-a)/(.015*r)}e=yield n}}(),this.generator.next(),t.forEach((e,o)=>{var n=this.generator.next({high:a[o],low:t[o],close:r[o]});n.value!=void 0&&this.result.push(n.value)})}nextValue(e){let t=this.generator.next(e).value;if(t!=void 0)return t}}ni.calculate=M;class ii extends En{constructor(e){super(e);var t=e.low,a=e.high,r=e.close,o=e.volume,n=this.format;if(t.length!==a.length||a.length!==r.length)throw'Inputs(low,high, close) not of equal size';this.result=[],this.generator=function*(){var e=yield;for(let t=0,a=0;;){let r=(e.high+e.low+e.close)/3,o=e.volume*r;t+=o,a+=e.volume,e=yield t/a}}(),this.generator.next(),t.forEach((e,n)=>{var i=this.generator.next({high:a[n],low:t[n],close:r[n],volume:o[n]});i.value!=void 0&&this.result.push(i.value)})}nextValue(e){let t=this.generator.next(e).value;if(t!=void 0)return t}}ii.calculate=D;class si extends En{constructor(e){super(e);this.format;let t=e.useATR,a=e.brickSize||0;if(t){let t=x(Object.assign({},e));a=t[t.length-1]}if(this.result=new Cn,0===a)return void console.error('Not enough data to calculate brickSize for renko when using ATR');let r=0,o=0,n=Infinity,i=0,s=0,u=0;this.generator=function*(){for(let e=yield;;){if(0==r){r=e.close,o=e.high,n=e.low,i=e.close,s=e.volume,u=e.timestamp,e=yield;continue}let t=Sn(e.close-i),l=Sn(e.close-r);if(t>=a&&l>=a){let u=t>l?r:i,p={open:u,high:o>e.high?o:e.high,low:n<e.Low?n:e.low,close:u>e.close?u-a:u+a,volume:s+e.volume,timestamp:e.timestamp};r=p.open,o=p.close,n=p.close,i=p.close,s=0,e=yield p}else o=o>e.high?o:e.high,n=n<e.Low?n:e.low,s+=e.volume,u=e.timestamp,e=yield}}(),this.generator.next(),e.low.forEach((t,a)=>{var r=this.generator.next({open:e.open[a],high:e.high[a],low:e.low[a],close:e.close[a],volume:e.volume[a],timestamp:e.timestamp[a]});r.value&&(this.result.open.push(r.value.open),this.result.high.push(r.value.high),this.result.low.push(r.value.low),this.result.close.push(r.value.close),this.result.volume.push(r.value.volume),this.result.timestamp.push(r.value.timestamp))})}nextValue(){return console.error('Cannot calculate next value on Renko, Every value has to be recomputed for every change, use calcualte method'),null}}si.calculate=I;class ui extends En{constructor(e){super(e);this.format;this.result=new Cn;let t=null,a=0,r=Infinity,o=0,n=0,i=0;this.generator=function*(){for(let e=yield,s=null;;){if(null==t)t=(e.close+e.open)/2,a=e.high,r=e.low,o=(e.close+e.open+e.high+e.low)/4,n=e.volume||0,i=e.timestamp||0,s={open:t,high:a,low:r,close:o,volume:e.volume||0,timestamp:e.timestamp||0};else{let n=(e.close+e.open+e.high+e.low)/4,i=(t+o)/2,u=bn(i,n,e.high),l=vn(e.low,i,n);s={close:n,open:i,high:u,low:l,volume:e.volume||0,timestamp:e.timestamp||0},o=n,t=i,a=u,r=l}e=yield s}}(),this.generator.next(),e.low.forEach((t,a)=>{var r=this.generator.next({open:e.open[a],high:e.high[a],low:e.low[a],close:e.close[a],volume:e.volume?e.volume[a]:e.volume,timestamp:e.timestamp?e.timestamp[a]:e.timestamp});r.value&&(this.result.open.push(r.value.open),this.result.high.push(r.value.high),this.result.low.push(r.value.low),this.result.close.push(r.value.close),this.result.volume.push(r.value.volume),this.result.timestamp.push(r.value.timestamp))})}nextValue(e){var t=this.generator.next(e).value;return t}}ui.calculate=A;class li{constructor(){}approximateEqual(e,t){let a=1*parseFloat(Sn(e-t).toPrecision(4)),r=1*parseFloat((1e-3*e).toPrecision(4));return a<=r}logic(){throw'this has to be implemented'}getAllPatternIndex(e){if(e.close.length<this.requiredCount)return console.warn('Data count less than data required for the strategy ',this.name),[];e.reversedInput&&(e.open.reverse(),e.high.reverse(),e.low.reverse(),e.close.reverse());let t=this.logic;return this._generateDataForCandleStick(e).map((e,a)=>t.call(this,e)?a:void 0).filter((e)=>e)}hasPattern(e){if(e.close.length<this.requiredCount)return console.warn('Data count less than data required for the strategy ',this.name),!1;e.reversedInput&&(e.open.reverse(),e.high.reverse(),e.low.reverse(),e.close.reverse());let t=this.logic;return t.call(this,this._getLastDataForCandleStick(e))}_getLastDataForCandleStick(e){let t=this.requiredCount;if(e.close.length===t)return e;else{let a={open:[],high:[],low:[],close:[]},r=0,o=e.close.length-t;for(;r<t;)a.open.push(e.open[o+r]),a.high.push(e.high[o+r]),a.low.push(e.low[o+r]),a.close.push(e.close[o+r]),r++;return a}}_generateDataForCandleStick(e){let t=this.requiredCount,a=e.close.map(function(a,r){let o=0,n={open:[],high:[],low:[],close:[]};for(;o<t;)n.open.push(e.open[r+o]),n.high.push(e.high[r+o]),n.low.push(e.low[r+o]),n.close.push(e.close[r+o]),o++;return n}).filter((a,r)=>r<=e.close.length-t);return a}}class pi extends li{constructor(){super(),this.name='MorningStar',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return a<t&&o>u&&o>s&&s<o&&u<o&&l>s&&i<l&&l<p&&p>(t+a)/2}}class di extends li{constructor(){super(),this.name='BullishEngulfingPattern',this.requiredCount=2}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return a<t&&t>n&&a>n&&t<i}}class ci extends li{constructor(){super(),this.requiredCount=2,this.name='BullishHarami'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return t<n&&a>n&&a>i&&t<u&&r>s}}class gi extends li{constructor(){super(),this.requiredCount=2,this.name='BullishHaramiCross'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=this.approximateEqual(n,i);return t<n&&a>n&&a>i&&t<u&&r>s&&l}}class hi extends li{constructor(){super(),this.name='Doji',this.requiredCount=1}logic(e){let t=e.open[0],a=e.close[0];return this.approximateEqual(t,a)}}class fi extends li{constructor(){super(),this.name='MorningDojiStar',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2],g=new hi().hasPattern({open:[n],close:[i],high:[s],low:[u]});return a<t&&g&&l<p&&s<o&&u<o&&l>s&&i<l&&p>(t+a)/2}}class mi extends li{constructor(){super(),this.requiredCount=3,this.name='DownsideTasukiGap'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return a<t&&i<n&&p>l&&s<o&&n>l&&i<l&&p>n&&p<a}}class _i extends li{constructor(){super(),this.name='BullishMarubozu',this.requiredCount=1}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=this.approximateEqual(a,r)&&this.approximateEqual(o,t)&&t<a&&t<r;return n}}class yi extends li{constructor(){super(),this.requiredCount=2,this.name='PiercingLine'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return u<o&&a<t&&o>n&&i>(t+a)/2&&i>n}}class xi extends li{constructor(){super(),this.name='ThreeWhiteSoldiers',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return s>r&&d>s&&t<a&&n<i&&l<p&&a>n&&n<r&&s>l&&l<i}}let vi=[new di,new mi,new ci,new gi,new fi,new pi,new _i,new yi,new xi];class bi extends li{constructor(){super(),this.name='Bullish Candlesticks'}hasPattern(e){return vi.reduce(function(t,a){let r=a.hasPattern(e);return t||r},!1)}}class Si extends li{constructor(){super(),this.name='BearishEngulfingPattern',this.requiredCount=2}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return a>t&&t<n&&a<n&&t>i}}class Ti extends li{constructor(){super(),this.requiredCount=2,this.name='BearishHarami'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return t>n&&a<n&&a<i&&t>u&&r>s}}class Pi extends li{constructor(){super(),this.requiredCount=2,this.name='BearishHaramiCross'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=this.approximateEqual(n,i);return t>n&&a<n&&a<i&&t>u&&r>s&&l}}class wi extends li{constructor(){super(),this.name='EveningDojiStar',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2],g=new hi().hasPattern({open:[n],close:[i],high:[s],low:[u]});return a>t&&g&&s>r&&u>r&&l<u&&i>l&&l>p&&p<(t+a)/2}}class Ci extends li{constructor(){super(),this.name='EveningStar',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return a>t&&r<u&&r<s&&s>r&&u>r&&l<u&&i>l&&l>p&&p<(t+a)/2}}class Fi extends li{constructor(){super(),this.name='BearishMarubozu',this.requiredCount=1}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=this.approximateEqual(t,r)&&this.approximateEqual(o,a)&&t>a&&t>o;return n}}class ki extends li{constructor(){super(),this.name='ThreeBlackCrows',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2];return o>u&&u>c&&t>a&&n>i&&l>p&&t>n&&n>a&&n>l&&l>i}}let Ei=[new Si,new Ti,new Pi,new wi,new Ci,new Fi,new ki];class Mi extends li{constructor(){super(),this.name='Bearish Candlesticks'}hasPattern(e){return Ei.reduce(function(t,a){return t||a.hasPattern(e)},!1)}}class Di extends li{constructor(){super(),this.name='AbandonedBaby',this.requiredCount=3}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1],l=e.open[2],p=e.close[2],d=e.high[2],c=e.low[2],g=new hi().hasPattern({open:[n],close:[i],high:[s],low:[u]});return a<t&&g&&s<o&&c>s&&p>l&&d<t}}class Ii extends li{constructor(){super(),this.name='DarkCloudCover',this.requiredCount=2}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=e.open[1],i=e.close[1],s=e.high[1],u=e.low[1];return a>t&&i<n&&n>r&&i<(a+t)/2&&i>t}}class Ai extends li{constructor(){super(),this.requiredCount=1,this.name='DragonFlyDoji'}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=this.approximateEqual(t,a),n=this.approximateEqual(t,r);return o&&n}}class Ri extends li{constructor(){super(),this.requiredCount=1,this.name='GraveStoneDoji'}logic(e){let t=e.open[0],a=e.close[0],r=e.low[0],o=this.approximateEqual(t,a),n=this.approximateEqual(t,r);return o&&n}}class Li extends li{constructor(){super(),this.name='BullishSpinningTop',this.requiredCount=1}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=Sn(a-t),i=Sn(r-a),s=Sn(t-o);return n<i&&n<s}}class Oi extends li{constructor(){super(),this.name='BearishSpinningTop',this.requiredCount=1}logic(e){let t=e.open[0],a=e.close[0],r=e.high[0],o=e.low[0],n=Sn(a-t),i=Sn(r-t),s=Sn(r-o);return n<i&&n<s}}var ji='undefined'==typeof window?'undefined'==typeof global?'undefined'==typeof self?{}:self:global:window,zi=ue(function(e){var t=e.exports='undefined'!=typeof window&&window.Math==Math?window:'undefined'!=typeof self&&self.Math==Math?self:Function('return this')();'number'==typeof __g&&(__g=t)}),Gi={}.hasOwnProperty,Ni=function(e,t){return Gi.call(e,t)},Ui=function(e){try{return!!e()}catch(t){return!0}},qi=!Ui(function(){return 7!=Object.defineProperty({},'a',{get:function(){return 7}}).a}),Bi=ue(function(e){var t=e.exports={version:'2.4.0'};'number'==typeof __e&&(__e=t)}),Vi=function(e){return'object'==typeof e?null!==e:'function'==typeof e},Hi=function(e){if(!Vi(e))throw TypeError(e+' is not an object!');return e},Wi=zi.document,Xi=Vi(Wi)&&Vi(Wi.createElement),Yi=function(e){return Xi?Wi.createElement(e):{}},$i=!qi&&!Ui(function(){return 7!=Object.defineProperty(Yi('div'),'a',{get:function(){return 7}}).a}),Ki=function(e,t){if(!Vi(e))return e;var a,r;if(t&&'function'==typeof(a=e.toString)&&!Vi(r=a.call(e)))return r;if('function'==typeof(a=e.valueOf)&&!Vi(r=a.call(e)))return r;if(!t&&'function'==typeof(a=e.toString)&&!Vi(r=a.call(e)))return r;throw TypeError('Can\'t convert object to primitive value')},Zi=Object.defineProperty,Qi=qi?Object.defineProperty:function(e,t,a){if(Hi(e),t=Ki(t,!0),Hi(a),$i)try{return Zi(e,t,a)}catch(t){}if('get'in a||'set'in a)throw TypeError('Accessors not supported!');return'value'in a&&(e[t]=a.value),e},Ji={f:Qi},es=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ts=qi?function(e,t,a){return Ji.f(e,t,es(1,a))}:function(e,t,a){return e[t]=a,e},as=0,rs=Math.random(),os=function(e){return'Symbol('.concat(e===void 0?'':e,')_',(++as+rs).toString(36))},ns=ue(function(e){var t=os('src'),a='toString',r=Function[a],o=(''+r).split(a);Bi.inspectSource=function(e){return r.call(e)},(e.exports=function(e,a,r,n){var i='function'==typeof r;i&&(Ni(r,'name')||ts(r,'name',a));e[a]===r||(i&&(Ni(r,t)||ts(r,t,e[a]?''+e[a]:o.join(a+''))),e===zi?e[a]=r:n?e[a]?e[a]=r:ts(e,a,r):(delete e[a],ts(e,a,r)))})(Function.prototype,a,function(){return'function'==typeof this&&this[t]||r.call(this)})}),is=function(e){if('function'!=typeof e)throw TypeError(e+' is not a function!');return e},ss=function(e,t,a){return(is(e),void 0===t)?e:1===a?function(r){return e.call(t,r)}:2===a?function(r,a){return e.call(t,r,a)}:3===a?function(r,a,o){return e.call(t,r,a,o)}:function(){return e.apply(t,arguments)}},us='prototype',ls=function(e,t,a){var r=e&ls.F,o=e&ls.G,n=e&ls.S,i=e&ls.P,s=e&ls.B,u=o?zi:n?zi[t]||(zi[t]={}):(zi[t]||{})[us],l=o?Bi:Bi[t]||(Bi[t]={}),p=l[us]||(l[us]={}),d,c,g,h;for(d in o&&(a=t),a)c=!r&&u&&void 0!==u[d],g=(c?u:a)[d],h=s&&c?ss(g,zi):i&&'function'==typeof g?ss(Function.call,g):g,u&&ns(u,d,g,e&ls.U),l[d]!=g&&ts(l,d,h),i&&p[d]!=g&&(p[d]=g)};zi.core=Bi,ls.F=1,ls.G=2,ls.S=4,ls.P=8,ls.B=16,ls.W=32,ls.U=64,ls.R=128;var ps=ls,ds=ue(function(e){var t=os('meta'),a=Ji.f,r=0,o=Object.isExtensible||function(){return!0},n=!Ui(function(){return o(Object.preventExtensions({}))}),i=function(e){a(e,t,{value:{i:'O'+ ++r,w:{}}})},s=e.exports={KEY:t,NEED:!1,fastKey:function(e,a){if(!Vi(e))return'symbol'==typeof e?e:('string'==typeof e?'S':'P')+e;if(!Ni(e,t)){if(!o(e))return'F';if(!a)return'E';i(e)}return e[t].i},getWeak:function(e,a){if(!Ni(e,t)){if(!o(e))return!0;if(!a)return!1;i(e)}return e[t].w},onFreeze:function(e){return n&&s.NEED&&o(e)&&!Ni(e,t)&&i(e),e}}}),cs='__core-js_shared__',gs=zi[cs]||(zi[cs]={}),hs=function(e){return gs[e]||(gs[e]={})},fs=ue(function(e){var t=hs('wks'),a=zi.Symbol,r='function'==typeof a,o=e.exports=function(e){return t[e]||(t[e]=r&&a[e]||(r?a:os)('Symbol.'+e))};o.store=t}),ms=Ji.f,_s=fs('toStringTag'),ys=function(e,t,a){e&&!Ni(e=a?e:e.prototype,_s)&&ms(e,_s,{configurable:!0,value:t})},xs=fs,vs={f:xs},bs=!1,Ss=Ji.f,Ts=function(e){var t=Bi.Symbol||(Bi.Symbol=zi.Symbol||{});'_'==e.charAt(0)||e in t||Ss(t,e,{value:vs.f(e)})},Ps={}.toString,ws=function(e){return Ps.call(e).slice(8,-1)},Cs=Object('z').propertyIsEnumerable(0)?Object:function(e){return'String'==ws(e)?e.split(''):Object(e)},Fs=function(e){if(e==void 0)throw TypeError('Can\'t call method on  '+e);return e},ks=function(e){return Cs(Fs(e))},Es=yn,Ms=_n,Ds=function(e){return isNaN(e=+e)?0:(0<e?Ms:Es)(e)},Is=vn,As=function(e){return 0<e?Is(Ds(e),9007199254740991):0},Rs=bn,Ls=vn,Os=function(e,t){return e=Ds(e),0>e?Rs(e+t,0):Ls(e,t)},js=function(e){return function(t,a,r){var o=ks(t),n=As(o.length),i=Os(r,n),s;if(e&&a!=a){for(;n>i;)if(s=o[i++],s!=s)return!0;}else for(;n>i;i++)if((e||i in o)&&o[i]===a)return e||i||0;return!e&&-1}},zs=hs('keys'),Gs=function(e){return zs[e]||(zs[e]=os(e))},Ns=js(!1),Us=Gs('IE_PROTO'),qs=function(e,t){var a=ks(e),r=0,o=[],n;for(n in a)n!=Us&&Ni(a,n)&&o.push(n);for(;t.length>r;)Ni(a,n=t[r++])&&(~Ns(o,n)||o.push(n));return o},Bs=['constructor','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','toLocaleString','toString','valueOf'],Vs=Object.keys||function(e){return qs(e,Bs)},Hs=function(e,t){for(var a=ks(e),r=Vs(a),o=r.length,n=0,i;o>n;)if(a[i=r[n++]]===t)return i},Ws=Object.getOwnPropertySymbols,Xs={f:Ws},Ys={}.propertyIsEnumerable,$s={f:Ys},Ks=function(e){var t=Vs(e),a=Xs.f;if(a)for(var r=a(e),o=$s.f,n=0,i;r.length>n;)o.call(e,i=r[n++])&&t.push(i);return t},Zs=Array.isArray||function(e){return'Array'==ws(e)},Qs=qi?Object.defineProperties:function(e,t){Hi(e);for(var a=Vs(t),r=a.length,o=0,n;r>o;)Ji.f(e,n=a[o++],t[n]);return e},Js=zi.document&&document.documentElement,eu=Gs('IE_PROTO'),tu=function(){},au='prototype',ru=function(){var e=Yi('iframe'),t=Bs.length,a='<',r='>',o;for(e.style.display='none',Js.appendChild(e),e.src='javascript:',o=e.contentWindow.document,o.open(),o.write(a+'script'+r+'document.F=Object'+a+'/script'+r),o.close(),ru=o.F;t--;)delete ru[au][Bs[t]];return ru()},ou=Object.create||function(e,t){var a;return null===e?a=ru():(tu[au]=Hi(e),a=new tu,tu[au]=null,a[eu]=e),void 0===t?a:Qs(a,t)},nu=Bs.concat('length','prototype'),iu=Object.getOwnPropertyNames||function(e){return qs(e,nu)},su={f:iu},uu=su.f,lu={}.toString,pu='object'==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],du=function(e){try{return uu(e)}catch(t){return pu.slice()}},cu=function(e){return pu&&'[object Window]'==lu.call(e)?du(e):uu(ks(e))},gu={f:cu},hu=Object.getOwnPropertyDescriptor,fu=qi?hu:function(e,t){if(e=ks(e),t=Ki(t,!0),$i)try{return hu(e,t)}catch(t){}return Ni(e,t)?es(!$s.f.call(e,t),e[t]):void 0},mu={f:fu},_u=ds.KEY,yu=mu.f,xu=Ji.f,vu=gu.f,bu=zi.Symbol,Su=zi.JSON,Tu=Su&&Su.stringify,Pu='prototype',wu=fs('_hidden'),Cu=fs('toPrimitive'),Fu={}.propertyIsEnumerable,ku=hs('symbol-registry'),Eu=hs('symbols'),Mu=hs('op-symbols'),Du=Object[Pu],Iu='function'==typeof bu,Au=zi.QObject,Ru=!Au||!Au[Pu]||!Au[Pu].findChild,Lu=qi&&Ui(function(){return 7!=ou(xu({},'a',{get:function(){return xu(this,'a',{value:7}).a}})).a})?function(e,t,a){var r=yu(Du,t);r&&delete Du[t],xu(e,t,a),r&&e!==Du&&xu(Du,t,r)}:xu,Ou=function(e){var t=Eu[e]=ou(bu[Pu]);return t._k=e,t},ju=Iu&&'symbol'==typeof bu.iterator?function(e){return'symbol'==typeof e}:function(e){return e instanceof bu},zu=function(e,t,a){return e===Du&&zu(Mu,t,a),Hi(e),t=Ki(t,!0),Hi(a),Ni(Eu,t)?(a.enumerable?(Ni(e,wu)&&e[wu][t]&&(e[wu][t]=!1),a=ou(a,{enumerable:es(0,!1)})):(!Ni(e,wu)&&xu(e,wu,es(1,{})),e[wu][t]=!0),Lu(e,t,a)):xu(e,t,a)},Gu=function(e,t){Hi(e);for(var a=Ks(t=ks(t)),r=0,o=a.length,n;o>r;)zu(e,n=a[r++],t[n]);return e},Nu=function(e,t){return t===void 0?ou(e):Gu(ou(e),t)},Uu=function(e){var t=Fu.call(this,e=Ki(e,!0));return this===Du&&Ni(Eu,e)&&!Ni(Mu,e)?!1:t||!Ni(this,e)||!Ni(Eu,e)||Ni(this,wu)&&this[wu][e]?t:!0},qu=function(e,t){if(e=ks(e),t=Ki(t,!0),e!==Du||!Ni(Eu,t)||Ni(Mu,t)){var a=yu(e,t);return a&&Ni(Eu,t)&&!(Ni(e,wu)&&e[wu][t])&&(a.enumerable=!0),a}},Bu=function(e){for(var t=vu(ks(e)),a=[],r=0,o;t.length>r;)Ni(Eu,o=t[r++])||o==wu||o==_u||a.push(o);return a},Vu=function(e){for(var t=e===Du,a=vu(t?Mu:ks(e)),r=[],o=0,n;a.length>o;)Ni(Eu,n=a[o++])&&(!t||Ni(Du,n))&&r.push(Eu[n]);return r};Iu||(bu=function(){if(this instanceof bu)throw TypeError('Symbol is not a constructor!');var e=os(0<arguments.length?arguments[0]:void 0),t=function(a){this===Du&&t.call(Mu,a),Ni(this,wu)&&Ni(this[wu],e)&&(this[wu][e]=!1),Lu(this,e,es(1,a))};return qi&&Ru&&Lu(Du,e,{configurable:!0,set:t}),Ou(e)},ns(bu[Pu],'toString',function(){return this._k}),mu.f=qu,Ji.f=zu,su.f=gu.f=Bu,$s.f=Uu,Xs.f=Vu,qi&&!bs&&ns(Du,'propertyIsEnumerable',Uu,!0),vs.f=function(e){return Ou(fs(e))}),ps(ps.G+ps.W+ps.F*!Iu,{Symbol:bu});for(var Hu=['hasInstance','isConcatSpreadable','iterator','match','replace','search','species','split','toPrimitive','toStringTag','unscopables'],Wu=0;Hu.length>Wu;)fs(Hu[Wu++]);for(var Hu=Vs(fs.store),Wu=0;Hu.length>Wu;)Ts(Hu[Wu++]);ps(ps.S+ps.F*!Iu,'Symbol',{for:function(e){return Ni(ku,e+='')?ku[e]:ku[e]=bu(e)},keyFor:function(e){if(ju(e))return Hs(ku,e);throw TypeError(e+' is not a symbol!')},useSetter:function(){Ru=!0},useSimple:function(){Ru=!1}}),ps(ps.S+ps.F*!Iu,'Object',{create:Nu,defineProperty:zu,defineProperties:Gu,getOwnPropertyDescriptor:qu,getOwnPropertyNames:Bu,getOwnPropertySymbols:Vu}),Su&&ps(ps.S+ps.F*(!Iu||Ui(function(){var e=bu();return'[null]'!=Tu([e])||'{}'!=Tu({a:e})||'{}'!=Tu(Object(e))})),'JSON',{stringify:function(e){if(!(void 0===e||ju(e))){for(var t=[e],a=1,r,o;arguments.length>a;)t.push(arguments[a++]);return r=t[1],'function'==typeof r&&(o=r),(o||!Zs(r))&&(r=function(e,t){if(o&&(t=o.call(this,e,t)),!ju(t))return t}),t[1]=r,Tu.apply(Su,t)}}}),bu[Pu][Cu]||ts(bu[Pu],Cu,bu[Pu].valueOf),ys(bu,'Symbol'),ys(Math,'Math',!0),ys(zi.JSON,'JSON',!0),ps(ps.S,'Object',{create:ou}),ps(ps.S+ps.F*!qi,'Object',{defineProperty:Ji.f}),ps(ps.S+ps.F*!qi,'Object',{defineProperties:Qs});var i=function(e,t){var a=(Bi.Object||{})[e]||Object[e],r={};r[e]=t(a),ps(ps.S+ps.F*Ui(function(){a(1)}),'Object',r)},Xu=mu.f;i('getOwnPropertyDescriptor',function(){return function(e,t){return Xu(ks(e),t)}});var Yu=function(e){return Object(Fs(e))},$u=Gs('IE_PROTO'),Ku=Object.prototype,Zu=Object.getPrototypeOf||function(e){return e=Yu(e),Ni(e,$u)?e[$u]:'function'==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Ku:null};i('getPrototypeOf',function(){return function(e){return Zu(Yu(e))}}),i('keys',function(){return function(e){return Vs(Yu(e))}}),i('getOwnPropertyNames',function(){return gu.f});var Qu=ds.onFreeze;i('freeze',function(e){return function(t){return e&&Vi(t)?e(Qu(t)):t}});var Ju=ds.onFreeze;i('seal',function(e){return function(t){return e&&Vi(t)?e(Ju(t)):t}});var el=ds.onFreeze;i('preventExtensions',function(e){return function(t){return e&&Vi(t)?e(el(t)):t}}),i('isFrozen',function(e){return function(t){return!Vi(t)||!!e&&e(t)}}),i('isSealed',function(e){return function(t){return!Vi(t)||!!e&&e(t)}}),i('isExtensible',function(e){return function(t){return!!Vi(t)&&(!e||e(t))}});var tl=Object.assign,al=!tl||Ui(function(){var e={},t={},a=Symbol(),r='abcdefghijklmnopqrst';return e[a]=7,r.split('').forEach(function(e){t[e]=e}),7!=tl({},e)[a]||Object.keys(tl({},t)).join('')!=r})?function(e){for(var t=Yu(e),a=arguments.length,r=1,o=Xs.f,n=$s.f;a>r;)for(var i=Cs(arguments[r++]),s=o?Vs(i).concat(o(i)):Vs(i),u=s.length,l=0,p;u>l;)n.call(i,p=s[l++])&&(t[p]=i[p]);return t}:tl;ps(ps.S+ps.F,'Object',{assign:al});var rl=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};ps(ps.S,'Object',{is:rl});var ol=function(e,t){if(Hi(e),!Vi(t)&&null!==t)throw TypeError(t+': can\'t set as prototype!')},nl={set:Object.setPrototypeOf||('__proto__'in{}?function(e,t,a){try{a=ss(Function.call,mu.f(Object.prototype,'__proto__').set,2),a(e,[]),t=!(e instanceof Array)}catch(a){t=!0}return function(e,r){return ol(e,r),t?e.__proto__=r:a(e,r),e}}({},!1):void 0),check:ol};ps(ps.S,'Object',{setPrototypeOf:nl.set});var il=fs('toStringTag'),sl='Arguments'==ws(function(){return arguments}()),ul=function(e,t){try{return e[t]}catch(t){}},ll=function(e){var t,a,r;return e===void 0?'Undefined':null===e?'Null':'string'==typeof(a=ul(t=Object(e),il))?a:sl?ws(t):'Object'==(r=ws(t))&&'function'==typeof t.callee?'Arguments':r},pl={};pl[fs('toStringTag')]='z',ns(Object.prototype,'toString',function(){return'[object '+ll(this)+']'},!0);var dl=function(e,t,a){var r=a===void 0;switch(t.length){case 0:return r?e():e.call(a);case 1:return r?e(t[0]):e.call(a,t[0]);case 2:return r?e(t[0],t[1]):e.call(a,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(a,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(a,t[0],t[1],t[2],t[3]);}return e.apply(a,t)},cl=[].slice,gl={},hl=function(e,t,a){if(!(t in gl)){for(var r=[],o=0;o<t;o++)r[o]='a['+o+']';gl[t]=Function('F,a','return new F('+r.join(',')+')')}return gl[t](e,a)},fl=Function.bind||function(e){var t=is(this),a=cl.call(arguments,1),r=function(){var o=a.concat(cl.call(arguments));return this instanceof r?hl(t,o.length,o):dl(t,o,e)};return Vi(t.prototype)&&(r.prototype=t.prototype),r};ps(ps.P,'Function',{bind:fl});var ml=Ji.f,_l=Function.prototype,yl=/^\s*function ([^ (]*)/,xl='name',vl=Object.isExtensible||function(){return!0};xl in _l||qi&&ml(_l,xl,{configurable:!0,get:function(){try{var e=this,t=(''+e).match(yl)[1];return Ni(e,xl)||!vl(e)||ml(e,xl,es(5,t)),t}catch(t){return''}}});var bl=fs('hasInstance'),Sl=Function.prototype;bl in Sl||Ji.f(Sl,bl,{value:function(e){if('function'!=typeof this||!Vi(e))return!1;if(!Vi(this.prototype))return e instanceof this;for(;e=Zu(e);)if(this.prototype===e)return!0;return!1}});var Tl='\t\n\x0B\f\r \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF',Pl='['+Tl+']',wl='\u200B\x85',Cl=/^[	\n\v\f\r   ᠎             　\u2028\u2029﻿][	\n\v\f\r   ᠎             　\u2028\u2029﻿]*/,Fl=/[	\n\v\f\r   ᠎             　\u2028\u2029﻿][	\n\v\f\r   ᠎             　\u2028\u2029﻿]*$/,kl=function(e,t,a){var r={},o=Ui(function(){return!!Tl[e]()||wl[e]()!=wl}),n=r[e]=o?t(El):Tl[e];a&&(r[a]=n),ps(ps.P+ps.F*o,'String',r)},El=kl.trim=function(e,t){return e=Fs(e)+'',1&t&&(e=e.replace(Cl,'')),2&t&&(e=e.replace(Fl,'')),e},Ml=kl,Dl=zi.parseInt,Il=Ml.trim,Al=/^[\-+]?0[xX]/,Rl=8!==Dl(Tl+'08')||22!==Dl(Tl+'0x16')?function(e,t){var a=Il(e+'',3);return Dl(a,t>>>0||(Al.test(a)?16:10))}:Dl;ps(ps.G+ps.F*(parseInt!=Rl),{parseInt:Rl});var Ll=zi.parseFloat,Ol=Ml.trim,jl=1/Ll(Tl+'-0')==-Infinity?Ll:function(e){var t=Ol(e+'',3),a=Ll(t);return 0===a&&'-'==t.charAt(0)?-0:a};ps(ps.G+ps.F*(parseFloat!=jl),{parseFloat:jl});var zl=nl.set,Gl=function(e,t,a){var r=t.constructor,o;return r!==a&&'function'==typeof r&&(o=r.prototype)!==a.prototype&&Vi(o)&&zl&&zl(e,o),e},Nl=su.f,Ul=mu.f,ql=Ji.f,Bl=Ml.trim,Vl='Number',Hl=zi[Vl],Wl=Hl,Xl=Hl.prototype,Yl=ws(ou(Xl))==Vl,$l='trim'in mn,Kl=function(e){var t=Ki(e,!1);if('string'==typeof t&&2<t.length){t=$l?t.trim():Bl(t,3);var a=t.charCodeAt(0),r,o,n;if(43===a||45===a){if(r=t.charCodeAt(2),88===r||120===r)return NaN;}else if(48===a){switch(t.charCodeAt(1)){case 66:case 98:o=2,n=49;break;case 79:case 111:o=8,n=55;break;default:return+t;}for(var s=t.slice(2),u=0,i=s.length,l;u<i;u++)if(l=s.charCodeAt(u),48>l||l>n)return NaN;return parseInt(s,o)}}return+t};if(!Hl(' 0o1')||!Hl('0b1')||Hl('+0x1')){Hl=function(e){var t=1>arguments.length?0:e,a=this;return a instanceof Hl&&(Yl?Ui(function(){Xl.valueOf.call(a)}):ws(a)!=Vl)?Gl(new Wl(Kl(t)),a,Hl):Kl(t)};for(var Zl=qi?Nl(Wl):'MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger'.split(','),Ql=0,j;Zl.length>Ql;Ql++)Ni(Wl,j=Zl[Ql])&&!Ni(Hl,j)&&ql(Hl,j,Ul(Wl,j));Hl.prototype=Xl,Xl.constructor=Hl,ns(zi,Vl,Hl)}var Jl=function(e,t){if('number'!=typeof e&&'Number'!=ws(e))throw TypeError(t);return+e},ep=function(e){var t=Fs(this)+'',a='',r=Ds(e);if(0>r||r==Infinity)throw RangeError('Count can\'t be negative');for(;0<r;(r>>>=1)&&(t+=t))1&r&&(a+=t);return a},tp=1 .toFixed,ap=_n,rp=[0,0,0,0,0,0],op='Number.toFixed: incorrect invocation!',np='0',ip=function(e,t){for(var a=-1,r=t;6>++a;)r+=e*rp[a],rp[a]=r%1e7,r=ap(r/1e7)},sp=function(e){for(var t=6,a=0;0<=--t;)a+=rp[t],rp[t]=ap(a/e),a=1e7*(a%e)},up=function(){for(var e=6,a='';0<=--e;)if(''!=a||0==e||0!==rp[e]){var r=rp[e]+'';a=''==a?r:a+ep.call(np,7-r.length)+r}return a},lp=function(e,t,a){return 0===t?a:1==t%2?lp(e,t-1,a*e):lp(e*e,t/2,a)},pp=function(e){for(var t=0,a=e;4096<=a;)t+=12,a/=4096;for(;2<=a;)t+=1,a/=2;return t};ps(ps.P+ps.F*('0.000'!==8e-5.toFixed(3)||'1'!==0.9.toFixed(0)||'1.25'!==1.255.toFixed(2)||'1000000000000000128'!==1000000000000000100 .toFixed(0)||!Ui(function(){tp.call({})})),'Number',{toFixed:function(t){var a=Jl(this,op),r=Ds(t),o='',n=np,i,s,u,l;if(0>r||20<r)throw RangeError(op);if(a!=a)return'NaN';if(-1e21>=a||1e21<=a)return a+'';if(0>a&&(o='-',a=-a),1e-21<a)if(i=pp(a*lp(2,69,1))-69,s=0>i?a*lp(2,-i,1):a/lp(2,i,1),s*=4503599627370496,i=52-i,0<i){for(ip(0,s),u=r;7<=u;)ip(1e7,0),u-=7;for(ip(lp(10,u,1),0),u=i-1;23<=u;)sp(8388608),u-=23;sp(1<<u),ip(1,1),sp(2),n=up()}else ip(0,s),ip(1<<-i,0),n=up()+ep.call(np,r);return 0<r?(l=n.length,n=o+(l<=r?'0.'+ep.call(np,r-l)+n:n.slice(0,l-r)+'.'+n.slice(l-r))):n=o+n,n}});var dp=1 .toPrecision;ps(ps.P+ps.F*(Ui(function(){return'1'!==dp.call(1,void 0)})||!Ui(function(){dp.call({})})),'Number',{toPrecision:function(e){var t=Jl(this,'Number#toPrecision: incorrect invocation!');return e===void 0?dp.call(t):dp.call(t,e)}}),ps(ps.S,'Number',{EPSILON:2.220446049250313e-16});var cp=zi.isFinite;ps(ps.S,'Number',{isFinite:function(e){return'number'==typeof e&&cp(e)}});var gp=_n,hp=function(e){return!Vi(e)&&isFinite(e)&&gp(e)===e};ps(ps.S,'Number',{isInteger:hp}),ps(ps.S,'Number',{isNaN:function(e){return e!=e}});var fp=Sn;ps(ps.S,'Number',{isSafeInteger:function(e){return hp(e)&&9007199254740991>=fp(e)}}),ps(ps.S,'Number',{MAX_SAFE_INTEGER:9007199254740991}),ps(ps.S,'Number',{MIN_SAFE_INTEGER:-9007199254740991}),ps(ps.S+ps.F*(Number.parseFloat!=jl),'Number',{parseFloat:jl}),ps(ps.S+ps.F*(Number.parseInt!=Rl),'Number',{parseInt:Rl});var mp=Math.log1p||function(e){return-1e-8<(e=+e)&&1e-8>e?e-e*e/2:fn(1+e)},_p=Tn,yp=Math.acosh;ps(ps.S+ps.F*!(yp&&710==_n(yp(Number.MAX_VALUE))&&yp(Infinity)==Infinity),'Math',{acosh:function(e){return 1>(e=+e)?NaN:94906265.62425156<e?fn(e)+hn:mp(e-1+_p(e-1)*_p(e+1))}});var xp=Math.asinh;ps(ps.S+ps.F*!(xp&&0<1/xp(0)),'Math',{asinh:le});var vp=Math.atanh;ps(ps.S+ps.F*!(vp&&0>1/vp(-0)),'Math',{atanh:function(e){return 0==(e=+e)?e:fn((1+e)/(1-e))/2}});var bp=gn||function(e){return 0==(e=+e)||e!=e?e:0>e?-1:1};ps(ps.S,'Math',{cbrt:function(e){return bp(e=+e)*Pn(Sn(e),1/3)}}),ps(ps.S,'Math',{clz32:function(e){return(e>>>=0)?31-_n(fn(e+0.5)*Math.LOG2E):32}});var Sp=cn;ps(ps.S,'Math',{cosh:function(e){return(Sp(e=+e)+Sp(-e))/2}});var Tp=dn,Pp=!Tp||22025.465794806718<Tp(10)||22025.465794806718>Tp(10)||-2e-17!=Tp(-2e-17)?function(e){return 0==(e=+e)?e:-1e-6<e&&1e-6>e?e+e*e/2:cn(e)-1}:Tp;ps(ps.S+ps.F*(Pp!=dn),'Math',{expm1:Pp});var wp=Pn,Cp=wp(2,-52),Fp=wp(2,-23),kp=wp(2,127)*(2-Fp),Ep=wp(2,-126),Mp=function(e){return e+1/Cp-1/Cp};ps(ps.S,'Math',{fround:function(e){var t=Sn(e),r=bp(e),o,a;return t<Ep?r*Mp(t/Ep/Fp)*Ep*Fp:(o=(1+Fp/Cp)*t,a=o-(o-t),a>kp||a!=a?r*Infinity:r*a)}});var Dp=Sn;ps(ps.S,'Math',{hypot:function(){for(var e=0,t=0,a=arguments.length,r=0,o,n;t<a;)o=Dp(arguments[t++]),r<o?(n=r/o,e=e*n*n+1,r=o):0<o?(n=o/r,e+=n*n):e+=o;return r==Infinity?Infinity:r*Tn(e)}});var Ip=Math.imul;ps(ps.S+ps.F*Ui(function(){return-5!=Ip(4294967295,5)||2!=Ip.length}),'Math',{imul:function(e,t){var a=65535,r=+e,o=+t,n=a&r,i=a&o;return 0|n*i+((a&r>>>16)*i+n*(a&o>>>16)<<16>>>0)}}),ps(ps.S,'Math',{log10:function(e){return fn(e)/Math.LN10}}),ps(ps.S,'Math',{log1p:mp}),ps(ps.S,'Math',{log2:function(e){return fn(e)/hn}}),ps(ps.S,'Math',{sign:bp});var Ap=cn;ps(ps.S+ps.F*Ui(function(){return!0}),'Math',{sinh:function(e){return 1>Sn(e=+e)?(Pp(e)-Pp(-e))/2:(Ap(e-1)-Ap(-e-1))*(Math.E/2)}});var Rp=cn;ps(ps.S,'Math',{tanh:function(e){var t=Pp(e=+e),a=Pp(-e);return t==Infinity?1:a==Infinity?-1:(t-a)/(Rp(e)+Rp(-e))}}),ps(ps.S,'Math',{trunc:function(e){return(0<e?_n:yn)(e)}});var Lp=pn,Op=String.fromCodePoint;ps(ps.S+ps.F*(!!Op&&1!=Op.length),'String',{fromCodePoint:function(){for(var e=[],t=arguments.length,a=0,r;t>a;){if(r=+arguments[a++],Os(r,1114111)!==r)throw RangeError(r+' is not a valid code point');e.push(65536>r?Lp(r):Lp(((r-=65536)>>10)+55296,r%1024+56320))}return e.join('')}}),ps(ps.S,'String',{raw:function(e){for(var t=ks(e.raw),a=As(t.length),r=arguments.length,o=[],n=0;a>n;)o.push(t[n++]+''),n<r&&o.push(arguments[n]+'');return o.join('')}}),Ml('trim',function(e){return function(){return e(this,3)}});var jp=function(e){return function(t,r){var o=Fs(t)+'',n=Ds(r),i=o.length,s,a;return 0>n||n>=i?e?'':void 0:(s=o.charCodeAt(n),55296>s||56319<s||n+1===i||56320>(a=o.charCodeAt(n+1))||57343<a?e?o.charAt(n):s:e?o.slice(n,n+2):(s-55296<<10)+(a-56320)+65536)}},zp={},Gp={};ts(Gp,fs('iterator'),function(){return this});var Np=function(e,t,a){e.prototype=ou(Gp,{next:es(1,a)}),ys(e,t+' Iterator')},Up=fs('iterator'),qp=!([].keys&&'next'in[].keys()),Bp='@@iterator',Vp='keys',Hp='values',Wp=function(){return this},Xp=function(e,t,a,r,o,n,i){Np(a,t,r);var s=function(e){return!qp&&e in d?d[e]:e===Vp?function(){return new a(this,e)}:e===Hp?function(){return new a(this,e)}:function(){return new a(this,e)}},u=t+' Iterator',l=o==Hp,p=!1,d=e.prototype,c=d[Up]||d[Bp]||o&&d[o],g=c||s(o),h=o?l?s('entries'):g:void 0,f='Array'==t?d.entries||c:c,m,_,y;if(f&&(y=Zu(f.call(new e)),y!==Object.prototype&&(ys(y,u,!0),!Ni(y,Up)&&ts(y,Up,Wp))),l&&c&&c.name!==Hp&&(p=!0,g=function(){return c.call(this)}),(qp||p||!d[Up])&&ts(d,Up,g),zp[t]=g,zp[u]=Wp,o)if(m={values:l?g:s(Hp),keys:n?g:s(Vp),entries:h},i)for(_ in m)_ in d||ns(d,_,m[_]);else ps(ps.P+ps.F*(qp||p),t,m);return m},Yp=jp(!0);Xp(String,'String',function(e){this._t=e+'',this._i=0},function(){var e=this._t,t=this._i,a;return t>=e.length?{value:void 0,done:!0}:(a=Yp(e,t),this._i+=a.length,{value:a,done:!1})});var $p=jp(!1);ps(ps.P,'String',{codePointAt:function(e){return $p(this,e)}});var Kp=fs('match'),Zp=function(e){var t;return Vi(e)&&((t=e[Kp])===void 0?'RegExp'==ws(e):!!t)},Qp=function(e,t,a){if(Zp(t))throw TypeError('String#'+a+' doesn\'t accept regex!');return Fs(e)+''},Jp=fs('match'),ed=function(e){var t=/./;try{'/./'[e](t)}catch(a){try{return t[Jp]=!1,!'/./'[e](t)}catch(e){}}return!0},td='endsWith',ad=''[td];ps(ps.P+ps.F*ed(td),'String',{endsWith:function(e){var t=Qp(this,e,td),a=1<arguments.length?arguments[1]:void 0,r=As(t.length),o=a===void 0?r:vn(As(a),r),n=e+'';return t.slice(o-n.length,o)===n}});var rd='includes';ps(ps.P+ps.F*ed(rd),'String',{includes:function(e){return!!~Qp(this,e,rd).indexOf(e,1<arguments.length?arguments[1]:void 0)}}),ps(ps.P,'String',{repeat:ep});var od='startsWith',nd=''[od];ps(ps.P+ps.F*ed(od),'String',{startsWith:function(e){var t=Qp(this,e,od),a=As(vn(1<arguments.length?arguments[1]:void 0,t.length)),r=e+'';return t.slice(a,a+r.length)===r}});var id=/"/g,sd=function(e,t,a,r){var o=Fs(e)+'',n='<'+t;return''!==a&&(n+=' '+a+'="'+(r+'').replace(id,'&quot;')+'"'),n+'>'+o+'</'+t+'>'},ud=function(e,t){var a={};a[e]=t(sd),ps(ps.P+ps.F*Ui(function(){var t=''[e]('"');return t!==t.toLowerCase()||3<t.split('"').length}),'String',a)};ud('anchor',function(e){return function(t){return e(this,'a','name',t)}}),ud('big',function(e){return function(){return e(this,'big','','')}}),ud('blink',function(e){return function(){return e(this,'blink','','')}}),ud('bold',function(e){return function(){return e(this,'b','','')}}),ud('fixed',function(e){return function(){return e(this,'tt','','')}}),ud('fontcolor',function(e){return function(t){return e(this,'font','color',t)}}),ud('fontsize',function(e){return function(t){return e(this,'font','size',t)}}),ud('italics',function(e){return function(){return e(this,'i','','')}}),ud('link',function(e){return function(t){return e(this,'a','href',t)}}),ud('small',function(e){return function(){return e(this,'small','','')}}),ud('strike',function(e){return function(){return e(this,'strike','','')}}),ud('sub',function(e){return function(){return e(this,'sub','','')}}),ud('sup',function(e){return function(){return e(this,'sup','','')}}),ps(ps.S,'Date',{now:function(){return new Date().getTime()}}),ps(ps.P+ps.F*Ui(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),'Date',{toJSON:function(){var e=Yu(this),t=Ki(e);return'number'!=typeof t||isFinite(t)?e.toISOString():null}});var ld=Date.prototype.getTime,pd=function(e){return 9<e?e:'0'+e};ps(ps.P+ps.F*(Ui(function(){return'0385-07-25T07:06:39.999Z'!=new Date(-50000000000001).toISOString()})||!Ui(function(){new Date(NaN).toISOString()})),'Date',{toISOString:function(){if(!isFinite(ld.call(this)))throw RangeError('Invalid time value');var e=this,t=e.getUTCFullYear(),a=e.getUTCMilliseconds(),r=0>t?'-':9999<t?'+':'';return r+('00000'+Sn(t)).slice(r?-6:-4)+'-'+pd(e.getUTCMonth()+1)+'-'+pd(e.getUTCDate())+'T'+pd(e.getUTCHours())+':'+pd(e.getUTCMinutes())+':'+pd(e.getUTCSeconds())+'.'+(99<a?a:'0'+pd(a))+'Z'}});var dd=Date.prototype,cd='Invalid Date',gd='toString',hd=dd[gd],fd=dd.getTime;new Date(NaN)+''!=cd&&ns(dd,gd,function(){var e=fd.call(this);return e===e?hd.call(this):cd});var md='number',_d=function(e){if('string'!==e&&e!==md&&'default'!==e)throw TypeError('Incorrect hint');return Ki(Hi(this),e!=md)},yd=fs('toPrimitive'),xd=Date.prototype;yd in xd||ts(xd,yd,_d),ps(ps.S,'Array',{isArray:Zs});var vd=function(t,e,a,r){try{return r?e(Hi(a)[0],a[1]):e(a)}catch(a){var o=t['return'];throw void 0!==o&&Hi(o.call(t)),a}},bd=fs('iterator'),Sd=Array.prototype,Td=function(e){return e!==void 0&&(zp.Array===e||Sd[bd]===e)},Pd=function(e,t,a){t in e?Ji.f(e,t,es(0,a)):e[t]=a},wd=fs('iterator'),Cd=Bi.getIteratorMethod=function(e){if(e!=void 0)return e[wd]||e['@@iterator']||zp[ll(e)]},Fd=fs('iterator'),kd=!1;try{var Ed=[7][Fd]();Ed['return']=function(){kd=!0},Array.from(Ed,function(){throw 2})}catch(t){}var Md=function(e,t){if(!t&&!kd)return!1;var a=!1;try{var r=[7],o=r[Fd]();o.next=function(){return{done:a=!0}},r[Fd]=function(){return o},e(r)}catch(t){}return a};ps(ps.S+ps.F*!Md(function(e){Array.from(e)}),'Array',{from:function(e){var t=Yu(e),a='function'==typeof this?this:Array,r=arguments.length,o=1<r?arguments[1]:void 0,n=void 0!==o,i=0,s=Cd(t),u,l,p,d;if(n&&(o=ss(o,2<r?arguments[2]:void 0,2)),void 0!=s&&!(a==Array&&Td(s)))for(d=s.call(t),l=new a;!(p=d.next()).done;i++)Pd(l,i,n?vd(d,o,[p.value,i],!0):p.value);else for(u=As(t.length),l=new a(u);u>i;i++)Pd(l,i,n?o(t[i],i):t[i]);return l.length=i,l}}),ps(ps.S+ps.F*Ui(function(){function e(){}return!(Array.of.call(e)instanceof e)}),'Array',{of:function(){for(var e=0,t=arguments.length,a=new('function'==typeof this?this:Array)(t);t>e;)Pd(a,e,arguments[e++]);return a.length=t,a}});var Dd=function(e,t){return!!e&&Ui(function(){t?e.call(null,function(){},1):e.call(null)})},Id=[].join;ps(ps.P+ps.F*(Cs!=Object||!Dd(Id)),'Array',{join:function(e){return Id.call(ks(this),e===void 0?',':e)}});var Ad=[].slice;ps(ps.P+ps.F*Ui(function(){Js&&Ad.call(Js)}),'Array',{slice:function(e,t){var a=As(this.length),r=ws(this);if(t=void 0===t?a:t,'Array'==r)return Ad.call(this,e,t);for(var o=Os(e,a),n=Os(t,a),s=As(n-o),u=Array(s),l=0;l<s;l++)u[l]='String'==r?this.charAt(o+l):this[o+l];return u}});var Rd=[].sort,Ld=[1,2,3];ps(ps.P+ps.F*(Ui(function(){Ld.sort(void 0)})||!Ui(function(){Ld.sort(null)})||!Dd(Rd)),'Array',{sort:function(e){return e===void 0?Rd.call(Yu(this)):Rd.call(Yu(this),is(e))}});var Od=fs('species'),jd=function(e){var t;return Zs(e)&&(t=e.constructor,'function'==typeof t&&(t===Array||Zs(t.prototype))&&(t=void 0),Vi(t)&&(t=t[Od],null===t&&(t=void 0))),void 0===t?Array:t},zd=function(e,t){return new(jd(e))(t)},Gd=function(e,t){var a=1==e,r=4==e,o=6==e,n=t||zd;return function(t,i,s){for(var u=Yu(t),l=Cs(u),p=ss(i,s,3),d=As(l.length),c=0,g=a?n(t,d):2==e?n(t,0):void 0,h,f;d>c;c++)if((5==e||o||c in l)&&(h=l[c],f=p(h,c,u),e))if(a)g[c]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return c;case 2:g.push(h);}else if(r)return!1;return o?-1:3==e||r?r:g}},Nd=Gd(0),Ud=Dd([].forEach,!0);ps(ps.P+ps.F*!Ud,'Array',{forEach:function(e){return Nd(this,e,arguments[1])}});var qd=Gd(1);ps(ps.P+ps.F*!Dd([].map,!0),'Array',{map:function(e){return qd(this,e,arguments[1])}});var Bd=Gd(2);ps(ps.P+ps.F*!Dd([].filter,!0),'Array',{filter:function(e){return Bd(this,e,arguments[1])}});var Vd=Gd(3);ps(ps.P+ps.F*!Dd([].some,!0),'Array',{some:function(e){return Vd(this,e,arguments[1])}});var Hd=Gd(4);ps(ps.P+ps.F*!Dd([].every,!0),'Array',{every:function(e){return Hd(this,e,arguments[1])}});var Wd=function(e,t,a,r,o){is(t);var n=Yu(e),s=Cs(n),u=As(n.length),l=o?u-1:0,p=o?-1:1;if(2>a)for(;;){if(l in s){r=s[l],l+=p;break}if(l+=p,o?0>l:u<=l)throw TypeError('Reduce of empty array with no initial value')}for(;o?0<=l:u>l;l+=p)l in s&&(r=t(r,s[l],l,n));return r};ps(ps.P+ps.F*!Dd([].reduce,!0),'Array',{reduce:function(e){return Wd(this,e,arguments.length,arguments[1],!1)}}),ps(ps.P+ps.F*!Dd([].reduceRight,!0),'Array',{reduceRight:function(e){return Wd(this,e,arguments.length,arguments[1],!0)}});var Xd=js(!1),Yd=[].indexOf,$d=!!Yd&&0>1/[1].indexOf(1,-0);ps(ps.P+ps.F*($d||!Dd(Yd)),'Array',{indexOf:function(e){return $d?Yd.apply(this,arguments)||0:Xd(this,e,arguments[1])}});var Kd=[].lastIndexOf,Zd=!!Kd&&0>1/[1].lastIndexOf(1,-0);ps(ps.P+ps.F*(Zd||!Dd(Kd)),'Array',{lastIndexOf:function(e){if(Zd)return Kd.apply(this,arguments)||0;var t=ks(this),a=As(t.length),r=a-1;for(1<arguments.length&&(r=vn(r,Ds(arguments[1]))),0>r&&(r=a+r);0<=r;r--)if(r in t&&t[r]===e)return r||0;return-1}});var Qd=[].copyWithin||function(e,t){var a=Yu(this),r=As(a.length),o=Os(e,r),n=Os(t,r),i=2<arguments.length?arguments[2]:void 0,s=vn((i===void 0?r:Os(i,r))-n,r-o),u=1;for(n<o&&o<n+s&&(u=-1,n+=s-1,o+=s-1);0<s--;)n in a?a[o]=a[n]:delete a[o],o+=u,n+=u;return a},Jd=fs('unscopables'),ec=Array.prototype;ec[Jd]==void 0&&ts(ec,Jd,{});var tc=function(e){ec[Jd][e]=!0};ps(ps.P,'Array',{copyWithin:Qd}),tc('copyWithin');var ac=function(e){for(var t=Yu(this),a=As(t.length),r=arguments.length,o=Os(1<r?arguments[1]:void 0,a),n=2<r?arguments[2]:void 0,i=void 0===n?a:Os(n,a);i>o;)t[o++]=e;return t};ps(ps.P,'Array',{fill:ac}),tc('fill');var rc=Gd(5),oc='find',nc=!0;oc in[]&&[,][oc](function(){nc=!1}),ps(ps.P+ps.F*nc,'Array',{find:function(e){return rc(this,e,1<arguments.length?arguments[1]:void 0)}}),tc(oc);var ic=Gd(6),sc='findIndex',uc=!0;sc in[]&&[,][sc](function(){uc=!1}),ps(ps.P+ps.F*uc,'Array',{findIndex:function(e){return ic(this,e,1<arguments.length?arguments[1]:void 0)}}),tc(sc);var lc=fs('species'),pc=function(e){var t=zi[e];qi&&t&&!t[lc]&&Ji.f(t,lc,{configurable:!0,get:function(){return this}})};pc('Array');var dc=function(e,t){return{value:t,done:!!e}},cc=Xp(Array,'Array',function(e,t){this._t=ks(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,a=this._i++;return!e||a>=e.length?(this._t=void 0,dc(1)):'keys'==t?dc(0,a):'values'==t?dc(0,e[a]):dc(0,[a,e[a]])},'values');zp.Arguments=zp.Array,tc('keys'),tc('values'),tc('entries');var gc=function(){var e=Hi(this),t='';return e.global&&(t+='g'),e.ignoreCase&&(t+='i'),e.multiline&&(t+='m'),e.unicode&&(t+='u'),e.sticky&&(t+='y'),t},hc=Ji.f,fc=su.f,mc=zi.RegExp,_c=mc,yc=mc.prototype,xc=/a/g,vc=/a/g,bc=new mc(xc)!==xc;if(qi&&(!bc||Ui(function(){return vc[fs('match')]=!1,mc(xc)!=xc||mc(vc)==vc||'/a/i'!=mc(xc,'i')}))){mc=function(e,t){var a=this instanceof mc,r=Zp(e),o=t===void 0;return!a&&r&&e.constructor===mc&&o?e:Gl(bc?new _c(r&&!o?e.source:e,t):_c((r=e instanceof mc)?e.source:e,r&&o?gc.call(e):t),a?this:yc,mc)};for(var Sc=function(e){(e in mc)||hc(mc,e,{configurable:!0,get:function(){return _c[e]},set:function(t){_c[e]=t}})},Tc=fc(_c),Pc=0;Tc.length>Pc;)Sc(Tc[Pc++]);yc.constructor=mc,mc.prototype=yc,ns(zi,'RegExp',mc)}pc('RegExp'),qi&&'g'!=/./g.flags&&Ji.f(RegExp.prototype,'flags',{configurable:!0,get:gc});var wc='toString',Cc=/./[wc],Fc=function(e){ns(RegExp.prototype,wc,e,!0)};Ui(function(){return'/a/b'!=Cc.call({source:'a',flags:'b'})})?Fc(function(){var e=Hi(this);return'/'.concat(e.source,'/','flags'in e?e.flags:!qi&&e instanceof RegExp?gc.call(e):void 0)}):Cc.name!=wc&&Fc(function(){return Cc.call(this)});var kc=function(e,t,a){var r=fs(e),o=a(Fs,r,''[e]),n=o[0],i=o[1];Ui(function(){var t={};return t[r]=function(){return 7},7!=''[e](t)})&&(ns(String.prototype,e,n),ts(RegExp.prototype,r,2==t?function(e,t){return i.call(e,this,t)}:function(e){return i.call(e,this)}))};kc('match',1,function(e,t,a){return[function(a){var r=e(this),o=a==void 0?void 0:a[t];return o===void 0?new RegExp(a)[t](r+''):o.call(a,r)},a]}),kc('replace',2,function(e,t,a){return[function(r,o){var n=e(this),i=r==void 0?void 0:r[t];return i===void 0?a.call(n+'',r,o):i.call(r,n,o)},a]}),kc('search',1,function(e,t,a){return[function(a){var r=e(this),o=a==void 0?void 0:a[t];return o===void 0?new RegExp(a)[t](r+''):o.call(a,r)},a]}),kc('split',2,function(e,t,a){var r=a,o=[].push,n='split',s='length',u='lastIndex';if('c'=='abbc'[n](/(b)*/)[1]||4!='test'[n](/(?:)/,-1)[s]||2!='ab'[n](/(?:ab)*/)[s]||4!='.'[n](/(.?)(.?)/)[s]||1<'.'[n](/()()/)[s]||''[n](/.?/)[s]){var l=/()??/.exec('')[1]===void 0;a=function(e,t){var a=this+'';if(void 0===e&&0===t)return[];if(!Zp(e))return r.call(a,e,t);var n=[],p=(e.ignoreCase?'i':'')+(e.multiline?'m':'')+(e.unicode?'u':'')+(e.sticky?'y':''),d=0,c=void 0===t?4294967295:t>>>0,g=new RegExp(e.source,p+'g'),h,f,m,_,y;for(l||(h=new RegExp('^'+g.source+'$(?!\\s)',p));(f=g.exec(a))&&(m=f.index+f[0][s],!(m>d&&(n.push(a.slice(d,f.index)),!l&&1<f[s]&&f[0].replace(h,function(){for(y=1;y<arguments[s]-2;y++)void 0===arguments[y]&&(f[y]=void 0)}),1<f[s]&&f.index<a[s]&&o.apply(n,f.slice(1)),_=f[0][s],d=m,n[s]>=c)));)g[u]===f.index&&g[u]++;return d===a[s]?(_||!g.test(''))&&n.push(''):n.push(a.slice(d)),n[s]>c?n.slice(0,c):n}}else'0'[n](void 0,0)[s]&&(a=function(e,t){return void 0===e&&0===t?[]:r.call(this,e,t)});return[function(r,o){var n=e(this),i=r==void 0?void 0:r[t];return i===void 0?a.call(n+'',r,o):i.call(r,n,o)},a]});var Ec=function(e,t,a,r){if(!(e instanceof t)||r!==void 0&&r in e)throw TypeError(a+': incorrect invocation!');return e},Mc=ue(function(e){var t={},a={},r=e.exports=function(e,r,o,n,i){var s=i?function(){return e}:Cd(e),u=ss(o,n,r?2:1),l=0,p,d,c,g;if('function'!=typeof s)throw TypeError(e+' is not iterable!');if(Td(s)){for(p=As(e.length);p>l;l++)if(g=r?u(Hi(d=e[l])[0],d[1]):u(e[l]),g===t||g===a)return g;}else for(c=s.call(e);!(d=c.next()).done;)if(g=vd(c,u,d.value,r),g===t||g===a)return g};r.BREAK=t,r.RETURN=a}),Dc=fs('species'),Ic=function(e,t){var a=Hi(e).constructor,r;return a===void 0||(r=Hi(a)[Dc])==void 0?t:is(r)},Ac=zi.process,Rc=zi.setImmediate,Lc=zi.clearImmediate,Oc=zi.MessageChannel,jc=0,zc={},Gc='onreadystatechange',Nc=function(){var e=+this;if(zc.hasOwnProperty(e)){var t=zc[e];delete zc[e],t()}},Uc=function(e){Nc.call(e.data)},qc,Bc,Vc;Rc&&Lc||(Rc=function(e){for(var t=[],a=1;arguments.length>a;)t.push(arguments[a++]);return zc[++jc]=function(){dl('function'==typeof e?e:Function(e),t)},qc(jc),jc},Lc=function(e){delete zc[e]},'process'==ws(Ac)?qc=function(e){Ac.nextTick(ss(Nc,e,1))}:Oc?(Bc=new Oc,Vc=Bc.port2,Bc.port1.onmessage=Uc,qc=ss(Vc.postMessage,Vc,1)):zi.addEventListener&&'function'==typeof postMessage&&!zi.importScripts?(qc=function(e){zi.postMessage(e+'','*')},zi.addEventListener('message',Uc,!1)):Gc in Yi('script')?qc=function(e){Js.appendChild(Yi('script'))[Gc]=function(){Js.removeChild(this),Nc.call(e)}}:qc=function(e){setTimeout(ss(Nc,e,1),0)});var Hc={set:Rc,clear:Lc},Wc=Hc.set,Xc=zi.MutationObserver||zi.WebKitMutationObserver,Yc=zi.process,$c=zi.Promise,Kc='process'==ws(Yc),Zc=function(){var e=function(){var e,o;for(Kc&&(e=Yc.domain)&&e.exit();t;){o=t.fn,t=t.next;try{o()}catch(o){throw t?r():a=void 0,o}}a=void 0,e&&e.enter()},t,a,r;if(Kc)r=function(){Yc.nextTick(e)};else if(Xc){var o=!0,n=document.createTextNode('');new Xc(e).observe(n,{characterData:!0}),r=function(){n.data=o=!o}}else if($c&&$c.resolve){var i=$c.resolve();r=function(){i.then(e)}}else r=function(){Wc.call(zi,e)};return function(e){var o={fn:e,next:void 0};a&&(a.next=o),t||(t=o,r()),a=o}},Qc=function(e,t,a){for(var r in t)ns(e,r,t[r],a);return e},Jc=Hc.set,eg=Zc(),tg='Promise',ag=zi.TypeError,rg=zi.process,og=zi[tg],rg=zi.process,ng='process'==ll(rg),ig=function(){},sg=!!function(){try{var e=og.resolve(1),t=(e.constructor={})[fs('species')]=function(e){e(ig,ig)};return(ng||'function'==typeof PromiseRejectionEvent)&&e.then(ig)instanceof t}catch(t){}}(),ug=function(e,t){return e===t||e===og&&t===bg},lg=function(e){var t;return Vi(e)&&'function'==typeof(t=e.then)&&t},pg=function(e){return ug(og,e)?new dg(e):new vg(e)},dg=vg=function(e){var t,a;this.promise=new e(function(e,r){if(t!=void 0||a!=void 0)throw ag('Bad Promise constructor');t=e,a=r}),this.resolve=is(t),this.reject=is(a)},cg=function(e){try{e()}catch(t){return{error:t}}},gg=function(e,t){if(!e._n){e._n=!0;var a=e._c;eg(function(){for(var r=e._v,o=1==e._s,n=0,i=function(t){var a=o?t.ok:t.fail,n=t.resolve,i=t.reject,s=t.domain,u,l;try{a?(!o&&(2==e._h&&mg(e),e._h=1),!0===a?u=r:(s&&s.enter(),u=a(r),s&&s.exit()),u===t.promise?i(ag('Promise-chain cycle')):(l=lg(u))?l.call(u,n,i):n(u)):i(r)}catch(t){i(t)}};a.length>n;)i(a[n++]);e._c=[],e._n=!1,t&&!e._h&&hg(e)})}},hg=function(e){Jc.call(zi,function(){var t=e._v,a,r,o;if(fg(e)&&(a=cg(function(){ng?rg.emit('unhandledRejection',t,e):(r=zi.onunhandledrejection)?r({promise:e,reason:t}):(o=zi.console)&&o.error&&o.error('Unhandled promise rejection',t)}),e._h=ng||fg(e)?2:1),e._a=void 0,a)throw a.error})},fg=function(e){if(1==e._h)return!1;for(var t=e._a||e._c,a=0,r;t.length>a;)if(r=t[a++],r.fail||!fg(r.promise))return!1;return!0},mg=function(e){Jc.call(zi,function(){var t;ng?rg.emit('rejectionHandled',e):(t=zi.onrejectionhandled)&&t({promise:e,reason:e._v})})},_g=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,!t._a&&(t._a=t._c.slice()),gg(t,!0))},yg=function(e){var t=this,a;if(!t._d){t._d=!0,t=t._w||t;try{if(t===e)throw ag('Promise can\'t be resolved itself');(a=lg(e))?eg(function(){var r={_w:t,_d:!1};try{a.call(e,ss(yg,r,1),ss(_g,r,1))}catch(t){_g.call(r,t)}}):(t._v=e,t._s=1,gg(t,!1))}catch(a){_g.call({_w:t,_d:!1},a)}}},xg,vg,bg;sg||(og=function(e){Ec(this,og,tg,'_h'),is(e),xg.call(this);try{e(ss(yg,this,1),ss(_g,this,1))}catch(e){_g.call(this,e)}},xg=function(){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},xg.prototype=Qc(og.prototype,{then:function(e,t){var a=pg(Ic(this,og));return a.ok='function'!=typeof e||e,a.fail='function'==typeof t&&t,a.domain=ng?rg.domain:void 0,this._c.push(a),this._a&&this._a.push(a),this._s&&gg(this,!1),a.promise},catch:function(e){return this.then(void 0,e)}}),dg=function(){var e=new xg;this.promise=e,this.resolve=ss(yg,e,1),this.reject=ss(_g,e,1)}),ps(ps.G+ps.W+ps.F*!sg,{Promise:og}),ys(og,tg),pc(tg),bg=Bi[tg],ps(ps.S+ps.F*!sg,tg,{reject:function(e){var t=pg(this),a=t.reject;return a(e),t.promise}}),ps(ps.S+ps.F*!sg,tg,{resolve:function(e){if(e instanceof og&&ug(e.constructor,this))return e;var t=pg(this),a=t.resolve;return a(e),t.promise}}),ps(ps.S+ps.F*!(sg&&Md(function(e){og.all(e)['catch'](ig)})),tg,{all:function(e){var t=this,a=pg(t),r=a.resolve,o=a.reject,n=cg(function(){var a=[],n=0,i=1;Mc(e,!1,function(e){var s=n++,u=!1;a.push(void 0),i++,t.resolve(e).then(function(e){u||(u=!0,a[s]=e,--i||r(a))},o)}),--i||r(a)});return n&&o(n.error),a.promise},race:function(e){var t=this,a=pg(t),r=a.reject,o=cg(function(){Mc(e,!1,function(e){t.resolve(e).then(a.resolve,r)})});return o&&r(o.error),a.promise}});var Sg=Ji.f,Tg=ds.fastKey,Pg=qi?'_s':'size',wg=function(e,t){var a=Tg(t),r;if('F'!==a)return e._i[a];for(r=e._f;r;r=r.n)if(r.k==t)return r},Cg={getConstructor:function(e,t,a,r){var o=e(function(e,n){Ec(e,o,t,'_i'),e._i=ou(null),e._f=void 0,e._l=void 0,e[Pg]=0,void 0!=n&&Mc(n,a,e[r],e)});return Qc(o.prototype,{clear:function(){for(var e=this,t=e._i,a=e._f;a;a=a.n)a.r=!0,a.p&&(a.p=a.p.n=void 0),delete t[a.i];e._f=e._l=void 0,e[Pg]=0},delete:function(e){var t=this,a=wg(t,e);if(a){var r=a.n,o=a.p;delete t._i[a.i],a.r=!0,o&&(o.n=r),r&&(r.p=o),t._f==a&&(t._f=r),t._l==a&&(t._l=o),t[Pg]--}return!!a},forEach:function(e){Ec(this,o,'forEach');for(var t=ss(e,1<arguments.length?arguments[1]:void 0,3),a;a=a?a.n:this._f;)for(t(a.v,a.k,this);a&&a.r;)a=a.p},has:function(e){return!!wg(this,e)}}),qi&&Sg(o.prototype,'size',{get:function(){return Fs(this[Pg])}}),o},def:function(e,t,a){var r=wg(e,t),o,n;return r?r.v=a:(e._l=r={i:n=Tg(t,!0),k:t,v:a,p:o=e._l,n:void 0,r:!1},!e._f&&(e._f=r),o&&(o.n=r),e[Pg]++,'F'!==n&&(e._i[n]=r)),e},getEntry:wg,setStrong:function(e,t,a){Xp(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,a=e._l;a&&a.r;)a=a.p;return e._t&&(e._l=a=a?a.n:e._t._f)?'keys'==t?dc(0,a.k):'values'==t?dc(0,a.v):dc(0,[a.k,a.v]):(e._t=void 0,dc(1))},a?'entries':'values',!a,!0),pc(t)}},Fg=function(e,t,a,r,o,n){var i=zi[e],s=i,u=o?'set':'add',l=s&&s.prototype,p={},d=function(e){var t=l[e];ns(l,e,'delete'==e?function(e){return n&&!Vi(e)?!1:t.call(this,0===e?0:e)}:'has'==e?function(e){return n&&!Vi(e)?!1:t.call(this,0===e?0:e)}:'get'==e?function(e){return n&&!Vi(e)?void 0:t.call(this,0===e?0:e)}:'add'==e?function(e){return t.call(this,0===e?0:e),this}:function(e,a){return t.call(this,0===e?0:e,a),this})};if('function'!=typeof s||!(n||l.forEach&&!Ui(function(){new s().entries().next()})))s=r.getConstructor(t,e,o,u),Qc(s.prototype,a),ds.NEED=!0;else{var c=new s,g=c[u](n?{}:-0,1)!=c,h=Ui(function(){c.has(1)}),f=Md(function(e){new s(e)}),m=!n&&Ui(function(){for(var e=new s,t=5;t--;)e[u](t,t);return!e.has(-0)});f||(s=t(function(t,a){Ec(t,s,e);var r=Gl(new i,t,s);return void 0!=a&&Mc(a,o,r[u],r),r}),s.prototype=l,l.constructor=s),(h||m)&&(d('delete'),d('has'),o&&d('get')),(m||g)&&d(u),n&&l.clear&&delete l.clear}return ys(s,e),p[e]=s,ps(ps.G+ps.W+ps.F*(s!=i),p),n||r.setStrong(s,e,o),s},kg=Fg('Map',function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{get:function(e){var t=Cg.getEntry(this,e);return t&&t.v},set:function(e,t){return Cg.def(this,0===e?0:e,t)}},Cg,!0),Eg=Fg('Set',function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{add:function(e){return Cg.def(this,e=0===e?0:e,e)}},Cg),Mg=ds.getWeak,Dg=Gd(5),Ig=Gd(6),Ag=0,Rg=function(e){return e._l||(e._l=new Lg)},Lg=function(){this.a=[]},Og=function(e,t){return Dg(e.a,function(e){return e[0]===t})};Lg.prototype={get:function(e){var t=Og(this,e);if(t)return t[1]},has:function(e){return!!Og(this,e)},set:function(e,t){var a=Og(this,e);a?a[1]=t:this.a.push([e,t])},delete:function(e){var t=Ig(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}};var jg={getConstructor:function(e,t,a,r){var o=e(function(e,n){Ec(e,o,t,'_i'),e._i=Ag++,e._l=void 0,void 0!=n&&Mc(n,a,e[r],e)});return Qc(o.prototype,{delete:function(e){if(!Vi(e))return!1;var t=Mg(e);return!0===t?Rg(this)['delete'](e):t&&Ni(t,this._i)&&delete t[this._i]},has:function(e){if(!Vi(e))return!1;var t=Mg(e);return!0===t?Rg(this).has(e):t&&Ni(t,this._i)}}),o},def:function(e,t,a){var r=Mg(Hi(t),!0);return!0===r?Rg(e).set(t,a):r[e._i]=a,e},ufstore:Rg},zg=ue(function(e){var t=Gd(0),a=ds.getWeak,r=Object.isExtensible,o=jg.ufstore,n={},i=function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},s={get:function(e){if(Vi(e)){var t=a(e);return!0===t?o(this).get(e):t?t[this._i]:void 0}},set:function(e,t){return jg.def(this,e,t)}},u=e.exports=Fg('WeakMap',i,s,jg,!0,!0),l;7!=new u().set((Object.freeze||Object)(n),7).get(n)&&(l=jg.getConstructor(i),al(l.prototype,s),ds.NEED=!0,t(['delete','has','get','set'],function(e){var t=u.prototype,o=t[e];ns(t,e,function(t,a){if(Vi(t)&&!r(t)){this._f||(this._f=new l);var n=this._f[e](t,a);return'set'==e?this:n}return o.call(this,t,a)})}))});Fg('WeakSet',function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{add:function(e){return jg.def(this,e,!0)}},jg,!1,!0);for(var Gg=os('typed_array'),Ng=os('view'),Ug=!!(zi.ArrayBuffer&&zi.DataView),qg=Ug,Bg=0,Vg=9,l=['Int8Array','Uint8Array','Uint8ClampedArray','Int16Array','Uint16Array','Int32Array','Uint32Array','Float32Array','Float64Array'],Hg;Bg<Vg;)(Hg=zi[l[Bg++]])?(ts(Hg.prototype,Gg,!0),ts(Hg.prototype,Ng,!0)):qg=!1;var Wg={ABV:Ug,CONSTR:qg,TYPED:Gg,VIEW:Ng},Xg=ue(function(e,t){var a=su.f,r=Ji.f,o='ArrayBuffer',n='DataView',i='prototype',s='Wrong length!',u='Wrong index!',l=zi[o],p=zi[n],d=zi.Math,c=zi.RangeError,g=zi.Infinity,h=l,f=Pn,m='buffer',_='byteLength',y='byteOffset',x=qi?'_b':m,v=qi?'_l':_,b=qi?'_o':y,S=function(t,a,r){var o=Array(r),n=8*r-a-1,u=(1<<n)-1,l=u>>1,p=23===a?f(2,-24)-f(2,-77):0,d=0,i=0>t||0===t&&0>1/t?1:0,s,h,m;for(t=Sn(t),t!=t||t===g?(h=t==t?0:1,s=u):(s=_n(fn(t)/hn),1>t*(m=f(2,-s))&&(s--,m*=2),t+=1<=s+l?p/m:p*f(2,1-l),2<=t*m&&(s++,m/=2),s+l>=u?(h=0,s=u):1<=s+l?(h=(t*m-1)*f(2,a),s+=l):(h=t*f(2,l-1)*f(2,a),s=0));8<=a;o[d++]=255&h,h/=256,a-=8);for(s=s<<a|h,n+=a;0<n;o[d++]=255&s,s/=256,n-=8);return o[--d]|=128*i,o},T=function(t,a,r){var o=8*r-a-1,n=(1<<o)-1,u=n>>1,l=o-7,p=r-1,i=t[p--],s=127&i,e;for(i>>=7;0<l;s=256*s+t[p],p--,l-=8);for(e=s&(1<<-l)-1,s>>=-l,l+=a;0<l;e=256*e+t[p],p--,l-=8);if(0===s)s=1-u;else{if(s===n)return e?NaN:i?-g:g;e+=f(2,a),s-=u}return(i?-1:1)*e*f(2,s-a)},P=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},w=function(e){return[255&e]},C=function(e){return[255&e,255&e>>8]},F=function(e){return[255&e,255&e>>8,255&e>>16,255&e>>24]},k=function(e){return S(e,52,8)},E=function(e){return S(e,23,4)},M=function(e,t,a){r(e[i],t,{get:function(){return this[a]}})},D=function(e,t,a,r){var o=+a,n=Ds(o);if(o!=n||0>n||n+t>e[v])throw c(u);var i=e[x]._b,s=n+e[b],l=i.slice(s,s+t);return r?l:l.reverse()},I=function(e,t,a,r,o,n){var s=+a,l=Ds(s);if(s!=l||0>l||l+t>e[v])throw c(u);for(var p=e[x]._b,d=l+e[b],g=r(+o),h=0;h<t;h++)p[d+h]=g[n?h:t-h-1]},A=function(e,t){Ec(e,l,o);var a=+t,r=As(a);if(a!=r)throw c(s);return r};if(!Wg.ABV)l=function(e){var t=A(this,e);this._b=ac.call(Array(t),0),this[v]=t},p=function(e,t,a){Ec(this,p,n),Ec(e,l,n);var r=e[v],o=Ds(t);if(0>o||o>r)throw c('Wrong offset!');if(a=void 0===a?r-o:As(a),o+a>r)throw c(s);this[x]=e,this[b]=o,this[v]=a},qi&&(M(l,_,'_l'),M(p,m,'_b'),M(p,_,'_l'),M(p,y,'_o')),Qc(p[i],{getInt8:function(e){return D(this,1,e)[0]<<24>>24},getUint8:function(e){return D(this,1,e)[0]},getInt16:function(e){var t=D(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=D(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return P(D(this,4,e,arguments[1]))},getUint32:function(e){return P(D(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return T(D(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return T(D(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){I(this,1,e,w,t)},setUint8:function(e,t){I(this,1,e,w,t)},setInt16:function(e,t){I(this,2,e,C,t,arguments[2])},setUint16:function(e,t){I(this,2,e,C,t,arguments[2])},setInt32:function(e,t){I(this,4,e,F,t,arguments[2])},setUint32:function(e,t){I(this,4,e,F,t,arguments[2])},setFloat32:function(e,t){I(this,4,e,E,t,arguments[2])},setFloat64:function(e,t){I(this,8,e,k,t,arguments[2])}});else{if(!Ui(function(){new l})||!Ui(function(){new l(.5)})){l=function(e){return new h(A(this,e))};for(var R=l[i]=h[i],L=a(h),O=0,j;L.length>O;)(j=L[O++])in l||ts(l,j,h[j]);R.constructor=l}var z=new p(new l(2)),G=p[i].setInt8;z.setInt8(0,2147483648),z.setInt8(1,2147483649),(z.getInt8(0)||!z.getInt8(1))&&Qc(p[i],{setInt8:function(e,t){G.call(this,e,t<<24>>24)},setUint8:function(e,t){G.call(this,e,t<<24>>24)}},!0)}ys(l,o),ys(p,n),ts(p[i],Wg.VIEW,!0),t[o]=l,t[n]=p}),Yg=zi.ArrayBuffer,$g=Xg.ArrayBuffer,Kg=Xg.DataView,Zg=Wg.ABV&&Yg.isView,Qg=$g.prototype.slice,Jg=Wg.VIEW,eh='ArrayBuffer';ps(ps.G+ps.W+ps.F*(Yg!==$g),{ArrayBuffer:$g}),ps(ps.S+ps.F*!Wg.CONSTR,eh,{isView:function(e){return Zg&&Zg(e)||Vi(e)&&Jg in e}}),ps(ps.P+ps.U+ps.F*Ui(function(){return!new $g(2).slice(1,void 0).byteLength}),eh,{slice:function(e,t){if(Qg!==void 0&&t===void 0)return Qg.call(Hi(this),e);for(var a=Hi(this).byteLength,r=Os(e,a),o=Os(void 0===t?a:t,a),n=new(Ic(this,$g))(As(o-r)),i=new Kg(this),s=new Kg(n),u=0;r<o;)s.setUint8(u++,i.getUint8(r++));return n}}),pc(eh),ps(ps.G+ps.W+ps.F*!Wg.ABV,{DataView:Xg.DataView});var th=ue(function(e){if(qi){var t=zi,a=Ui,r=ps,o=Wg,n=Xg,i=Ec,s=ts,u=Qc,l=As,p=Os,d=Ki,c=Ni,g=ll,h=Vi,f=Yu,m=su.f,_=os,y=fs,x=Gd,v=js,b=Ic,S=cc,T=Ji,P=mu,w=T.f,C=P.f,F=t.RangeError,k=t.TypeError,E=t.Uint8Array,M='ArrayBuffer',D='Shared'+M,I='BYTES_PER_ELEMENT',A='prototype',R=Array[A],L=n.ArrayBuffer,O=n.DataView,j=x(0),z=x(2),G=x(3),N=x(4),U=x(5),q=x(6),B=v(!0),V=v(!1),H=S.values,W=S.keys,X=S.entries,Y=R.lastIndexOf,$=R.reduce,K=R.reduceRight,Z=R.join,Q=R.sort,J=R.slice,ee=R.toString,te=R.toLocaleString,ae=y('iterator'),re=y('toStringTag'),oe=_('typed_constructor'),ne=_('def_constructor'),ie=o.CONSTR,se=o.TYPED,ue=o.VIEW,le='Wrong length!',pe=x(1,function(e,t){return me(b(e,e[ne]),t)}),de=a(function(){return 1===new E(new Uint16Array([1]).buffer)[0]}),ce=!!E&&!!E[A].set&&a(function(){new E(1).set({})}),ge=function(e,t){if(e===void 0)throw k(le);var a=l(e);if(t&&!rl(+e,a))throw F(le);return a},he=function(e,t){var a=Ds(e);if(0>a||a%t)throw F('Wrong offset!');return a},fe=function(e){if(h(e)&&se in e)return e;throw k(e+' is not a typed array!')},me=function(e,t){if(!(h(e)&&oe in e))throw k('It is not a typed array constructor!');return new e(t)},_e=function(e,t){return ye(b(e,e[ne]),t)},ye=function(e,t){for(var a=0,r=t.length,o=me(e,r);r>a;)o[a]=t[a++];return o},xe=function(e,t,a){w(e,t,{get:function(){return this._d[a]}})},ve=function(e){var t=f(e),a=arguments.length,r=1<a?arguments[1]:void 0,o=r!==void 0,n=Cd(t),s,i,u,p,d,c;if(n!=void 0&&!Td(n)){for(c=n.call(t),u=[],s=0;!(d=c.next()).done;s++)u.push(d.value);t=u}for(o&&2<a&&(r=ss(r,arguments[2],2)),s=0,i=l(t.length),p=me(this,i);i>s;s++)p[s]=o?r(t[s],s):t[s];return p},be=function(){for(var e=0,t=arguments.length,a=me(this,t);t>e;)a[e]=arguments[e++];return a},Se=!!E&&a(function(){te.call(new E(1))}),Te=function(){return te.apply(Se?J.call(fe(this)):fe(this),arguments)},Pe={copyWithin:function(e,t){return Qd.call(fe(this),e,t,2<arguments.length?arguments[2]:void 0)},every:function(e){return N(fe(this),e,1<arguments.length?arguments[1]:void 0)},fill:function(){return ac.apply(fe(this),arguments)},filter:function(e){return _e(this,z(fe(this),e,1<arguments.length?arguments[1]:void 0))},find:function(e){return U(fe(this),e,1<arguments.length?arguments[1]:void 0)},findIndex:function(e){return q(fe(this),e,1<arguments.length?arguments[1]:void 0)},forEach:function(e){j(fe(this),e,1<arguments.length?arguments[1]:void 0)},indexOf:function(e){return V(fe(this),e,1<arguments.length?arguments[1]:void 0)},includes:function(e){return B(fe(this),e,1<arguments.length?arguments[1]:void 0)},join:function(){return Z.apply(fe(this),arguments)},lastIndexOf:function(){return Y.apply(fe(this),arguments)},map:function(e){return pe(fe(this),e,1<arguments.length?arguments[1]:void 0)},reduce:function(){return $.apply(fe(this),arguments)},reduceRight:function(){return K.apply(fe(this),arguments)},reverse:function(){for(var e=this,t=fe(e).length,a=_n(t/2),r=0,o;r<a;)o=e[r],e[r++]=e[--t],e[t]=o;return e},some:function(e){return G(fe(this),e,1<arguments.length?arguments[1]:void 0)},sort:function(e){return Q.call(fe(this),e)},subarray:function(e,t){var a=fe(this),r=a.length,o=p(e,r);return new(b(a,a[ne]))(a.buffer,a.byteOffset+o*a.BYTES_PER_ELEMENT,l((t===void 0?r:p(t,r))-o))}},we=function(e,t){return _e(this,J.call(fe(this),e,t))},Ce=function(e){fe(this);var t=he(arguments[1],1),a=this.length,r=f(e),o=l(r.length),n=0;if(o+t>a)throw F(le);for(;n<o;)this[t+n]=r[n++]},Fe={entries:function(){return X.call(fe(this))},keys:function(){return W.call(fe(this))},values:function(){return H.call(fe(this))}},ke=function(e,t){return h(e)&&e[se]&&'symbol'!=typeof t&&t in e&&+t+''==t+''},Ee=function(e,t){return ke(e,t=d(t,!0))?es(2,e[t]):C(e,t)},Me=function(e,t,a){return ke(e,t=d(t,!0))&&h(a)&&c(a,'value')&&!c(a,'get')&&!c(a,'set')&&!a.configurable&&(!c(a,'writable')||a.writable)&&(!c(a,'enumerable')||a.enumerable)?(e[t]=a.value,e):w(e,t,a)};ie||(P.f=Ee,T.f=Me),r(r.S+r.F*!ie,'Object',{getOwnPropertyDescriptor:Ee,defineProperty:Me}),a(function(){ee.call({})})&&(ee=te=function(){return Z.call(this)});var De=u({},Pe);u(De,Fe),s(De,ae,Fe.values),u(De,{slice:we,set:Ce,constructor:function(){},toString:ee,toLocaleString:Te}),xe(De,'buffer','b'),xe(De,'byteOffset','o'),xe(De,'byteLength','l'),xe(De,'length','e'),w(De,re,{get:function(){return this[se]}}),e.exports=function(e,n,u,p){p=!!p;var d=e+(p?'Clamped':'')+'Array',c=t[d],f=c||{},_=c&&Zu(c),y=!c||!o.ABV,x={},v=c&&c[A],b=function(t,a){var r=t._d;return r.v['get'+e](a*n+r.o,de)},S=function(t,a,r){var o=t._d;p&&(r=0>(r=xn(r))?0:255<r?255:255&r),o.v['set'+e](a*n+o.o,r,de)},T=function(e,t){w(e,t,{get:function(){return b(this,t)},set:function(e){return S(this,t,e)},enumerable:!0})};y?(c=u(function(e,t,a,r){i(e,c,d,'_d');var o=0,u=0,p,f,m,_;if(!h(t))m=ge(t,!0),f=m*n,p=new L(f);else if(t instanceof L||(_=g(t))==M||_==D){p=t,u=he(a,n);var y=t.byteLength;if(void 0===r){if(y%n)throw F(le);if(f=y-u,0>f)throw F(le)}else if(f=l(r)*n,f+u>y)throw F(le);m=f/n}else return se in t?ye(c,t):ve.call(c,t);for(s(e,'_d',{b:p,o:u,l:f,e:m,v:new O(p)});o<m;)T(e,o++)}),v=c[A]=ou(De),s(v,'constructor',c)):!Md(function(e){new c(null),new c(e)},!0)&&(c=u(function(e,t,a,r){i(e,c,d);var o;return h(t)?t instanceof L||(o=g(t))==M||o==D?void 0===r?void 0===a?new f(t):new f(t,he(a,n)):new f(t,he(a,n),r):se in t?ye(c,t):ve.call(c,t):new f(ge(t,'Uint8Array'!=d))}),j(_===Function.prototype?m(f):m(f).concat(m(_)),function(e){e in c||s(c,e,f[e])}),c[A]=v,v.constructor=c);var P=v[ae],C=!!P&&('values'==P.name||P.name==void 0),k=Fe.values;s(c,oe,!0),s(v,se,d),s(v,ue,!0),s(v,ne,c),(p?new c(1)[re]!=d:!(re in v))&&w(v,re,{get:function(){return d}}),x[d]=c,r(r.G+r.W+r.F*(c!=f),x),r(r.S,d,{BYTES_PER_ELEMENT:n,from:ve,of:be}),I in v||s(v,I,n),r(r.P,d,Pe),pc(d),r(r.P+r.F*ce,d,{set:Ce}),r(r.P+r.F*!C,d,Fe),r(r.P+r.F*(v.toString!=ee),d,{toString:ee}),r(r.P+r.F*a(function(){new c(1).slice()}),d,{slice:we}),r(r.P+r.F*(a(function(){return[1,2].toLocaleString()!=new c([1,2]).toLocaleString()})||!a(function(){v.toLocaleString.call([1,2])})),d,{toLocaleString:Te}),zp[d]=C?P:k,C||s(v,ae,k)}}else e.exports=function(){}});th('Int8',1,function(e){return function(t,a,r){return e(this,t,a,r)}}),th('Uint8',1,function(e){return function(t,a,r){return e(this,t,a,r)}}),th('Uint8',1,function(e){return function(t,a,r){return e(this,t,a,r)}},!0),th('Int16',2,function(e){return function(t,a,r){return e(this,t,a,r)}}),th('Uint16',2,function(e){return function(t,a,r){return e(this,t,a,r)}}),th('Int32',4,function(e){return function(t,a,r){return e(this,t,a,r)}}),th('Uint32',4,function(e){return function(t,a,r){return e(this,t,a,r)}}),th('Float32',4,function(e){return function(t,a,r){return e(this,t,a,r)}}),th('Float64',8,function(e){return function(t,a,r){return e(this,t,a,r)}});var ah=(zi.Reflect||{}).apply,rh=Function.apply;ps(ps.S+ps.F*!Ui(function(){ah(function(){})}),'Reflect',{apply:function(e,t,a){var r=is(e),o=Hi(a);return ah?ah(r,t,o):rh.call(r,t,o)}});var oh=(zi.Reflect||{}).construct,nh=Ui(function(){function e(){}return!(oh(function(){},[],e)instanceof e)}),ih=!Ui(function(){oh(function(){})});ps(ps.S+ps.F*(nh||ih),'Reflect',{construct:function(e,t){is(e),Hi(t);var a=3>arguments.length?e:is(arguments[2]);if(ih&&!nh)return oh(e,t,a);if(e==a){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);}var r=[null];return r.push.apply(r,t),new(fl.apply(e,r))}var o=a.prototype,n=ou(Vi(o)?o:Object.prototype),i=Function.apply.call(e,n,t);return Vi(i)?i:n}}),ps(ps.S+ps.F*Ui(function(){Reflect.defineProperty(Ji.f({},1,{value:1}),1,{value:2})}),'Reflect',{defineProperty:function(e,t,a){Hi(e),t=Ki(t,!0),Hi(a);try{return Ji.f(e,t,a),!0}catch(t){return!1}}});var sh=mu.f;ps(ps.S,'Reflect',{deleteProperty:function(e,t){var a=sh(Hi(e),t);return a&&!a.configurable?!1:delete e[t]}});var uh=function(e){this._t=Hi(e),this._i=0;var t=this._k=[],a;for(a in e)t.push(a)};Np(uh,'Object',function(){var e=this,t=e._k,a;do if(e._i>=t.length)return{value:void 0,done:!0};while(!((a=t[e._i++])in e._t));return{value:a,done:!1}}),ps(ps.S,'Reflect',{enumerate:function(e){return new uh(e)}}),ps(ps.S,'Reflect',{get:pe}),ps(ps.S,'Reflect',{getOwnPropertyDescriptor:function(e,t){return mu.f(Hi(e),t)}}),ps(ps.S,'Reflect',{getPrototypeOf:function(e){return Zu(Hi(e))}}),ps(ps.S,'Reflect',{has:function(e,t){return t in e}});var lh=Object.isExtensible;ps(ps.S,'Reflect',{isExtensible:function(e){return Hi(e),!lh||lh(e)}});var ph=zi.Reflect,dh=ph&&ph.ownKeys||function(e){var t=su.f(Hi(e)),a=Xs.f;return a?t.concat(a(e)):t};ps(ps.S,'Reflect',{ownKeys:dh});var ch=Object.preventExtensions;ps(ps.S,'Reflect',{preventExtensions:function(e){Hi(e);try{return ch&&ch(e),!0}catch(t){return!1}}}),ps(ps.S,'Reflect',{set:de}),nl&&ps(ps.S,'Reflect',{setPrototypeOf:function(e,t){nl.check(e,t);try{return nl.set(e,t),!0}catch(t){return!1}}});var gh=js(!0);ps(ps.P,'Array',{includes:function(e){return gh(this,e,1<arguments.length?arguments[1]:void 0)}}),tc('includes');var hh=jp(!0);ps(ps.P,'String',{at:function(e){return hh(this,e)}});var fh=function(e,t,a,r){var o=Fs(e)+'',n=o.length,i=void 0===a?' ':a+'',s=As(t);if(s<=n||''==i)return o;var u=s-n,l=ep.call(i,yn(u/i.length));return l.length>u&&(l=l.slice(0,u)),r?l+o:o+l};ps(ps.P,'String',{padStart:function(e){return fh(this,e,1<arguments.length?arguments[1]:void 0,!0)}}),ps(ps.P,'String',{padEnd:function(e){return fh(this,e,1<arguments.length?arguments[1]:void 0,!1)}}),Ml('trimLeft',function(e){return function(){return e(this,1)}},'trimStart'),Ml('trimRight',function(e){return function(){return e(this,2)}},'trimEnd');var mh=RegExp.prototype,_h=function(e,t){this._r=e,this._s=t};Np(_h,'RegExp String',function(){var e=this._r.exec(this._s);return{value:e,done:null===e}}),ps(ps.P,'String',{matchAll:function(e){if(Fs(this),!Zp(e))throw TypeError(e+' is not a regexp!');var t=this+'',a='flags'in mh?e.flags+'':gc.call(e),r=new RegExp(e.source,~a.indexOf('g')?a:'g'+a);return r.lastIndex=As(e.lastIndex),new _h(r,t)}}),Ts('asyncIterator'),Ts('observable'),ps(ps.S,'Object',{getOwnPropertyDescriptors:function(e){for(var t=ks(e),a=mu.f,r=dh(t),o={},n=0,i;r.length>n;)Pd(o,i=r[n++],a(t,i));return o}});var yh=$s.f,xh=function(e){return function(t){for(var a=ks(t),r=Vs(a),o=r.length,n=0,i=[],s;o>n;)yh.call(a,s=r[n++])&&i.push(e?[s,a[s]]:a[s]);return i}},vh=xh(!1);ps(ps.S,'Object',{values:function(e){return vh(e)}});var bh=xh(!0);ps(ps.S,'Object',{entries:function(e){return bh(e)}});var Sh=!Ui(function(){var e=Math.random();__defineSetter__.call(null,e,function(){}),delete zi[e]});qi&&ps(ps.P+Sh,'Object',{__defineGetter__:function(e,t){Ji.f(Yu(this),e,{get:is(t),enumerable:!0,configurable:!0})}}),qi&&ps(ps.P+Sh,'Object',{__defineSetter__:function(e,t){Ji.f(Yu(this),e,{set:is(t),enumerable:!0,configurable:!0})}});var Th=mu.f;qi&&ps(ps.P+Sh,'Object',{__lookupGetter__:function(e){var t=Yu(this),a=Ki(e,!0),r;do if(r=Th(t,a))return r.get;while(t=Zu(t))}});var Ph=mu.f;qi&&ps(ps.P+Sh,'Object',{__lookupSetter__:function(e){var t=Yu(this),a=Ki(e,!0),r;do if(r=Ph(t,a))return r.set;while(t=Zu(t))}});var wh=function(e,t){var a=[];return Mc(e,!1,a.push,a,t),a},Ch=function(e){return function(){if(ll(this)!=e)throw TypeError(e+'#toJSON isn\'t generic');return wh(this)}};ps(ps.P+ps.R,'Map',{toJSON:Ch('Map')}),ps(ps.P+ps.R,'Set',{toJSON:Ch('Set')}),ps(ps.S,'System',{global:zi}),ps(ps.S,'Error',{isError:function(e){return'Error'===ws(e)}}),ps(ps.S,'Math',{iaddh:function(e,t,a,r){var o=e>>>0,n=a>>>0;return 0|(t>>>0)+(r>>>0)+((o&n|(o|n)&~(o+n>>>0))>>>31)}}),ps(ps.S,'Math',{isubh:function(e,t,a,r){var o=e>>>0,n=a>>>0;return 0|(t>>>0)-(r>>>0)-((~o&n|~(o^n)&o-n>>>0)>>>31)}}),ps(ps.S,'Math',{imulh:function(e,a){var r=65535,o=+e,n=+a,i=o&r,s=n&r,l=o>>16,p=n>>16,d=(l*s>>>0)+(i*s>>>16);return l*p+(d>>16)+((i*p>>>0)+(d&r)>>16)}}),ps(ps.S,'Math',{umulh:function(e,a){var r=65535,o=+e,n=+a,i=o&r,s=n&r,l=o>>>16,p=n>>>16,d=(l*s>>>0)+(i*s>>>16);return l*p+(d>>>16)+((i*p>>>0)+(d&r)>>>16)}});var Fh=hs('metadata'),kh=Fh.store||(Fh.store=new zg),Eh=function(e,t,a){var r=kh.get(e);if(!r){if(!a)return;kh.set(e,r=new kg)}var o=r.get(t);if(!o){if(!a)return;r.set(t,o=new kg)}return o},Mh=function(e,t,a){var r=Eh(t,a,!1);return r!==void 0&&r.has(e)},Dh=function(e,t,a){var r=Eh(t,a,!1);return r===void 0?void 0:r.get(e)},Ih=function(e,t,a,r){Eh(a,r,!0).set(e,t)},Ah=function(e,t){var a=Eh(e,t,!1),r=[];return a&&a.forEach(function(e,t){r.push(t)}),r},Rh=function(e){return e===void 0||'symbol'==typeof e?e:e+''},Lh=function(e){ps(ps.S,'Reflect',e)},Oh={store:kh,map:Eh,has:Mh,get:Dh,set:Ih,keys:Ah,key:Rh,exp:Lh},jh=Oh.key,zh=Oh.set;Oh.exp({defineMetadata:function(e,t,a,r){zh(e,t,Hi(a),jh(r))}});var Gh=Oh.key,Nh=Oh.map,Uh=Oh.store;Oh.exp({deleteMetadata:function(e,t){var a=3>arguments.length?void 0:Gh(arguments[2]),r=Nh(Hi(t),a,!1);if(void 0===r||!r['delete'](e))return!1;if(r.size)return!0;var o=Uh.get(t);return o['delete'](a),!!o.size||Uh['delete'](t)}});var qh=Oh.has,Bh=Oh.get,Vh=Oh.key,Hh=function(e,t,a){var r=qh(e,t,a);if(r)return Bh(e,t,a);var o=Zu(t);return null===o?void 0:Hh(e,o,a)};Oh.exp({getMetadata:function(e,t){return Hh(e,Hi(t),3>arguments.length?void 0:Vh(arguments[2]))}});var Wh=Oh.keys,Xh=Oh.key,Yh=function(e,t){var a=Wh(e,t),r=Zu(e);if(null===r)return a;var o=Yh(r,t);return o.length?a.length?wh(new Eg(a.concat(o))):o:a};Oh.exp({getMetadataKeys:function(e){return Yh(Hi(e),2>arguments.length?void 0:Xh(arguments[1]))}});var $h=Oh.get,Kh=Oh.key;Oh.exp({getOwnMetadata:function(e,t){return $h(e,Hi(t),3>arguments.length?void 0:Kh(arguments[2]))}});var Zh=Oh.keys,Qh=Oh.key;Oh.exp({getOwnMetadataKeys:function(e){return Zh(Hi(e),2>arguments.length?void 0:Qh(arguments[1]))}});var Jh=Oh.has,ef=Oh.key,tf=function(e,t,a){var r=Jh(e,t,a);if(r)return!0;var o=Zu(t);return null!==o&&tf(e,o,a)};Oh.exp({hasMetadata:function(e,t){return tf(e,Hi(t),3>arguments.length?void 0:ef(arguments[2]))}});var af=Oh.has,rf=Oh.key;Oh.exp({hasOwnMetadata:function(e,t){return af(e,Hi(t),3>arguments.length?void 0:rf(arguments[2]))}});var of=Oh.key,nf=Oh.set;Oh.exp({metadata:function(e,t){return function(a,r){nf(e,t,(r===void 0?is:Hi)(a),of(r))}}});var sf=Zc(),uf=zi.process,lf='process'==ws(uf);ps(ps.G,{asap:function(e){var t=lf&&uf.domain;sf(t?t.bind(e):e)}});var pf=Zc(),df=fs('observable'),cf=Mc.RETURN,gf=function(e){return null==e?void 0:is(e)},hf=function(e){var t=e._c;t&&(e._c=void 0,t())},ff=function(e){return e._o===void 0},mf=function(e){ff(e)||(e._o=void 0,hf(e))},_f=function(t,e){Hi(t),this._c=void 0,this._o=t,t=new yf(this);try{var a=e(t),r=a;null!=a&&('function'==typeof a.unsubscribe?a=function(){r.unsubscribe()}:is(a),this._c=a)}catch(a){return void t.error(a)}ff(this)&&hf(this)};_f.prototype=Qc({},{unsubscribe:function(){mf(this)}});var yf=function(e){this._s=e};yf.prototype=Qc({},{next:function(e){var t=this._s;if(!ff(t)){var a=t._o;try{var r=gf(a.next);if(r)return r.call(a,e)}catch(a){try{mf(t)}finally{throw a}}}},error:function(e){var t=this._s;if(ff(t))throw e;var a=t._o;t._o=void 0;try{var r=gf(a.error);if(!r)throw e;e=r.call(a,e)}catch(a){try{hf(t)}finally{throw a}}return hf(t),e},complete:function(e){var t=this._s;if(!ff(t)){var a=t._o;t._o=void 0;try{var r=gf(a.complete);e=r?r.call(a,e):void 0}catch(a){try{hf(t)}finally{throw a}}return hf(t),e}}});var xf=function(e){Ec(this,xf,'Observable','_f')._f=is(e)};Qc(xf.prototype,{subscribe:function(e){return new _f(e,this._f)},forEach:function(e){var t=this;return new(Bi.Promise||zi.Promise)(function(a,r){is(e);var o=t.subscribe({next:function(t){try{return e(t)}catch(t){r(t),o.unsubscribe()}},error:r,complete:a})})}}),Qc(xf,{from:function(e){var t='function'==typeof this?this:xf,a=gf(Hi(e)[df]);if(a){var r=Hi(a.call(e));return r.constructor===t?r:new t(function(e){return r.subscribe(e)})}return new t(function(t){var a=!1;return pf(function(){if(!a){try{if(Mc(e,!1,function(e){if(t.next(e),a)return cf})===cf)return}catch(r){if(a)throw r;return void t.error(r)}t.complete()}}),function(){a=!0}})},of:function(){for(var e=0,t=arguments.length,a=Array(t);e<t;)a[e]=arguments[e++];return new('function'==typeof this?this:xf)(function(e){var t=!1;return pf(function(){if(!t){for(var r=0;r<a.length;++r)if(e.next(a[r]),t)return;e.complete()}}),function(){t=!0}})}}),ts(xf.prototype,df,function(){return this}),ps(ps.G,{Observable:xf}),pc('Observable');var vf=zi,bf=function(){for(var e=is(this),t=arguments.length,a=Array(t),r=0,o=vf._,n=!1;t>r;)(a[r]=arguments[r++])===o&&(n=!0);return function(){var r=this,i=arguments.length,s=0,u=0,l;if(!n&&!i)return dl(e,a,r);if(l=a.slice(),n)for(;t>s;s++)l[s]===o&&(l[s]=arguments[u++]);for(;i>u;)l.push(arguments[u++]);return dl(e,l,r)}},Sf=zi.navigator,Tf=!!Sf&&/MSIE .\./.test(Sf.userAgent),Pf=function(e){return Tf?function(t,a){return e(dl(bf,[].slice.call(arguments,2),'function'==typeof t?t:Function(t)),a)}:e};ps(ps.G+ps.B+ps.F*Tf,{setTimeout:Pf(zi.setTimeout),setInterval:Pf(zi.setInterval)}),ps(ps.G+ps.B,{setImmediate:Hc.set,clearImmediate:Hc.clear});for(var wf=fs('iterator'),Cf=fs('toStringTag'),Ff=zp.Array,kf=['NodeList','DOMTokenList','MediaList','StyleSheetList','CSSRuleList'],Ef=0;5>Ef;Ef++){var Mf=kf[Ef],Df=zi[Mf],If=Df&&Df.prototype,Af;if(If)for(Af in If[wf]||ts(If,wf,Ff),If[Cf]||ts(If,Cf,Mf),zp[Mf]=Ff,cc)If[Af]||ns(If,Af,cc[Af],!0)}var Rf=ue(function(e){!function(t){function a(e,t,a,r){var n=t&&t.prototype instanceof o?t:o,i=Object.create(n.prototype),s=new g(r||[]);return i._invoke=l(e,a,s),i}function r(e,t,a){try{return{type:'normal',arg:e.call(t,a)}}catch(e){return{type:'throw',arg:e}}}function o(){}function n(){}function i(){}function s(e){['next','throw','return'].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function u(e){function t(a,o,n,i){var s=r(e[a],e,o);if('throw'===s.type)i(s.arg);else{var u=s.arg,l=u.value;return l&&'object'==typeof l&&_.call(l,'__await')?Promise.resolve(l.__await).then(function(e){t('next',e,n,i)},function(e){t('throw',e,n,i)}):Promise.resolve(l).then(function(e){u.value=e,n(u)},i)}}var a;this._invoke=function(e,r){function o(){return new Promise(function(a,o){t(e,r,a,o)})}return a=a?a.then(o,o):o()}}function l(e,t,a){var o=T;return function(n,i){if(o==w)throw new Error('Generator is already running');if(o==C){if('throw'===n)throw i;return f()}for(a.method=n,a.arg=i;;){var s=a.delegate;if(s){var u=p(s,a);if(u){if(u===F)continue;return u}}if('next'===a.method)a.sent=a._sent=a.arg;else if('throw'===a.method){if(o==T)throw o=C,a.arg;a.dispatchException(a.arg)}else'return'===a.method&&a.abrupt('return',a.arg);o=w;var l=r(e,t,a);if('normal'===l.type){if(o=a.done?C:P,l.arg===F)continue;return{value:l.arg,done:a.done}}'throw'===l.type&&(o=C,a.method='throw',a.arg=l.arg)}}}function p(e,t){var a=e.iterator[t.method];if(void 0===a){if(t.delegate=null,'throw'===t.method){if(e.iterator.return&&(t.method='return',t.arg=void 0,p(e,t),'throw'===t.method))return F;t.method='throw',t.arg=new TypeError('The iterator does not provide a \'throw\' method')}return F}var o=r(a,e.iterator,t.arg);if('throw'===o.type)return t.method='throw',t.arg=o.arg,t.delegate=null,F;var n=o.arg;if(!n)return t.method='throw',t.arg=new TypeError('iterator result is not an object'),t.delegate=null,F;if(n.done)t[e.resultName]=n.value,t.next=e.nextLoc,'return'!==t.method&&(t.method='next',t.arg=void 0);else return n;return t.delegate=null,F}function d(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function c(e){var t=e.completion||{};t.type='normal',delete t.arg,e.completion=t}function g(e){this.tryEntries=[{tryLoc:'root'}],e.forEach(d,this),this.reset(!0)}function h(e){if(e){var t=e[x];if(t)return t.call(e);if('function'==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function t(){for(;++a<e.length;)if(_.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:f}}function f(){return{value:void 0,done:!0}}var m=Object.prototype,_=m.hasOwnProperty,y='function'==typeof Symbol?Symbol:{},x=y.iterator||'@@iterator',v=y.asyncIterator||'@@asyncIterator',b=y.toStringTag||'@@toStringTag',S=t.regeneratorRuntime;if(S)return void(e.exports=S);S=t.regeneratorRuntime=e.exports,S.wrap=a;var T='suspendedStart',P='suspendedYield',w='executing',C='completed',F={},k={};k[x]=function(){return this};var E=Object.getPrototypeOf,M=E&&E(E(h([])));M&&M!==m&&_.call(M,x)&&(k=M);var D=i.prototype=o.prototype=Object.create(k);n.prototype=D.constructor=i,i.constructor=n,i[b]=n.displayName='GeneratorFunction',S.isGeneratorFunction=function(e){var t='function'==typeof e&&e.constructor;return!!t&&(t===n||'GeneratorFunction'===(t.displayName||t.name))},S.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,i):(e.__proto__=i,!(b in e)&&(e[b]='GeneratorFunction')),e.prototype=Object.create(D),e},S.awrap=function(e){return{__await:e}},s(u.prototype),u.prototype[v]=function(){return this},S.AsyncIterator=u,S.async=function(e,t,r,o){var n=new u(a(e,t,r,o));return S.isGeneratorFunction(t)?n:n.next().then(function(e){return e.done?e.value:n.next()})},s(D),D[b]='Generator',D[x]=function(){return this},D.toString=function(){return'[object Generator]'},S.keys=function(e){var t=[];for(var a in e)t.push(a);return t.reverse(),function a(){for(;t.length;){var r=t.pop();if(r in e)return a.value=r,a.done=!1,a}return a.done=!0,a}},S.values=h,g.prototype={constructor:g,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method='next',this.arg=void 0,this.tryEntries.forEach(c),!e)for(var t in this)'t'===t.charAt(0)&&_.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if('throw'===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,r){return n.type='throw',n.arg=e,a.next=t,r&&(a.method='next',a.arg=void 0),!!r}if(this.done)throw e;for(var a=this,r=this.tryEntries.length-1;0<=r;--r){var o=this.tryEntries[r],n=o.completion;if('root'===o.tryLoc)return t('end');if(o.tryLoc<=this.prev){var i=_.call(o,'catchLoc'),s=_.call(o,'finallyLoc');if(i&&s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);}else if(!s)throw new Error('try statement without catch or finally');else if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1,r;0<=a;--a)if(r=this.tryEntries[a],r.tryLoc<=this.prev&&_.call(r,'finallyLoc')&&this.prev<r.finallyLoc){var o=r;break}o&&('break'===e||'continue'===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var n=o?o.completion:{};return n.type=e,n.arg=t,o?(this.method='next',this.next=o.finallyLoc,F):this.complete(n)},complete:function(e,t){if('throw'===e.type)throw e.arg;return'break'===e.type||'continue'===e.type?this.next=e.arg:'return'===e.type?(this.rval=this.arg=e.arg,this.method='return',this.next='end'):'normal'===e.type&&t&&(this.next=t),F},finish:function(e){for(var t=this.tryEntries.length-1,a;0<=t;--t)if(a=this.tryEntries[t],a.finallyLoc===e)return this.complete(a.completion,a.afterLoc),c(a),F},catch:function(e){for(var t=this.tryEntries.length-1,a;0<=t;--t)if(a=this.tryEntries[t],a.tryLoc===e){var r=a.completion;if('throw'===r.type){var o=r.arg;c(a)}return o}throw new Error('illegal catch attempt')},delegateYield:function(e,t,a){return this.delegate={iterator:h(e),resultName:t,nextLoc:a},'next'===this.method&&(this.arg=void 0),F}}}(function(){return this}()||Function('return this')())});if(ji._babelPolyfill)throw new Error('only one instance of @babel/polyfill is allowed');ji._babelPolyfill=!0;var Lf=ce,Of='object'==typeof ji&&ji&&ji.Object===Object&&ji,jf=Of,zf='object'==typeof self&&self&&self.Object===Object&&self,Gf=jf||zf||Function('return this')(),Nf=Gf,Uf=Nf.Symbol,qf=Uf,Bf=Object.prototype,Vf=Bf.hasOwnProperty,Hf=Bf.toString,Wf=qf?qf.toStringTag:void 0,Xf=ge,Yf=Object.prototype,$f=Yf.toString,Kf=he,Zf='[object Null]',Qf='[object Undefined]',Jf=qf?qf.toStringTag:void 0,em=fe,tm=me,am='[object Arguments]',rm=_e,om=Object.prototype,nm=om.hasOwnProperty,im=om.propertyIsEnumerable,sm=rm(function(){return arguments}())?rm:function(e){return tm(e)&&nm.call(e,'callee')&&!im.call(e,'callee')},um=sm,lm=Array.isArray,pm=lm,dm=ye,cm=ue(function(e,t){var a=t&&!t.nodeType&&t,r=a&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===a,n=o?Nf.Buffer:void 0,i=n?n.isBuffer:void 0;e.exports=i||dm}),gm=9007199254740991,hm=/^(?:0|[1-9]\d*)$/,fm=xe,mm=9007199254740991,_m=ve,ym='[object Arguments]',xm='[object Array]',vm='[object Boolean]',bm='[object Date]',Sm='[object Error]',Tm='[object Function]',Pm='[object Map]',wm='[object Number]',Cm='[object Object]',Fm='[object RegExp]',km='[object Set]',Em='[object String]',Mm='[object WeakMap]',Dm='[object ArrayBuffer]',Im='[object DataView]',Am='[object Float32Array]',Rm='[object Float64Array]',Lm='[object Int8Array]',Om='[object Int16Array]',jm='[object Int32Array]',zm='[object Uint8Array]',Gm='[object Uint8ClampedArray]',Nm='[object Uint16Array]',Um='[object Uint32Array]',qm={};qm[Am]=qm[Rm]=qm[Lm]=qm[Om]=qm[jm]=qm[zm]=qm[Gm]=qm[Nm]=qm[Um]=!0,qm[ym]=qm[xm]=qm[Dm]=qm[vm]=qm[Im]=qm[bm]=qm[Sm]=qm[Tm]=qm[Pm]=qm[wm]=qm[Cm]=qm[Fm]=qm[km]=qm[Em]=qm[Mm]=!1;var Bm=be,Vm=Se,Hm=ue(function(e,t){var a=t&&!t.nodeType&&t,r=a&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===a,n=o&&jf.process,i=function(){try{return n&&n.binding&&n.binding('util')}catch(t){}}();e.exports=i}),Wm=Hm&&Hm.isTypedArray,Xm=Wm?Vm(Wm):Bm,Ym=Xm,$m=Object.prototype,Km=$m.hasOwnProperty,Zm=Te,Qm=Object.prototype,Jm=Pe,e_=we,t_=e_(Object.keys,Object),a_=t_,r_=Object.prototype,o_=r_.hasOwnProperty,n_=Ce,i_=Fe,s_='[object AsyncFunction]',u_='[object Function]',l_='[object GeneratorFunction]',p_='[object Proxy]',d_=ke,c_=Ee,g_=Me,h_=De,f_=Ie,m_=Ae,__=Array.prototype,y_=__.splice,x_=Re,v_=Le,b_=Oe,S_=je;ze.prototype.clear=h_,ze.prototype['delete']=x_,ze.prototype.get=v_,ze.prototype.has=b_,ze.prototype.set=S_;var T_=ze,P_=Ge,w_=Ne,C_=Ue,F_=qe,k_=Nf['__core-js_shared__'],E_=k_,M_=function(){var e=/[^.]+$/.exec(E_&&E_.keys&&E_.keys.IE_PROTO||'');return e?'Symbol(src)_1.'+e:''}(),D_=Be,I_=Function.prototype,A_=I_.toString,R_=Ve,L_=/[\\^$.*+?()[\]{}|]/g,O_=/^\[object .+?Constructor\]$/,j_=Function.prototype,z_=Object.prototype,G_=j_.toString,N_=z_.hasOwnProperty,U_=RegExp('^'+G_.call(N_).replace(L_,'\\$&').replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,'$1.*?')+'$'),q_=He,B_=We,V_=Xe,H_=V_(Nf,'Map'),W_=H_,X_=V_(Object,'create'),Y_=X_,$_=Ye,K_=$e,Z_='__lodash_hash_undefined__',Q_=Object.prototype,J_=Q_.hasOwnProperty,ey=Ke,ty=Object.prototype,ay=ty.hasOwnProperty,ry=Ze,oy='__lodash_hash_undefined__',ny=Qe;Je.prototype.clear=$_,Je.prototype['delete']=K_,Je.prototype.get=ey,Je.prototype.has=ry,Je.prototype.set=ny;var iy=Je,sy=et,uy=tt,ly=at,py=rt,dy=ot,cy=nt,gy=it;st.prototype.clear=sy,st.prototype['delete']=py,st.prototype.get=dy,st.prototype.has=cy,st.prototype.set=gy;var hy=st,fy=200,my=ut;lt.prototype.clear=P_,lt.prototype['delete']=w_,lt.prototype.get=C_,lt.prototype.has=F_,lt.prototype.set=my;var _y=lt,yy='__lodash_hash_undefined__',xy=pt,vy=dt;ct.prototype.add=ct.prototype.push=xy,ct.prototype.has=vy;var by=ct,Sy=gt,Ty=ht,Py=1,wy=2,Cy=ft,Fy=Nf.Uint8Array,ky=Fy,Ey=mt,My=_t,Dy=1,Iy=2,Ay='[object Boolean]',Ry='[object Date]',Ly='[object Error]',Oy='[object Map]',jy='[object Number]',zy='[object RegExp]',Gy='[object Set]',Ny='[object String]',Uy='[object Symbol]',qy='[object ArrayBuffer]',By='[object DataView]',Vy=qf?qf.prototype:void 0,Hy=Vy?Vy.valueOf:void 0,Wy=yt,Xy=xt,Yy=vt,$y=bt,Ky=St,Zy=Object.prototype,Qy=Zy.propertyIsEnumerable,Jy=Object.getOwnPropertySymbols,ex=Jy?function(e){return null==e?[]:(e=Object(e),$y(Jy(e),function(t){return Qy.call(e,t)}))}:Ky,tx=ex,ax=Tt,rx=1,ox=Object.prototype,nx=ox.hasOwnProperty,ix=Pt,sx=V_(Nf,'DataView'),ux=sx,lx=V_(Nf,'Promise'),px=lx,dx=V_(Nf,'Set'),cx=dx,gx=V_(Nf,'WeakMap'),hx=gx,fx='[object Map]',mx='[object Object]',_x='[object Promise]',yx='[object Set]',xx='[object WeakMap]',vx='[object DataView]',bx=R_(ux),Sx=R_(W_),Tx=R_(px),Px=R_(cx),wx=R_(hx),Cx=em;(ux&&Cx(new ux(new ArrayBuffer(1)))!=vx||W_&&Cx(new W_)!=fx||px&&Cx(px.resolve())!=_x||cx&&Cx(new cx)!=yx||hx&&Cx(new hx)!=xx)&&(Cx=function(e){var t=em(e),a=t==mx?e.constructor:void 0,r=a?R_(a):'';if(r)switch(r){case bx:return vx;case Sx:return fx;case Tx:return _x;case Px:return yx;case wx:return xx;}return t});var Fx=Cx,kx=1,Ex='[object Arguments]',Mx='[object Array]',Dx='[object Object]',Ix=Object.prototype,Ax=Ix.hasOwnProperty,Rx=wt,Lx=Ct,Ox=Ft,jx=kt,zx=1,Gx=2,Nx=Et,Ux=Mt,qx=Dt,Bx=It,Vx=At,Hx='[object Symbol]',Wx=Rt,Xx=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Yx=/^\w*$/,$x=Lt,Kx='Expected a function';Ot.Cache=hy;var Zx=Ot,Qx=500,Jx=jt,ev=/^\./,tv=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,av=/\\(\\)?/g,rv=Jx(function(e){var t=[];return ev.test(e)&&t.push(''),e.replace(tv,function(e,a,r,o){t.push(r?o.replace(av,'$1'):a||e)}),t}),ov=rv,nv=1/0,iv=qf?qf.prototype:void 0,sv=iv?iv.toString:void 0,uv=zt,lv=Gt,pv=Nt,dv=1/0,cv=Ut,gv=qt,hv=Bt,fv=Vt,mv=Ht,_v=Wt,yv=1,xv=2,vv=Xt,bv=Yt,Sv=$t,Tv=Kt,Pv=Zt,wv=Qt,Cv=Jt,Fv=Cv(),kv=Fv,Ev=ea,Mv=ta,Dv=Mv(Ev),Iv=Dv,Av=aa,Rv=ra,Lv=oa,Ov=na,jv=ia,zv=sa,Gv=ua,Nv=la,Uv=0/0,qv=/^\s+|\s+$/g,Bv=/^[-+]0x[0-9a-f]+$/i,Vv=/^0b[01]+$/i,Hv=/^0o[0-7]+$/i,Wv=parseInt,Xv=pa,Yv=1/0,$v=1.7976931348623157e308,Kv=da,Zv=ca,Qv=bn,Jv=ga,eb=Gv(Jv),tb=eb,ab=function(){try{var e=V_(Object,'defineProperty');return e({},'',{}),e}catch(t){}}(),rb=ab,ob=ha,nb=Object.prototype,ib=nb.hasOwnProperty,sb=fa,ub=ma,lb=_a,pb=ya,db=qf?qf.isConcatSpreadable:void 0,cb=xa,gb=va,hb=ba,fb=Sa,mb=bn,_b=Ta,yb=Pa,xb=rb?function(e,t){return rb(e,'toString',{configurable:!0,enumerable:!1,value:yb(t),writable:!0})}:bv,vb=xb,bb=800,Sb=16,Tb=Date.now,Pb=wa,wb=Pb(vb),Cb=wb,Fb=Ca,kb=Fb(function(e,t){return null==e?{}:pb(e,t)}),Eb=kb,Mb=ue(function(t,e){!function(a){t.exports=a()}(function(){var e,t,a;return function p(d,e,t){function a(i,o){if(!e[i]){if(!d[i]){var n='function'==typeof _dereq_&&_dereq_;if(!o&&n)return n(i,!0);if(r)return r(i,!0);var s=new Error('Cannot find module \''+i+'\'');throw s.code='MODULE_NOT_FOUND',s}var c=e[i]={exports:{}};d[i][0].call(c.exports,function(t){var e=d[i][1][t];return a(e?e:t)},c,c.exports,p,d,e,t)}return e[i].exports}for(var r='function'==typeof _dereq_&&_dereq_,n=0;n<t.length;n++)a(t[n]);return a}({1:[function(e,t){t.exports=function(e){function t(e){var t=new a(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var a=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t){function a(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new u(16),this._normalQueue=new u(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=s}function r(e,t,a){this._lateQueue.push(e,t,a),this._queueTick()}function o(e,t,a){this._normalQueue.push(e,t,a),this._queueTick()}function n(e){this._normalQueue._pushOne(e),this._queueTick()}var i;try{throw new Error}catch(t){i=t}var s=e('./schedule'),u=e('./queue'),l=e('./util');a.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},a.prototype.hasCustomScheduler=function(){return this._customScheduler},a.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},a.prototype.disableTrampolineIfNecessary=function(){l.hasDevTools&&(this._trampolineEnabled=!1)},a.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},a.prototype.fatalError=function(t,e){e?(process.stderr.write('Fatal '+(t instanceof Error?t.stack:t)+'\n'),process.exit(2)):this.throwLater(t)},a.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),'undefined'!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(t){throw new Error('No async scheduler available\n\n    See http://goo.gl/MqrFmX\n')}},l.hasDevTools?(a.prototype.invokeLater=function(e,t,a){this._trampolineEnabled?r.call(this,e,t,a):this._schedule(function(){setTimeout(function(){e.call(t,a)},100)})},a.prototype.invoke=function(e,t,a){this._trampolineEnabled?o.call(this,e,t,a):this._schedule(function(){e.call(t,a)})},a.prototype.settlePromises=function(e){this._trampolineEnabled?n.call(this,e):this._schedule(function(){e._settlePromises()})}):(a.prototype.invokeLater=r,a.prototype.invoke=o,a.prototype.settlePromises=n),a.prototype._drainQueue=function(e){for(;0<e.length();){var t=e.shift();if('function'!=typeof t){t._settlePromises();continue}var a=e.shift(),r=e.shift();t.call(a,r)}},a.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},t.exports=a,t.exports.firstLineError=i},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t){t.exports=function(e,t,a,r){var o=!1,n=function(t,a){this._reject(a)},i=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(n,n,null,this,t)},s=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},u=function(t,e){e.promiseRejectionQueued||this._reject(t)};e.prototype.bind=function(n){o||(o=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var l=a(n),p=new e(t);p._propagateFrom(this,1);var d=this._target();if(p._setBoundTo(l),l instanceof e){var c={promiseRejectionQueued:!1,promise:p,target:d,bindingPromise:l};d._then(t,i,void 0,p,c),l._then(s,u,void 0,p,c),p._setOnCancel(l)}else p._resolveCallback(d);return p},e.prototype._setBoundTo=function(e){e===void 0?this._bitField&=-2097153:(this._bitField|=2097152,this._boundTo=e)},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,a){return e.resolve(a).bind(t)}}},{}],4:[function(e,t){var a;'undefined'!=typeof Promise&&(a=Promise);var r=e('./promise')();r.noConflict=function(){try{Promise===r&&(Promise=a)}catch(t){}return r},t.exports=r},{"./promise":22}],5:[function(e,t){var a=Object.create;if(a){var r=a(null),o=a(null);r[' size']=o[' size']=0}t.exports=function(t){function a(e,a){var r;if(null!=e&&(r=e[a]),'function'!=typeof r){var o='Object '+i.classString(e)+' has no method \''+i.toString(a)+'\'';throw new t.TypeError(o)}return r}function r(e){var t=this.pop(),r=a(e,t);return r.apply(e,this)}function o(e){return e[this]}function n(e){var t=+this;return 0>t&&(t=bn(0,t+e.length)),e[t]}var i=e('./util'),s=i.canEvaluate,u=i.isIdentifier,l;t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(r,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if(!!('number'==typeof e))t=n;else if(s){var a=l(e);t=null===a?o:a}else t=o;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t){t.exports=function(t,a,r,o){var n=e('./util'),i=n.tryCatch,s=n.errorObj,u=t._async;t.prototype['break']=t.prototype.cancel=function(){if(!o.cancellation())return this._warn('cancellation is disabled');for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var a=e._cancellationParent;if(null==a||!a._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}else e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=a}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return this._branchesRemainingToCancel===void 0||0>=this._branchesRemainingToCancel},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):!(this._branchHasCancelled(),!this._enoughBranchesHaveCancelled())&&(this._invokeOnCancel(),!0)},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){0<this._length()&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,a){if(n.isArray(t))for(var r=0;r<t.length;++r)this._doInvokeOnCancel(t[r],a);else if(t!==void 0)if('function'!=typeof t)t._resultCancelled(this);else if(!a){var o=i(t).call(this._boundValue());o===s&&(this._attachExtraTrace(o.e),u.throwLater(o.e))}},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t){t.exports=function(t){var a=e('./util'),r=e('./es5').keys,o=a.tryCatch,n=a.errorObj;return function(s,u,l){return function(p){var e=l._boundValue();predicateLoop:for(var d=0,i;d<s.length;++d)if(i=s[d],i===Error||null!=i&&i.prototype instanceof Error){if(p instanceof i)return o(u).call(e,p);}else if('function'==typeof i){var c=o(i).call(e,p);if(c===n)return c;if(c)return o(u).call(e,p)}else if(a.isObject(p)){for(var g=r(i),h=0,f;h<g.length;++h)if(f=g[h],i[f]!=p[f])continue predicateLoop;return o(u).call(e,p)}return t}}}},{"./es5":13,"./util":36}],8:[function(e,t){t.exports=function(e){function t(){this._trace=new t.CapturedTrace(a())}function a(){var e=o.length-1;return 0<=e?o[e]:void 0}var r=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=function(){if(r)return new t},t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var o=e.prototype._pushContext,n=e.prototype._popContext,i=e._peekContext,s=e.prototype._peekContext,u=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=o,e.prototype._popContext=n,e._peekContext=i,e.prototype._peekContext=s,e.prototype._promiseCreated=u,r=!1},r=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=a,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t){t.exports=function(t,a){function r(e,t){return{promise:t}}function o(){return!1}function n(e,t,a){var r=this;try{e(t,a,function(e){if('function'!=typeof e)throw new TypeError('onCancel must be a function, got: '+D.toString(e));r._attachCancellationCallback(e)})}catch(t){return t}}function i(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0===t?this._setOnCancel(e):D.isArray(t)?t.push(e):this._setOnCancel([t,e])}function s(){return this._onCancelField}function u(e){this._onCancelField=e}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function p(e,t){if(0!=(1&t)){this._cancellationParent=e;var a=e._branchesRemainingToCancel;void 0===a&&(a=0),e._branchesRemainingToCancel=a+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function d(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function c(){this._trace=new F(this._peekContext())}function g(e,t){if(I(e)){var a=this._trace;if(void 0!==a&&t&&(a=a._parent),void 0!==a)a.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=v(e);D.notEnumerableProp(e,'stack',r.message+'\n'+r.stack.join('\n')),D.notEnumerableProp(e,'__stackCleaned__',!0)}}}function h(e,a,r){if(te.warnings){var o=new M(e),n;if(a)r._attachExtraTrace(o);else if(te.longStackTraces&&(n=t._peekContext()))n.attachExtraTrace(o);else{var i=v(o);o.stack=i.message+'\n'+i.stack.join('\n')}K('warning',o)||b(o,'',!0)}}function f(e,t){for(var a=0;a<t.length-1;++a)t[a].push('From previous event:'),t[a]=t[a].join('\n');return a<t.length&&(t[a]=t[a].join('\n')),e+'\n'+t.join('\n')}function m(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function _(e){for(var t=e[0],a=1;a<e.length;++a){for(var r=e[a],o=t.length-1,n=t[o],i=-1,s=r.length-1;0<=s;--s)if(r[s]===n){i=s;break}for(var s=i,u;0<=s&&(u=r[s],t[o]===u);--s)t.pop(),o--;t=r}}function y(e){for(var t=[],a=0;a<e.length;++a){var r=e[a],o='    (No stack trace)'===r||O.test(r),n=o&&Q(r);o&&!n&&(z&&' '!==r.charAt(0)&&(r='    '+r),t.push(r))}return t}function x(e){for(var t=e.stack.replace(/\s+$/g,'').split('\n'),a=0,r;a<t.length&&(r=t[a],!('    (No stack trace)'===r||O.test(r)));++a);return 0<a&&'SyntaxError'!=e.name&&(t=t.slice(a)),t}function v(e){var t=e.stack,a=e.toString();return t='string'==typeof t&&0<t.length?x(e):['    (No stack trace)'],{message:a,stack:'SyntaxError'==e.name?t:y(t)}}function b(e,t,a){if('undefined'!=typeof console){var r;if(D.isObject(e)){var o=e.stack;r=t+j(o,e)}else r=t+(e+'');'function'==typeof H?H(r,a):('function'==typeof console.log||'object'==typeof console.log)&&console.log(r)}}function S(e,t,a,r){var o=!1;try{'function'==typeof t&&(o=!0,'rejectionHandled'===e?t(r):t(a,r))}catch(t){E.throwLater(t)}'unhandledRejection'===e?!K(e,a,r)&&!o&&b(a,'Unhandled rejection '):K(e,r)}function T(e){var t;if('function'==typeof e)t='[function '+(e.name||'anonymous')+']';else{t=e&&'function'==typeof e.toString?e.toString():D.toString(e);var a=/\[object [a-zA-Z0-9$_]+\]/;if(a.test(t))try{var r=JSON.stringify(e);t=r}catch(t){}0===t.length&&(t='(empty array)')}return'(<'+P(t)+'>, no stack trace)'}function P(e){var t=41;return e.length<t?e:e.substr(0,t-3)+'...'}function w(){return'function'==typeof ee}function C(e){var t=e.match(J);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function F(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ee(this,F),32<t&&this.uncycle()}var k=t._getDomain,E=t._async,M=e('./errors').Warning,D=e('./util'),I=D.canAttachTrace,A=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,R=/\((?:timers\.js):\d+:\d+\)/,L=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,O=null,j=null,z=!1,G=!(0==D.env('BLUEBIRD_DEBUG')||0),N=!!(0!=D.env('BLUEBIRD_WARNINGS')&&(G||D.env('BLUEBIRD_WARNINGS'))),U=!!(0!=D.env('BLUEBIRD_LONG_STACK_TRACES')&&(G||D.env('BLUEBIRD_LONG_STACK_TRACES'))),q=0!=D.env('BLUEBIRD_W_FORGOTTEN_RETURN')&&(N||!!D.env('BLUEBIRD_W_FORGOTTEN_RETURN')),B,V,H;t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=524288|-1048577&e._bitField},t.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var e=this;setTimeout(function(){e._notifyUnhandledRejection()},1)}},t.prototype._notifyUnhandledRejectionIsHandled=function(){S('rejectionHandled',B,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField|=268435456},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),S('unhandledRejection',V,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField|=262144},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField&=-262145},t.prototype._isUnhandledRejectionNotified=function(){return 0<(262144&this._bitField)},t.prototype._setRejectionIsUnhandled=function(){this._bitField|=1048576},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField&=-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return 0<(1048576&this._bitField)},t.prototype._warn=function(e,t,a){return h(e,t,a||this)},t.onPossiblyUnhandledRejection=function(e){var t=k();V='function'==typeof e?null===t?e:D.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=k();B='function'==typeof e?null===t?e:D.domainBind(t,e):void 0};var W=function(){};t.longStackTraces=function(){if(E.haveItemsQueued()&&!te.longStackTraces)throw new Error('cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n');if(!te.longStackTraces&&w()){var e=t.prototype._captureStackTrace,r=t.prototype._attachExtraTrace;te.longStackTraces=!0,W=function(){if(E.haveItemsQueued()&&!te.longStackTraces)throw new Error('cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n');t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=r,a.deactivateLongStackTraces(),E.enableTrampoline(),te.longStackTraces=!1},t.prototype._captureStackTrace=c,t.prototype._attachExtraTrace=g,a.activateLongStackTraces(),E.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return te.longStackTraces&&w()};var X=function(){try{if('function'==typeof CustomEvent){var e=new CustomEvent('CustomEvent');return D.global.dispatchEvent(e),function(e,t){var a=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!D.global.dispatchEvent(a)}}if('function'==typeof Event){var e=new Event('CustomEvent');return D.global.dispatchEvent(e),function(e,t){var a=new Event(e.toLowerCase(),{cancelable:!0});return a.detail=t,!D.global.dispatchEvent(a)}}var e=document.createEvent('CustomEvent');return e.initCustomEvent('testingtheevent',!1,!0,{}),D.global.dispatchEvent(e),function(e,t){var a=document.createEvent('CustomEvent');return a.initCustomEvent(e.toLowerCase(),!1,!0,t),!D.global.dispatchEvent(a)}}catch(t){}return function(){return!1}}(),Y=function(){return D.isNode?function(){return process.emit.apply(process,arguments)}:D.global?function(e){var t='on'+e.toLowerCase(),a=D.global[t];return!!a&&(a.apply(D.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),$={promiseCreated:r,promiseFulfilled:r,promiseRejected:r,promiseResolved:r,promiseCancelled:r,promiseChained:function(e,t,a){return{promise:t,child:a}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,a){return{reason:t,promise:a}},rejectionHandled:r},K=function(e){var t=!1;try{t=Y.apply(null,arguments)}catch(a){E.throwLater(a),t=!0}var a=!1;try{a=X(e,$[e].apply(null,arguments))}catch(t){E.throwLater(t),a=!0}return a||t};t.config=function(e){if(e=Object(e),'longStackTraces'in e&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&W()),'warnings'in e){var a=e.warnings;te.warnings=!!a,q=te.warnings,D.isObject(a)&&'wForgottenReturn'in a&&(q=!!a.wForgottenReturn)}if('cancellation'in e&&e.cancellation&&!te.cancellation){if(E.haveItemsQueued())throw new Error('cannot enable cancellation after promises are in use');t.prototype._clearCancellationData=l,t.prototype._propagateFrom=p,t.prototype._onCancel=s,t.prototype._setOnCancel=u,t.prototype._attachCancellationCallback=i,t.prototype._execute=n,Z=p,te.cancellation=!0}return'monitoring'in e&&(e.monitoring&&!te.monitoring?(te.monitoring=!0,t.prototype._fireEvent=K):!e.monitoring&&te.monitoring&&(te.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(e,t,a){try{e(t,a)}catch(t){return t}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(){},t.prototype._attachCancellationCallback=function(){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(){};var Z=function(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)},Q=function(){return!1},J=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;D.inherits(F,Error),a.CapturedTrace=F,F.prototype.uncycle=function(){var e=this._length;if(!(2>e)){for(var t=[],a={},r=0,o=this;void 0!==o;++r)t.push(o),o=o._parent;e=this._length=r;for(var r=e-1,n;0<=r;--r)n=t[r].stack,void 0===a[n]&&(a[n]=r);for(var r=0;r<e;++r){var i=t[r].stack,s=a[i];if(void 0!==s&&s!==r){0<s&&(t[s-1]._parent=void 0,t[s-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var u=0<r?t[r-1]:this;s<e-1?(u._parent=t[s+1],u._parent.uncycle(),u._length=u._parent._length+1):(u._parent=void 0,u._length=1);for(var l=u._length+1,p=r-2;0<=p;--p)t[p]._length=l,l++;return}}}},F.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=v(e),a=t.message,r=[t.stack],o=this;void 0!==o;)r.push(y(o.stack.split('\n'))),o=o._parent;_(r),m(r),D.notEnumerableProp(e,'stack',f(a,r)),D.notEnumerableProp(e,'__stackCleaned__',!0)}};var ee=function(){var e=/^\s*at\s*/,t=function(e,t){return'string'==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():T(t)};if('number'==typeof Error.stackTraceLimit&&'function'==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,O=e,j=t;var a=Error.captureStackTrace;return Q=function(e){return A.test(e)},function(e,t){Error.stackTraceLimit+=6,a(e,t),Error.stackTraceLimit-=6}}var r=new Error;if('string'==typeof r.stack&&0<=r.stack.split('\n')[0].indexOf('stackDetection@'))return O=/@/,j=t,z=!0,function(e){e.stack=new Error().stack};var o;try{throw new Error}catch(t){o='stack'in t}return!('stack'in r)&&o&&'number'==typeof Error.stackTraceLimit?(O=e,j=t,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(a){t.stack=a.stack}Error.stackTraceLimit-=6}):(j=function(e,t){return'string'==typeof e?e:('object'==typeof t||'function'==typeof t)&&void 0!==t.name&&void 0!==t.message?t.toString():T(t)},null)}([]);'undefined'!=typeof console&&'undefined'!=typeof console.warn&&(H=function(e){console.warn(e)},D.isNode&&process.stderr.isTTY?H=function(e,t){var a=t?'\x1B[33m':'\x1B[31m';console.warn(a+e+'\x1B[0m\n')}:!D.isNode&&'string'==typeof new Error().stack&&(H=function(e,t){console.warn('%c'+e,t?'color: darkorange':'color: red')}));var te={warnings:N,longStackTraces:!1,cancellation:!1,monitoring:!1};return U&&t.longStackTraces(),{longStackTraces:function(){return te.longStackTraces},warnings:function(){return te.warnings},cancellation:function(){return te.cancellation},monitoring:function(){return te.monitoring},propagateFromFunction:function(){return Z},boundValueFunction:function(){return d},checkForgottenReturns:function(e,t,a,r,o){if(void 0===e&&null!==t&&q){if(void 0!==o&&o._returnedNonUndefined())return;if(0==(65535&r._bitField))return;a&&(a+=' ');var n='',s='';if(t._trace){for(var u=t._trace.stack.split('\n'),l=y(u),p=l.length-1,i;0<=p;--p)if(i=l[p],!R.test(i)){var d=i.match(L);d&&(n='at '+d[1]+':'+d[2]+':'+d[3]+' ');break}if(0<l.length)for(var c=l[0],p=0;p<u.length;++p)if(u[p]===c){0<p&&(s='\n'+u[p-1]);break}}var g='a promise was created in a '+a+'handler '+n+'but was not returned from it, see http://goo.gl/rRqMUw'+s;r._warn(g,!0,t)}},setBounds:function(e,t){if(w()){for(var a=e.stack.split('\n'),r=t.stack.split('\n'),o=-1,n=-1,s=0,i,u,l;s<a.length;++s)if(l=C(a[s]),l){i=l.fileName,o=l.line;break}for(var s=0,l;s<r.length;++s)if(l=C(r[s]),l){u=l.fileName,n=l.line;break}0>o||0>n||!i||!u||i!==u||o>=n||(Q=function(e){if(A.test(e))return!0;var t=C(e);return t&&t.fileName===i&&o<=t.line&&t.line<=n})}},warn:h,deprecated:function(e,t){var a=e+' is deprecated and will be removed in a future version.';return t&&(a+=' Use '+t+' instead.'),h(a)},CapturedTrace:F,fireDomEvent:X,fireGlobalEvent:Y}}},{"./errors":12,"./util":36}],10:[function(e,t){t.exports=function(e){function t(){return this.value}function a(){throw this.reason}e.prototype['return']=e.prototype.thenReturn=function(a){return a instanceof e&&a.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:a},void 0)},e.prototype['throw']=e.prototype.thenThrow=function(e){return this._then(a,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(1>=arguments.length)return this._then(void 0,a,void 0,{reason:e},void 0);var t=arguments[1];return this.caught(e,function(){throw t})},e.prototype.catchReturn=function(a){if(1>=arguments.length)return a instanceof e&&a.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:a},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();return this.caught(a,function(){return r})}}},{}],11:[function(e,t){t.exports=function(e,t){function a(){return o(this)}var r=e.reduce,o=e.all;e.prototype.each=function(e){return r(this,e,t,0)._then(a,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return r(this,e,t,t)},e.each=function(e,o){return r(e,o,t,0)._then(a,void 0,void 0,e,void 0)},e.mapSeries=function(e,a){return r(e,a,t,t)}}},{}],12:[function(e,t){function a(e,t){function a(r){return this instanceof a?void(l(this,'message','string'==typeof r?r:t),l(this,'name',e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)):new a(r)}return u(a,Error),a}function r(e){return this instanceof r?void(l(this,'name','OperationalError'),l(this,'message',e),this.cause=e,this.isOperational=!0,e instanceof Error?(l(this,'message',e.message),l(this,'stack',e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)):new r(e)}var o=e('./es5'),n=o.freeze,s=e('./util'),u=s.inherits,l=s.notEnumerableProp,p=a('Warning','warning'),d=a('CancellationError','cancellation error'),c=a('TimeoutError','timeout error'),g=a('AggregateError','aggregate error'),h,f;try{h=TypeError,f=RangeError}catch(t){h=a('TypeError','type error'),f=a('RangeError','range error')}for(var m='join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse'.split(' '),_=0;_<m.length;++_)'function'==typeof Array.prototype[m[_]]&&(g.prototype[m[_]]=Array.prototype[m[_]]);o.defineProperty(g.prototype,'length',{value:0,configurable:!1,writable:!0,enumerable:!0}),g.prototype.isOperational=!0;var y=0;g.prototype.toString=function(){var e=Array(4*y+1).join(' '),t='\n'+e+'AggregateError of:\n';y++,e=Array(4*y+1).join(' ');for(var a=0;a<this.length;++a){for(var r=this[a]===this?'[Circular AggregateError]':this[a]+'',o=r.split('\n'),n=0;n<o.length;++n)o[n]=e+o[n];r=o.join('\n'),t+=r+'\n'}return y--,t},u(r,Error);var i=Error.__BluebirdErrorTypes__;i||(i=n({CancellationError:d,TimeoutError:c,OperationalError:r,RejectionError:r,AggregateError:g}),o.defineProperty(Error,'__BluebirdErrorTypes__',{value:i,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:h,RangeError:f,CancellationError:i.CancellationError,OperationalError:i.OperationalError,TimeoutError:i.TimeoutError,AggregateError:i.AggregateError,Warning:p}},{"./es5":13,"./util":36}],13:[function(e,t){var a=function(){return this===void 0}();if(a)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:a,propertyIsWritable:function(e,t){var a=Object.getOwnPropertyDescriptor(e,t);return!!(!a||a.writable||a.set)}};else{var r={}.hasOwnProperty,o={}.toString,n={}.constructor.prototype,i=function(e){var t=[];for(var a in e)r.call(e,a)&&t.push(a);return t},s=function(e,t){return{value:e[t]}},u=function(e,t,a){return e[t]=a.value,e},l=function(e){return e},p=function(e){try{return Object(e).constructor.prototype}catch(t){return n}},d=function(e){try{return'[object Array]'===o.call(e)}catch(t){return!1}};t.exports={isArray:d,keys:i,names:i,defineProperty:u,getDescriptor:s,freeze:l,getPrototypeOf:p,isES5:a,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t){t.exports=function(e,t){var a=e.map;e.prototype.filter=function(e,r){return a(this,e,r,t)},e.filter=function(e,r,o){return a(e,r,o,t)}}},{}],15:[function(e,t){t.exports=function(t,a,r){function o(e,t,a){this.promise=e,this.type=t,this.handler=a,this.called=!1,this.cancelPromise=null}function n(e){this.finallyHandler=e}function i(e,t){return null!=e.cancelPromise&&(1<arguments.length?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return l.call(this,this.promise._target()._settledValue())}function u(e){if(!i(this,e))return c.e=e,c}function l(e){var o=this.promise,l=this.handler;if(!this.called){this.called=!0;var p=this.isFinallyHandler()?l.call(o._boundValue()):l.call(o._boundValue(),e);if(p===r)return p;if(void 0!==p){o._setReturnedNonUndefined();var g=a(p,o);if(g instanceof t){if(null!=this.cancelPromise){if(g._isCancelled()){var h=new d('late cancellation observer');return o._attachExtraTrace(h),c.e=h,c}g.isPending()&&g._attachCancellationCallback(new n(this))}return g._then(s,u,void 0,this,void 0)}}}return o.isRejected()?(i(this),c.e=e,c):(i(this),e)}var p=e('./util'),d=t.CancellationError,c=p.errorObj,g=e('./catch_filter')(r);return o.prototype.isFinallyHandler=function(){return 0===this.type},n.prototype._resultCancelled=function(){i(this.finallyHandler)},t.prototype._passThrough=function(e,t,a,r){return'function'==typeof e?this._then(a,r,void 0,new o(this,t,e),void 0):this.then()},t.prototype.lastly=t.prototype['finally']=function(e){return this._passThrough(e,0,l,l)},t.prototype.tap=function(e){return this._passThrough(e,1,l)},t.prototype.tapCatch=function(e){var a=arguments.length;if(1===a)return this._passThrough(e,1,void 0,l);var r=Array(a-1),o=0,n;for(n=0;n<a-1;++n){var i=arguments[n];if(p.isObject(i))r[o++]=i;else return t.reject(new TypeError('tapCatch statement predicate: expecting an object but got '+p.classString(i)))}r.length=o;var s=arguments[n];return this._passThrough(g(r,s,this),1,void 0,l)},o}},{"./catch_filter":7,"./util":36}],16:[function(e,t){t.exports=function(t,a,r,o,n,i){function s(e,a,r){for(var n=0;n<a.length;++n){r._pushContext();var i=g(a[n])(e);if(r._popContext(),i===c){r._pushContext();var s=t.reject(c.e);return r._popContext(),s}var u=o(i,r);if(u instanceof t)return u}return null}function u(e,a,o,n){if(i.cancellation()){var s=new t(r),u=this._finallyPromise=new t(r);this._promise=s.lastly(function(){return u}),s._captureStackTrace(),s._setOnCancel(this)}else{var l=this._promise=new t(r);l._captureStackTrace()}this._stack=n,this._generatorFunction=e,this._receiver=a,this._generator=void 0,this._yieldHandlers='function'==typeof o?[o].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}var l=e('./errors'),p=l.TypeError,d=e('./util'),c=d.errorObj,g=d.tryCatch,h=[];d.inherits(u,n),u.prototype._isResolved=function(){return null===this._promise},u.prototype._cleanup=function(){this._promise=this._generator=null,i.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},u.prototype._promiseCancelled=function(){if(!this._isResolved()){var e='undefined'!=typeof this._generator['return'],a;if(!e){var r=new t.CancellationError('generator .return() sentinel');t.coroutine.returnSentinel=r,this._promise._attachExtraTrace(r),this._promise._pushContext(),a=g(this._generator['throw']).call(this._generator,r),this._promise._popContext()}else this._promise._pushContext(),a=g(this._generator['return']).call(this._generator,void 0),this._promise._popContext();this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(a)}},u.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=g(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=g(this._generator['throw']).call(this._generator,e);this._promise._popContext(),this._continue(t)},u.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},u.prototype.promise=function(){return this._promise},u.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},u.prototype._continue=function(e){var a=this._promise;if(e===c)return this._cleanup(),this._cancellationPhase?a.cancel():a._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?a.cancel():a._resolveCallback(r);var n=o(r,this._promise);if(!(n instanceof t)&&(n=s(n,this._yieldHandlers,this._promise),null===n))return void this._promiseRejected(new p('A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n'.replace('%s',r+'')+'From coroutine:\n'+this._stack.split('\n').slice(1,-7).join('\n')));n=n._target();var i=n._bitField;0==(50397184&i)?(this._yieldedPromise=n,n._proxy(this,null)):0==(33554432&i)?0==(16777216&i)?this._promiseCancelled():t._async.invoke(this._promiseRejected,this,n._reason()):t._async.invoke(this._promiseFulfilled,this,n._value())},t.coroutine=function(e,t){if('function'!=typeof e)throw new p('generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n');var a=Object(t).yieldHandler,r=new Error().stack;return function(){var t=e.apply(this,arguments),o=new u(void 0,void 0,a,r),n=o.promise();return o._generator=t,o._promiseFulfilled(void 0),n}},t.coroutine.addYieldHandler=function(e){if('function'!=typeof e)throw new p('expecting a function but got '+d.classString(e));h.push(e)},t.spawn=function(e){if(i.deprecated('Promise.spawn()','Promise.coroutine()'),'function'!=typeof e)return a('generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n');var r=new u(e,this),o=r.promise();return r._run(t.spawn),o}}},{"./errors":12,"./util":36}],17:[function(e,t){t.exports=function(t,a){var r=e('./util'),o=r.canEvaluate,n=r.tryCatch,i=r.errorObj;t.join=function(){var e=arguments.length-1,t;if(0<e&&'function'==typeof arguments[e]){t=arguments[e];var r}var o=[].slice.call(arguments);t&&o.pop();var r=new a(o).promise();return t===void 0?r:r.spread(t)}}},{"./util":36}],18:[function(e,t){t.exports=function(t,a,r,o,n,i){function s(e,t,a,r){this.constructor$(e),this._promise._captureStackTrace();var o=l();this._callback=null===o?t:p.domainBind(o,t),this._preservedValues=r===n?Array(this.length()):null,this._limit=a,this._inFlight=0,this._queue=[],g.invoke(this._asyncInit,this,void 0)}function u(e,a,o,n){if('function'!=typeof a)return r('expecting a function but got '+p.classString(a));var i=0;if(void 0!==o)if('object'==typeof o&&null!==o){if('number'!=typeof o.concurrency)return t.reject(new TypeError('\'concurrency\' must be a number but it is '+p.classString(o.concurrency)));i=o.concurrency}else return t.reject(new TypeError('options argument must be an object but it is '+p.classString(o)));return i='number'==typeof i&&isFinite(i)&&1<=i?i:0,new s(e,a,i,n).promise()}var l=t._getDomain,p=e('./util'),d=p.tryCatch,c=p.errorObj,g=t._async;p.inherits(s,a),s.prototype._asyncInit=function(){this._init$(void 0,-2)},s.prototype._init=function(){},s.prototype._promiseFulfilled=function(e,a){var r=this._values,n=this.length(),s=this._preservedValues,u=this._limit;if(!(0>a)){if(1<=u&&this._inFlight>=u)return r[a]=e,this._queue.push(a),!1;null!==s&&(s[a]=e);var l=this._promise,p=this._callback,g=l._boundValue();l._pushContext();var h=d(p).call(g,e,a,n),f=l._popContext();if(i.checkForgottenReturns(h,f,null===s?'Promise.map':'Promise.filter',l),h===c)return this._reject(h.e),!0;var m=o(h,this._promise);if(m instanceof t){m=m._target();var _=m._bitField;if(0==(50397184&_))return 1<=u&&this._inFlight++,r[a]=m,m._proxy(this,-1*(a+1)),!1;if(0!=(33554432&_))h=m._value();else return 0==(16777216&_)?(this._cancel(),!0):(this._reject(m._reason()),!0)}r[a]=h}else if(a=-1*a-1,r[a]=e,1<=u&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0;var y=++this._totalResolved;return!!(y>=n)&&(null===s?this._resolve(r):this._filter(r,s),!0)},s.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,a=this._values;0<e.length&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(a[r],r)}},s.prototype._filter=function(e,t){for(var a=t.length,r=Array(a),o=0,n=0;n<a;++n)e[n]&&(r[o++]=t[n]);r.length=o,this._resolve(r)},s.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return u(this,e,t,null)},t.map=function(e,t,a,r){return u(e,t,a,r)}}},{"./util":36}],19:[function(e,t){t.exports=function(t,a,r,o,n){var i=e('./util'),s=i.tryCatch;t.method=function(e){if('function'!=typeof e)throw new t.TypeError('expecting a function but got '+i.classString(e));return function(){var r=new t(a);r._captureStackTrace(),r._pushContext();var o=s(e).apply(this,arguments),i=r._popContext();return n.checkForgottenReturns(o,i,'Promise.method',r),r._resolveFromSyncValue(o),r}},t.attempt=t['try']=function(e){if('function'!=typeof e)return o('expecting a function but got '+i.classString(e));var r=new t(a);r._captureStackTrace(),r._pushContext();var u;if(1<arguments.length){n.deprecated('calling Promise.try with more than 1 argument');var l=arguments[1],p=arguments[2];u=i.isArray(l)?s(e).apply(p,l):s(e).call(p,l)}else u=s(e)();var d=r._popContext();return n.checkForgottenReturns(u,d,'Promise.try',r),r._resolveFromSyncValue(u),r},t.prototype._resolveFromSyncValue=function(e){e===i.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t){function a(e){return e instanceof Error&&u.getPrototypeOf(e)===Error.prototype}function r(e){var t;if(a(e)){t=new s(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var r=u.keys(e),n=0,i;n<r.length;++n)i=r[n],l.test(i)||(t[i]=e[i]);return t}return o.markAsOriginatingFromRejection(e),e}var o=e('./util'),n=o.maybeWrapAsError,i=e('./errors'),s=i.OperationalError,u=e('./es5'),l=/^(?:name|message|stack|cause)$/;t.exports=function(e,t){return function(a,o){if(null!==e){if(a){var i=r(n(a));e._attachExtraTrace(i),e._reject(i)}else if(!t)e._fulfill(o);else{var s=[].slice.call(arguments,1);e._fulfill(s)}e=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t){t.exports=function(t){function a(e,t){var a=this;if(!n.isArray(e))return r.call(a,e,t);var o=s(t).apply(a._boundValue(),[null].concat(e));o===u&&i.throwLater(o.e)}function r(e,t){var a=this,r=a._boundValue(),o=e===void 0?s(t).call(r,null):s(t).call(r,null,e);o===u&&i.throwLater(o.e)}function o(e,t){var a=this;if(!e){var r=new Error(e+'');r.cause=e,e=r}var o=s(t).call(a._boundValue(),e);o===u&&i.throwLater(o.e)}var n=e('./util'),i=t._async,s=n.tryCatch,u=n.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if('function'==typeof e){var n=r;t!==void 0&&Object(t).spread&&(n=a),this._then(n,o,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t){t.exports=function(){function a(){}function r(e,t){if(null==e||e.constructor!==o)throw new y('the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n');if('function'!=typeof t)throw new y('expecting a function but got '+c.classString(t))}function o(e){e!==v&&r(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent('promiseCreated',this)}function n(e){this.promise._resolveCallback(e)}function i(e){this.promise._rejectCallback(e,!1)}function s(e){var t=new o(v);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var u=function(){return new y('circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n')},l=function(){return new o.PromiseInspection(this._target())},p=function(e){return o.reject(new y(e))},d={},c=e('./util'),g;g=c.isNode?function(){var e=process.domain;return void 0===e&&(e=null),e}:function(){return null},c.notEnumerableProp(o,'_getDomain',g);var h=e('./es5'),f=e('./async'),m=new f;h.defineProperty(o,'_async',{value:m});var _=e('./errors'),y=o.TypeError=_.TypeError;o.RangeError=_.RangeError;var x=o.CancellationError=_.CancellationError;o.TimeoutError=_.TimeoutError,o.OperationalError=_.OperationalError,o.RejectionError=_.OperationalError,o.AggregateError=_.AggregateError;var v=function(){},b={},S={},T=e('./thenables')(o,v),P=e('./promise_array')(o,v,T,p,a),w=e('./context')(o),C=w.create,F=e('./debuggability')(o,w),k=F.CapturedTrace,E=e('./finally')(o,T,S),M=e('./catch_filter')(S),D=e('./nodeback'),I=c.errorObj,A=c.tryCatch;return o.prototype.toString=function(){return'[object Promise]'},o.prototype.caught=o.prototype['catch']=function(e){var t=arguments.length;if(1<t){var a=Array(t-1),r=0,o;for(o=0;o<t-1;++o){var n=arguments[o];if(c.isObject(n))a[r++]=n;else return p('Catch statement predicate: expecting an object but got '+c.classString(n))}return a.length=r,e=arguments[o],this.then(void 0,M(a,e,this))}return this.then(void 0,e)},o.prototype.reflect=function(){return this._then(l,l,void 0,this,void 0)},o.prototype.then=function(e,t){if(F.warnings()&&0<arguments.length&&'function'!=typeof e&&'function'!=typeof t){var a='.then() only accepts functions but was passed: '+c.classString(e);1<arguments.length&&(a+=', '+c.classString(t)),this._warn(a)}return this._then(e,t,void 0,void 0,void 0)},o.prototype.done=function(e,t){var a=this._then(e,t,void 0,void 0,void 0);a._setIsFinal()},o.prototype.spread=function(e){return'function'==typeof e?this.all()._then(e,void 0,void 0,b,void 0):p('expecting a function but got '+c.classString(e))},o.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},o.prototype.all=function(){return 0<arguments.length&&this._warn('.all() was passed arguments but it does not take any'),new P(this).promise()},o.prototype.error=function(e){return this.caught(c.originatesFromRejection,e)},o.getNewLibraryCopy=t.exports,o.is=function(e){return e instanceof o},o.fromNode=o.fromCallback=function(e){var t=new o(v);t._captureStackTrace();var a=!!(1<arguments.length)&&!!Object(arguments[1]).multiArgs,r=A(e)(D(t,a));return r===I&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},o.all=function(e){return new P(e).promise()},o.cast=function(e){var t=T(e);return t instanceof o||(t=new o(v),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(e){var t=new o(v);return t._captureStackTrace(),t._rejectCallback(e,!0),t},o.setScheduler=function(e){if('function'!=typeof e)throw new y('expecting a function but got '+c.classString(e));return m.setScheduler(e)},o.prototype._then=function(e,t,a,r,n){var i=void 0!==n,s=i?n:new o(v),u=this._target(),l=u._bitField;i||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(0==(50397184&l)?r=u===this?void 0:this._boundTo:r=this._boundValue()),this._fireEvent('promiseChained',this,s));var p=g();if(0!=(50397184&l)){var d=u._settlePromiseCtx,h,f;0==(33554432&l)?0==(16777216&l)?(d=u._settlePromiseLateCancellationObserver,f=new x('late cancellation observer'),u._attachExtraTrace(f),h=t):(f=u._fulfillmentHandler0,h=t,u._unsetRejectionIsUnhandled()):(f=u._rejectionHandler0,h=e),m.invoke(d,u,{handler:null===p?h:'function'==typeof h&&c.domainBind(p,h),promise:s,receiver:r,value:f})}else u._addCallbacks(e,t,s,r,p);return s},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},o.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},o.prototype._setFulfilled=function(){this._bitField|=33554432,this._fireEvent('promiseFulfilled',this)},o.prototype._setRejected=function(){this._bitField|=16777216,this._fireEvent('promiseRejected',this)},o.prototype._setFollowing=function(){this._bitField|=67108864,this._fireEvent('promiseResolved',this)},o.prototype._setIsFinal=function(){this._bitField|=4194304},o.prototype._isFinal=function(){return 0<(4194304&this._bitField)},o.prototype._unsetCancelled=function(){this._bitField&=-65537},o.prototype._setCancelled=function(){this._bitField|=65536,this._fireEvent('promiseCancelled',this)},o.prototype._setWillBeCancelled=function(){this._bitField|=8388608},o.prototype._setAsyncGuaranteed=function(){m.hasCustomScheduler()||(this._bitField|=134217728)},o.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==d)return void 0===t&&this._isBound()?this._boundValue():t},o.prototype._promiseAt=function(e){return this[4*e-4+2]},o.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},o.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(e){var t=e._bitField,a=e._fulfillmentHandler0,r=e._rejectionHandler0,o=e._promise0,n=e._receiverAt(0);void 0===n&&(n=d),this._addCallbacks(a,r,o,n,null)},o.prototype._migrateCallbackAt=function(e,t){var a=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),o=e._promiseAt(t),n=e._receiverAt(t);void 0===n&&(n=d),this._addCallbacks(a,r,o,n,null)},o.prototype._addCallbacks=function(e,t,a,r,o){var n=this._length();if(65531<=n&&(n=0,this._setLength(0)),0===n)this._promise0=a,this._receiver0=r,'function'==typeof e&&(this._fulfillmentHandler0=null===o?e:c.domainBind(o,e)),'function'==typeof t&&(this._rejectionHandler0=null===o?t:c.domainBind(o,t));else{var i=4*n-4;this[i+2]=a,this[i+3]=r,'function'==typeof e&&(this[i+0]=null===o?e:c.domainBind(o,e)),'function'==typeof t&&(this[i+1]=null===o?t:c.domainBind(o,t))}return this._setLength(n+1),n},o.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},o.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(u(),!1);var a=T(e,this);if(!(a instanceof o))return this._fulfill(e);t&&this._propagateFrom(a,2);var r=a._target();if(r===this)return void this._reject(u());var n=r._bitField;if(0==(50397184&n)){var s=this._length();0<s&&r._migrateCallback0(this);for(var l=1;l<s;++l)r._migrateCallbackAt(this,l);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&n))this._fulfill(r._value());else if(0!=(16777216&n))this._reject(r._reason());else{var i=new x('late cancellation observer');r._attachExtraTrace(i),this._reject(i)}}},o.prototype._rejectCallback=function(e,t,a){var r=c.ensureErrorObject(e),o=r===e;if(!o&&!a&&F.warnings()){var n='a promise was rejected with a non-error: '+c.classString(e);this._warn(n,!0)}this._attachExtraTrace(r,!!t&&o),this._reject(e)},o.prototype._resolveFromExecutor=function(e){if(e!==v){var t=this;this._captureStackTrace(),this._pushContext();var a=!0,o=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,a)});a=!1,this._popContext(),void 0!==o&&t._rejectCallback(o,!0)}},o.prototype._settlePromiseFromHandler=function(e,t,a,r){var o=r._bitField;if(0==(65536&o)){r._pushContext();var n;t===b?a&&'number'==typeof a.length?n=A(e).apply(this._boundValue(),a):(n=I,n.e=new y('cannot .spread() a non-array: '+c.classString(a))):n=A(e).call(t,a);var i=r._popContext();o=r._bitField,0!=(65536&o)||(n===S?r._reject(a):n===I?r._rejectCallback(n.e,!1):(F.checkForgottenReturns(n,i,'',r,this),r._resolveCallback(n)))}},o.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(e){this._rejectionHandler0=e},o.prototype._settlePromise=function(e,t,r,n){var i=e instanceof o,s=this._bitField,u=0!=(134217728&s);0==(65536&s)?'function'==typeof t?i?(u&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,r,n,e)):t.call(r,n,e):r instanceof a?!r._isResolved()&&(0==(33554432&s)?r._promiseRejected(n,e):r._promiseFulfilled(n,e)):i&&(u&&e._setAsyncGuaranteed(),0==(33554432&s)?e._reject(n):e._fulfill(n)):(i&&e._invokeInternalOnCancel(),r instanceof E&&r.isFinallyHandler()?(r.cancelPromise=e,A(t).call(r,n)===I&&e._reject(I.e)):t===l?e._fulfill(l.call(r)):r instanceof a?r._promiseCancelled(e):i||e instanceof P?e._cancel():r.cancel())},o.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,a=e.promise,r=e.receiver,n=e.value;'function'==typeof t?a instanceof o?this._settlePromiseFromHandler(t,r,n,a):t.call(r,n,a):a instanceof o&&a._reject(n)},o.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},o.prototype._settlePromise0=function(e,t){var a=this._promise0,r=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(a,e,r,t)},o.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},o.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var a=u();return this._attachExtraTrace(a),this._reject(a)}this._setFulfilled(),this._rejectionHandler0=e,0<(65535&t)&&(0==(134217728&t)?m.settlePromises(this):this._settlePromises())}},o.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16))return this._setRejected(),this._fulfillmentHandler0=e,this._isFinal()?m.fatalError(e,c.isNode):void(0<(65535&t)?m.settlePromises(this):this._ensurePossibleRejectionHandled())},o.prototype._fulfillPromises=function(e,t){for(var a=1;a<e;a++){var r=this._fulfillmentHandlerAt(a),o=this._promiseAt(a),n=this._receiverAt(a);this._clearCallbackDataAtIndex(a),this._settlePromise(o,r,n,t)}},o.prototype._rejectPromises=function(e,t){for(var a=1;a<e;a++){var r=this._rejectionHandlerAt(a),o=this._promiseAt(a),n=this._receiverAt(a);this._clearCallbackDataAtIndex(a),this._settlePromise(o,r,n,t)}},o.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(0<t){if(0!=(16842752&e)){var a=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,a,e),this._rejectPromises(t,a)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var e=this._bitField;return 0==(33554432&e)?0==(16777216&e)?void 0:this._fulfillmentHandler0:this._rejectionHandler0},o.defer=o.pending=function(){F.deprecated('Promise.defer','new Promise');var e=new o(v);return{promise:e,resolve:n,reject:i}},c.notEnumerableProp(o,'_makeSelfResolutionError',u),e('./method')(o,v,T,p,F),e('./bind')(o,v,T,F),e('./cancel')(o,P,p,F),e('./direct_resolve')(o),e('./synchronous_inspection')(o),e('./join')(o,P,T,v,m,g),o.Promise=o,o.version='3.5.1',e('./map.js')(o,P,p,T,v,F),e('./call_get.js')(o),e('./using.js')(o,p,T,C,v,F),e('./timers.js')(o,v,F),e('./generators.js')(o,p,v,T,a,F),e('./nodeify.js')(o),e('./promisify.js')(o,v),e('./props.js')(o,P,T,p),e('./race.js')(o,v,T,p),e('./reduce.js')(o,P,p,T,v,F),e('./settle.js')(o,P,F),e('./some.js')(o,P,p),e('./filter.js')(o,v),e('./each.js')(o,v),e('./any.js')(o),c.toFastProperties(o),c.toFastProperties(o.prototype),s({a:1}),s({b:2}),s({c:3}),s(1),s(function(){}),s(void 0),s(!1),s(new o(v)),F.setBounds(f.firstLineError,c.lastLineError),o}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t){t.exports=function(t,a,r,o,n){function i(e){return-2===e?[]:-3===e?{}:-6===e?new Map:void 0}function s(e){var r=this._promise=new t(a);e instanceof t&&r._propagateFrom(e,3),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=e('./util'),l=u.isArray;return u.inherits(s,n),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function e(a,n){var s=r(this._values,this._promise);if(s instanceof t){s=s._target();var l=s._bitField;if(this._values=s,0==(50397184&l))return this._promise._setAsyncGuaranteed(),s._then(e,this._reject,void 0,this,n);if(0!=(33554432&l))s=s._value();else return 0==(16777216&l)?this._cancel():this._reject(s._reason())}if(s=u.asArray(s),null===s){var p=o('expecting an array or an iterable object but got '+u.classString(s)).reason();return void this._promise._rejectCallback(p,!1)}return 0===s.length?void(-5===n?this._resolveEmptyArray():this._resolve(i(n))):void this._iterate(s)},s.prototype._iterate=function(e){var a=this.getActualLength(e.length);this._length=a,this._values=this.shouldCopyValues()?Array(a):this._values;for(var o=this._promise,n=!1,s=null,u=0,i;u<a;++u)i=r(e[u],o),i instanceof t?(i=i._target(),s=i._bitField):s=null,n?null!==s&&i.suppressUnhandledRejections():null===s?n=this._promiseFulfilled(i,u):0==(50397184&s)?(i._proxy(this,u),this._values[u]=i):0==(33554432&s)?0==(16777216&s)?n=this._promiseCancelled(u):n=this._promiseRejected(i._reason(),u):n=this._promiseFulfilled(i._value(),u);n||o._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},s.prototype._cancel=function(){this._isResolved()||!this._promise._isCancellable()||(this._values=null,this._promise._cancel())},s.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},s.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var a=++this._totalResolved;return!!(a>=this._length)&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var a=0;a<e.length;++a)e[a]instanceof t&&e[a].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(e){return e},s}},{"./util":36}],24:[function(e,t){t.exports=function(t,a){function r(e){return!y.test(e)}function o(e){try{return!0===e.__isPromisified__}catch(t){return!1}}function n(e,t,a){var r=d.getDataPropertyOrDefault(e,t+a,_);return!!r&&o(r)}function s(e,t,a){for(var r=0,o;r<e.length;r+=2)if(o=e[r],a.test(o))for(var n=o.replace(a,''),i=0;i<e.length;i+=2)if(e[i]===n)throw new m('Cannot promisify an API that has normal methods with \'%s\'-suffix\n\n    See http://goo.gl/MqrFmX\n'.replace('%s',t))}function u(e,t,a,r){for(var u=d.inheritedDataKeys(e),l=[],p=0;p<u.length;++p){var i=u[p],c=e[i],g=r===x||x(i,c,e);'function'!=typeof c||o(c)||n(e,i,t)||!r(i,c,e,g)||l.push(i,c)}return s(l,t,a),l}function l(e,t,a,r,o){for(var n=new RegExp(v(t)+'$'),s=u(e,t,n,a),l=0,i=s.length;l<i;l+=2){var c=s[l],g=s[l+1],h=c+t;if(r===b)e[h]=b(c,p,c,g,t,o);else{var f=r(g,function(){return b(c,p,c,g,t,o)});d.notEnumerableProp(f,'__isPromisified__',!0),e[h]=f}}return d.toFastProperties(e),e}function i(e,t,a){return b(e,t,void 0,e,null,a)}var p={},d=e('./util'),c=e('./nodeback'),g=d.withAppended,h=d.maybeWrapAsError,f=d.canEvaluate,m=e('./errors').TypeError,_={__isPromisified__:!0},y=new RegExp('^(?:'+['arity','length','name','arguments','caller','callee','prototype','__isPromisified__'].join('|')+')$'),x=function(e){return d.isIdentifier(e)&&'_'!==e.charAt(0)&&'constructor'!==e},v=function(e){return e.replace(/([$])/,'\\$')},b=f?S:function(e,r,o,n,i,s){function u(){var o=r;r===p&&(o=this);var n=new t(a);n._captureStackTrace();var i='string'==typeof f&&this!==l?this[f]:e,u=c(n,s);try{i.apply(o,g(arguments,u))}catch(t){n._rejectCallback(h(t),!0,!0)}return n._isFateSealed()||n._setAsyncGuaranteed(),n}var l=function(){return this}(),f=e;return'string'==typeof f&&(e=n),d.notEnumerableProp(u,'__isPromisified__',!0),u},S;t.promisify=function(e,t){if('function'!=typeof e)throw new m('expecting a function but got '+d.classString(e));if(o(e))return e;t=Object(t);var a=void 0===t.context?p:t.context,n=!!t.multiArgs,s=i(e,a,n);return d.copyDescriptors(e,s,r),s},t.promisifyAll=function(e,t){if('function'!=typeof e&&'object'!=typeof e)throw new m('the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n');t=Object(t);var a=!!t.multiArgs,r=t.suffix;'string'!=typeof r&&(r='Async');var o=t.filter;'function'!=typeof o&&(o=x);var n=t.promisifier;if('function'!=typeof n&&(n=b),!d.isIdentifier(r))throw new RangeError('suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n');for(var s=d.inheritedDataKeys(e),u=0,i;u<s.length;++u)i=e[s[u]],'constructor'!==s[u]&&d.isClass(i)&&(l(i.prototype,r,o,n,a),l(i,r,o,n,a));return l(e,r,o,n,a)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t){t.exports=function(t,a,r,o){function n(e){var t=!1,a;if(p!==void 0&&e instanceof p)a=d(e),t=!0;else{var r=l.keys(e),o=r.length;a=Array(2*o);for(var n=0,i;n<o;++n)i=r[n],a[n]=e[i],a[n+o]=i}this.constructor$(a),this._isMap=t,this._init$(void 0,t?-6:-3)}function i(e){var a=r(e),i;return u(a)?(i=a instanceof t?a._then(t.props,void 0,void 0,void 0,void 0):new n(a).promise(),a instanceof t&&i._propagateFrom(a,2),i):o('cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n')}var s=e('./util'),u=s.isObject,l=e('./es5'),p;'function'==typeof Map&&(p=Map);var d=function(){function e(e,r){this[t]=e,this[t+a]=r,t++}var t=0,a=0;return function(r){a=r.size,t=0;var o=Array(2*r.size);return r.forEach(e,o),o}}(),c=function(e){for(var t=new p,a=0|e.length/2,r=0;r<a;++r){var o=e[a+r],n=e[r];t.set(o,n)}return t};s.inherits(n,a),n.prototype._init=function(){},n.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var a=++this._totalResolved;if(a>=this._length){var r;if(this._isMap)r=c(this._values);else{r={};for(var o=this.length(),n=0,i=this.length();n<i;++n)r[this._values[n+o]]=this._values[n]}return this._resolve(r),!0}return!1},n.prototype.shouldCopyValues=function(){return!1},n.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return i(this)},t.props=function(e){return i(e)}}},{"./es5":13,"./util":36}],26:[function(e,t){function a(e,t,a,r,o){for(var n=0;n<o;++n)a[n+r]=e[n+t],e[n+t]=void 0}function r(e){this._capacity=e,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(e){return this._capacity<e},r.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1);var a=this._front+t&this._capacity-1;this[a]=e,this._length=t+1},r.prototype.push=function(e,t,a){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(a);var o=this._front+r-3;this._checkCapacity(r);var n=this._capacity-1;this[o+0&n]=e,this[o+1&n]=t,this[o+2&n]=a,this._length=r},r.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var r=this._front,o=this._length;a(this,0,this,t,r+o&t-1)},t.exports=r},{}],27:[function(e,t){t.exports=function(t,a,r,o){function n(e,n){var l=r(e);if(l instanceof t)return u(l);if(e=s.asArray(e),null===e)return o('expecting an array or an iterable object but got '+s.classString(e));var p=new t(a);n!==void 0&&p._propagateFrom(n,3);for(var d=p._fulfill,c=p._reject,g=0,i=e.length,h;g<i;++g)(h=e[g],void 0!==h||g in e)&&t.cast(h)._then(d,c,void 0,p,null);return p}var s=e('./util'),u=function(e){return e.then(function(t){return n(t,e)})};t.race=function(e){return n(e,void 0)},t.prototype.race=function(){return n(this,void 0)}}},{"./util":36}],28:[function(e,t){t.exports=function(t,a,r,o,n,i){function s(e,a,r,o){this.constructor$(e);var i=c();this._fn=null===i?a:g.domainBind(i,a),r!==void 0&&(r=t.resolve(r),r._attachCancellationCallback(this)),this._initialValue=r,this._currentCancellable=null,this._eachValues=o===n?Array(this._length):0===o?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function l(e,t,a,o){if('function'!=typeof t)return r('expecting a function but got '+g.classString(t));var n=new s(e,t,a,o);return n.promise()}function p(e){this.accum=e,this.array._gotAccum(e);var a=o(this.value,this.array._promise);return a instanceof t?(this.array._currentCancellable=a,a._then(d,void 0,void 0,this,void 0)):d.call(this,a)}function d(e){var a=this.array,r=a._promise,o=h(a._fn);r._pushContext();var n;n=void 0===a._eachValues?o.call(r._boundValue(),this.accum,e,this.index,this.length):o.call(r._boundValue(),e,this.index,this.length),n instanceof t&&(a._currentCancellable=n);var s=r._popContext();return i.checkForgottenReturns(n,s,void 0===a._eachValues?'Promise.reduce':'Promise.each',r),n}var c=t._getDomain,g=e('./util'),h=g.tryCatch;g.inherits(s,a),s.prototype._gotAccum=function(e){this._eachValues!==void 0&&null!==this._eachValues&&e!==n&&this._eachValues.push(e)},s.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(this._eachValues===void 0?this._initialValue:this._eachValues)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},s.prototype._resultCancelled=function(e){return e===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))},s.prototype._iterate=function(e){this._values=e;var a=e.length,r,o;if(void 0===this._initialValue?(r=t.resolve(e[0]),o=1):(r=this._initialValue,o=0),this._currentCancellable=r,!r.isRejected())for(;o<a;++o){var n={accum:null,value:e[o],index:o,length:a,array:this};r=r._then(p,void 0,void 0,n,void 0)}void 0!==this._eachValues&&(r=r._then(this._eachComplete,void 0,void 0,this,void 0)),r._then(u,u,void 0,r,this)},t.prototype.reduce=function(e,t){return l(this,e,t,null)},t.reduce=function(e,t,a,r){return l(e,t,a,r)}}},{"./util":36}],29:[function(e,t){var a=e('./util'),r=a.getNativePromise(),o;if(a.isNode&&'undefined'==typeof MutationObserver){var n=ji.setImmediate,i=process.nextTick;o=a.isRecentNode?function(e){n.call(ji,e)}:function(e){i.call(process,e)}}else if('function'==typeof r&&'function'==typeof r.resolve){var s=r.resolve();o=function(e){s.then(e)}}else o='undefined'==typeof MutationObserver||'undefined'!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?'undefined'==typeof setImmediate?'undefined'==typeof setTimeout?function(){throw new Error('No async scheduler available\n\n    See http://goo.gl/MqrFmX\n')}:function(e){setTimeout(e,0)}:function(e){setImmediate(e)}:function(){var e=document.createElement('div'),t={attributes:!0},a=!1,r=document.createElement('div'),o=new MutationObserver(function(){e.classList.toggle('foo'),a=!1});o.observe(r,t);var n=function(){a||(a=!0,r.classList.toggle('foo'))};return function(a){var r=new MutationObserver(function(){r.disconnect(),a()});r.observe(e,t),n()}}();t.exports=o},{"./util":36}],30:[function(e,t){t.exports=function(t,a,r){function o(e){this.constructor$(e)}var n=t.PromiseInspection,i=e('./util');i.inherits(o,a),o.prototype._promiseResolved=function(e,t){this._values[e]=t;var a=++this._totalResolved;return!!(a>=this._length)&&(this._resolve(this._values),!0)},o.prototype._promiseFulfilled=function(e,t){var a=new n;return a._bitField=33554432,a._settledValueField=e,this._promiseResolved(t,a)},o.prototype._promiseRejected=function(e,t){var a=new n;return a._bitField=16777216,a._settledValueField=e,this._promiseResolved(t,a)},t.settle=function(e){return r.deprecated('.settle()','.reflect()'),new o(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t){t.exports=function(t,a,r){function o(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function n(e,t){if((0|t)!==t||0>t)return r('expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n');var a=new o(e),n=a.promise();return a.setHowMany(t),a.init(),n}var i=e('./util'),s=e('./errors').RangeError,u=e('./errors').AggregateError,l=i.isArray,p={};i.inherits(o,a),o.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=l(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},o.prototype.init=function(){this._initialized=!0,this._init()},o.prototype.setUnwrap=function(){this._unwrap=!0},o.prototype.howMany=function(){return this._howMany},o.prototype.setHowMany=function(e){this._howMany=e},o.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},o.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},o.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(p),this._checkOutcome())},o.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new u,e=this.length();e<this._values.length;++e)this._values[e]!==p&&t.push(this._values[e]);return 0<t.length?this._reject(t):this._cancel(),!0}return!1},o.prototype._fulfilled=function(){return this._totalResolved},o.prototype._rejected=function(){return this._values.length-this.length()},o.prototype._addRejected=function(e){this._values.push(e)},o.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},o.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},o.prototype._getRangeError=function(e){var t='Input array must contain at least '+this._howMany+' items but contains only '+e+' items';return new s(t)},o.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return n(e,t)},t.prototype.some=function(e){return n(this,e)},t._SomePromiseArray=o}},{"./errors":12,"./util":36}],32:[function(e,t){t.exports=function(e){function t(e){e===void 0?(this._bitField=0,this._settledValueField=void 0):(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0)}t.prototype._settledValue=function(){return this._settledValueField};var a=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError('cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n');return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError('cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n');return this._settledValue()},o=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},n=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},i=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return i.call(this._target())},e.prototype.isRejected=function(){return n.call(this._target())},e.prototype.isFulfilled=function(){return o.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return a.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t){t.exports=function(t,a){function r(e){return e.then}function o(e){try{return r(e)}catch(t){return u.e=t,u}}function n(e){try{return p.call(e,'_promise0')}catch(t){return!1}}function i(e,r,o){var n=new t(a),i=n;o&&o._pushContext(),n._captureStackTrace(),o&&o._popContext();var l=!0,p=s.tryCatch(r).call(e,function(e){n&&(n._resolveCallback(e),n=null)},function(e){n&&(n._rejectCallback(e,l,!0),n=null)});return l=!1,n&&p===u&&(n._rejectCallback(p.e,!0,!0),n=null),i}var s=e('./util'),u=s.errorObj,l=s.isObject,p={}.hasOwnProperty;return function(e,r){if(l(e)){if(e instanceof t)return e;var s=o(e);if(s===u){r&&r._pushContext();var p=t.reject(s.e);return r&&r._popContext(),p}if('function'==typeof s){if(n(e)){var p=new t(a);return e._then(p._fulfill,p._reject,void 0,p,null),p}return i(e,s,r)}}return e}}},{"./util":36}],34:[function(e,t){t.exports=function(t,a,r){function o(e){this.handle=e}function n(e){return clearTimeout(this.handle),e}function i(e){throw clearTimeout(this.handle),e}var s=e('./util'),u=t.TimeoutError;o.prototype._resultCancelled=function(){clearTimeout(this.handle)};var l=function(e){return p(+this).thenReturn(e)},p=t.delay=function(e,n){var i,s;return void 0===n?(i=new t(a),s=setTimeout(function(){i._fulfill()},+e),r.cancellation()&&i._setOnCancel(new o(s)),i._captureStackTrace()):(i=t.resolve(n)._then(l,null,null,e,void 0),r.cancellation()&&n instanceof t&&i._setOnCancel(n)),i._setAsyncGuaranteed(),i};t.prototype.delay=function(e){return p(e,this)};var d=function(e,t,a){var r;r='string'==typeof t?new u(t):t instanceof Error?t:new u('operation timed out'),s.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=a&&a.cancel()};t.prototype.timeout=function(e,t){e=+e;var a=new o(setTimeout(function(){s.isPending()&&d(s,t,u)},e)),s,u;return r.cancellation()?(u=this.then(),s=u._then(n,i,void 0,a,void 0),s._setOnCancel(a)):s=this._then(n,i,void 0,a,void 0),s}}},{"./util":36}],35:[function(e,t){t.exports=function(t,a,r,o,n,s){function i(t){setTimeout(function(){throw t},0)}function u(e){var t=r(e);return t!==e&&'function'==typeof e._isDisposable&&'function'==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function l(e,a){function o(){if(s>=l)return p._fulfill();var n=u(e[s++]);if(n instanceof t&&n._isDisposable()){try{n=r(n._getDisposer().tryDispose(a),e.promise)}catch(t){return i(t)}if(n instanceof t)return n._then(o,i,null,null,null)}o()}var s=0,l=e.length,p=new t(n);return o(),p}function p(e,t,a){this._data=e,this._promise=t,this._context=a}function d(e,t,a){this.constructor$(e,t,a)}function c(e){return p.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function g(e){this.length=e,this.promise=null,this[e-1]=null}var h=e('./util'),f=e('./errors').TypeError,m=e('./util').inherits,_=h.errorObj,y=h.tryCatch,x={};p.prototype.data=function(){return this._data},p.prototype.promise=function(){return this._promise},p.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():x},p.prototype.tryDispose=function(e){var t=this.resource(),a=this._context;void 0!==a&&a._pushContext();var r=t===x?null:this.doDispose(t,e);return void 0!==a&&a._popContext(),this._promise._unsetDisposable(),this._data=null,r},p.isDisposer=function(e){return null!=e&&'function'==typeof e.resource&&'function'==typeof e.tryDispose},m(d,p),d.prototype.doDispose=function(e,t){var a=this.data();return a.call(e,e,t)},g.prototype._resultCancelled=function(){for(var e=this.length,a=0,r;a<e;++a)r=this[a],r instanceof t&&r.cancel()},t.using=function(){var e=arguments.length;if(2>e)return a('you must pass at least 2 arguments to Promise.using');var o=arguments[e-1];if('function'!=typeof o)return a('expecting a function but got '+h.classString(o));var n=!0,u;2===e&&Array.isArray(arguments[0])?(u=arguments[0],e=u.length,n=!1):(u=arguments,e--);for(var d=new g(e),f=0,m;f<e;++f){if(m=u[f],p.isDisposer(m)){var x=m;m=m.promise(),m._setDisposable(x)}else{var v=r(m);v instanceof t&&(m=v._then(c,null,null,{resources:d,index:f},void 0))}d[f]=m}for(var b=Array(d.length),f=0;f<b.length;++f)b[f]=t.resolve(d[f]).reflect();var S=t.all(b).then(function(e){for(var t=0,a;t<e.length;++t){if(a=e[t],a.isRejected())return _.e=a.error(),_;if(!a.isFulfilled())return void S.cancel();e[t]=a.value()}T._pushContext(),o=y(o);var r=n?o.apply(void 0,e):o(e),i=T._popContext();return s.checkForgottenReturns(r,i,'Promise.using',T),r}),T=S.lastly(function(){var e=new t.PromiseInspection(S);return l(d,e)});return d.promise=T,T._setOnCancel(d),T},t.prototype._setDisposable=function(e){this._bitField|=131072,this._disposer=e},t.prototype._isDisposable=function(){return 0<(131072&this._bitField)},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField&=-131073,this._disposer=void 0},t.prototype.disposer=function(e){if('function'==typeof e)return new d(e,this,o());throw new f}}},{"./errors":12,"./util":36}],36:[function(e,t,a){function r(){try{var e=O;return O=null,e.apply(this,arguments)}catch(t){return k.e=t,k}}function o(e){return O=e,r}function n(e){return null==e||!0===e||!1===e||'string'==typeof e||'number'==typeof e}function i(e){return'function'==typeof e||'object'==typeof e&&null!==e}function s(e){return n(e)?new Error(m(e)):e}function u(e,t){var a=e.length,r=Array(a+1),o;for(o=0;o<a;++o)r[o]=e[o];return r[o]=t,r}function l(e,t,a){if(C.isES5){var r=Object.getOwnPropertyDescriptor(e,t);if(null!=r)return null==r.get&&null==r.set?r.value:a}else return{}.hasOwnProperty.call(e,t)?e[t]:void 0}function p(e,t,a){if(n(e))return e;return C.defineProperty(e,t,{value:a,configurable:!0,enumerable:!1,writable:!0}),e}function d(e){throw e}function c(e){try{if('function'==typeof e){var t=C.names(e.prototype),a=C.isES5&&1<t.length,r=0<t.length&&(1!==t.length||'constructor'!==t[0]),o=I.test(e+'')&&0<C.names(e).length;if(a||r||o)return!0}return!1}catch(t){return!1}}function g(e){function t(){}t.prototype=e;for(var a=8;a--;)new t;return e}function h(e){return A.test(e)}function f(e,t,a){for(var r=Array(e),o=0;o<e;++o)r[o]=t+o+a;return r}function m(e){try{return e+''}catch(t){return'[no string representation]'}}function _(e){return e instanceof Error||null!==e&&'object'==typeof e&&'string'==typeof e.message&&'string'==typeof e.name}function y(t){try{p(t,'isOperational',!0)}catch(e){}}function x(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)}function v(e){return _(e)&&C.propertyIsWritable(e,'stack')}function b(e){return{}.toString.call(e)}function S(e,t,a){for(var r=C.names(e),o=0,n;o<r.length;++o)if(n=r[o],a(n))try{C.defineProperty(t,n,C.getDescriptor(e,n))}catch(e){}}function T(e){return G?process.env[e]:void 0}function P(){if('function'==typeof Promise)try{var e=new Promise(function(){});if('[object Promise]'==={}.toString.call(e))return Promise}catch(t){}}function w(e,t){return e.bind(t)}var C=e('./es5'),F='undefined'==typeof navigator,k={e:{}},E='undefined'==typeof self?'undefined'==typeof window?'undefined'==typeof ji?this===void 0?null:this:ji:window:self,M=function(e,t){function a(){for(var a in this.constructor=e,this.constructor$=t,t.prototype)r.call(t.prototype,a)&&'$'!==a.charAt(a.length-1)&&(this[a+'$']=t.prototype[a])}var r={}.hasOwnProperty;return a.prototype=t.prototype,e.prototype=new a,e.prototype},D=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var a=0;a<e.length;++a)if(e[a]===t)return!0;return!1};if(C.isES5){var a=Object.getOwnPropertyNames;return function(e){for(var r=[],o=Object.create(null);null!=e&&!t(e);){var n;try{n=a(e)}catch(t){return r}for(var s=0,i;s<n.length;++s)if(i=n[s],!o[i]){o[i]=!0;var u=Object.getOwnPropertyDescriptor(e,i);null!=u&&null==u.get&&null==u.set&&r.push(i)}e=C.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(a){if(t(a))return[];var o=[];enumeration:for(var n in a)if(r.call(a,n))o.push(n);else{for(var s=0;s<e.length;++s)if(r.call(e[s],n))continue enumeration;o.push(n)}return o}}(),I=/this\s*\.\s*\S+\s*=/,A=/^[a-z$_][a-z$_0-9]*$/i,R=function(){return'stack'in new Error?function(e){return v(e)?e:new Error(m(e))}:function(e){if(v(e))return e;try{throw new Error(m(e))}catch(e){return e}}}(),L=function(e){return C.isArray(e)?e:null},O;if('undefined'!=typeof Symbol&&Symbol.iterator){var j='function'==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t=[],a=e[Symbol.iterator](),r;!(r=a.next()).done;)t.push(r.value);return t};L=function(e){if(C.isArray(e))return e;return null!=e&&'function'==typeof e[Symbol.iterator]?j(e):null}}var z='undefined'!=typeof process&&'[object process]'===b(process).toLowerCase(),G='undefined'!=typeof process&&'undefined'!=typeof process.env,N={isClass:c,isIdentifier:h,inheritedDataKeys:D,getDataPropertyOrDefault:l,thrower:d,isArray:C.isArray,asArray:L,notEnumerableProp:p,isPrimitive:n,isObject:i,isError:_,canEvaluate:F,errorObj:k,tryCatch:o,inherits:M,withAppended:u,maybeWrapAsError:s,toFastProperties:g,filledRange:f,toString:m,canAttachTrace:v,ensureErrorObject:R,originatesFromRejection:x,markAsOriginatingFromRejection:y,classString:b,copyDescriptors:S,hasDevTools:'undefined'!=typeof chrome&&chrome&&'function'==typeof chrome.loadTimes,isNode:z,hasEnvVariables:G,env:T,global:E,getNativePromise:P,domainBind:w};N.isRecentNode=N.isNode&&function(){var e=process.versions.node.split('.').map(Number);return 0===e[0]&&10<e[1]||0<e[0]}(),N.isNode&&N.toFastProperties(process);try{throw new Error}catch(t){N.lastLineError=t}t.exports=N},{"./es5":13}]},{},[4])(4)}),'undefined'!=typeof window&&null!==window?window.P=window.Promise:'undefined'!=typeof self&&null!==self&&(self.P=self.Promise)}),Db=function(e,t){return function(){for(var a=Array(arguments.length),r=0;r<a.length;r++)a[r]=arguments[r];return e.apply(t,a)}},Ib=function(e){return null!=e&&(Fa(e)||ka(e)||!!e._isBuffer)},Ab=Object.prototype.toString,Rb={isArray:Ea,isArrayBuffer:Ma,isBuffer:Ib,isFormData:Da,isArrayBufferView:Ia,isString:Aa,isNumber:Ra,isObject:Oa,isUndefined:La,isDate:ja,isFile:za,isBlob:Ga,isFunction:Na,isStream:Ua,isURLSearchParams:qa,isStandardBrowserEnv:Va,forEach:Ha,merge:Wa,extend:Xa,trim:Ba},Lb=function(e,t){Rb.forEach(e,function(a,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=a,delete e[r])})},Ob=function(e,t,a,r,o){return e.config=t,a&&(e.code=a),e.request=r,e.response=o,e},jb=function(e,t,a,r,o){var n=new Error(e);return Ob(n,t,a,r,o)},zb=function(e,t,a){var r=a.config.validateStatus;a.status&&r&&!r(a.status)?t(jb('Request failed with status code '+a.status,a.config,null,a.request,a)):e(a)},Gb=function(e,t,a){if(!t)return e;var r;if(a)r=a(t);else if(Rb.isURLSearchParams(t))r=t.toString();else{var o=[];Rb.forEach(t,function(e,t){null===e||'undefined'==typeof e||(Rb.isArray(e)&&(t+='[]'),!Rb.isArray(e)&&(e=[e]),Rb.forEach(e,function(e){Rb.isDate(e)?e=e.toISOString():Rb.isObject(e)&&(e=JSON.stringify(e)),o.push(Ya(t)+'='+Ya(e))}))}),r=o.join('&')}return r&&(e+=(-1===e.indexOf('?')?'?':'&')+r),e},Nb=['age','authorization','content-length','content-type','etag','expires','from','host','if-modified-since','if-unmodified-since','last-modified','location','max-forwards','proxy-authorization','referer','retry-after','user-agent'],Ub=function(e){var t={},a,r,o;return e?(Rb.forEach(e.split('\n'),function(e){if(o=e.indexOf(':'),a=Rb.trim(e.substr(0,o)).toLowerCase(),r=Rb.trim(e.substr(o+1)),a){if(t[a]&&0<=Nb.indexOf(a))return;t[a]='set-cookie'===a?(t[a]?t[a]:[]).concat([r]):t[a]?t[a]+', '+r:r}}),t):t},qb=Rb.isStandardBrowserEnv()?function(){function e(e){var r=e;return t&&(a.setAttribute('href',r),r=a.href),a.setAttribute('href',r),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,''):'',host:a.host,search:a.search?a.search.replace(/^\?/,''):'',hash:a.hash?a.hash.replace(/^#/,''):'',hostname:a.hostname,port:a.port,pathname:'/'===a.pathname.charAt(0)?a.pathname:'/'+a.pathname}}var t=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement('a'),r;return r=e(window.location.href),function(t){var a=Rb.isString(t)?e(t):t;return a.protocol===r.protocol&&a.host===r.host}}():function(){return function(){return!0}}(),Bb='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';$a.prototype=new Error,$a.prototype.code=5,$a.prototype.name='InvalidCharacterError';var Vb=E,Hb=Rb.isStandardBrowserEnv()?function(){return{write:function(e,t,a,r,o,n){var i=[];i.push(e+'='+encodeURIComponent(t)),Rb.isNumber(a)&&i.push('expires='+new Date(a).toGMTString()),Rb.isString(r)&&i.push('path='+r),Rb.isString(o)&&i.push('domain='+o),!0===n&&i.push('secure'),document.cookie=i.join('; ')},read:function(e){var t=document.cookie.match(new RegExp('(^|;\\s*)('+e+')=([^;]*)'));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,'',Date.now()-8.64e7)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),Wb='undefined'!=typeof window&&window.btoa&&window.btoa.bind(window)||Vb,Xb=function(t){return new Promise(function(e,a){var r=t.data,o=t.headers;Rb.isFormData(r)&&delete o['Content-Type'];var n=new XMLHttpRequest,i='onreadystatechange',s=!1;if('test'===process.env.NODE_ENV||'undefined'==typeof window||!window.XDomainRequest||'withCredentials'in n||qb(t.url)||(n=new window.XDomainRequest,i='onload',s=!0,n.onprogress=function(){},n.ontimeout=function(){}),t.auth){var u=t.auth.username||'',l=t.auth.password||'';o.Authorization='Basic '+Wb(u+':'+l)}if(n.open(t.method.toUpperCase(),Gb(t.url,t.params,t.paramsSerializer),!0),n.timeout=t.timeout,n[i]=function(){if(n&&(4===n.readyState||s)&&(0!==n.status||n.responseURL&&0===n.responseURL.indexOf('file:'))){var r='getAllResponseHeaders'in n?Ub(n.getAllResponseHeaders()):null,o=t.responseType&&'text'!==t.responseType?n.response:n.responseText,i={data:o,status:1223===n.status?204:n.status,statusText:1223===n.status?'No Content':n.statusText,headers:r,config:t,request:n};zb(e,a,i),n=null}},n.onerror=function(){a(jb('Network Error',t,null,n)),n=null},n.ontimeout=function(){a(jb('timeout of '+t.timeout+'ms exceeded',t,'ECONNABORTED',n)),n=null},Rb.isStandardBrowserEnv()){var p=(t.withCredentials||qb(t.url))&&t.xsrfCookieName?Hb.read(t.xsrfCookieName):void 0;p&&(o[t.xsrfHeaderName]=p)}if('setRequestHeader'in n&&Rb.forEach(o,function(e,t){'undefined'==typeof r&&'content-type'===t.toLowerCase()?delete o[t]:n.setRequestHeader(t,e)}),t.withCredentials&&(n.withCredentials=!0),t.responseType)try{n.responseType=t.responseType}catch(a){if('json'!==t.responseType)throw a}'function'==typeof t.onDownloadProgress&&n.addEventListener('progress',t.onDownloadProgress),'function'==typeof t.onUploadProgress&&n.upload&&n.upload.addEventListener('progress',t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(e){n&&(n.abort(),a(e),n=null)}),void 0===r&&(r=null),n.send(r)})},Yb={"Content-Type":'application/x-www-form-urlencoded'},$b={adapter:Za(),transformRequest:[function(e,t){return Lb(t,'Content-Type'),Rb.isFormData(e)||Rb.isArrayBuffer(e)||Rb.isBuffer(e)||Rb.isStream(e)||Rb.isFile(e)||Rb.isBlob(e)?e:Rb.isArrayBufferView(e)?e.buffer:Rb.isURLSearchParams(e)?(Ka(t,'application/x-www-form-urlencoded;charset=utf-8'),e.toString()):Rb.isObject(e)?(Ka(t,'application/json;charset=utf-8'),JSON.stringify(e)):e}],transformResponse:[function(e){if('string'==typeof e)try{e=JSON.parse(e)}catch(t){}return e}],timeout:0,xsrfCookieName:'XSRF-TOKEN',xsrfHeaderName:'X-XSRF-TOKEN',maxContentLength:-1,validateStatus:function(e){return 200<=e&&300>e}};$b.headers={common:{Accept:'application/json, text/plain, */*'}},Rb.forEach(['delete','get','head'],function(e){$b.headers[e]={}}),Rb.forEach(['post','put','patch'],function(e){$b.headers[e]=Rb.merge(Yb)});var Kb=$b;Qa.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},Qa.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Qa.prototype.forEach=function(e){Rb.forEach(this.handlers,function(t){null!==t&&e(t)})};var Zb=Qa,Qb=function(e,t,a){return Rb.forEach(a,function(a){e=a(e,t)}),e},Jb=function(e){return!!(e&&e.__CANCEL__)},eS=function(e){return /^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)},tS=function(e,t){return t?e.replace(/\/+$/,'')+'/'+t.replace(/^\/+/,''):e},aS=function(e){Ja(e),e.baseURL&&!eS(e.url)&&(e.url=tS(e.baseURL,e.url)),e.headers=e.headers||{},e.data=Qb(e.data,e.headers,e.transformRequest),e.headers=Rb.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),Rb.forEach(['delete','get','head','post','put','patch','common'],function(t){delete e.headers[t]});var t=e.adapter||Kb.adapter;return t(e).then(function(t){return Ja(e),t.data=Qb(t.data,t.headers,e.transformResponse),t},function(t){return Jb(t)||(Ja(e),t&&t.response&&(t.response.data=Qb(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})};er.prototype.request=function(e){'string'==typeof e&&(e=Rb.merge({url:arguments[0]},arguments[1])),e=Rb.merge(Kb,this.defaults,{method:'get'},e),e.method=e.method.toLowerCase();var t=[aS,void 0],a=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)a=a.then(t.shift(),t.shift());return a},Rb.forEach(['delete','get','head','options'],function(e){er.prototype[e]=function(t,a){return this.request(Rb.merge(a||{},{method:e,url:t}))}}),Rb.forEach(['post','put','patch'],function(e){er.prototype[e]=function(t,a,r){return this.request(Rb.merge(r||{},{method:e,url:t,data:a}))}});var rS=er;tr.prototype.toString=function(){return'Cancel'+(this.message?': '+this.message:'')},tr.prototype.__CANCEL__=!0;var oS=tr;ar.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},ar.source=function(){var e=new ar(function(e){t=e}),t;return{token:e,cancel:t}};var nS=ar,iS=function(e){return function(t){return e.apply(null,t)}},sS=rr(Kb);sS.Axios=rS,sS.create=function(e){return rr(Rb.merge(Kb,e))},sS.Cancel=oS,sS.CancelToken=nS,sS.isCancel=Jb,sS.all=function(e){return Promise.all(e)},sS.spread=iS;var uS=sS,lS=sS;uS.default=lS;var pS=uS,dS=ue(function(e){(function(){var t,a,r,o,n,i;'undefined'!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:'undefined'!=typeof process&&null!==process&&process.hrtime?(e.exports=function(){return(t()-n)/1e6},a=process.hrtime,t=function(){var e;return e=a(),1e9*e[0]+e[1]},o=t(),i=1e9*process.uptime(),n=o-i):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return new Date().getTime()-r},r=new Date().getTime())}).call(ji)}),cS=ue(function(e){function t(){}function a(e,t,a){this.fn=e,this.context=t,this.once=a||!1}function r(e,t,r,o,n){if('function'!=typeof r)throw new TypeError('The listener must be a function');var i=new a(r,o||e,n),u=s?s+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],i]:e._events[u].push(i):(e._events[u]=i,e._eventsCount++),e}function o(e,a){0==--e._eventsCount?e._events=new t:delete e._events[a]}function n(){this._events=new t,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,s='~';Object.create&&(t.prototype=Object.create(null),!new t().__proto__&&(s=!1)),n.prototype.eventNames=function(){var e=[],t,a;if(0===this._eventsCount)return e;for(a in t=this._events)i.call(t,a)&&e.push(s?a.slice(1):a);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e},n.prototype.listeners=function(e){var t=s?s+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var r=0,o=a.length,n=Array(o);r<o;r++)n[r]=a[r].fn;return n},n.prototype.listenerCount=function(e){var t=s?s+e:e,a=this._events[t];return a?a.fn?1:a.length:0},n.prototype.emit=function(e,t,a,r,o,n){var u=s?s+e:e;if(!this._events[u])return!1;var l=this._events[u],p=arguments.length,d,c;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,a),!0;case 4:return l.fn.call(l.context,t,a,r),!0;case 5:return l.fn.call(l.context,t,a,r,o),!0;case 6:return l.fn.call(l.context,t,a,r,o,n),!0;}for(c=1,d=Array(p-1);c<p;c++)d[c-1]=arguments[c];l.fn.apply(l.context,d)}else{var i=l.length,g;for(c=0;c<i;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),p){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,a);break;case 4:l[c].fn.call(l[c].context,t,a,r);break;default:if(!d)for(g=1,d=Array(p-1);g<p;g++)d[g-1]=arguments[g];l[c].fn.apply(l[c].context,d);}}return!0},n.prototype.on=function(e,t,a){return r(this,e,t,a,!1)},n.prototype.once=function(e,t,a){return r(this,e,t,a,!0)},n.prototype.removeListener=function(e,t,a,r){var n=s?s+e:e;if(!this._events[n])return this;if(!t)return o(this,n),this;var u=this._events[n];if(u.fn)u.fn!==t||r&&!u.once||a&&u.context!==a||o(this,n);else{for(var l=0,i=[],p=u.length;l<p;l++)(u[l].fn!==t||r&&!u[l].once||a&&u[l].context!==a)&&i.push(u[l]);i.length?this._events[n]=1===i.length?i[0]:i:o(this,n)}return this},n.prototype.removeAllListeners=function(e){var a;return e?(a=s?s+e:e,this._events[a]&&o(this,a)):(this._events=new t,this._eventsCount=0),this},n.prototype.off=n.prototype.removeListener,n.prototype.addListener=n.prototype.on,n.prefixed=s,n.EventEmitter=n,e.exports=n}),gS=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.MAX_TEXTURE_IMAGE_UNITS=t.MAX_TEXTURE_SIZE=t.webgl2=void 0;const a=new class{constructor(){if(this.isSupported=!1,this.vertexShader=null,'undefined'!=typeof window){this.canvas=document.createElement('canvas'),this.context=this.canvas.getContext('webgl2');const e=this.context;e?(this.isSupported=!0,e.getExtension('EXT_color_buffer_float'),this.MAX_TEXTURE_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),this.MAX_TEXTURE_IMAGE_UNITS=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.init()):console.log('Unable to initialize WebGL2 -- your browser may not support it.')}this._refs={textures:[],buffers:[]}}init(){this.createCommonVertexShader()}createCommonVertexShader(){const e=this.context,t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,'#version 300 es\nprecision highp float;\n\nin vec3 position;\nin vec2 texcoord;\nout vec2 outTex;\n\nvoid main () {\n  gl_Position = vec4(position, 1.0);\n\toutTex = texcoord;\n}\n'),e.compileShader(t);const a=e.getShaderParameter(t,e.COMPILE_STATUS);a||(console.error(e.getShaderInfoLog(t)),e.deleteShader(t),this.isSupported=!1),this.vertexShader=t}compileProgram(e){const t=this.context,a=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(a,e),t.compileShader(a);let r=t.getShaderParameter(a,t.COMPILE_STATUS);r||(console.error(t.getShaderInfoLog(a)),t.deleteShader(a),this.isSupported=!1);const o=t.createProgram();return t.attachShader(o,this.vertexShader),t.attachShader(o,a),t.linkProgram(o),r=t.getProgramParameter(o,t.LINK_STATUS),r||(console.error(t.getProgramInfoLog(o)),this.isSupported=!1),this.setupVertices(o),o}setupVertices(e){const t=this.context,a=t.getAttribLocation(e,'position'),r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),this.storeRef('buffer',r),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]),t.STATIC_DRAW),t.vertexAttribPointer(a,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a);const o=t.getAttribLocation(e,'texcoord'),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),t.STATIC_DRAW),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o),this.storeRef('buffer',n);const i=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),t.STATIC_DRAW),this.storeRef('buffer',i)}selectProgram(e){const t=this.context;t.useProgram(e)}bindUniforms(e,t){const a=this.context;t.forEach(({value:t,type:r,name:o})=>{const n=a.getUniformLocation(e,o);'float'===r?a.uniform1f(n,t):('int'===r||'bool'===r)&&a.uniform1i(n,t)})}bindInputTextures(e,t,a){const r=this.context;t.forEach(({input:t,name:o},n)=>{if(r.activeTexture(r.TEXTURE0+n),!t.glTextureFragments){const{textureTarget:e}=this.getWebGLTextureOptions(t.glTextureType,t.glTextureFormat);r.bindTexture(e,t.glTexture)}else if(t.glTextureFragmentsAsColStack){const{textureTarget:e}=this.getWebGLTextureOptions(t.glTextureType,t.glTextureFormat);r.bindTexture(e,t.glTextureFragmentsAsColStack)}else{const{textureTarget:e}=this.getWebGLTextureOptions(t.glTextureType,t.glTextureFormat);r.bindTexture(e,t.glTextureFragments[a])}r.uniform1i(r.getUniformLocation(e,o),n)})}bindOutputTexture(e,t){const a=this.context;a.viewport(0,0,t[1],t[0]),this.framebuffer=this.framebuffer||a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0)}runProgram({program:e,output:t,inputs:a,uniforms:r,supportsTextureFragments:o=!1}){if(!e)throw new Error('[WebGL2] missing program');if(!t)throw new Error('[WebGL2] missing output');if(!a)throw new Error('[WebGL2] missing inputs');const n=this.context;if(this.selectProgram(e),r&&Array.isArray(r)&&this.bindUniforms(e,r),t.glTextureFragments){if(!o)throw new Error('[WebGL2] program does not support texture fragments');const r=a.filter((e)=>e.input.glTextureFragments&&!e.input.glTextureFragmentsAsColStack),i=t.glTextureFragments.length;if(r.some((e)=>e.input.glTextureFragments.length!==i))throw new Error('[WebGL2] number of texture fragments in inputs and output do not match');for(let r=0;r<i;r++)this.bindOutputTexture(t.glTextureFragments[r],t.glTextureFragmentShape),this.bindInputTextures(e,a,r),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}else this.bindOutputTexture(t.glTexture,t.glTextureShape),this.bindInputTextures(e,a),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}readData(e){const t=this.context,a=new ArrayBuffer(4*(4*(e[0]*e[1]))),r=new Float32Array(a);t.readPixels(0,0,e[1],e[0],t.RGBA,t.FLOAT,r);const o=[];for(let t=0;t<r.length;t+=4)o.push(r[t]);return new Float32Array(o)}getWebGLTextureOptions(e,t){const a=this.context,r={"2d":a.TEXTURE_2D,"2d_array":a.TEXTURE_2D_ARRAY,"3d":a.TEXTURE_3D},o={float:a.R32F,int:a.R32I},n={float:a.RED,int:a.RED_INTEGER},i={float:a.FLOAT,int:a.INT},s=r[e],u=o[t],l=n[t],p=i[t];return{textureTarget:s,textureInternalFormat:u,textureFormat:l,textureType:p}}storeRef(e,t){'texture'===e?this._refs.textures.push(t):'buffer'===e&&this._refs.buffers.push(t)}clearRefs(){const e=this.context;this._refs.textures.forEach((t)=>e.deleteTexture(t)),this._refs.buffers.forEach((t)=>e.deleteBuffer(t)),this._refs={textures:[],buffers:[]}}};t.webgl2=a;const r=a.MAX_TEXTURE_SIZE;t.MAX_TEXTURE_SIZE=r;const o=a.MAX_TEXTURE_IMAGE_UNITS;t.MAX_TEXTURE_IMAGE_UNITS=o});se(gS);var hS=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;t.default=class{constructor(e={}){this.layerClass='Layer',this.name=e.name,this.description='',this.gpu=gS.webgl2.isSupported&&e.gpu,this.params=[],this.weights={},this.inbound=[],this.outbound=[]}throwError(e){throw new Error(`[${this.layerClass} layer: ${this.name||''}] ${e}`)}toggleGPU(e){const t='undefined'==typeof e?!this.gpu:e;this.gpu=gS.webgl2.isSupported&&t}setWeights(e,t=!0){this.params.forEach((a,r)=>{this.weights[a]=e[r],this.gpu&&t&&this.weights[a].createGLTexture({type:'2d',format:'float'})})}call(e){return this.output=e,this.output}}});se(hS);var fS=yn,mS=bn,_S=or,yS=nr,xS=yS(),vS=xS,bS=ir,SS='undefined'!=typeof Float64Array,TS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]},PS=dr,wS=hr,CS=vr,FS=br,kS=Tr,ES=ue(function(e,t){function a(e){if(!e)return n;for(var t=0,r;t<e.args.length;++t)r=e.args[t],e.args[t]=0===t?{name:r,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1};return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function r(e){return kS({args:e.args,pre:a(e.pre),body:a(e.body),post:a(e.proc),funcName:e.funcName})}function o(e){for(var t=[],a=0;a<e.args.length;++a)t.push('a'+a);var o=new Function('P',['return function ',e.funcName,'_ndarrayops(',t.join(','),') {P(',t.join(','),');return a0}'].join(''));return o(r(e))}var n={body:'',args:[],thisVars:[],localVars:[]},i={add:'+',sub:'-',mul:'*',div:'/',mod:'%',band:'&',bor:'|',bxor:'^',lshift:'<<',rshift:'>>',rrshift:'>>>'};(function(){for(var e in i){var a=i[e];t[e]=o({args:['array','array','array'],body:{args:['a','b','c'],body:'a=b'+a+'c'},funcName:e}),t[e+'eq']=o({args:['array','array'],body:{args:['a','b'],body:'a'+a+'=b'},rvalue:!0,funcName:e+'eq'}),t[e+'s']=o({args:['array','array','scalar'],body:{args:['a','b','s'],body:'a=b'+a+'s'},funcName:e+'s'}),t[e+'seq']=o({args:['array','scalar'],body:{args:['a','s'],body:'a'+a+'=s'},rvalue:!0,funcName:e+'seq'})}})();var s={not:'!',bnot:'~',neg:'-',recip:'1.0/'};(function(){for(var e in s){var a=s[e];t[e]=o({args:['array','array'],body:{args:['a','b'],body:'a='+a+'b'},funcName:e}),t[e+'eq']=o({args:['array'],body:{args:['a'],body:'a='+a+'a'},rvalue:!0,count:2,funcName:e+'eq'})}})();var u={and:'&&',or:'||',eq:'===',neq:'!==',lt:'<',gt:'>',leq:'<=',geq:'>='};(function(){for(var e in u){var a=u[e];t[e]=o({args:['array','array','array'],body:{args:['a','b','c'],body:'a=b'+a+'c'},funcName:e}),t[e+'s']=o({args:['array','array','scalar'],body:{args:['a','b','s'],body:'a=b'+a+'s'},funcName:e+'s'}),t[e+'eq']=o({args:['array','array'],body:{args:['a','b'],body:'a=a'+a+'b'},rvalue:!0,count:2,funcName:e+'eq'}),t[e+'seq']=o({args:['array','scalar'],body:{args:['a','s'],body:'a=a'+a+'s'},rvalue:!0,count:2,funcName:e+'seq'})}})();var l=['abs','acos','asin','atan','ceil','cos','exp','floor','log','round','sin','sqrt','tan'];(function(){for(var e=0,a;e<l.length;++e)a=l[e],t[a]=o({args:['array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(b)',thisVars:['this_f']},funcName:a}),t[a+'eq']=o({args:['array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a'],body:'a=this_f(a)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'eq'})})();var p=['max','min','atan2','pow'];(function(){for(var e=0,a;e<p.length;++e)a=p[e],t[a]=o({args:['array','array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(b,c)',thisVars:['this_f']},funcName:a}),t[a+'s']=o({args:['array','array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(b,c)',thisVars:['this_f']},funcName:a+'s'}),t[a+'eq']=o({args:['array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(a,b)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'eq'}),t[a+'seq']=o({args:['array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(a,b)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'seq'})})();var d=['atan2','pow'];(function(){for(var e=0,a;e<d.length;++e)a=d[e],t[a+'op']=o({args:['array','array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(c,b)',thisVars:['this_f']},funcName:a+'op'}),t[a+'ops']=o({args:['array','array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b','c'],body:'a=this_f(c,b)',thisVars:['this_f']},funcName:a+'ops'}),t[a+'opeq']=o({args:['array','array'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(b,a)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'opeq'}),t[a+'opseq']=o({args:['array','scalar'],pre:{args:[],body:'this_f=Math.'+a,thisVars:['this_f']},body:{args:['a','b'],body:'a=this_f(b,a)',thisVars:['this_f']},rvalue:!0,count:2,funcName:a+'opseq'})})(),t.any=kS({args:['array'],pre:n,body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:1}],body:'if(a){return true}',localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:'return false'},funcName:'any'}),t.all=kS({args:['array'],pre:n,body:{args:[{name:'x',lvalue:!1,rvalue:!0,count:1}],body:'if(!x){return false}',localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:'return true'},funcName:'all'}),t.sum=kS({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:1}],body:'this_s+=a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'sum'}),t.prod=kS({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=1'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:1}],body:'this_s*=a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'prod'}),t.norm2squared=kS({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:2}],body:'this_s+=a*a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'norm2squared'}),t.norm2=kS({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:2}],body:'this_s+=a*a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return Math.sqrt(this_s)'},funcName:'norm2'}),t.norminf=kS({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:4}],body:'if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'norminf'}),t.norm1=kS({args:['array'],pre:{args:[],localVars:[],thisVars:['this_s'],body:'this_s=0'},body:{args:[{name:'a',lvalue:!1,rvalue:!0,count:3}],body:'this_s+=a<0?-a:a',localVars:[],thisVars:['this_s']},post:{args:[],localVars:[],thisVars:['this_s'],body:'return this_s'},funcName:'norm1'}),t.sup=kS({args:['array'],pre:{body:'this_h=-Infinity',args:[],thisVars:['this_h'],localVars:[]},body:{body:'if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_h'],localVars:[]},post:{body:'return this_h',args:[],thisVars:['this_h'],localVars:[]}}),t.inf=kS({args:['array'],pre:{body:'this_h=Infinity',args:[],thisVars:['this_h'],localVars:[]},body:{body:'if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_h'],localVars:[]},post:{body:'return this_h',args:[],thisVars:['this_h'],localVars:[]}}),t.argmin=kS({args:['index','array','shape'],pre:{body:'{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}',args:[{name:'_inline_0_arg0_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg1_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg2_',lvalue:!1,rvalue:!0,count:1}],thisVars:['this_i','this_v'],localVars:[]},body:{body:'{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2},{name:'_inline_1_arg1_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_i','this_v'],localVars:['_inline_1_k']},post:{body:'{return this_i}',args:[],thisVars:['this_i'],localVars:[]}}),t.argmax=kS({args:['index','array','shape'],pre:{body:'{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}',args:[{name:'_inline_0_arg0_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg1_',lvalue:!1,rvalue:!1,count:0},{name:'_inline_0_arg2_',lvalue:!1,rvalue:!0,count:1}],thisVars:['this_i','this_v'],localVars:[]},body:{body:'{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}',args:[{name:'_inline_1_arg0_',lvalue:!1,rvalue:!0,count:2},{name:'_inline_1_arg1_',lvalue:!1,rvalue:!0,count:2}],thisVars:['this_i','this_v'],localVars:['_inline_1_k']},post:{body:'{return this_i}',args:[],thisVars:['this_i'],localVars:[]}}),t.random=o({args:['array'],pre:{args:[],body:'this_f=Math.random',thisVars:['this_f']},body:{args:['a'],body:'a=this_f()',thisVars:['this_f']},funcName:'random'}),t.assign=o({args:['array','array'],body:{args:['a','b'],body:'a=b'},funcName:'assign'}),t.assigns=o({args:['array','scalar'],body:{args:['a','b'],body:'a=b'},funcName:'assigns'}),t.equals=kS({args:['array','array'],pre:n,body:{args:[{name:'x',lvalue:!1,rvalue:!0,count:1},{name:'y',lvalue:!1,rvalue:!0,count:1}],body:'if(x!==y){return false}',localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:'return true'},funcName:'equals'})}),MS=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.checkShape=function(e,t){if(e.length&&t.length&&e.length!==t.reduce((e,t)=>e*t,1))throw new Error('[Tensor] specified shape incompatible with data.')},t.data3DLayoutForGL=function(e,t,a){const r=new e(t.data.length),n=(0,o.default)(new e(a[0]*a[1]),[a[0],a[1]]);let u=0;for(let o=0;o<a[2];o++)s.default.assign(n,t.pick(null,null,o)),r.set(n.data,u),u+=a[0]*a[1];return r},t.createIndicesFor2DReshaped=function(e,t=!1,a=-1){const n=e.reduce((e,t)=>e*t,1),i=(0,o.default)(new Int32Array(n),e);if(t){const e=yn(Tn(n)),t=(0,o.default)(new Int32Array(e**2),[e,e]),a=(0,o.default)(new Int32Array(e**2),[e,e]),r=(0,o.default)(new Int32Array(e**2),[e,e]);for(let a=0;a<e;a++)s.default.assigns(t.pick(a,null),a);for(let t=0;t<e;t++)s.default.assigns(a.pick(null,t),t);s.default.muls(r,t,e),s.default.addeq(r,a),i.data.set(r.data.subarray(0,i.size))}else{0>a&&(a=e.length+a);const t=e[a],u=(0,o.default)(new Int32Array(n),e),l=(0,o.default)(new Int32Array(n),e),p=[...e.slice(0,a),...e.slice(a+1)],d=p.reduce((e,t)=>e*t,1),c=(0,o.default)(new Int32Array((0,r.default)(d)),p),g=Array(e.length).fill(null);for(let e=0;e<t;e++)g[a]=e,s.default.assign(u.pick(...g),c),s.default.assigns(l.pick(...g),e);s.default.muls(i,u,t),s.default.addeq(i,l)}return i};var r=a(vS),o=a(PS),s=a(ES)});se(MS);var DS=Pr,IS=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(MS),o=a(PS),i=a(ES),n=a(DS);t.default=class{constructor(e,t,a={}){this.arrayType=a.type||Float32Array,e&&e.length&&(e instanceof this.arrayType||e instanceof Array)?(r.checkShape(e,t),e instanceof this.arrayType?this.tensor=(0,o.default)(e,t):e instanceof Array&&(this.tensor=(0,o.default)(new this.arrayType(e),t))):!e.length&&t.length?this.tensor=(0,o.default)(new this.arrayType(t.reduce((e,t)=>e*t,1)),t):this.tensor=(0,o.default)(new this.arrayType([]),[])}createGLTexture({type:e='2d',format:t='float',supportsTextureFragments:a=!1}){let r=[];if(1===this.tensor.shape.length)r=[1,this.tensor.shape[0]],this.is1D=!0;else if(2===this.tensor.shape.length)r=this.tensor.shape;else if(3===this.tensor.shape.length&&('2d_array'===e||'3d'===e))r=this.tensor.shape;else throw new Error('[Tensor] cannot create WebGL2 texture.');if(this.glTextureShape=r,this.glTextureType=e,this.glTextureFormat=t,'2d'===e)this.glTextureShape[0]>gS.MAX_TEXTURE_SIZE&&a?this._create2DRowFragmentedGLTexture():this._create2DGLTexture();else if('2d_array'===e||'3d'===e)this._create3DGLTexture();else throw new Error(`[Tensor] invalid type ${e}.`)}_create2DGLTexture(){const e=gS.webgl2.context,t=gS.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),{textureTarget:a,textureInternalFormat:r,textureFormat:o,textureType:n}=t;this.glTexture=e.createTexture(),gS.webgl2.storeRef('texture',this.glTexture),e.bindTexture(a,this.glTexture);const i=this.glTextureShape,s=this.tensor.data;e.texImage2D(a,0,r,i[1],i[0],0,o,n,s),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)}_create2DRowFragmentedGLTexture(){const e=gS.webgl2.context,t=gS.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),{textureTarget:a,textureInternalFormat:r,textureFormat:o,textureType:n}=t;this.glTextureFragments=[],this.glTextureFragmentShape=[gS.MAX_TEXTURE_SIZE,this.glTextureShape[1]];const i=this.glTextureFragmentShape,s=yn(this.glTextureShape[0]/gS.MAX_TEXTURE_SIZE);let u=0;for(let t=0;t<s;t++){const l=e.createTexture();gS.webgl2.storeRef('texture',l),e.bindTexture(a,l);let p;t===s-1?(p=new this.arrayType(i[0]*i[1]),p.set(this.tensor.data.slice(u,u+i[0]*i[1]),0)):p=this.tensor.data.slice(u,u+i[0]*i[1]),e.texImage2D(a,0,r,i[1],i[0],0,o,n,p),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST),this.glTextureFragments.push(l),u+=i[0]*i[1]}}_create3DGLTexture(){const e=gS.webgl2.context,t=gS.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),{textureTarget:a,textureInternalFormat:o,textureFormat:n,textureType:i}=t;this.glTexture=e.createTexture(),gS.webgl2.storeRef('texture',this.glTexture),e.bindTexture(a,this.glTexture);const s=this.glTextureShape,u=r.data3DLayoutForGL(this.arrayType,this.tensor,this.glTextureShape);e.texImage3D(a,0,o,s[1],s[0],s[2],0,n,i,u),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)}convert2DRowFragmentedGLTextureToColStack(){if(!this.glTextureFragments||!this.glTextureFragmentShape)throw new Error('[Tensor] no glTextureFragments available.');const e=gS.webgl2.context,t=gS.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),{textureTarget:a,textureInternalFormat:r,textureFormat:o,textureType:n}=t;if(!this.glTextureFragmentsAsColStack){this.glTextureFragmentsAsColStack=e.createTexture(),gS.webgl2.storeRef('texture',this.glTextureFragmentsAsColStack),e.bindTexture(a,this.glTextureFragmentsAsColStack);const t=this.glTextureFragments.length;this.glTextureFragmentsAsColStackShape=[this.glTextureFragmentShape[0],this.glTextureFragmentShape[1]*t];const i=this.glTextureFragmentsAsColStackShape,s=new this.arrayType(i.reduce((e,t)=>e*t,1));e.texImage2D(a,0,r,i[1],i[0],0,o,n,s),e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)}else e.bindTexture(a,this.glTextureFragmentsAsColStack);const i=e.createFramebuffer();e.bindFramebuffer(e.READ_FRAMEBUFFER,i),this.glTextureFragments.forEach((t,r)=>{e.framebufferTexture2D(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),e.copyTexSubImage2D(a,0,r*this.glTextureFragmentShape[1],0,0,0,this.glTextureFragmentShape[1],this.glTextureFragmentShape[0])}),e.deleteFramebuffer(i)}removeGLTextureFragmentsAsColStack(){if(this.glTextureFragmentsAsColStack){const e=gS.webgl2.context;e.deleteTexture(this.glTextureFragmentsAsColStack),delete this.glTextureFragmentsAsColStack,delete this.glTextureFragmentsAsColStackShape}}deleteGLTexture(){const e=gS.webgl2.context;this.glTexture&&(e.deleteTexture(this.glTexture),delete this.glTexture),this.glTextureFragments&&(this.glTextureFragments.forEach((t)=>{e.deleteTexture(t)}),delete this.glTextureFragments)}replaceTensorData(e){if(e&&e.length&&e instanceof this.arrayType)this.tensor.data.set(e);else if(e&&e.length&&e instanceof Array)this.tensor.data.set(new this.arrayType(e));else throw new Error('[Tensor] invalid input for replaceTensorData method.');if(this.glTexture){const e=gS.webgl2.context,t=gS.webgl2.getWebGLTextureOptions(this.glTextureType,this.glTextureFormat),{textureTarget:a,textureFormat:o,textureType:n}=t;e.bindTexture(a,this.glTexture);const i=this.glTextureShape;if('2d'===this.glTextureType){const t=this.tensor.data;e.texSubImage2D(a,0,0,0,i[1],i[0],o,n,t,0)}else if('2d_array'===this.glTextureType||'3d'===this.glTextureType){const t=r.data3DLayoutForGL(this.arrayType,this.tensor,i);e.texSubImage3D(a,0,0,0,0,i[1],i[0],i[2],o,n,t,0)}}}transferFromGLTexture(){if(this.glTextureFragments){this.tensor=(0,o.default)(new this.arrayType(this.glTextureShape[0]*this.glTextureShape[1]),this.glTextureShape);let e=0;for(let t=0;t<this.glTextureFragments.length;t++){gS.webgl2.bindOutputTexture(this.glTextureFragments[t],this.glTextureFragmentShape);const a=gS.webgl2.readData(this.glTextureFragmentShape);if(t===this.glTextureFragments.length-1){const t=this.tensor.data.length-e;this.tensor.data.set(a.subarray(0,t),e)}else this.tensor.data.set(a,e);e+=a.length}}else gS.webgl2.bindOutputTexture(this.glTexture,this.glTextureShape),this.tensor=(0,o.default)(new this.arrayType([]),this.glTextureShape),this.tensor.data=gS.webgl2.readData(this.glTextureShape);this.is1D&&1===this.glTextureShape[0]&&(this.tensor=(0,n.default)(this.tensor,[0]))}reshapeTo2D(){const e=this.tensor.shape.length-1,t=this.tensor.shape[e],a=this.tensor.shape.slice(0,e),n=a.reduce((e,t)=>e*t,1),s=(0,o.default)(new this.arrayType(n*t),[n,t]),u=(0,o.default)(new this.arrayType(n),a),l=(0,o.default)(new this.arrayType(n),[n]),p=Array(this.tensor.shape.length).fill(null);for(let a=0;a<t;a++)p[e]=a,i.default.assign(u,this.tensor.pick(...p)),l.data=u.data,i.default.assign(s.pick(null,a),l);this.originalShape=this.tensor.shape,this.indicesForReshaped=r.createIndicesFor2DReshaped(this.tensor.shape,!1,e),this.tensor=s,this.is2DReshaped=!0}reshapeFrom2D(e=-1){if(!this.is2DReshaped)throw new Error('[Tensor] not in reshaped 2D representation.');if(!this.originalShape)throw new Error('[Tensor] does not contain originalShape.');0>e&&(e=this.originalShape.length+e);const t=this.tensor.shape[0],a=this.tensor.shape[1],r=(0,o.default)(new this.arrayType(this.originalShape.reduce((e,t)=>e*t,1)),this.originalShape),s=(0,o.default)(new this.arrayType(t),[t]),n=[...this.originalShape.slice(0,e),...this.originalShape.slice(e+1)],u=(0,o.default)(new this.arrayType(n.reduce((e,t)=>e*t,1)),n),l=Array(this.originalShape.length).fill(null);for(let t=0;t<a;t++)i.default.assign(s,this.tensor.pick(null,t)),u.data=s.data,l[e]=t,i.default.assign(r.pick(...l),u);this.tensor=r}reshapeTo2DSquare(){const e=yn(Tn(this.tensor.size)),t=(0,o.default)(new this.arrayType(e**2),[e,e]);t.data.set(this.tensor.data),this.originalShape=this.tensor.shape,this.indicesForReshaped=r.createIndicesFor2DReshaped(this.tensor.shape,!0),this.tensor=t,this.is2DSquareReshaped=!0}reshapeFrom2DSquare(){if(!this.is2DSquareReshaped)throw new Error('[Tensor] not in reshaped 2D square representation.');if(!this.originalShape)throw new Error('[Tensor] does not contain originalShape.');const e=this.originalShape.reduce((e,t)=>e*t,1),t=(0,o.default)(new this.arrayType(e),this.originalShape);t.data.set(this.tensor.data.subarray(0,e)),this.tensor=t}}});se(IS);var AS=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(Ox),o=a(hS),n=a(IS);class i extends o.default{constructor(e={}){super(e),this.layerClass='InputLayer';const{shape:t=[]}=e;this.shape=e.batch_input_shape&&e.batch_input_shape.length?e.batch_input_shape.slice(1):t,this.description=`shape: ${JSON.stringify(this.shape)}`}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.inputShape=e.tensor.shape,(0,r.default)(this.inputShape,this.shape)||this.throwError(`input tensor shape ${e.tensor.shape} does not match specified shape ${this.shape}.`),this.output=new n.default(e.tensor.data,e.tensor.shape)}_callGPU(e){this.inputShape=e.glTexture||e.glTextureFragments?e.is2DReshaped||e.is2DSquareReshaped?e.originalShape:e.tensor.shape:e.tensor.shape,(0,r.default)(this.inputShape,this.shape)||this.throwError(`input tensor shape ${e.tensor.shape} does not match specified shape ${this.shape}.`),e.glTexture||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}):2<e.tensor.shape.length&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}))),this.output=e}}t.default=i});se(AS);var RS=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){if(1===e.tensor.shape.length){const t=a.default.sup(e.tensor);a.default.subseq(e.tensor,t),a.default.expeq(e.tensor);const r=a.default.sum(e.tensor);a.default.divseq(e.tensor,r)}else if(2===e.tensor.shape.length)for(let t=0;t<e.tensor.shape[0];t++){const r=a.default.sup(e.tensor.pick(t,null));a.default.subseq(e.tensor.pick(t,null),r),a.default.expeq(e.tensor.pick(t,null));const o=a.default.sum(e.tensor.pick(t,null));a.default.divseq(e.tensor.pick(t,null),o)}else throw new Error(`[activations.softmax] tensor shape ${e.tensor.shape} not supported.`)};var a=function(e){return e&&e.__esModule?e:{default:e}}(ES)});se(RS);var LS=ue(function(e,t){(function(e,a){a(t)})(ji,function(e){function t(e,t){if(!e)throw new Error('ASSERT: '+t)}function a(e){return 48<=e&&57>=e}function r(e){return 0<='0123456789abcdefABCDEF'.indexOf(e)}function o(e){return 0<='01234567'.indexOf(e)}function n(e){return 32===e||9===e||11===e||12===e||160===e||5760<=e&&0<=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)}function i(e){return 10===e||13===e||8232===e||8233===e}function s(e){return 36===e||95===e||65<=e&&90>=e||97<=e&&122>=e||92===e||128<=e&&rt.NonAsciiIdentifierStart.test(pn(e))}function u(e){return 36===e||95===e||65<=e&&90>=e||97<=e&&122>=e||48<=e&&57>=e||92===e||128<=e&&rt.NonAsciiIdentifierPart.test(pn(e))}function l(e){return'class'===e||'enum'===e||'export'===e||'extends'===e||'import'===e||'super'===e}function p(e){return'implements'===e||'interface'===e||'package'===e||'private'===e||'protected'===e||'public'===e||'static'===e||'yield'===e||'let'===e}function d(e){return'eval'===e||'arguments'===e}function c(e){if(it&&p(e))return!0;switch(e.length){case 2:return'if'===e||'in'===e||'do'===e;case 3:return'var'===e||'for'===e||'new'===e||'try'===e||'let'===e;case 4:return'this'===e||'else'===e||'case'===e||'void'===e||'with'===e||'enum'===e;case 5:return'while'===e||'break'===e||'catch'===e||'throw'===e||'const'===e||'yield'===e||'class'===e||'super'===e;case 6:return'return'===e||'typeof'===e||'delete'===e||'switch'===e||'export'===e||'import'===e;case 7:return'default'===e||'finally'===e||'extends'===e;case 8:return'function'===e||'continue'===e||'debugger'===e;case 10:return'instanceof'===e;default:return!1;}}function g(e,a,r,o,n){var i;t('number'==typeof r,'Comment must have valid position');gt.lastCommentStart>=r||(gt.lastCommentStart=r,i={type:e,value:a},ht.range&&(i.range=[r,o]),ht.loc&&(i.loc=n),ht.comments.push(i),ht.attachComment&&(ht.leadingComments.push(i),ht.trailingComments.push(i)))}function h(e){var t,a,r,o;for(t=st-e,a={start:{line:ut,column:st-lt-e}};st<pt;)if(r=nt.charCodeAt(st),++st,i(r))return ht.comments&&(o=nt.slice(t+e,st-1),a.end={line:ut,column:st-lt-1},g('Line',o,t,st-1,a)),13===r&&10===nt.charCodeAt(st)&&++st,++ut,void(lt=st);ht.comments&&(o=nt.slice(t+e,st),a.end={line:ut,column:st-lt},g('Line',o,t,st,a))}function f(){var e,t,a,r;for(ht.comments&&(e=st-2,t={start:{line:ut,column:st-lt-2}});st<pt;)if(a=nt.charCodeAt(st),i(a))13===a&&10===nt.charCodeAt(st+1)&&++st,++ut,++st,lt=st,st>=pt&&U({},at.UnexpectedToken,'ILLEGAL');else if(42===a){if(47===nt.charCodeAt(st+1))return++st,++st,void(ht.comments&&(r=nt.slice(e+2,st-2),t.end={line:ut,column:st-lt},g('Block',r,e,st,t)));++st}else++st;U({},at.UnexpectedToken,'ILLEGAL')}function m(){var e,t;for(t=0===st;st<pt;)if(e=nt.charCodeAt(st),n(e))++st;else if(i(e))++st,13===e&&10===nt.charCodeAt(st)&&++st,++ut,lt=st,t=!0;else if(47===e){if(e=nt.charCodeAt(st+1),47===e)++st,++st,h(2),t=!0;else if(42===e)++st,++st,f();else break;}else if(t&&45===e){if(45===nt.charCodeAt(st+1)&&62===nt.charCodeAt(st+2))st+=3,h(3);else break;}else if(60!==e)break;else if('!--'===nt.slice(st+1,st+4))++st,++st,++st,++st,h(4);else break}function _(e){var t=0,a,o,n;for(o='u'===e?4:2,a=0;a<o;++a)if(st<pt&&r(nt[st]))n=nt[st++],t=16*t+'0123456789abcdef'.indexOf(n.toLowerCase());else return'';return pn(t)}function y(){var e,t;for(e=nt.charCodeAt(st++),t=pn(e),92===e&&(117!==nt.charCodeAt(st)&&U({},at.UnexpectedToken,'ILLEGAL'),++st,e=_('u'),(!e||'\\'===e||!s(e.charCodeAt(0)))&&U({},at.UnexpectedToken,'ILLEGAL'),t=e);st<pt&&(e=nt.charCodeAt(st),!!u(e));)++st,t+=pn(e),92===e&&(t=t.substr(0,t.length-1),117!==nt.charCodeAt(st)&&U({},at.UnexpectedToken,'ILLEGAL'),++st,e=_('u'),(!e||'\\'===e||!u(e.charCodeAt(0)))&&U({},at.UnexpectedToken,'ILLEGAL'),t+=e);return t}function x(){var e,t;for(e=st++;st<pt;){if(t=nt.charCodeAt(st),92===t)return st=e,y();if(u(t))++st;else break}return nt.slice(e,st)}function v(){var e,t,a;return e=st,t=92===nt.charCodeAt(st)?y():x(),a=1===t.length?Ze.Identifier:c(t)?Ze.Keyword:'null'===t?Ze.NullLiteral:'true'===t||'false'===t?Ze.BooleanLiteral:Ze.Identifier,{type:a,value:t,lineNumber:ut,lineStart:lt,start:e,end:st}}function b(){var e=st,t=nt.charCodeAt(st),a=nt[st],r,o,n,i;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++st,ht.tokenize&&(40===t?ht.openParenToken=ht.tokens.length:123===t&&(ht.openCurlyToken=ht.tokens.length)),{type:Ze.Punctuator,value:pn(t),lineNumber:ut,lineStart:lt,start:e,end:st};default:if(r=nt.charCodeAt(st+1),61===r)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return st+=2,{type:Ze.Punctuator,value:pn(t)+pn(r),lineNumber:ut,lineStart:lt,start:e,end:st};case 33:case 61:return st+=2,61===nt.charCodeAt(st)&&++st,{type:Ze.Punctuator,value:nt.slice(e,st),lineNumber:ut,lineStart:lt,start:e,end:st};}}return(i=nt.substr(st,4),'>>>='===i)?(st+=4,{type:Ze.Punctuator,value:i,lineNumber:ut,lineStart:lt,start:e,end:st}):(n=i.substr(0,3),'>>>'===n||'<<='===n||'>>='===n)?(st+=3,{type:Ze.Punctuator,value:n,lineNumber:ut,lineStart:lt,start:e,end:st}):(o=n.substr(0,2),a===o[1]&&0<='+-<>&|'.indexOf(a)||'=>'===o?(st+=2,{type:Ze.Punctuator,value:o,lineNumber:ut,lineStart:lt,start:e,end:st}):0<='<>=!+-*%&|^/'.indexOf(a)?(++st,{type:Ze.Punctuator,value:a,lineNumber:ut,lineStart:lt,start:e,end:st}):void U({},at.UnexpectedToken,'ILLEGAL'))}function S(e){for(var t='';st<pt&&!!r(nt[st]);)t+=nt[st++];return 0===t.length&&U({},at.UnexpectedToken,'ILLEGAL'),s(nt.charCodeAt(st))&&U({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.NumericLiteral,value:parseInt('0x'+t,16),lineNumber:ut,lineStart:lt,start:e,end:st}}function T(e){for(var t='0'+nt[st++];st<pt&&!!o(nt[st]);)t+=nt[st++];return(s(nt.charCodeAt(st))||a(nt.charCodeAt(st)))&&U({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.NumericLiteral,value:parseInt(t,8),octal:!0,lineNumber:ut,lineStart:lt,start:e,end:st}}function P(){var e,t;for(e=st+1;e<pt;++e){if(t=nt[e],'8'===t||'9'===t)return!1;if(!o(t))return!0}return!0}function w(){var e,r,n;if(n=nt[st],t(a(n.charCodeAt(0))||'.'===n,'Numeric literal must start with a decimal digit or a decimal point'),r=st,e='','.'!==n){if(e=nt[st++],n=nt[st],'0'===e){if('x'===n||'X'===n)return++st,S(r);if(o(n)&&P())return T(r)}for(;a(nt.charCodeAt(st));)e+=nt[st++];n=nt[st]}if('.'===n){for(e+=nt[st++];a(nt.charCodeAt(st));)e+=nt[st++];n=nt[st]}if('e'===n||'E'===n)if(e+=nt[st++],n=nt[st],('+'===n||'-'===n)&&(e+=nt[st++]),a(nt.charCodeAt(st)))for(;a(nt.charCodeAt(st));)e+=nt[st++];else U({},at.UnexpectedToken,'ILLEGAL');return s(nt.charCodeAt(st))&&U({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.NumericLiteral,value:parseFloat(e),lineNumber:ut,lineStart:lt,start:r,end:st}}function C(){var e='',a=!1,r,n,s,u,l,p,d,c;for(d=ut,c=lt,r=nt[st],t('\''===r||'"'===r,'String literal must starts with a quote'),n=st,++st;st<pt;)if(s=nt[st++],s===r){r='';break}else if('\\'===s)s=nt[st++],s&&i(s.charCodeAt(0))?(++ut,'\r'===s&&'\n'===nt[st]&&++st,lt=st):'u'===s||'x'===s?(p=st,l=_(s),l?e+=l:(st=p,e+=s)):'n'===s?e+='\n':'r'===s?e+='\r':'t'===s?e+='\t':'b'===s?e+='\b':'f'===s?e+='\f':'v'===s?e+='\x0B':o(s)?(u='01234567'.indexOf(s),0!==u&&(a=!0),st<pt&&o(nt[st])&&(a=!0,u=8*u+'01234567'.indexOf(nt[st++]),0<='0123'.indexOf(s)&&st<pt&&o(nt[st])&&(u=8*u+'01234567'.indexOf(nt[st++]))),e+=pn(u)):e+=s;else if(i(s.charCodeAt(0)))break;else e+=s;return''!==r&&U({},at.UnexpectedToken,'ILLEGAL'),{type:Ze.StringLiteral,value:e,octal:a,startLineNumber:d,startLineStart:c,lineNumber:ut,lineStart:lt,start:n,end:st}}function F(e,t){var a;try{a=new RegExp(e,t)}catch(t){U({},at.InvalidRegExp)}return a}function k(){var e,a,r,o,n;for(e=nt[st],t('/'===e,'Regular expression literal must start with a slash'),a=nt[st++],r=!1,o=!1;st<pt;)if(e=nt[st++],a+=e,'\\'===e)e=nt[st++],i(e.charCodeAt(0))&&U({},at.UnterminatedRegExp),a+=e;else if(i(e.charCodeAt(0)))U({},at.UnterminatedRegExp);else if(r)']'===e&&(r=!1);else if('/'===e){o=!0;break}else'['===e&&(r=!0);return o||U({},at.UnterminatedRegExp),n=a.substr(1,a.length-2),{value:n,literal:a}}function E(){var e,t,a,r;for(t='',a='';st<pt&&(e=nt[st],!!u(e.charCodeAt(0)));)if(++st,!('\\'===e&&st<pt))a+=e,t+=e;else if(e=nt[st],'u'===e){if(++st,r=st,e=_('u'),e)for(a+=e,t+='\\u';r<st;++r)t+=nt[r];else st=r,a+='u',t+='\\u';q({},at.UnexpectedToken,'ILLEGAL')}else t+='\\',q({},at.UnexpectedToken,'ILLEGAL');return{value:a,literal:t}}function M(){var e,t,a,r;return ct=null,m(),e=st,t=k(),a=E(),r=F(t.value,a.value),ht.tokenize?{type:Ze.RegularExpression,value:r,lineNumber:ut,lineStart:lt,start:e,end:st}:{literal:t.literal+a.literal,value:r,start:e,end:st}}function D(){var e,t,a,r;return m(),e=st,t={start:{line:ut,column:st-lt}},a=M(),t.end={line:ut,column:st-lt},ht.tokenize||(0<ht.tokens.length&&(r=ht.tokens[ht.tokens.length-1],r.range[0]===e&&'Punctuator'===r.type&&('/'===r.value||'/='===r.value)&&ht.tokens.pop()),ht.tokens.push({type:'RegularExpression',value:a.literal,range:[e,st],loc:t})),a}function I(e){return e.type===Ze.Identifier||e.type===Ze.Keyword||e.type===Ze.BooleanLiteral||e.type===Ze.NullLiteral}function A(){var e,t;if(e=ht.tokens[ht.tokens.length-1],!e)return D();if('Punctuator'===e.type){if(']'===e.value)return b();if(')'===e.value)return t=ht.tokens[ht.openParenToken-1],t&&'Keyword'===t.type&&('if'===t.value||'while'===t.value||'for'===t.value||'with'===t.value)?D():b();if('}'===e.value){if(!(ht.tokens[ht.openCurlyToken-3]&&'Keyword'===ht.tokens[ht.openCurlyToken-3].type)){if(!(ht.tokens[ht.openCurlyToken-4]&&'Keyword'===ht.tokens[ht.openCurlyToken-4].type))return b();if(t=ht.tokens[ht.openCurlyToken-5],!t)return D()}else if(t=ht.tokens[ht.openCurlyToken-4],!t)return b();return 0<=Je.indexOf(t.value)?b():D()}return D()}return'Keyword'===e.type&&'this'!==e.value?D():b()}function R(){var e;return(m(),st>=pt)?{type:Ze.EOF,lineNumber:ut,lineStart:lt,start:st,end:st}:(e=nt.charCodeAt(st),s(e)?v():40===e||41===e||59===e?b():39===e||34===e?C():46===e?a(nt.charCodeAt(st+1))?w():b():a(e)?w():ht.tokenize&&47===e?A():b())}function L(){var e,t,a;return m(),e={start:{line:ut,column:st-lt}},t=R(),e.end={line:ut,column:st-lt},t.type!==Ze.EOF&&(a=nt.slice(t.start,t.end),ht.tokens.push({type:Qe[t.type],value:a,range:[t.start,t.end],loc:e})),t}function O(){var e;return e=ct,st=e.end,ut=e.lineNumber,lt=e.lineStart,ct='undefined'==typeof ht.tokens?R():L(),st=e.end,ut=e.lineNumber,lt=e.lineStart,e}function j(){var e,t,a;e=st,t=ut,a=lt,ct='undefined'==typeof ht.tokens?R():L(),st=e,ut=t,lt=a}function z(e,t){this.line=e,this.column=t}function G(e,t,a,r){this.start=new z(e,t),this.end=new z(a,r)}function N(){var e,t,a,r;return e=st,t=ut,a=lt,m(),r=ut!==t,st=e,ut=t,lt=a,r}function U(e,a){var r=Array.prototype.slice.call(arguments,2),o=a.replace(/%(\d)/g,function(e,a){return t(a<r.length,'Message reference must be in range'),r[a]}),n;throw'number'==typeof e.lineNumber?(n=new Error('Line '+e.lineNumber+': '+o),n.index=e.start,n.lineNumber=e.lineNumber,n.column=e.start-lt+1):(n=new Error('Line '+ut+': '+o),n.index=st,n.lineNumber=ut,n.column=st-lt+1),n.description=o,n}function q(){try{U.apply(null,arguments)}catch(t){if(ht.errors)ht.errors.push(t);else throw t}}function B(e){if(e.type===Ze.EOF&&U(e,at.UnexpectedEOS),e.type===Ze.NumericLiteral&&U(e,at.UnexpectedNumber),e.type===Ze.StringLiteral&&U(e,at.UnexpectedString),e.type===Ze.Identifier&&U(e,at.UnexpectedIdentifier),e.type===Ze.Keyword){if(l(e.value))U(e,at.UnexpectedReserved);else if(it&&p(e.value))return void q(e,at.StrictReservedWord);U(e,at.UnexpectedToken,e.value)}U(e,at.UnexpectedToken,e.value)}function V(e){var t=O();(t.type!==Ze.Punctuator||t.value!==e)&&B(t)}function H(e){var t=O();(t.type!==Ze.Keyword||t.value!==e)&&B(t)}function W(e){return ct.type===Ze.Punctuator&&ct.value===e}function X(e){return ct.type===Ze.Keyword&&ct.value===e}function Y(){var e;return!(ct.type!==Ze.Punctuator)&&(e=ct.value,'='===e||'*='===e||'/='===e||'%='===e||'+='===e||'-='===e||'<<='===e||'>>='===e||'>>>='===e||'&='===e||'^='===e||'|='===e)}function $(){var e=st,t=ut,a=lt,r=ct,o;return 59===nt.charCodeAt(st)||W(';')?void O():(o=ut,m(),ut===o?void(ct.type!==Ze.EOF&&!W('}')&&B(ct)):(st=e,ut=t,lt=a,void(ct=r)))}function K(e){return e.type===et.Identifier||e.type===et.MemberExpression}function Z(){var e=[],t;for(t=ct,V('[');!W(']');)W(',')?(O(),e.push(null)):(e.push(me()),W(']')||V(','));return O(),dt.markEnd(dt.createArrayExpression(e),t)}function Q(e,t){var a,r,o;return a=it,o=ct,r=Be(),t&&it&&d(e[0].name)&&q(t,at.StrictParamName),it=a,dt.markEnd(dt.createFunctionExpression(null,e,[],r),o)}function J(){var e,t;return t=ct,e=O(),e.type===Ze.StringLiteral||e.type===Ze.NumericLiteral?(it&&e.octal&&q(e,at.StrictOctalLiteral),dt.markEnd(dt.createLiteral(e),t)):dt.markEnd(dt.createIdentifier(e.value),t)}function ee(){var e,t,a,r,o,n;return(e=ct,n=ct,e.type===Ze.Identifier)?(a=J(),'get'===e.value&&!W(':'))?(t=J(),V('('),V(')'),r=Q([]),dt.markEnd(dt.createProperty('get',t,r),n)):'set'!==e.value||W(':')?(V(':'),r=me(),dt.markEnd(dt.createProperty('init',a,r),n)):(t=J(),V('('),e=ct,e.type===Ze.Identifier?(o=[ve()],V(')'),r=Q(o,e)):(V(')'),q(e,at.UnexpectedToken,e.value),r=Q([])),dt.markEnd(dt.createProperty('set',t,r),n)):e.type===Ze.EOF||e.type===Ze.Punctuator?void B(e):(t=J(),V(':'),r=me(),dt.markEnd(dt.createProperty('init',t,r),n))}function te(){var e=[],t={},a=String,r,o,n,i,s;for(s=ct,V('{');!W('}');)r=ee(),o=r.key.type===et.Identifier?r.key.name:a(r.key.value),i='init'===r.kind?tt.Data:'get'===r.kind?tt.Get:tt.Set,n='$'+o,Object.prototype.hasOwnProperty.call(t,n)?(t[n]===tt.Data?it&&i===tt.Data?q({},at.StrictDuplicateProperty):i!==tt.Data&&q({},at.AccessorDataProperty):i===tt.Data?q({},at.AccessorDataProperty):t[n]&i&&q({},at.AccessorGetSet),t[n]|=i):t[n]=i,e.push(r),W('}')||V(',');return V('}'),dt.markEnd(dt.createObjectExpression(e),s)}function ae(){var e;return V('('),e=_e(),V(')'),e}function re(){var e,t,a,r;if(W('('))return ae();if(W('['))return Z();if(W('{'))return te();if(e=ct.type,r=ct,e===Ze.Identifier)a=dt.createIdentifier(O().value);else if(e===Ze.StringLiteral||e===Ze.NumericLiteral)it&&ct.octal&&q(ct,at.StrictOctalLiteral),a=dt.createLiteral(O());else if(e===Ze.Keyword){if(X('function'))return We();X('this')?(O(),a=dt.createThisExpression()):B(O())}else e===Ze.BooleanLiteral?(t=O(),t.value='true'===t.value,a=dt.createLiteral(t)):e===Ze.NullLiteral?(t=O(),t.value=null,a=dt.createLiteral(t)):W('/')||W('/=')?(a='undefined'==typeof ht.tokens?dt.createLiteral(M()):dt.createLiteral(D()),j()):B(O());return dt.markEnd(a,r)}function oe(){var e=[];if(V('('),!W(')'))for(;st<pt&&(e.push(me()),!W(')'));)V(',');return V(')'),e}function ne(){var e,t;return t=ct,e=O(),I(e)||B(e),dt.markEnd(dt.createIdentifier(e.value),t)}function ie(){return V('.'),ne()}function se(){var e;return V('['),e=_e(),V(']'),e}function ue(){var e,t,a;return a=ct,H('new'),e=pe(),t=W('(')?oe():[],dt.markEnd(dt.createNewExpression(e,t),a)}function le(){var e=gt.allowIn,t,a,r,o;for(o=ct,gt.allowIn=!0,t=X('new')?ue():re();;){if(W('.'))r=ie(),t=dt.createMemberExpression('.',t,r);else if(W('('))a=oe(),t=dt.createCallExpression(t,a);else if(W('['))r=se(),t=dt.createMemberExpression('[',t,r);else break;dt.markEnd(t,o)}return gt.allowIn=e,t}function pe(){var e,a,r;for(t(gt.allowIn,'callee of new expression always allow in keyword.'),r=ct,e=X('new')?ue():re();W('.')||W('[');)W('[')?(a=se(),e=dt.createMemberExpression('[',e,a)):(a=ie(),e=dt.createMemberExpression('.',e,a)),dt.markEnd(e,r);return e}function de(){var e=ct,t,a;return t=le(),ct.type===Ze.Punctuator&&(W('++')||W('--'))&&!N()&&(it&&t.type===et.Identifier&&d(t.name)&&q({},at.StrictLHSPostfix),!K(t)&&q({},at.InvalidLHSInAssignment),a=O(),t=dt.markEnd(dt.createPostfixExpression(a.value,t),e)),t}function ce(){var e,t,a;return ct.type!==Ze.Punctuator&&ct.type!==Ze.Keyword?t=de():W('++')||W('--')?(a=ct,e=O(),t=ce(),it&&t.type===et.Identifier&&d(t.name)&&q({},at.StrictLHSPrefix),!K(t)&&q({},at.InvalidLHSInAssignment),t=dt.createUnaryExpression(e.value,t),t=dt.markEnd(t,a)):W('+')||W('-')||W('~')||W('!')?(a=ct,e=O(),t=ce(),t=dt.createUnaryExpression(e.value,t),t=dt.markEnd(t,a)):X('delete')||X('void')||X('typeof')?(a=ct,e=O(),t=ce(),t=dt.createUnaryExpression(e.value,t),t=dt.markEnd(t,a),it&&'delete'===t.operator&&t.argument.type===et.Identifier&&q({},at.StrictDelete)):t=de(),t}function ge(e,t){var a=0;if(e.type!==Ze.Punctuator&&e.type!==Ze.Keyword)return 0;switch(e.value){case'||':a=1;break;case'&&':a=2;break;case'|':a=3;break;case'^':a=4;break;case'&':a=5;break;case'==':case'!=':case'===':case'!==':a=6;break;case'<':case'>':case'<=':case'>=':case'instanceof':a=7;break;case'in':a=t?7:0;break;case'<<':case'>>':case'>>>':a=8;break;case'+':case'-':a=9;break;case'*':case'/':case'%':a=11;break;default:}return a}function he(){var e,t,a,r,o,n,s,u,l,p;if(e=ct,l=ce(),r=ct,o=ge(r,gt.allowIn),0===o)return l;for(r.prec=o,O(),t=[e,ct],s=ce(),n=[l,r,s];0<(o=ge(ct,gt.allowIn));){for(;2<n.length&&o<=n[n.length-2].prec;)s=n.pop(),u=n.pop().value,l=n.pop(),a=dt.createBinaryExpression(u,l,s),t.pop(),e=t[t.length-1],dt.markEnd(a,e),n.push(a);r=O(),r.prec=o,n.push(r),t.push(ct),a=ce(),n.push(a)}for(p=n.length-1,a=n[p],t.pop();1<p;)a=dt.createBinaryExpression(n[p-1].value,n[p-2],a),p-=2,e=t.pop(),dt.markEnd(a,e);return a}function fe(){var e,t,a,r,o;return o=ct,e=he(),W('?')&&(O(),t=gt.allowIn,gt.allowIn=!0,a=me(),gt.allowIn=t,V(':'),r=me(),e=dt.createConditionalExpression(e,a,r),dt.markEnd(e,o)),e}function me(){var e,t,a,r,o;return e=ct,o=ct,r=t=fe(),Y()&&(!K(t)&&q({},at.InvalidLHSInAssignment),it&&t.type===et.Identifier&&d(t.name)&&q(e,at.StrictLHSAssignment),e=O(),a=me(),r=dt.markEnd(dt.createAssignmentExpression(e.value,t,a),o)),r}function _e(){var e=ct,t;if(t=me(),W(',')){for(t=dt.createSequenceExpression([t]);st<pt&&!!W(',');)O(),t.expressions.push(me());dt.markEnd(t,e)}return t}function ye(){for(var e=[],t;st<pt&&!W('}')&&!(t=Xe(),'undefined'==typeof t);)e.push(t);return e}function xe(){var e,t;return t=ct,V('{'),e=ye(),V('}'),dt.markEnd(dt.createBlockStatement(e),t)}function ve(){var e,t;return t=ct,e=O(),e.type!==Ze.Identifier&&B(e),dt.markEnd(dt.createIdentifier(e.value),t)}function be(e){var t=null,a,r;return r=ct,a=ve(),it&&d(a.name)&&q({},at.StrictVarName),'const'===e?(V('='),t=me()):W('=')&&(O(),t=me()),dt.markEnd(dt.createVariableDeclarator(a,t),r)}function Se(e){var t=[];do{if(t.push(be(e)),!W(','))break;O()}while(st<pt);return t}function Te(){var e;return H('var'),e=Se(),$(),dt.createVariableDeclaration(e,'var')}function Pe(e){var t,a;return a=ct,H(e),t=Se(e),$(),dt.markEnd(dt.createVariableDeclaration(t,e),a)}function we(){return V(';'),dt.createEmptyStatement()}function Ce(){var e=_e();return $(),dt.createExpressionStatement(e)}function Fe(){var e,t,a;return H('if'),V('('),e=_e(),V(')'),t=qe(),X('else')?(O(),a=qe()):a=null,dt.createIfStatement(e,t,a)}function ke(){var e,t,a;return H('do'),a=gt.inIteration,gt.inIteration=!0,e=qe(),gt.inIteration=a,H('while'),V('('),t=_e(),V(')'),W(';')&&O(),dt.createDoWhileStatement(e,t)}function Ee(){var e,t,a;return H('while'),V('('),e=_e(),V(')'),a=gt.inIteration,gt.inIteration=!0,t=qe(),gt.inIteration=a,dt.createWhileStatement(e,t)}function Me(){var e,t,a;return a=ct,e=O(),t=Se(),dt.markEnd(dt.createVariableDeclaration(t,e.value),a)}function De(){var e=gt.allowIn,t,a,r,o,n,i,s;return t=a=r=null,H('for'),V('('),W(';')?O():(X('var')||X('let')?(gt.allowIn=!1,t=Me(),gt.allowIn=e,1===t.declarations.length&&X('in')&&(O(),o=t,n=_e(),t=null)):(gt.allowIn=!1,t=_e(),gt.allowIn=e,X('in')&&(!K(t)&&q({},at.InvalidLHSInForIn),O(),o=t,n=_e(),t=null)),'undefined'==typeof o&&V(';')),'undefined'==typeof o&&(!W(';')&&(a=_e()),V(';'),!W(')')&&(r=_e())),V(')'),s=gt.inIteration,gt.inIteration=!0,i=qe(),gt.inIteration=s,'undefined'==typeof o?dt.createForStatement(t,a,r,i):dt.createForInStatement(o,n,i)}function Ie(){var e=null,t;return(H('continue'),59===nt.charCodeAt(st))?(O(),gt.inIteration||U({},at.IllegalContinue),dt.createContinueStatement(null)):N()?(gt.inIteration||U({},at.IllegalContinue),dt.createContinueStatement(null)):(ct.type===Ze.Identifier&&(e=ve(),t='$'+e.name,!Object.prototype.hasOwnProperty.call(gt.labelSet,t)&&U({},at.UnknownLabel,e.name)),$(),null!==e||gt.inIteration||U({},at.IllegalContinue),dt.createContinueStatement(e))}function Ae(){var e=null,t;return(H('break'),59===nt.charCodeAt(st))?(O(),gt.inIteration||gt.inSwitch||U({},at.IllegalBreak),dt.createBreakStatement(null)):N()?(gt.inIteration||gt.inSwitch||U({},at.IllegalBreak),dt.createBreakStatement(null)):(ct.type===Ze.Identifier&&(e=ve(),t='$'+e.name,!Object.prototype.hasOwnProperty.call(gt.labelSet,t)&&U({},at.UnknownLabel,e.name)),$(),null!==e||gt.inIteration||gt.inSwitch||U({},at.IllegalBreak),dt.createBreakStatement(e))}function Re(){var e=null;return(H('return'),gt.inFunctionBody||q({},at.IllegalReturn),32===nt.charCodeAt(st)&&s(nt.charCodeAt(st+1)))?(e=_e(),$(),dt.createReturnStatement(e)):N()?dt.createReturnStatement(null):(W(';')||W('}')||ct.type===Ze.EOF||(e=_e()),$(),dt.createReturnStatement(e))}function Le(){var e,t;return it&&(m(),q({},at.StrictModeWith)),H('with'),V('('),e=_e(),V(')'),t=qe(),dt.createWithStatement(e,t)}function Oe(){var e=[],t,a,r;for(r=ct,X('default')?(O(),t=null):(H('case'),t=_e()),V(':');st<pt&&!(W('}')||X('default')||X('case'));)a=qe(),e.push(a);return dt.markEnd(dt.createSwitchCase(t,e),r)}function je(){var e,t,a,r,o;if(H('switch'),V('('),e=_e(),V(')'),V('{'),t=[],W('}'))return O(),dt.createSwitchStatement(e,t);for(r=gt.inSwitch,gt.inSwitch=!0,o=!1;st<pt&&!W('}');)a=Oe(),null===a.test&&(o&&U({},at.MultipleDefaultsInSwitch),o=!0),t.push(a);return gt.inSwitch=r,V('}'),dt.createSwitchStatement(e,t)}function ze(){var e;return H('throw'),N()&&U({},at.NewlineAfterThrow),e=_e(),$(),dt.createThrowStatement(e)}function Ge(){var e,t,a;return a=ct,H('catch'),V('('),W(')')&&B(ct),e=ve(),it&&d(e.name)&&q({},at.StrictCatchVariable),V(')'),t=xe(),dt.markEnd(dt.createCatchClause(e,t),a)}function Ne(){var e=[],t=null,a;return H('try'),a=xe(),X('catch')&&e.push(Ge()),X('finally')&&(O(),t=xe()),0!==e.length||t||U({},at.NoCatchOrFinally),dt.createTryStatement(a,[],e,t)}function Ue(){return H('debugger'),$(),dt.createDebuggerStatement()}function qe(){var e=ct.type,t,a,r,o;if(e===Ze.EOF&&B(ct),e===Ze.Punctuator&&'{'===ct.value)return xe();if(o=ct,e===Ze.Punctuator)switch(ct.value){case';':return dt.markEnd(we(),o);case'(':return dt.markEnd(Ce(),o);default:}if(e===Ze.Keyword)switch(ct.value){case'break':return dt.markEnd(Ae(),o);case'continue':return dt.markEnd(Ie(),o);case'debugger':return dt.markEnd(Ue(),o);case'do':return dt.markEnd(ke(),o);case'for':return dt.markEnd(De(),o);case'function':return dt.markEnd(He(),o);case'if':return dt.markEnd(Fe(),o);case'return':return dt.markEnd(Re(),o);case'switch':return dt.markEnd(je(),o);case'throw':return dt.markEnd(ze(),o);case'try':return dt.markEnd(Ne(),o);case'var':return dt.markEnd(Te(),o);case'while':return dt.markEnd(Ee(),o);case'with':return dt.markEnd(Le(),o);default:}return(t=_e(),t.type===et.Identifier&&W(':'))?(O(),r='$'+t.name,Object.prototype.hasOwnProperty.call(gt.labelSet,r)&&U({},at.Redeclaration,'Label',t.name),gt.labelSet[r]=!0,a=qe(),delete gt.labelSet[r],dt.markEnd(dt.createLabeledStatement(t,a),o)):($(),dt.markEnd(dt.createExpressionStatement(t),o))}function Be(){var e=[],t,a,r,o,n,i,s,u,l;for(l=ct,V('{');st<pt&&ct.type===Ze.StringLiteral&&(a=ct,t=Xe(),e.push(t),t.expression.type===et.Literal);)r=nt.slice(a.start+1,a.end-1),'use strict'===r?(it=!0,o&&q(o,at.StrictOctalLiteral)):!o&&a.octal&&(o=a);for(n=gt.labelSet,i=gt.inIteration,s=gt.inSwitch,u=gt.inFunctionBody,gt.labelSet={},gt.inIteration=!1,gt.inSwitch=!1,gt.inFunctionBody=!0;st<pt&&!W('}')&&(t=Xe(),'undefined'!=typeof t);)e.push(t);return V('}'),gt.labelSet=n,gt.inIteration=i,gt.inSwitch=s,gt.inFunctionBody=u,dt.markEnd(dt.createBlockStatement(e),l)}function Ve(e){var t=[],a,r,o,n,i,s;if(V('('),!W(')'))for(n={};st<pt&&(r=ct,a=ve(),i='$'+r.value,it?(d(r.value)&&(o=r,s=at.StrictParamName),Object.prototype.hasOwnProperty.call(n,i)&&(o=r,s=at.StrictParamDupe)):!e&&(d(r.value)?(e=r,s=at.StrictParamName):p(r.value)?(e=r,s=at.StrictReservedWord):Object.prototype.hasOwnProperty.call(n,i)&&(e=r,s=at.StrictParamDupe)),t.push(a),n[i]=!0,!W(')'));)V(',');return V(')'),{params:t,stricted:o,firstRestricted:e,message:s}}function He(){var e=[],t,a,r,o,n,i,s,u,l;return l=ct,H('function'),r=ct,t=ve(),it?d(r.value)&&q(r,at.StrictFunctionName):d(r.value)?(i=r,s=at.StrictFunctionName):p(r.value)&&(i=r,s=at.StrictReservedWord),n=Ve(i),e=n.params,o=n.stricted,i=n.firstRestricted,n.message&&(s=n.message),u=it,a=Be(),it&&i&&U(i,s),it&&o&&q(o,s),it=u,dt.markEnd(dt.createFunctionDeclaration(t,e,[],a),l)}function We(){var e=null,t=[],a,r,o,n,i,s,u,l;return l=ct,H('function'),W('(')||(a=ct,e=ve(),it?d(a.value)&&q(a,at.StrictFunctionName):d(a.value)?(o=a,n=at.StrictFunctionName):p(a.value)&&(o=a,n=at.StrictReservedWord)),i=Ve(o),t=i.params,r=i.stricted,o=i.firstRestricted,i.message&&(n=i.message),u=it,s=Be(),it&&o&&U(o,n),it&&r&&q(r,n),it=u,dt.markEnd(dt.createFunctionExpression(e,t,[],s),l)}function Xe(){if(ct.type===Ze.Keyword)switch(ct.value){case'const':case'let':return Pe(ct.value);case'function':return He();default:return qe();}return ct.type===Ze.EOF?void 0:qe()}function Ye(){for(var e=[],t,a,r,o;st<pt&&(a=ct,a.type===Ze.StringLiteral)&&!(t=Xe(),e.push(t),t.expression.type!==et.Literal);)r=nt.slice(a.start+1,a.end-1),'use strict'===r?(it=!0,o&&q(o,at.StrictOctalLiteral)):!o&&a.octal&&(o=a);for(;st<pt&&(t=Xe(),'undefined'!=typeof t);)e.push(t);return e}function $e(){var e,t;return m(),j(),t=ct,it=!1,e=Ye(),dt.markEnd(dt.createProgram(e),t)}function Ke(){var e=[],t,a,r;for(t=0;t<ht.tokens.length;++t)a=ht.tokens[t],r={type:a.type,value:a.value},ht.range&&(r.range=a.range),ht.loc&&(r.loc=a.loc),e.push(r);ht.tokens=e}var Ze,Qe,Je,et,tt,at,rt,ot,nt,it,st,ut,lt,pt,dt,ct,gt,ht;Ze={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},Qe={},Qe[Ze.BooleanLiteral]='Boolean',Qe[Ze.EOF]='<end>',Qe[Ze.Identifier]='Identifier',Qe[Ze.Keyword]='Keyword',Qe[Ze.NullLiteral]='Null',Qe[Ze.NumericLiteral]='Numeric',Qe[Ze.Punctuator]='Punctuator',Qe[Ze.StringLiteral]='String',Qe[Ze.RegularExpression]='RegularExpression',Je=['(','{','[','in','typeof','instanceof','new','return','case','delete','throw','void','=','+=','-=','*=','/=','%=','<<=','>>=','>>>=','&=','|=','^=',',','+','-','*','/','%','++','--','<<','>>','>>>','&','|','^','!','~','&&','||','?',':','===','==','>=','<=','<','>','!=','!=='],et={AssignmentExpression:'AssignmentExpression',ArrayExpression:'ArrayExpression',BlockStatement:'BlockStatement',BinaryExpression:'BinaryExpression',BreakStatement:'BreakStatement',CallExpression:'CallExpression',CatchClause:'CatchClause',ConditionalExpression:'ConditionalExpression',ContinueStatement:'ContinueStatement',DoWhileStatement:'DoWhileStatement',DebuggerStatement:'DebuggerStatement',EmptyStatement:'EmptyStatement',ExpressionStatement:'ExpressionStatement',ForStatement:'ForStatement',ForInStatement:'ForInStatement',FunctionDeclaration:'FunctionDeclaration',FunctionExpression:'FunctionExpression',Identifier:'Identifier',IfStatement:'IfStatement',Literal:'Literal',LabeledStatement:'LabeledStatement',LogicalExpression:'LogicalExpression',MemberExpression:'MemberExpression',NewExpression:'NewExpression',ObjectExpression:'ObjectExpression',Program:'Program',Property:'Property',ReturnStatement:'ReturnStatement',SequenceExpression:'SequenceExpression',SwitchStatement:'SwitchStatement',SwitchCase:'SwitchCase',ThisExpression:'ThisExpression',ThrowStatement:'ThrowStatement',TryStatement:'TryStatement',UnaryExpression:'UnaryExpression',UpdateExpression:'UpdateExpression',VariableDeclaration:'VariableDeclaration',VariableDeclarator:'VariableDeclarator',WhileStatement:'WhileStatement',WithStatement:'WithStatement'},tt={Data:1,Get:2,Set:4},at={UnexpectedToken:'Unexpected token %0',UnexpectedNumber:'Unexpected number',UnexpectedString:'Unexpected string',UnexpectedIdentifier:'Unexpected identifier',UnexpectedReserved:'Unexpected reserved word',UnexpectedEOS:'Unexpected end of input',NewlineAfterThrow:'Illegal newline after throw',InvalidRegExp:'Invalid regular expression',UnterminatedRegExp:'Invalid regular expression: missing /',InvalidLHSInAssignment:'Invalid left-hand side in assignment',InvalidLHSInForIn:'Invalid left-hand side in for-in',MultipleDefaultsInSwitch:'More than one default clause in switch statement',NoCatchOrFinally:'Missing catch or finally after try',UnknownLabel:'Undefined label \'%0\'',Redeclaration:'%0 \'%1\' has already been declared',IllegalContinue:'Illegal continue statement',IllegalBreak:'Illegal break statement',IllegalReturn:'Illegal return statement',StrictModeWith:'Strict mode code may not include a with statement',StrictCatchVariable:'Catch variable may not be eval or arguments in strict mode',StrictVarName:'Variable name may not be eval or arguments in strict mode',StrictParamName:'Parameter name eval or arguments is not allowed in strict mode',StrictParamDupe:'Strict mode function may not have duplicate parameter names',StrictFunctionName:'Function name may not be eval or arguments in strict mode',StrictOctalLiteral:'Octal literals are not allowed in strict mode.',StrictDelete:'Delete of an unqualified identifier in strict mode.',StrictDuplicateProperty:'Duplicate data property in object literal not allowed in strict mode',AccessorDataProperty:'Object literal may not have data and accessor property with the same name',AccessorGetSet:'Object literal may not have multiple get/set accessors with the same name',StrictLHSAssignment:'Assignment to eval or arguments is not allowed in strict mode',StrictLHSPostfix:'Postfix increment/decrement may not have eval or arguments operand in strict mode',StrictLHSPrefix:'Prefix increment/decrement may not have eval or arguments operand in strict mode',StrictReservedWord:'Use of future reserved word in strict mode'},rt={NonAsciiIdentifierStart:/[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]/,NonAsciiIdentifierPart:/[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԧԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠࢢ-ࢬࣤ-ࣾऀ-ॣ०-९ॱ-ॷॹ-ॿঁ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఁ-ఃఅ-ఌఎ-ఐఒ-నప-ళవ-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಂಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲംഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤜᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶᴀ-ᷦ᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚗꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺꩻꪀ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︦︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]/},ot={name:'SyntaxTree',processComment:function(e){var t,a;if(!(e.type===et.Program&&0<e.body.length)){for(0<ht.trailingComments.length?ht.trailingComments[0].range[0]>=e.range[1]?(a=ht.trailingComments,ht.trailingComments=[]):ht.trailingComments.length=0:0<ht.bottomRightStack.length&&ht.bottomRightStack[ht.bottomRightStack.length-1].trailingComments&&ht.bottomRightStack[ht.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(a=ht.bottomRightStack[ht.bottomRightStack.length-1].trailingComments,delete ht.bottomRightStack[ht.bottomRightStack.length-1].trailingComments);0<ht.bottomRightStack.length&&ht.bottomRightStack[ht.bottomRightStack.length-1].range[0]>=e.range[0];)t=ht.bottomRightStack.pop();t?t.leadingComments&&t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=t.leadingComments,delete t.leadingComments):0<ht.leadingComments.length&&ht.leadingComments[ht.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=ht.leadingComments,ht.leadingComments=[]),a&&(e.trailingComments=a),ht.bottomRightStack.push(e)}},markEnd:function(e,t){return ht.range&&(e.range=[t.start,st]),ht.loc&&(e.loc=new G(void 0===t.startLineNumber?t.lineNumber:t.startLineNumber,t.start-(void 0===t.startLineStart?t.lineStart:t.startLineStart),ut,st-lt),this.postProcess(e)),ht.attachComment&&this.processComment(e),e},postProcess:function(e){return ht.source&&(e.loc.source=ht.source),e},createArrayExpression:function(e){return{type:et.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,a){return{type:et.AssignmentExpression,operator:e,left:t,right:a}},createBinaryExpression:function(e,t,a){var r='||'===e||'&&'===e?et.LogicalExpression:et.BinaryExpression;return{type:r,operator:e,left:t,right:a}},createBlockStatement:function(e){return{type:et.BlockStatement,body:e}},createBreakStatement:function(e){return{type:et.BreakStatement,label:e}},createCallExpression:function(e,t){return{type:et.CallExpression,callee:e,arguments:t}},createCatchClause:function(e,t){return{type:et.CatchClause,param:e,body:t}},createConditionalExpression:function(e,t,a){return{type:et.ConditionalExpression,test:e,consequent:t,alternate:a}},createContinueStatement:function(e){return{type:et.ContinueStatement,label:e}},createDebuggerStatement:function(){return{type:et.DebuggerStatement}},createDoWhileStatement:function(e,t){return{type:et.DoWhileStatement,body:e,test:t}},createEmptyStatement:function(){return{type:et.EmptyStatement}},createExpressionStatement:function(e){return{type:et.ExpressionStatement,expression:e}},createForStatement:function(e,t,a,r){return{type:et.ForStatement,init:e,test:t,update:a,body:r}},createForInStatement:function(e,t,a){return{type:et.ForInStatement,left:e,right:t,body:a,each:!1}},createFunctionDeclaration:function(e,t,a,r){return{type:et.FunctionDeclaration,id:e,params:t,defaults:a,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(e,t,a,r){return{type:et.FunctionExpression,id:e,params:t,defaults:a,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:et.Identifier,name:e}},createIfStatement:function(e,t,a){return{type:et.IfStatement,test:e,consequent:t,alternate:a}},createLabeledStatement:function(e,t){return{type:et.LabeledStatement,label:e,body:t}},createLiteral:function(e){return{type:et.Literal,value:e.value,raw:nt.slice(e.start,e.end)}},createMemberExpression:function(e,t,a){return{type:et.MemberExpression,computed:'['===e,object:t,property:a}},createNewExpression:function(e,t){return{type:et.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:et.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:et.UpdateExpression,operator:e,argument:t,prefix:!1}},createProgram:function(e){return{type:et.Program,body:e}},createProperty:function(e,t,a){return{type:et.Property,key:t,value:a,kind:e}},createReturnStatement:function(e){return{type:et.ReturnStatement,argument:e}},createSequenceExpression:function(e){return{type:et.SequenceExpression,expressions:e}},createSwitchCase:function(e,t){return{type:et.SwitchCase,test:e,consequent:t}},createSwitchStatement:function(e,t){return{type:et.SwitchStatement,discriminant:e,cases:t}},createThisExpression:function(){return{type:et.ThisExpression}},createThrowStatement:function(e){return{type:et.ThrowStatement,argument:e}},createTryStatement:function(e,t,a,r){return{type:et.TryStatement,block:e,guardedHandlers:t,handlers:a,finalizer:r}},createUnaryExpression:function(e,t){return'++'===e||'--'===e?{type:et.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:et.UnaryExpression,operator:e,argument:t,prefix:!0}},createVariableDeclaration:function(e,t){return{type:et.VariableDeclaration,declarations:e,kind:t}},createVariableDeclarator:function(e,t){return{type:et.VariableDeclarator,id:e,init:t}},createWhileStatement:function(e,t){return{type:et.WhileStatement,test:e,body:t}},createWithStatement:function(e,t){return{type:et.WithStatement,object:e,body:t}}},e.version='1.2.5',e.tokenize=function(e,t){var a,r,o;a=String,'string'==typeof e||e instanceof String||(e=a(e)),dt=ot,nt=e,st=0,ut=0<nt.length?1:0,lt=0,pt=nt.length,ct=null,gt={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},ht={},t=t||{},t.tokens=!0,ht.tokens=[],ht.tokenize=!0,ht.openParenToken=-1,ht.openCurlyToken=-1,ht.range='boolean'==typeof t.range&&t.range,ht.loc='boolean'==typeof t.loc&&t.loc,'boolean'==typeof t.comment&&t.comment&&(ht.comments=[]),'boolean'==typeof t.tolerant&&t.tolerant&&(ht.errors=[]);try{if(j(),ct.type===Ze.EOF)return ht.tokens;for(r=O();ct.type!==Ze.EOF;)try{r=O()}catch(e){if(r=ct,ht.errors){ht.errors.push(e);break}else throw e}Ke(),o=ht.tokens,'undefined'!=typeof ht.comments&&(o.comments=ht.comments),'undefined'!=typeof ht.errors&&(o.errors=ht.errors)}catch(t){throw t}finally{ht={}}return o},e.parse=function(e,t){var a,r;r=String,'string'==typeof e||e instanceof String||(e=r(e)),dt=ot,nt=e,st=0,ut=0<nt.length?1:0,lt=0,pt=nt.length,ct=null,gt={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},ht={},'undefined'!=typeof t&&(ht.range='boolean'==typeof t.range&&t.range,ht.loc='boolean'==typeof t.loc&&t.loc,ht.attachComment='boolean'==typeof t.attachComment&&t.attachComment,ht.loc&&null!==t.source&&t.source!==void 0&&(ht.source=r(t.source)),'boolean'==typeof t.tokens&&t.tokens&&(ht.tokens=[]),'boolean'==typeof t.comment&&t.comment&&(ht.comments=[]),'boolean'==typeof t.tolerant&&t.tolerant&&(ht.errors=[]),ht.attachComment&&(ht.range=!0,ht.comments=[],ht.bottomRightStack=[],ht.trailingComments=[],ht.leadingComments=[]));try{a=$e(),'undefined'!=typeof ht.comments&&(a.comments=ht.comments),'undefined'!=typeof ht.tokens&&(Ke(),a.tokens=ht.tokens),'undefined'!=typeof ht.errors&&(a.errors=ht.errors)}catch(t){throw t}finally{ht={}}return a},e.Syntax=function(){var e={},t;for(t in'function'==typeof Object.create&&(e=Object.create(null)),et)et.hasOwnProperty(t)&&(e[t]=et[t]);return'function'==typeof Object.freeze&&Object.freeze(e),e}()})}),OS=0,jS=Er,zS=['args','body'],GS=['pre','post','printCode','funcName','blockSize'],NS=Mr,US=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t={}){const{alpha:a=1}=t;r(e.tensor,a)};var a=function(e){return e&&e.__esModule?e:{default:e}}(NS);const r=(0,a.default)({args:['array','scalar'],body:function(e,t){e=bn(e,0)+t*(cn(vn(e,0))-1)}})});se(US);var qS=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(NS);const r=(0,a.default)({args:['array','scalar'],body:function(e){e=1.0507009873554805*(bn(e,0)+1.6732632423543772*(cn(vn(e,0))-1))}})});se(qS);var BS=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(NS);const r=(0,a.default)({args:['array'],body:function(e){e=fn(cn(e)+1)}})});se(BS);var VS=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(NS);const r=(0,a.default)({args:['array'],body:function(e){e/=1+Sn(e)}})});se(VS);var HS=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t={}){const{alpha:a=0,maxValue:n=null}=t;let i;0!==a&&(i=new o.default([],e.tensor.shape),r.default.mins(i.tensor,e.tensor,0),r.default.mulseq(i.tensor,a)),r.default.maxseq(e.tensor,0),n&&r.default.minseq(e.tensor,n),i&&r.default.addeq(e.tensor,i.tensor)};var r=a(ES),o=a(IS)});se(HS);var WS=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(NS);const r=(0,a.default)({args:['array'],body:function(e){e=Math.tanh(e)}})});se(WS);var XS=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(NS);const r=(0,a.default)({args:['array'],body:function(e){e=1/(1+cn(-e))}})});se(XS);var YS=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){r(e.tensor)};var a=function(e){return e&&e.__esModule?e:{default:e}}(NS);const r=(0,a.default)({args:['array'],body:function(e){e=0.2*e+0.5,0>=e?e=0:1<=e&&(e=1)}})});se(YS);var $S=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e){return e}});se($S);var KS=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'softmax',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'elu',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'selu',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'softplus',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'softsign',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'relu',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'tanh',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'sigmoid',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'hard_sigmoid',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'linear',{enumerable:!0,get:function(){return c.default}});var r=a(RS),o=a(US),n=a(qS),i=a(BS),s=a(VS),u=a(HS),l=a(WS),p=a(XS),d=a(YS),c=a($S)});se(KS);var ZS=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS);class n extends r.default{constructor(e={}){super(e),this.layerClass='LeakyReLU';const{alpha:t=0.3}=e;this.description=`alpha: ${t}`,this.alpha=t,this.gpu&&(this.program=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform float alpha;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + alpha * min(v, 0.0);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=e,(0,KS.relu)(this.output,{alpha:this.alpha})}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),gS.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.alpha,type:'float',name:'alpha'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=n});se(ZS);var QS=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(NS);class i extends r.default{constructor(e={}){super(e),Object.defineProperty(this,'_compute',{configurable:!0,enumerable:!0,writable:!0,value:(0,n.default)({args:['array','array'],body:function(e,t){e=bn(e,0)+t*vn(e,0)}})}),this.layerClass='PReLU',this.params=['alpha'],this.gpu&&(this.program=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D alpha;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  vec4 a = texture(alpha, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + a * min(v, 0.0);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=e,this._compute(this.output.tensor,this.weights.alpha.tensor)}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),gS.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'},{input:this.weights.alpha,name:'alpha'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=i});se(QS);var JS=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(NS);class i extends r.default{constructor(e={}){super(e),s.call(this),this.layerClass='ELU';const{alpha:t=1}=e;this.description=`alpha: ${t}`,this.alpha=t,this.gpu&&(this.program=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform float alpha;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + alpha * (exp(min(v, 0.0)) - 1.0);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=e,this._compute(this.output.tensor,this.alpha)}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),gS.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.alpha,type:'float',name:'alpha'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=i;var s=function(){Object.defineProperty(this,'_compute',{configurable:!0,enumerable:!0,writable:!0,value:(0,n.default)({args:['array','scalar'],body:function(e,t){e=bn(e,0)+t*(cn(vn(e,0))-1)}})})}});se(JS);var eT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(NS);class i extends r.default{constructor(e={}){super(e),s.call(this),this.layerClass='ThresholdedReLU';const{theta:t=1}=e;this.description=`theta: ${t}`,this.theta=t,this.gpu&&(this.program=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform float theta;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = v * float(greaterThan(v, vec4(theta)));\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=e,this._compute(this.output.tensor,this.theta)}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),gS.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.theta,type:'float',name:'theta'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=i;var s=function(){Object.defineProperty(this,'_compute',{configurable:!0,enumerable:!0,writable:!0,value:(0,n.default)({args:['array','scalar'],body:function(e,t){e*=+(e>t)}})})}});se(eT);var tT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'LeakyReLU',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'PReLU',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'ELU',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'ThresholdedReLU',{enumerable:!0,get:function(){return i.default}});var r=a(ZS),o=a(QS),n=a(JS),i=a(eT)});se(tT);var aT=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const r=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);
  
  outColor = vec4(${(0,a.default)(e).map((e)=>`texelFetch(inputs[${e}], ivec2(out_x, out_y), 0).r`).join(' + ')});
}
`;return r};var a=function(e){return e&&e.__esModule?e:{default:e}}(vS)});se(aT);var rT=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const r=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);
  
  outColor = vec4((${(0,a.default)(e).map((e)=>`texelFetch(inputs[${e}], ivec2(out_x, out_y), 0).r`).join(' + ')}) / float(${e}));
}
`;return r};var a=function(e){return e&&e.__esModule?e:{default:e}}(vS)});se(rT);var oT=Dr,nT=Ir,iT=Ar,sT=Rr,uT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a,s){const u=t.map((e)=>e[s]),l=(0,n.default)(e+1).map((e)=>(0,o.default)((0,r.default)(u,e))),p=0===s?'out_y':'out_x';let i=`
  int n = 0;
  int offset = 0;
  if (${p} >= ${l[1]} && ${p} < ${l[2]}) {
    n = 1;
    offset = ${l[1]};
  }`;2<e&&(i+=`${(0,n.default)(2,e).map((e)=>` else if (${p} >= ${l[e]} && ${p} < ${l[e+1]}) {
    n = ${e};
    offset = ${l[e]};
  }`).join('')}
`);let d='outColor = vec4(0.0);';if(0===s||1===s){const t=(e)=>`out_x${1===s?` - ${l[e]}`:''}`,a=(e)=>`out_y${0===s?` - ${l[e]}`:''}`;d=`
  if (n == 0) {
    outColor = vec4(texelFetch(inputs[0], ivec2(out_x, out_y), 0).r);
  }${(0,n.default)(1,e).map((e)=>` else if (n == ${e}) {
    outColor = vec4(texelFetch(inputs[${e}], ivec2(${t(e)}, ${a(e)}), 0).r);
  }`).join('')}
`}const c=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${a[0]}) * outTex.y);
  int out_x = int(float(${a[1]}) * outTex.x);
${i}
${d}
}
`;return c};var r=a(nT),o=a(sT),n=a(vS)});se(uT);var lT=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const a=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);

  float val = texelFetch(inputs[0], ivec2(out_x, out_y), 0).r;
  for (int i = 1; i < ${e}; i++) {
    val = max(val, texelFetch(inputs[i], ivec2(out_x, out_y), 0).r);
  }

  outColor = vec4(val);
}
`;return a}});se(lT);var pT=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const a=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);

  float val = texelFetch(inputs[0], ivec2(out_x, out_y), 0).r;
  for (int i = 1; i < ${e}; i++) {
    val = min(val, texelFetch(inputs[i], ivec2(out_x, out_y), 0).r);
  }

  outColor = vec4(val);
}
`;return a}});se(pT);var dT=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const r=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[${e}];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);

  outColor = vec4(${(0,a.default)(e).map((e)=>`texelFetch(inputs[${e}], ivec2(out_x, out_y), 0).r`).join(' * ')});
}
`;return r};var a=function(e){return e&&e.__esModule?e:{default:e}}(vS)});se(dT);var cT=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t){const a=`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D inputs[2];
out vec4 outColor;

void main() {
  int out_y = int(float(${t[0]}) * outTex.y);
  int out_x = int(float(${t[1]}) * outTex.x);
  
  outColor = vec4(texelFetch(inputs[0], ivec2(out_x, out_y), 0).r - texelFetch(inputs[1], ivec2(out_x, out_y), 0).r);
}
`;return a}});se(cT);var gT=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a,r,o){const n=r?`sum += texelFetch(bias, ivec2(out_x, 0), 0).r;`:'',i=o?`int fragmentIndex = int(floor(float(rowIndex) / float(${t[0]})));
      rowIndex = int(mod(float(rowIndex), float(${t[0]})));
      colIndex += fragmentIndex * ${t[1]};`:'',s=`#version 300 es
precision highp float;
precision highp isampler2D;

in vec2 outTex;
uniform sampler2D x;
uniform isampler2D indexMap;
uniform sampler2D kernel;
uniform sampler2D bias;
out vec4 outColor;

void main() {
  int out_y = int(float(${e[0]}) * outTex.y);
  int out_x = int(float(${e[1]}) * outTex.x);

  float sum = 0.;
  for (int i = 0; i < ${a[1]}; ++i) {
    int index = texelFetch(indexMap, ivec2(i, out_y), 0).r;    
    if (index != -1) {
      int rowIndex = int(floor(float(index) / float(${t[1]})));
      int colIndex = int(mod(float(index), float(${t[1]})));
      ${i}
      sum += texelFetch(x, ivec2(colIndex, rowIndex), 0).r * texelFetch(kernel, ivec2(out_x, i), 0).r;
    }
  }

  ${n}
  outColor = vec4(sum);
}   
`;return s}});se(gT);var hT=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a,r,o){const n=r?`sum += texelFetch(bias, ivec2(out_x, 0), 0).r;`:'',i=o?`int fragmentIndex = int(floor(float(rowIndex) / float(${t[0]})));
      rowIndex = int(mod(float(rowIndex), float(${t[0]})));
      colIndex += fragmentIndex * ${t[1]};`:'',s=`#version 300 es
precision highp float;
precision highp isampler2D;

in vec2 outTex;
uniform sampler2D matMulResult;
uniform isampler2D indexMap;
uniform sampler2D bias;
out vec4 outColor;

void main() {
  int out_y = int(float(${e[0]}) * outTex.y);
  int out_x = int(float(${e[1]}) * outTex.x);

  float sum = 0.;
  for (int n = 0; n < ${a[1]}; ++n) {
    int index = texelFetch(indexMap, ivec2(n, out_y), 0).r;
    if (index != -1) {
      int rowIndex = int(floor(float(index) / float(${t[1]})));
      int colIndex = int(mod(float(index), float(${t[1]})));
      ${i}
      sum += texelFetch(matMulResult, ivec2(colIndex + out_x, rowIndex), 0).r;
    }
  }

  ${n}
  outColor = vec4(sum);
}  
`;return s}});se(hT);var fT=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,t,a){let r;return r=a?`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D featureMaps;
uniform sampler2D weights;
out vec4 outColor;

void main() {
  int out_y = int(float(${e[0]}) * outTex.y);
  int out_x = int(float(${e[1]}) * outTex.x);

  int featureMapsRow = out_x + ${e[0]} * out_y;

  float sum = 0.;
  for (int k = 0; k < ${t}; ++k) {
    float f = texelFetch(featureMaps, ivec2(k, featureMapsRow), 0).r;
    float w = texelFetch(weights, ivec2(k, 0), 0).r;
    sum += f * w;
  }

  outColor = vec4(max(sum, 0.0));
}  
`:`#version 300 es
precision highp float;

in vec2 outTex;
uniform sampler2D featureMaps;
uniform sampler2D weights;
out vec4 outColor;

void main() {
  int out_y = int(float(${e[0]}) * outTex.y);
  int out_x = int(float(${e[1]}) * outTex.x);

  float sum = 0.;
  for (int k = 0; k < ${t}; ++k) {
    float f = texelFetch(featureMaps, ivec2(k, out_y), 0).r;
    float w = texelFetch(weights, ivec2(out_x, k), 0).r;
    sum += f * w;
  }

  outColor = vec4(max(sum, 0.0));
}  
`,r}});se(fT);var mT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=function(e,...t){switch(e){case'add':return(0,r.default)(...t);case'average':return(0,o.default)(...t);case'concatenate':return(0,n.default)(...t);case'maximum':return(0,i.default)(...t);case'minimum':return(0,s.default)(...t);case'multiply':return(0,u.default)(...t);case'subtract':return(0,l.default)(...t);case'conv2d':return(0,p.default)(...t);case'conv2dTranspose':return(0,d.default)(...t);case'cam':return(0,c.default)(...t);default:throw new Error('GLSL program not found');}};var r=a(aT),o=a(rT),n=a(uT),i=a(lT),s=a(pT),u=a(dT),l=a(cT),p=a(gT),d=a(hT),c=a(fT)});se(mT);var _T=Br,yT=32,xT=Xr,vT={},bT=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.linear=t.hard_sigmoid=t.sigmoid=t.tanh=t.relu=t.softsign=t.softplus=t.selu=t.elu=t.softmax=void 0;t.softmax='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float maxval = 0.0;\n  for (int i = 0; i < int(size[0]); ++i) {\n    float val = texelFetch(x, ivec2(i, out_y), 0).r;\n    if (i == 0 || val > maxval) {\n      maxval = val;\n    }\n  }\n\n  float sum = 0.0;\n  for (int i = 0; i < int(size[0]); ++i) {\n    float val = texelFetch(x, ivec2(i, out_y), 0).r;\n    sum += exp(val - maxval);\n  }\n\n  outColor = exp(texture(x, vec2(outTex.x, outTex.y)) - maxval) / sum;\n}\n';t.elu='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  float alpha = 1.0;\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0) + alpha * (exp(min(v, 0.0)) - 1.0);\n}\n';t.selu='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  float alpha = 1.6732632423543772848170429916717;\n  float scale = 1.0507009873554804934193349852946;\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = scale * (max(v, 0.0) + alpha * (exp(min(v, 0.0)) - 1.0));\n}\n';t.softplus='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = log(1.0 + exp(texture(x, vec2(outTex.x, outTex.y))));\n}\n';t.softsign='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  v /= 1.0 + abs(v);\n  outColor = v;\n}\n';t.relu='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = max(v, 0.0);\n}\n';t.tanh='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  outColor = tanh(v);\n}\n';t.sigmoid='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = 1.0 / (1.0 + exp(-1.0 * texture(x, vec2(outTex.x, outTex.y))));\n}\n';t.hard_sigmoid='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  vec4 v = texture(x, vec2(outTex.x, outTex.y));\n  v = v * 0.2 + 0.5;\n  v = max(v, 0.0);\n  v = min(v, 1.0);\n  outColor = v;\n}\n';t.linear='#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(x, vec2(outTex.x, outTex.y));\n}\n'});se(bT);var ST=ue(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hS),n=r(IS),i=a(KS),s=r(mT),u=a(MS),l=r(ES),p=r(xT),d=a(bT);class c extends o.default{constructor(e={}){super(e),this.layerClass='Conv2D';const{filters:t=1,kernel_size:a=[3,3],strides:r=[1,1],padding:o='valid',data_format:n='channels_last',dilation_rate:s=[1,1],activation:u='linear',use_bias:l=!0}=e;this.kernelShape=Array.isArray(a)?[t,...a]:[t,a,a],this.strides=Array.isArray(r)?r:[r,r],'valid'===o||'same'===o?this.padding=o:this.throwError('Invalid padding.'),'channels_last'===n||'channels_first'===n?this.dataFormat=n:this.throwError('Only channels_last and channels_first data formats are allowed.'),this.dilationRate=Array.isArray(s)?s:[s,s],(1!==this.dilationRate[0]||1!==this.dilationRate[1])&&(1!==this.strides[0]||1!==this.strides[1])&&this.throwError(`Incompatible combination of dilation_rate with strides.`),this.activation=u,this.activationFunc=i[u],this.useBias=l,this.params=this.useBias?['kernel','bias']:['kernel'],this.description=`${this.kernelShape[0]} ${this.kernelShape.slice(1).join('x')} filters`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.description+=this.dilationRate.some((e)=>1<e)?`, ${this.dilationRate.join('x')} dilation`:'',this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),this.mapInputFragmentsProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(indexMap, 0);\n  int out_x = int(float(outputSize[0]) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    int fragmentIndex = int(floor(float(rowIndex) / float(inputSize[1])));\n    rowIndex = int(mod(float(rowIndex), float(inputSize[1])));\n    colIndex = fragmentIndex * inputCols + colIndex;\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),this.matMulProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=gS.webgl2.compileProgram(d[this.activation]))}setWeights(e){'channels_first'===this.dataFormat&&(e[0].tensor=e[0].tensor.transpose(2,3,1,0)),super.setWeights(e,!1),this._w2row(),this.gpu&&(this.weights.kernel=this.wRowsMat,this.weights.kernel.createGLTexture({type:'2d',format:'float'}),this.useBias&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_calcOutputShape(e){if(!(this.outputShape&&this.inputPadding)){const t=e[0],a=e[1],[r,o,n]=this.kernelShape,i=o+(o-1)*(this.dilationRate[0]-1),s=n+(n-1)*(this.dilationRate[1]-1),u='same'===this.padding?_n((t+this.strides[0]-1)/this.strides[0]):_n((t-i+this.strides[0])/this.strides[0]),l='same'===this.padding?_n((a+this.strides[1]-1)/this.strides[1]):_n((a-s+this.strides[1])/this.strides[1]),p='same'===this.padding?bn(0,_n((u-1)*this.strides[0]+i-t)):0,d='same'===this.padding?bn(0,_n((l-1)*this.strides[1]+s-a)):0,c=_n(p/2),g=_n(d/2);this.outputShape=[u,l,r],this.inputPadding=[c,p-c,g,d-g]}}_padInput(e,t=0){if('same'===this.padding){const[a,r,o]=e.tensor.shape,[i,s,u,p]=this.inputPadding,d=new n.default([],[a+i+s,r+u+p,o]);return 0!==t&&l.default.assigns(d.tensor,t),l.default.assign(d.tensor.hi(a+i,r+u,o).lo(i,u,0),e.tensor),d}return e}_im2col(e){const[t,a,r]=e.tensor.shape,o=this.kernelShape[1],i=this.kernelShape[2],s=this.outputShape[0],u=this.outputShape[1],p=o*i*r,d=o+(o-1)*(this.dilationRate[0]-1),c=i+(i-1)*(this.dilationRate[1]-1);if(this.imColsMat||(this.imColsMat=new n.default([],[s*u,p])),1===d&&1===c&&1===this.strides[0]&&1===this.strides[1])return this.imColsMat.replaceTensorData(e.tensor.data),this.imColsMat;const g=new n.default([],[o,i,r]);let h=0;for(let o=0;o<=t-d;o+=this.strides[0])for(let t=0;t<=a-c;t+=this.strides[1])l.default.assign(g.tensor,e.tensor.hi(o+d,t+c,r).lo(o,t,0).step(this.dilationRate[0],this.dilationRate[1],1)),this.imColsMat.tensor.data.set(g.tensor.data,h),h+=p;return this.imColsMat}_w2row(){const e=this.weights.kernel.tensor.shape[2],[t,a,r]=this.kernelShape,o=a*r*e;this.wRowsMat=new n.default([],[o,t]);const i=new n.default([],[a,r,e]),s=new n.default([],[o]);for(let e=0;e<t;e++)l.default.assign(i.tensor,this.weights.kernel.tensor.pick(null,null,null,e)),s.replaceTensorData(i.tensor.data),l.default.assign(this.wRowsMat.tensor.pick(null,e),s.tensor);return this.wRowsMat}_callCPU(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._im2col(e);const t=this.kernelShape[0],a=this.outputShape[0],r=this.outputShape[1],o=new n.default([],[a*r,t]);if(this.useBias)for(let e=0;e<t;e++)l.default.assigns(o.tensor.pick(null,e),this.weights.bias.tensor.get(e));(0,p.default)(o.tensor,this.imColsMat.tensor,this.wRowsMat.tensor,1,1),this.output=new n.default([],this.outputShape);let i=new n.default([],[a*r]),s=new n.default([],[a,r]);for(let a=0;a<t;a++)l.default.assign(i.tensor,o.tensor.pick(null,a)),s.replaceTensorData(i.tensor.data),l.default.assign(this.output.tensor.pick(null,null,a),s.tensor);this.activationFunc(this.output),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1))}_createIndexMap(e){if(this.indexMap)return;let[t,a,r]=this.inputShape,o=new n.default(e.data,e.shape,{type:Int32Array});if('same'===this.padding){const[e,r,n,i]=this.inputPadding;t=t+e+r,a=a+n+i;o=this._padInput(o,-1)}const i=this.kernelShape[1],s=this.kernelShape[2],u=this.outputShape[0],p=this.outputShape[1],d=i*s*r,c=i+(i-1)*(this.dilationRate[0]-1),g=s+(s-1)*(this.dilationRate[1]-1);this.indexMap=new n.default([],[u*p,d],{type:Int32Array});const h=new n.default([],[i,s,r]);let f=0;for(let n=0,i=t-c;n<=i;n+=this.strides[0])for(let e=0,t=a-g;e<=t;e+=this.strides[1])l.default.assign(h.tensor,o.tensor.hi(n+c,e+g,r).lo(n,e,0).step(this.dilationRate[0],this.dilationRate[1],1)),this.indexMap.tensor.data.set(h.tensor.data,f),f+=d;this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_callGPU(e){let t;if(e.is2DReshaped||e.is2DSquareReshaped?(this.inputShape=e.originalShape,this._calcOutputShape(this.inputShape),this._createIndexMap(e.indicesForReshaped),t=[this.indexMap.glTextureShape[0],this.weights.kernel.glTextureShape[1]]):(this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._im2col(e),this.imColsMat.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),t=[this.imColsMat.glTextureShape[0],this.weights.kernel.glTextureShape[1]]),'linear'===this.activation||this.outputPreactiv||(this.outputPreactiv=new n.default([],t),this.outputPreactiv.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputPreactiv.is2DReshaped=!0,this.outputPreactiv.originalShape=this.outputShape,this.outputPreactiv.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)),this.output||(this.output=new n.default([],t),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)),e.is2DReshaped||e.is2DSquareReshaped){const t=!!e.glTextureFragments;if(t&&e.convert2DRowFragmentedGLTextureToColStack(),!this.convProgram){const a=(0,s.default)('conv2d',this.output.glTextureFragmentShape?this.output.glTextureFragmentShape:this.output.glTextureShape,e.glTextureFragmentShape?e.glTextureFragmentShape:e.glTextureShape,this.indexMap.glTextureFragmentShape?this.indexMap.glTextureFragmentShape:this.indexMap.glTextureShape,this.useBias,t);this.convProgram=gS.webgl2.compileProgram(a)}gS.webgl2.runProgram({program:this.convProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'},{input:this.weights.kernel,name:'kernel'},...(this.useBias?[{input:this.weights.bias,name:'bias'}]:[])],supportsTextureFragments:!0}),t&&e.removeGLTextureFragmentsAsColStack()}else{const e=[{input:this.imColsMat,name:'A'},{input:this.weights.kernel,name:'B'}];this.useBias&&e.push({input:this.weights.bias,name:'C'}),gS.webgl2.runProgram({program:this.matMulProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:e,uniforms:[{value:this.useBias?1:0,type:'bool',name:'addC'}],supportsTextureFragments:!0})}'linear'!==this.activation&&gS.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}t.default=c});se(ST);var TT=Yr,PT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ST),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(MS),s=a(ES),u=a(DS),l=a(TT);class p extends r.default{constructor(e={}){super(e),this.layerClass='Conv1D';const{filters:t=1,kernel_size:a=1,strides:r=1,padding:o='valid',dilation_rate:i=1,activation:s='linear',use_bias:u=!0}=e;this.description=`${t} filters of size ${a}, striding ${r}`,this.description+='valid'===o?`, no border padding`:', pad to same borders',this.description+=1<i?`, dilation rate ${i}`:'',this.description+='linear'===s?'':`, ${s} activation`,'valid'!==o&&'same'!==o&&this.throwError('Invalid padding.'),1!==i&&1!==r&&this.throwError('Incompatible combination of dilation_rate with strides.'),this.use_bias=u,this.params=this.use_bias?['kernel','bias']:['kernel'];const l={filters:t,kernel_size:[a,1],strides:[r,1],padding:o,data_format:'channels_first',dilation_rate:i,activation:s,use_bias:u};this._conv2dAttrs=l,this._conv2d=new n.default(Object.assign(l,{gpu:e.gpu}))}setWeights(e){e[0].tensor=(0,l.default)(e[0].tensor).transpose(2,1,0,3),this._conv2d.setWeights(e)}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t=new o.default(e.tensor.data,e.tensor.shape);t.tensor=(0,l.default)(t.tensor).transpose(0,2,1);const a=this._conv2d.call(t);this.outputShape=[0,2].map((e)=>this._conv2d.outputShape[e]),this.output=new o.default([],this.outputShape),s.default.assign(this.output.tensor,(0,u.default)(a.tensor).transpose(1,0,2))}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});const t=e.tensor.shape,a=new o.default([],t);Object.assign(a,e),a.glTextureShape=t,a.is2DReshaped=!0,a.originalShape=[t[0],1,t[1]],a.indicesForReshaped=i.createIndicesFor2DReshaped(a.originalShape,!1,-1),this.output=this._conv2d.call(a),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=p});se(PT);var wT=ue(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hS),n=r(IS),i=a(KS),s=a(MS),u=r(ES),l=r(xT),p=r(ST),d=a(bT);class c extends p.default{constructor(e={}){super(e)}_calcOutputShape(e){super._calcOutputShape(e);const t=this.kernelShape[0],a=e[2];this.outputShape[2]=t*a}_im2col(e){const[t,a,r]=e.tensor.shape,o=this.kernelShape[1],s=this.kernelShape[2],i=this.outputShape[0],l=this.outputShape[1],p=o*s;this.imColsMat||(this.imColsMat=new n.default([],[i*l*r,p]));let d=new n.default([],[o,s,1]),g=0;for(let n=0;n<r;n++)for(let r=0;r<=t-o;r+=this.strides[0])for(let t=0;t<=a-s;t+=this.strides[1])u.default.assign(d.tensor,e.tensor.hi(r+o,t+s,n+1).lo(r,t,n)),this.imColsMat.tensor.data.set(d.tensor.data,g),g+=p;return this.imColsMat}_w2row(){const e=this.weights.kernel.tensor.shape[2],[t,a,r]=this.kernelShape,o=a*r;this.wRowsMat=new n.default([],[o,t*e]);let i=new n.default([],[a,r]),s=new n.default([],[o]),l=0;for(let a=0;a<e;a++)for(let e=0;e<t;e++)u.default.assign(i.tensor,this.weights.kernel.tensor.pick(null,null,a,e)),s.replaceTensorData(i.tensor.data),u.default.assign(this.wRowsMat.tensor.pick(null,l),s.tensor),l+=1;return this.wRowsMat}_callCPU(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._im2col(e);const t=this.kernelShape[0],a=this.outputShape[0],r=this.outputShape[1],o=this.inputShape[2],i=new n.default([],[a*r*o,t*o]);(0,l.default)(i.tensor,this.imColsMat.tensor,this.wRowsMat.tensor,1,1),this.output=new n.default([],this.outputShape);const s=a*r*t*o;let u=new Float32Array(s);for(let a=0;a<o;a++)for(let e=a*s+a*t;e<(a+1)*s;e+=t*o)for(let r=0;r<t;r++)u[e+r-a*s]=i.tensor.data[e+r];this.output.replaceTensorData(u)}_createIndexMap(e){if(this.indexMap)return;let[t,a,r]=this.inputShape,o=new n.default(e.data,e.shape,{type:Int32Array});if('same'===this.padding){const[e,r,n,i]=this.inputPadding;t=t+e+r,a=a+n+i;o=this._padInput(o,-1)}const s=this.kernelShape[1],l=this.kernelShape[2],i=this.outputShape[0],p=this.outputShape[1],d=s*l;this.indexMap=new n.default([],[i*p*r,d],{type:Int32Array});const g=new n.default([],[s,l,1]);let h=0;for(let n=0;n<r;n++)for(let e=0,r=t-s;e<=r;e+=this.strides[0])for(let t=0,r=a-l;t<=r;t+=this.strides[1])u.default.assign(g.tensor,o.tensor.hi(e+s,t+l,n+1).lo(e,t,n)),this.indexMap.tensor.data.set(g.tensor.data,h),h+=d;this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_createOutputReshapeIndexMap(){if(!this.reshapeIndexMap){const e=this.kernelShape[0],t=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]],a=new n.default([],t,{type:Int32Array}),r=new n.default([],t,{type:Int32Array});this.reshapeIndexMap=new n.default([],t,{type:Int32Array});for(let r=0;r<t[1];r++)for(let o=0;o<t[0];o++)u.default.assigns(a.tensor.pick(o,r),o+_n(r/e)*t[0]);for(let e=0;e<t[1];e++)u.default.assigns(r.tensor.pick(null,e),e);u.default.muls(this.reshapeIndexMap.tensor,a.tensor,t[1]),u.default.addeq(this.reshapeIndexMap.tensor,r.tensor),this.reshapeIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}_callGPU(e){if(super._callGPU(e),this._createOutputReshapeIndexMap(),!this.outputReshaped){const e=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]];this.outputReshaped=new n.default([],e),this.outputReshaped.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputReshaped.is2DReshaped=!0,this.outputReshaped.originalShape=this.outputShape,this.outputReshaped.indicesForReshaped=s.createIndicesFor2DReshaped(this.outputShape,!1,-1)}this.output.glTextureFragments&&this.output.convert2DRowFragmentedGLTextureToColStack(),gS.webgl2.runProgram({program:this.output.glTextureFragments?this.mapInputFragmentsProgram:this.mapInputProgram,output:this.outputReshaped,inputs:[{input:this.output,name:'x'},{input:this.reshapeIndexMap,name:'indexMap'}],uniforms:[{value:this.output.glTextureShape[1],type:'int',name:'inputCols'}],supportsTextureFragments:!0}),this.output.glTextureFragments&&this.output.removeGLTextureFragmentsAsColStack()}}class g extends o.default{constructor(e={}){super(e),this.layerClass='SeparableConv2D';const{filters:t=1,kernel_size:a=[1,1],strides:r=[1,1],padding:o='valid',data_format:n='channels_last',depth_multiplier:s=1,activation:u='linear',use_bias:l=!0}=e;this.kernelShape=Array.isArray(a)?[t,...a]:[t,a,a],this.strides=Array.isArray(r)?r:[r,r],'valid'===o||'same'===o?this.padding=o:this.throwError('Invalid padding.'),'channels_last'===n||'channels_first'===n?this.dataFormat=n:this.throwError('Only channels_last and channels_first data formats are allowed.'),this.activation=u,this.activationFunc=i[u],'valid'===o||'same'===o?this.padding=o:this.throwError('Invalid padding.'),this.useBias=l,this.params=this.useBias?['depthwise_kernel','pointwise_kernel','bias']:['depthwise_kernel','pointwise_kernel'],this.depthwiseConvAttrs={filters:s,kernel_size:[this.kernelShape[1],this.kernelShape[2]],strides:this.strides,padding:o,data_format:n,activation:'linear',use_bias:!1,gpu:e.gpu},this.pointwiseConvAttrs={filters:t,kernel_size:[1,1],strides:[1,1],padding:o,data_format:n,activation:'linear',use_bias:l,gpu:e.gpu},this.description=`${this.kernelShape[0]} ${this.kernelShape.slice(1).join('x')} filters`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.description+=1<s?`, depth multiplier: ${s}`:'',this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.gpu&&(this.activationProgram=gS.webgl2.compileProgram(d[this.activation]))}setWeights(e){this._depthwiseConv=new c(this.depthwiseConvAttrs),this._depthwiseConv.setWeights(e.slice(0,1)),this._pointwiseConv=new p.default(this.pointwiseConvAttrs),this._pointwiseConv.setWeights(e.slice(1,3))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this._depthwiseConv._callCPU(e),this._pointwiseConv._callCPU(this._depthwiseConv.output),this.output=this._pointwiseConv.output,this.activationFunc(this.output)}_callGPU(e){this._depthwiseConv.outbound=[null],this._pointwiseConv.outbound=[null],this._depthwiseConv._callGPU(e),this._pointwiseConv._callGPU(this._depthwiseConv.outputReshaped),'linear'===this.activation?this.output=this._pointwiseConv.output:(!this.output&&(this.output=new n.default([],this._pointwiseConv.output.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this._pointwiseConv.output.originalShape,this.output.indicesForReshaped=s.createIndicesFor2DReshaped(this._pointwiseConv.output.originalShape,!1,-1)),this.outputPreactiv=this._pointwiseConv.output,gS.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0})),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}t.default=g});se(wT);var CT=ue(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hS),n=r(IS),i=a(KS),s=r(mT),u=a(MS),l=r(NS),p=r(ES),d=r(xT),c=a(bT);const g=(0,l.default)({args:[{blockIndices:-1},'scalar','scalar'],body:function(e,t,a){for(let r=0;r<a;r++)if(-1===e[r]){e[r]=t;break}}}),h=(0,l.default)({args:[{blockIndices:-1},'array','scalar'],body:function(e,t,a){for(let r=0;r<a;r++)if(-1===e[r]){e[r]=t;break}}});class f extends o.default{constructor(e={}){super(e),this.layerClass='Conv2DTranspose';const{filters:t=1,kernel_size:a=[3,3],strides:r=[1,1],padding:o='valid',data_format:n='channels_last',activation:s='linear',use_bias:u=!0}=e;this.kernelShape=Array.isArray(a)?[t,...a]:[t,a,a],this.strides=Array.isArray(r)?r:[r,r],'valid'===o||'same'===o?this.padding=o:this.throwError('Invalid padding.'),'channels_last'===n||'channels_first'===n?this.dataFormat=n:this.throwError('Only channels_last and channels_first data formats are allowed.'),this.activation=s,this.activationFunc=i[s],this.useBias=u,this.params=this.useBias?['kernel','bias']:['kernel'],this.description=`${this.kernelShape[0]} ${this.kernelShape.slice(1).join('x')} filters`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.gpu&&(this.matMulProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=gS.webgl2.compileProgram(c[this.activation]))}setWeights(e){'channels_first'===this.dataFormat&&(e[0].tensor=e[0].tensor.transpose(2,3,1,0)),super.setWeights(e,!1),this._w2row(),this.gpu&&(this.weights.kernel=this.wRowsMat,this.weights.kernel.createGLTexture({type:'2d',format:'float'}),this.useBias&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_calcOutputShape(e){if(!(this.outputShape&&this.outputPadding)){const t=e[0],a=e[1],[r,o,n]=this.kernelShape,i='same'===this.padding?t*this.strides[0]:t*this.strides[0]+bn(o-this.strides[0],0),s='same'===this.padding?a*this.strides[1]:a*this.strides[1]+bn(n-this.strides[1],0),u='same'===this.padding?bn(0,_n((t-1)*this.strides[0]+o-i)):0,l='same'===this.padding?bn(0,_n((a-1)*this.strides[1]+n-s)):0,p=_n(u/2),d=_n(l/2);this.outputShape=[i,s,r],this.outputPadding=[p,u-p,d,l-d]}}_im2col(e){const[t,a,r]=e.tensor.shape;this.imColsMat||(this.imColsMat=new n.default([],[t*a,r]));const o=new n.default([],[t*a]),i=new n.default([],[t,a]);for(let t=0;t<r;t++)p.default.assign(i.tensor,e.tensor.pick(null,null,t)),o.replaceTensorData(i.tensor.data),p.default.assign(this.imColsMat.tensor.pick(null,t),o.tensor);return this.imColsMat}_w2row(){const[e,t,a,r]=this.weights.kernel.tensor.shape;this.wRowsMat=new n.default([],[r,e*t*a]);const o=new n.default([],[e*t*a]),i=new n.default([],[e,t,a]);for(let e=0;e<r;e++)p.default.assign(i.tensor,this.weights.kernel.tensor.pick(null,null,null,e)),o.replaceTensorData(i.tensor.data),p.default.assign(this.wRowsMat.tensor.pick(e,null),o.tensor);return this.wRowsMat}_callCPU(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),this._im2col(e);const t=e.tensor.shape[0],a=e.tensor.shape[1],[r,o,s]=this.kernelShape,u=new n.default([],[t*a,o*s*r]);(0,d.default)(u.tensor,this.imColsMat.tensor,this.wRowsMat.tensor,1,1);const[i,l,c,g]=this.outputPadding;this.output=new n.default([],this.outputShape);let h=new n.default([],[this.outputShape[0]+i+l,this.outputShape[1]+c+g,this.outputShape[2]]);let f=new n.default([],[o,s,r]),m=new n.default([],[o*s*r]),_=0;for(let r=0;r<t;r++)for(let e=0;e<a;e++){p.default.assign(m.tensor,u.tensor.pick(_,null)),f.replaceTensorData(m.tensor.data);const t=r*this.strides[0],a=e*this.strides[1];p.default.addeq(h.tensor.hi(t+o,a+s,this.outputShape[2]).lo(t,a,0),f.tensor),_+=1}if(p.default.assign(this.output.tensor,h.tensor.hi(this.outputShape[0]+i,this.outputShape[1]+c,this.outputShape[2]).lo(i,c,0)),this.useBias)for(let e=0;e<r;e++)p.default.addseq(this.output.tensor.pick(null,null,e),this.weights.bias.tensor.get(e));this.activationFunc(this.output),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1))}_createIndexMap(){if(!this.indexMap){const e=this.inputShape[0],t=this.inputShape[1],[a,r,o]=this.kernelShape,[i,s,u,l]=this.outputPadding,d=(r-this.strides[0]+1)*(o-this.strides[1]+1),c=[this.outputShape[0],this.outputShape[1],d],f=[this.outputShape[0]+i+s,this.outputShape[1]+u+l,d],m=new n.default([],c,{type:Int32Array}),_=new n.default([],c,{type:Int32Array}),y=new n.default([],f,{type:Int32Array}),x=new n.default([],f,{type:Int32Array});p.default.assigns(m.tensor,-1),p.default.assigns(_.tensor,-1),p.default.assigns(y.tensor,-1),p.default.assigns(x.tensor,-1);const v=new n.default([],[r,o,a],{type:Int32Array});for(let e=0;e<r*o*a;e++)v.tensor.data[e]=e;for(let a=0;a<e;a++)for(let e=0;e<t;e++){const n=a*t+e,i=a*this.strides[0],s=e*this.strides[1];g(y.tensor.hi(i+r,s+o,d).lo(i,s,0),n,d),h(x.tensor.hi(i+r,s+o,d).lo(i,s,0),v.tensor.pick(null,null,0),d)}p.default.assign(m.tensor,y.tensor.hi(this.outputShape[0]+i,this.outputShape[1]+u,d).lo(i,u,0)),p.default.assign(_.tensor,x.tensor.hi(this.outputShape[0]+i,this.outputShape[1]+u,d).lo(i,u,0));const b=[this.outputShape[0]*this.outputShape[1],d];this.indexMap=new n.default([],b,{type:Int32Array});const S=new n.default([],[d],{type:Int32Array});for(let e=0;e<this.outputShape[0];e++)for(let t=0;t<this.outputShape[1];t++){for(let a=0;a<d;a++){const r=m.tensor.get(e,t,a),o=_.tensor.get(e,t,a);-1!==r&&-1!==o?S.tensor.set(a,r*this.weights.kernel.glTextureShape[1]+o):S.tensor.set(a,-1)}p.default.assign(this.indexMap.tensor.pick(e*this.outputShape[1]+t,null),S.tensor)}this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}_callGPU(e){e.is2DReshaped||e.is2DSquareReshaped?(this.inputShape=e.originalShape,this._calcOutputShape(this.inputShape)):(this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),this._im2col(e),this.imColsMat.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}));const t=e.is2DReshaped||e.is2DSquareReshaped?e:this.imColsMat;if(!this.matMulResult){const e=[t.glTextureShape[0],this.weights.kernel.glTextureShape[1]];this.matMulResult=new n.default([],e),this.matMulResult.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})}if('linear'!==this.activation&&!this.outputPreactiv){const e=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]];this.outputPreactiv=new n.default([],e),this.outputPreactiv.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputPreactiv.is2DReshaped=!0,this.outputPreactiv.originalShape=this.outputShape,this.outputPreactiv.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)}if(!this.output){const e=[this.outputShape[0]*this.outputShape[1],this.outputShape[2]];this.output=new n.default([],e),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)}gS.webgl2.runProgram({program:this.matMulProgram,output:this.matMulResult,inputs:[{input:t,name:'A'},{input:this.weights.kernel,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}],supportsTextureFragments:!0}),this._createIndexMap();const a=!!this.matMulResult.glTextureFragments;if(a&&this.matMulResult.convert2DRowFragmentedGLTextureToColStack(),!this.convTransposeProgram){const e=(0,s.default)('conv2dTranspose',this.output.glTextureFragmentShape?this.output.glTextureFragmentShape:this.output.glTextureShape,this.matMulResult.glTextureFragmentShape?this.matMulResult.glTextureFragmentShape:this.matMulResult.glTextureShape,this.indexMap.glTextureFragmentShape?this.indexMap.glTextureFragmentShape:this.indexMap.glTextureShape,this.useBias,a);this.convTransposeProgram=gS.webgl2.compileProgram(e)}gS.webgl2.runProgram({program:this.convTransposeProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:[{input:this.matMulResult,name:'matMulResult'},{input:this.indexMap,name:'indexMap'},...(this.useBias?[{input:this.weights.bias,name:'bias'}]:[])],supportsTextureFragments:!0}),a&&this.matMulResult.removeGLTextureFragmentsAsColStack(),'linear'!==this.activation&&gS.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}t.default=f});se(CT);var FT=ue(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hS),n=r(IS),i=a(KS),s=r(mT),u=a(MS),l=r(ES),p=r(xT),d=a(bT);class c extends o.default{constructor(e={}){super(e),this.layerClass='Conv3D';const{filters:t=1,kernel_size:a=[1,1,1],strides:r=[1,1,1],padding:o='valid',data_format:n='channels_last',dilation_rate:s=[1,1,1],activation:u='linear',use_bias:l=!0}=e;this.kernelShape=Array.isArray(a)?[t,...a]:[t,a,a,a],this.strides=Array.isArray(r)?r:[r,r,r],'valid'===o||'same'===o?this.padding=o:this.throwError('Invalid padding.'),'channels_last'===n||'channels_first'===n?this.dataFormat=n:this.throwError('Only channels_last and channels_first data formats are allowed.'),this.dilationRate=Array.isArray(s)?s:[s,s,s],(1!==this.dilationRate[0]||1!==this.dilationRate[1]||1!==this.dilationRate[2])&&(1!==this.strides[0]||1!==this.strides[1]||1!==this.strides[2])&&this.throwError('Incompatible combination of dilation_rate with strides.'),this.activation=u,this.activationFunc=i[u],this.useBias=l,this.params=this.useBias?['kernel','bias']:['kernel'],this.description=`${this.kernelShape[0]} ${this.kernelShape.slice(1).join('x')} filters`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.description+=this.dilationRate.some((e)=>1<e)?`, ${this.dilationRate.join('x')} dilation`:'',this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),this.mapInputFragmentsProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(indexMap, 0);\n  int out_x = int(float(outputSize[0]) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    int fragmentIndex = int(floor(float(rowIndex) / float(inputSize[1])));\n    rowIndex = int(mod(float(rowIndex), float(inputSize[1])));\n    colIndex = fragmentIndex * inputCols + colIndex;\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),this.matMulProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=gS.webgl2.compileProgram(d[this.activation]))}setWeights(e){'channels_first'===this.dataFormat&&(e[0].tensor=e[0].tensor.transpose(2,3,4,1,0)),super.setWeights(e,!1),this._w2row(),this.gpu&&(this.weights.kernel=this.wRowsMat,this.weights.kernel.createGLTexture({type:'2d',format:'float'}),this.useBias&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_calcOutputShape(e){if(!(this.outputShape&&this.inputPadding)){const t=e[0],a=e[1],r=e[2],[o,n,i,s]=this.kernelShape,u=n+(n-1)*(this.dilationRate[0]-1),l=i+(i-1)*(this.dilationRate[1]-1),p=s+(s-1)*(this.dilationRate[2]-1),d='same'===this.padding?_n((t+this.strides[0]-1)/this.strides[0]):_n((t-u+this.strides[0])/this.strides[0]),c='same'===this.padding?_n((a+this.strides[1]-1)/this.strides[1]):_n((a-l+this.strides[1])/this.strides[1]),g='same'===this.padding?_n((r+this.strides[2]-1)/this.strides[2]):_n((r-p+this.strides[2])/this.strides[2]),h='same'===this.padding?bn(0,_n((d-1)*this.strides[0]+u-t)):0,f='same'===this.padding?bn(0,_n((c-1)*this.strides[1]+l-a)):0,m='same'===this.padding?bn(0,_n((g-1)*this.strides[2]+p-r)):0,_=_n(h/2),y=_n(f/2),x=_n(m/2);this.outputShape=[d,c,g,o],this.inputPadding=[_,h-_,y,f-y,x,m-x]}}_padInput(e,t=0){if('same'===this.padding){const[a,r,o,i]=e.tensor.shape,[s,u,p,d,c,g]=this.inputPadding,h=new n.default([],[a+s+u,r+p+d,o+c+g,i]);return 0!==t&&l.default.assigns(h.tensor,t),l.default.assign(h.tensor.hi(a+s,r+p,o+c,i).lo(s,p,c,0),e.tensor),h}return e}_vol2col(e){const[t,a,r,o]=e.tensor.shape,i=this.kernelShape[1],s=this.kernelShape[2],u=this.kernelShape[3],p=this.outputShape[0],d=this.outputShape[1],c=this.outputShape[2],g=i*s*u*o,h=i+(i-1)*(this.dilationRate[0]-1),f=s+(s-1)*(this.dilationRate[1]-1),m=u+(u-1)*(this.dilationRate[2]-1);if(this.volColsMat||(this.volColsMat=new n.default([],[p*d*c,g])),1===h&&1===f&&1===m&&1===this.strides[0]&&1===this.strides[1]&&1===this.strides[2])return this.volColsMat.replaceTensorData(e.tensor.data),this.volColsMat;const _=new n.default([],[i,s,u,o]);let y=0;for(let n=0;n<=t-h;n+=this.strides[0])for(let t=0;t<=a-f;t+=this.strides[1])for(let a=0;a<=r-m;a+=this.strides[2])l.default.assign(_.tensor,e.tensor.hi(n+h,t+f,a+m,o).lo(n,t,a,0).step(this.dilationRate[0],this.dilationRate[1],this.dilationRate[2],1)),this.volColsMat.tensor.data.set(_.tensor.data,y),y+=g;return this.volColsMat}_w2row(){const e=this.weights.kernel.tensor.shape[3],[t,a,r,o]=this.kernelShape,i=a*r*o*e;this.wRowsMat=new n.default([],[i,t]);const s=new n.default([],[a,r,o,e]),u=new n.default([],[i]);for(let e=0;e<t;e++)l.default.assign(s.tensor,this.weights.kernel.tensor.pick(null,null,null,null,e)),u.replaceTensorData(s.tensor.data),l.default.assign(this.wRowsMat.tensor.pick(null,e),u.tensor);return this.wRowsMat}_callCPU(e){this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._vol2col(e);const t=this.kernelShape[0],a=this.outputShape[0],r=this.outputShape[1],o=this.outputShape[2],i=new n.default([],[a*r*o,t]);if(this.useBias)for(let e=0;e<t;e++)l.default.assigns(i.tensor.pick(null,e),this.weights.bias.tensor.get(e));(0,p.default)(i.tensor,this.volColsMat.tensor,this.wRowsMat.tensor,1,1),this.output=new n.default([],this.outputShape);let s=new n.default([],[a*r*o]),u=new n.default([],[a,r,o]);for(let a=0;a<t;a++)l.default.assign(s.tensor,i.tensor.pick(null,a)),u.replaceTensorData(s.tensor.data),l.default.assign(this.output.tensor.pick(null,null,null,a),u.tensor);this.activationFunc(this.output),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2))}_createIndexMap(e){if(this.indexMap)return;let[t,a,r,o]=this.inputShape,s=new n.default(e.data,e.shape,{type:Int32Array});if('same'===this.padding){const[e,o,n,i,u,l]=this.inputPadding;t=t+e+o,a=a+n+i,r=r+u+l;s=this._padInput(s,-1)}const i=this.kernelShape[1],u=this.kernelShape[2],p=this.kernelShape[3],d=this.outputShape[0],c=this.outputShape[1],g=this.outputShape[2],h=i*u*p*o,f=i+(i-1)*(this.dilationRate[0]-1),m=u+(u-1)*(this.dilationRate[1]-1),_=p+(p-1)*(this.dilationRate[2]-1);this.indexMap=new n.default([],[d*c*g,h],{type:Int32Array});const y=new n.default([],[i,u,p,o]);let x=0;for(let n=0,i=t-f;n<=i;n+=this.strides[0])for(let e=0,t=a-m;e<=t;e+=this.strides[1])for(let t=0,a=r-_;t<=a;t+=this.strides[2])l.default.assign(y.tensor,s.tensor.hi(n+f,e+m,t+_,o).lo(n,e,t,0).step(this.dilationRate[0],this.dilationRate[1],this.dilationRate[2],1)),this.indexMap.tensor.data.set(y.tensor.data,x),x+=h;this.indexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_callGPU(e){let t;if(e.is2DReshaped||e.is2DSquareReshaped?(this.inputShape=e.originalShape,this._calcOutputShape(this.inputShape),this._createIndexMap(e.indicesForReshaped),t=[this.indexMap.glTextureShape[0],this.weights.kernel.glTextureShape[1]]):(this.inputShape=e.tensor.shape,this._calcOutputShape(this.inputShape),e=this._padInput(e),this._vol2col(e),this.volColsMat.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),t=[this.volColsMat.glTextureShape[0],this.weights.kernel.glTextureShape[1]]),'linear'===this.activation||this.outputPreactiv||(this.outputPreactiv=new n.default([],t),this.outputPreactiv.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.outputPreactiv.is2DReshaped=!0,this.outputPreactiv.originalShape=this.outputShape,this.outputPreactiv.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)),this.output||(this.output=new n.default([],t),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=u.createIndicesFor2DReshaped(this.outputShape,!1,-1)),e.is2DReshaped||e.is2DSquareReshaped){const t=!!e.glTextureFragments;if(t&&e.convert2DRowFragmentedGLTextureToColStack(),!this.convProgram){const a=(0,s.default)('conv2d',this.output.glTextureFragmentShape?this.output.glTextureFragmentShape:this.output.glTextureShape,e.glTextureFragmentShape?e.glTextureFragmentShape:e.glTextureShape,this.indexMap.glTextureFragmentShape?this.indexMap.glTextureFragmentShape:this.indexMap.glTextureShape,this.useBias,t);this.convProgram=gS.webgl2.compileProgram(a)}gS.webgl2.runProgram({program:this.convProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'},{input:this.weights.kernel,name:'kernel'},...(this.useBias?[{input:this.weights.bias,name:'bias'}]:[])],supportsTextureFragments:!0}),t&&e.removeGLTextureFragmentsAsColStack()}else{const e=[{input:this.volColsMat,name:'A'},{input:this.weights.kernel,name:'B'}];this.useBias&&e.push({input:this.weights.bias,name:'C'}),gS.webgl2.runProgram({program:this.matMulProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:e,uniforms:[{value:this.useBias?1:0,type:'bool',name:'addC'}],supportsTextureFragments:!0})}'linear'!==this.activation&&gS.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2)))}}t.default=c});se(FT);var kT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='Cropping1D';const{cropping:t=[0,0]}=e;this.cropping=Array.isArray(t)?t:[t,t],this.description=`${JSON.stringify(this.cropping)}`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0]-this.cropping[1],this.inputShape[1]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor,e.tensor.hi(this.inputShape[0]-this.cropping[1],this.inputShape[2]).lo(this.cropping[0],0))}_createIndexMap(){if(!this.indexMap){const e=new o.default([],this.inputShape,{type:Int32Array}),t=new o.default([],this.inputShape,{type:Int32Array}),a=new o.default([],this.inputShape,{type:Int32Array});for(let e=0;e<this.inputShape[0];e++)n.default.assigns(t.tensor.pick(e,null),e);for(let e=0;e<this.inputShape[1];e++)n.default.assigns(a.tensor.pick(null,e),e);n.default.muls(e.tensor,t.tensor,this.inputShape[1]),n.default.addeq(e.tensor,a.tensor),this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r=[this.cropping[0],0],i=[this.inputShape[0]-this.cropping[1],this.inputShape[2]];n.default.assign(this.indexMap.tensor,e.tensor.hi(...i).lo(...r)),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0]-this.cropping[1],this.inputShape[1]],this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});se(kT);var ET=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='Cropping2D';const{cropping:t=[[0,0],[0,0]],data_format:a='channels_last'}=e;this.cropping=Array.isArray(t)?Array.isArray(t[0])?t:[[t[0],t[0]],[t[1],t[1]]]:[[t,t],[t,t]],this.dataFormat=a,this.description=`${JSON.stringify(this.cropping)}`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor,e.tensor.hi(this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]).lo(this.cropping[0][0],this.cropping[1][0],0)),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(2,0,1),this.output.tensor=this.output.tensor.transpose(2,0,1))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r='channels_first'===this.dataFormat?[0,this.cropping[0][0],this.cropping[1][0]]:[this.cropping[0][0],this.cropping[1][0],0],i='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][1]]:[this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]];n.default.assign(this.indexMap.tensor,a.tensor.hi(...i).lo(...r)),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][0]-this.cropping[1][1]]:[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});se(ET);var MT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='Cropping3D';const{cropping:t=[[0,0],[0,0],[0,0]],data_format:a='channels_last'}=e;this.cropping=Array.isArray(t)?Array.isArray(t[0])?t:[[t[0],t[0]],[t[1],t[1]],[t[2],t[2]]]:[[t,t],[t,t],[t,t]],this.dataFormat=a,this.description=`${JSON.stringify(this.cropping)}`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][0]-this.cropping[2][1],this.inputShape[3]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor,e.tensor.hi(this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][1],this.inputShape[3]).lo(this.cropping[0][0],this.cropping[1][0],this.cropping[2][0],0)),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(3,0,1,2),this.output.tensor=this.output.tensor.transpose(3,0,1,2))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r='channels_first'===this.dataFormat?[0,this.cropping[0][0],this.cropping[1][0],this.cropping[2][0]]:[this.cropping[0][0],this.cropping[1][0],this.cropping[2][0],0],i='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][1],this.inputShape[3]-this.cropping[2][1]]:[this.inputShape[0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][1],this.inputShape[3]];n.default.assign(this.indexMap.tensor,a.tensor.hi(...i).lo(...r)),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[2]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[3]-this.cropping[2][0]-this.cropping[2][1]]:[this.inputShape[0]-this.cropping[0][0]-this.cropping[0][1],this.inputShape[1]-this.cropping[1][0]-this.cropping[1][1],this.inputShape[2]-this.cropping[2][0]-this.cropping[2][1],this.inputShape[3]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});se(MT);var DT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='UpSampling1D';const{size:t=2}=e;this.size=t,this.description=`size ${t}`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size,this.inputShape[1]],this.output=new o.default([],this.outputShape);for(let t=0;t<this.size;t++)n.default.assign(this.output.tensor.lo(t,0).step(this.size,1),e.tensor)}_createIndexMap(){if(!this.indexMap){const e=new o.default([],this.inputShape,{type:Int32Array}),t=new o.default([],this.inputShape,{type:Int32Array}),a=new o.default([],this.inputShape,{type:Int32Array});for(let e=0;e<this.inputShape[0];e++)n.default.assigns(t.tensor.pick(e,null),e);for(let e=0;e<this.inputShape[1];e++)n.default.assigns(a.tensor.pick(null,e),e);n.default.muls(e.tensor,t.tensor,this.inputShape[1]),n.default.addeq(e.tensor,a.tensor),this.indexMap=new o.default([],this.outputShape,{type:Int32Array});for(let t=0;t<this.size;t++)n.default.assign(this.indexMap.tensor.lo(t,0).step(this.size,1),e.tensor);this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size,this.inputShape[1]],this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});se(DT);var IT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='UpSampling2D';const{size:t=[2,2],data_format:a='channels_last'}=e;this.size=Array.isArray(t)?t:[t,t],this.dataFormat=a,this.description=`size ${this.size.join('x')}`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]],this.output=new o.default([],this.outputShape);for(let t=0;t<this.size[0];t++)for(let a=0;a<this.size[1];a++)n.default.assign(this.output.tensor.lo(t,a,0).step(this.size[0],this.size[1],1),e.tensor);'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(2,0,1),this.output.tensor=this.output.tensor.transpose(2,0,1))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});for(let e=0;e<this.size[0];e++)for(let t=0;t<this.size[1];t++){const r='channels_first'===this.dataFormat?[0,e,t]:[e,t,0],o='channels_first'===this.dataFormat?[1,this.size[0],this.size[1]]:[this.size[0],this.size[1],1];n.default.assign(this.indexMap.tensor.lo(...r).step(...o),a.tensor)}t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]*this.size[0],this.inputShape[2]*this.size[1]]:[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});se(IT);var AT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='UpSampling3D';const{size:t=[2,2,2],data_format:a='channels_last'}=e;this.size=Array.isArray(t)?t:[t,t,t],this.dataFormat=a,this.description=`size ${this.size.join('x')}`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]*this.size[2],this.inputShape[3]],this.output=new o.default([],this.outputShape);for(let t=0;t<this.size[0];t++)for(let a=0;a<this.size[1];a++)for(let r=0;r<this.size[2];r++)n.default.assign(this.output.tensor.lo(t,a,r,0).step(this.size[0],this.size[1],this.size[2],1),e.tensor);'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(3,0,1,2),this.output.tensor=this.output.tensor.transpose(3,0,1,2))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});for(let e=0;e<this.size[0];e++)for(let t=0;t<this.size[1];t++)for(let r=0;r<this.size[2];r++){const o='channels_first'===this.dataFormat?[0,e,t,r]:[e,t,r,0],i='channels_first'===this.dataFormat?[1,this.size[0],this.size[1],this.size[2]]:[this.size[0],this.size[1],this.size[2],1];n.default.assign(this.indexMap.tensor.lo(...o).step(...i),a.tensor)}t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]*this.size[0],this.inputShape[2]*this.size[1],this.inputShape[3]*this.size[2]]:[this.inputShape[0]*this.size[0],this.inputShape[1]*this.size[1],this.inputShape[2]*this.size[2],this.inputShape[3]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});se(AT);var RT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='ZeroPadding1D';const{padding:t=[1,1]}=e;this.padding=Array.isArray(t)?t:[t,t],this.description=`${JSON.stringify(this.padding)}`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0]+this.padding[1],this.inputShape[1]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor.hi(this.inputShape[0]+this.padding[0],this.inputShape[1]).lo(this.padding[0],0),e.tensor)}_createIndexMap(){if(!this.indexMap){const e=new o.default([],this.inputShape,{type:Int32Array}),t=new o.default([],this.inputShape,{type:Int32Array}),a=new o.default([],this.inputShape,{type:Int32Array});for(let e=0;e<this.inputShape[0];e++)n.default.assigns(t.tensor.pick(e,null),e);for(let e=0;e<this.inputShape[1];e++)n.default.assigns(a.tensor.pick(null,e),e);n.default.muls(e.tensor,t.tensor,this.inputShape[1]),n.default.addeq(e.tensor,a.tensor),this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r=[this.padding[0],0],i=[this.inputShape[0]+this.padding[0],this.inputShape[1]];n.default.assigns(this.indexMap.tensor,-1),n.default.assign(this.indexMap.tensor.hi(...i).lo(...r),e.tensor),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0]+this.padding[1],this.inputShape[1]],this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});se(RT);var LT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='ZeroPadding2D';const{padding:t=[[1,1],[1,1]],data_format:a='channels_last'}=e;this.padding=Array.isArray(t)?Array.isArray(t[0])?t:[[t[0],t[0]],[t[1],t[1]]]:[[t,t],[t,t]],this.dataFormat=a,this.description=`${JSON.stringify(this.padding)}`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor.hi(this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]).lo(this.padding[0][0],this.padding[1][0],0),e.tensor),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(2,0,1),this.output.tensor=this.output.tensor.transpose(2,0,1))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r='channels_first'===this.dataFormat?[0,this.padding[0][0],this.padding[1][0]]:[this.padding[0][0],this.padding[1][0],0],i='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0],this.inputShape[2]+this.padding[1][0]]:[this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]];n.default.assigns(this.indexMap.tensor,-1),n.default.assign(this.indexMap.tensor.hi(...i).lo(...r),a.tensor),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0]+this.padding[0][1],this.inputShape[2]+this.padding[1][0]+this.padding[1][1]]:[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});se(LT);var OT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='ZeroPadding3D';const{padding:t=[[1,1],[1,1],[1,1]],data_format:a='channels_last'}=e;this.padding=Array.isArray(t)?Array.isArray(t[0])?t:[[t[0],t[0]],[t[1],t[1]],[t[2],t[2]]]:[[t,t],[t,t],[t,t]],this.dataFormat=a,this.description=`${JSON.stringify(this.padding)}`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this.outputShape=[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]+this.padding[2][0]+this.padding[2][1],this.inputShape[3]],this.output=new o.default([],this.outputShape),n.default.assign(this.output.tensor.hi(this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]+this.padding[2][0],this.inputShape[3]).lo(this.padding[0][0],this.padding[1][0],this.padding[2][0],0),e.tensor),'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(3,0,1,2),this.output.tensor=this.output.tensor.transpose(3,0,1,2))}_createIndexMap(e,t){if(!this.indexMap){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMap=new o.default([],this.outputShape,{type:Int32Array});const r='channels_first'===this.dataFormat?[0,this.padding[0][0],this.padding[1][0],this.padding[2][0]]:[this.padding[0][0],this.padding[1][0],this.padding[2][0],0],i='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0],this.inputShape[2]+this.padding[1][0],this.inputShape[3]+this.padding[2][0]]:[this.inputShape[0]+this.padding[0][0],this.inputShape[1]+this.padding[1][0],this.inputShape[2]+this.padding[2][0],this.inputShape[3]];n.default.assigns(this.indexMap.tensor,-1),n.default.assign(this.indexMap.tensor.hi(...i).lo(...r),a.tensor),t?this.indexMap.reshapeTo2D():this.indexMap.reshapeTo2DSquare(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture||(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'})),this.inputShape=e.originalShape,this.outputShape='channels_first'===this.dataFormat?[this.inputShape[0],this.inputShape[1]+this.padding[0][0]+this.padding[0][1],this.inputShape[2]+this.padding[1][0]+this.padding[1][1],this.inputShape[3]+this.padding[2][0]+this.padding[2][1]]:[this.inputShape[0]+this.padding[0][0]+this.padding[0][1],this.inputShape[1]+this.padding[1][0]+this.padding[1][1],this.inputShape[2]+this.padding[2][0]+this.padding[2][1],this.inputShape[3]],this._createIndexMap(e.indicesForReshaped,e.is2DReshaped),this.output||(this.output=new o.default([],this.outputShape),e.is2DReshaped?this.output.reshapeTo2D():this.output.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.reshapeFrom2DSquare())}}t.default=i});se(OT);var jT=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Conv1D',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Conv2D',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'SeparableConv2D',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'Conv2DTranspose',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'Conv3D',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'Cropping1D',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'Cropping2D',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'Cropping3D',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'UpSampling1D',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'UpSampling2D',{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,'UpSampling3D',{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,'ZeroPadding1D',{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,'ZeroPadding2D',{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,'ZeroPadding3D',{enumerable:!0,get:function(){return m.default}});var r=a(PT),o=a(ST),n=a(wT),i=a(CT),s=a(FT),u=a(kT),l=a(ET),p=a(MT),d=a(DT),c=a(IT),g=a(AT),h=a(RT),f=a(LT),m=a(OT)});se(jT);var zT=function(e,t){var a=e.data,r=t.data,o=e.stride[0],n=t.stride[0],s=e.offset,u=t.offset,l,i;for(l=e.shape[0]-1;0<=l;l--,s+=o,u+=n)i=a[s],a[s]=r[u],r[u]=i},GT=function(e,t){var a=t.data,r=t.stride[0],o=t.offset,n;for(n=t.shape[0]-1;0<=n;n--,o+=r)a[o]*=e},NT=function(e,t){var a=e.data,r=t.data,o=e.stride[0],n=t.stride[0],s=e.offset,u=t.offset,l;for(l=e.shape[0]-1;0<=l;l--,s+=o,u+=n)r[u]=a[s]},UT=function(e,t,a){var r=t.data,o=a.data,n=t.stride[0],s=a.stride[0],u=t.offset,l=a.offset,p;for(p=t.shape[0]-1;0<=p;p--,u+=n,l+=s)o[l]+=e*r[u]},qT=function(e,t){var a=e.data,r=e.stride[0],o=e.offset,n=0,s,i;if(e===t)for(s=e.shape[0]-1;0<=s;s--,o+=r)i=a[o],n+=i*i;else{var u=t.data,l=t.stride[0],p=t.offset;for(s=e.shape[0]-1;0<=s;s--,o+=r,p+=l)n+=u[p]*a[o]}return n},BT=function(e,t,a){var r=t.data,o=a.data,n=t.stride[0],s=a.stride[0],u=t.offset,l=a.offset,p;for(p=t.shape[0]-1;0<=p;p--,u+=n,l+=s)o[l]=e*r[u]},VT=function(e,a){if(0===e&&0===a)return 0;var r=Sn(e),o=Sn(a),n=vn(r,o),t=bn(r,o);return n/=t,t*Tn(1+n*n)},HT=function(e){var t=e.data,a=e.stride[0],r=e.offset,o=0,n,i;for(n=e.shape[0]-1;0<=n;n--,r+=a)i=t[r],o=VT(o,i);return o},WT=function(e){var t=e.data,a=e.stride[0],r=e.offset,o=0,n;for(n=e.shape[0]-1;0<=n;n--,r+=a)o+=Sn(t[r]);return o},XT=function(e){var t=-Infinity,a=e.data,r=e.stride[0],o=e.offset,n=e.shape[0],s,i,u;for(s=0;s<n;s++,o+=r)i=Sn(a[o]),i>t&&(t=i,u=s);return u};gn=gn||function(e){return e=+e,0===e||isNaN(e)?e:0<e?1:-1};var YT=function(e,a,o){var n=0,i=0,s=0,r=0,t=0;return 0===a?(n=gn(e),i=0,s=Sn(e)):0===e?(n=0,i=gn(a),s=Sn(a)):Sn(e)>Sn(a)?(r=a/e,t=gn(e)*Tn(1+r*r),n=1/t,i=r*n,s=e*t):(r=e/a,t=gn(e)*Tn(1+r*r),i=1/t,n=r*i,s=a*t),void 0!==o&&2<o.length?void(o[0]=n,o[1]=i,o[2]=s):[n,i,s]},$T=zT,KT=GT,ZT=NT,QT=UT,JT=qT,eP=BT,tP=HT,aP=WT,rP=XT,oP=YT,nP={swap:$T,scal:KT,copy:ZT,axpy:QT,dot:JT,cpsc:eP,nrm2:tP,asum:aP,iamax:rP,rotg:oP},iP=$r,sP=Kr,uP=Zr,lP=Qr,pP=ue(function(e){e.exporst=function(){console.error('SPMV (symmetric packed matrix vector multiply) not yet implemented')}}),dP=Jr,cP=eo,gP=to,hP=ue(function(e){e.exporst=function(){console.error('TBSV (triangular banded matrix solver) not yet implemented')}}),fP=ao,mP=ro,_P=oo,yP=no,xP=io,vP=so,bP=ue(function(e){e.exports.gemv=iP,e.exports.gbmv=sP,e.exports.symv=uP,e.exports.sbmv=lP,e.exports.spmv=pP,e.exports.trmv=dP,e.exports.tbmv=cP,e.exports.trsv=gP,e.exports.tbsv=hP,e.exports.tpsv=fP,e.exports.ger=mP,e.exports.syr=_P,e.exports.spr=yP,e.exports.syr2=xP,e.exports.spr2=vP,e.exports.trmv_lower=function(t,a){return console.warn('trmv_lower is deprecated. Please use the \'isLower\' flag with trmv.'),e.exports.trmv(t,a,!0)},e.exports.trsv_lower=function(t,a){return console.warn('trsv_lower is deprecated. Please use the \'isLower\' flag with trsv.'),e.exports.trsv(t,a,!0)}}),SP=ue(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hS),n=r(IS),i=a(KS),s=r(ES),u=a(bT);class l extends o.default{constructor(e={}){super(e),this.layerClass='Dense';const{units:t=1,activation:a='linear',input_dim:r=null,use_bias:o=!0}=e;this.description=`${a} activation, output dimensions: ${t}`,this.activation=a,this.activationFunc=i[this.activation],this.units=t,this.input_dim=r,this.use_bias=o,this.params=this.use_bias?['kernel','bias']:['kernel'],this.input_dim&&(this.inputShape=[this.input_dim]),this.gpu&&(this.matMulProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=gS.webgl2.compileProgram(u[this.activation]))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=new n.default([],[this.units]),this.use_bias&&s.default.assign(this.output.tensor,this.weights.bias.tensor),(0,bP.gemv)(1,this.weights.kernel.tensor.transpose(1,0),e.tensor,1,this.output.tensor),this.activationFunc(this.output)}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),'linear'===this.activation||this.outputPreactiv||(this.outputPreactiv=new n.default([],[this.units]),this.outputPreactiv.createGLTexture({type:'2d',format:'float'})),this.output||(this.output=new n.default([],[this.units]),this.output.createGLTexture({type:'2d',format:'float'}));const t=[{input:e,name:'A'},{input:this.weights.kernel,name:'B'}];this.use_bias&&t.push({input:this.weights.bias,name:'C'}),gS.webgl2.runProgram({program:this.matMulProgram,output:'linear'===this.activation?this.output:this.outputPreactiv,inputs:t,uniforms:[{value:this.use_bias?1:0,type:'bool',name:'addC'}]}),'linear'!==this.activation&&gS.webgl2.runProgram({program:this.activationProgram,output:this.output,inputs:[{input:this.outputPreactiv,name:'x'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=l});se(SP);var TP=ue(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(hS),n=r(IS),i=a(KS),s=a(bT);class u extends o.default{constructor(e={}){super(e),this.layerClass='Activation';const{activation:t='linear'}=e;this.activation=t,this.activationFunc=i[t],this.description=`${this.activation}`,this.gpu&&(this.program=gS.webgl2.compileProgram(s[this.activation]))}call(e){return'linear'===this.activation?(this.output=e,this.output):(this.gpu?this._callGPU(e):this._callCPU(e),this.output)}_callCPU(e){this.output=new n.default(new e.arrayType(e.tensor.data),e.tensor.shape),this.activationFunc(this.output)}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output||(this.output=new n.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped)),gS.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}],supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=u});se(TP);var PP=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hS);class r extends a.default{constructor(e={}){super(e),this.layerClass='Dropout';const{rate:t=0.5}=e;this.description=`${t}`,this.rate=vn(bn(0,t),1)}call(e){return this.output=e,this.output}}t.default=r});se(PP);var wP=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hS);class r extends a.default{constructor(e={}){super(e),this.layerClass='SpatialDropout1D';const{p:t=0.5}=e;this.description=`${t}`,this.p=vn(bn(0,t),1)}call(e){return this.output=e,this.output}}t.default=r});se(wP);var CP=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hS);class r extends a.default{constructor(e={}){super(e),this.layerClass='SpatialDropout2D';const{rate:t=0.5,data_format:a='channels_last'}=e;this.description=`${t}`,this.rate=vn(bn(0,t),1),this.dataFormat=a}call(e){return this.output=e,this.output}}t.default=r});se(CP);var FP=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hS);class r extends a.default{constructor(e={}){super(e),this.layerClass='SpatialDropout3D';const{rate:t=0.5,data_format:a='channels_last'}=e;this.description=`${t}`,this.rate=vn(bn(0,t),1),this.dataFormat=a}call(e){return this.output=e,this.output}}t.default=r});se(FP);var kP=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS);class n extends r.default{constructor(e={}){super(e),this.layerClass='Flatten',this.gpu&&(this.flattenProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int outputSize;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(outputSize) * outTex.x);\n  int out_y = 0;\n\n  int i = int(floor(float(out_x) / float(inputCols)));\n  int j = int(mod(float(out_x), float(inputCols)));\n  outColor = vec4(texelFetch(x, ivec2(j, i), 0).r);\n}\n'),this.flattenFragmentsProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int outputSize;\nuniform int inputRows;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(outputSize) * outTex.x);\n  int out_y = 0;\n\n  int rowIndex = int(mod(floor(float(out_x) / float(inputCols)), float(inputRows)));\n  int colIndex = int(mod(float(out_x), float(inputCols)));\n  int fragmentIndex = int(floor(float(out_x) / (float(inputRows) * float(inputCols))));\n  colIndex += fragmentIndex * inputCols;\n  outColor = vec4(texelFetch(x, ivec2(colIndex, rowIndex), 0).r);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){1>=e.tensor.shape.length?this.output=e:(this.output=new o.default([],[e.tensor.shape.reduce((e,t)=>e*t,1)]),this.output.replaceTensorData(e.tensor.data))}_callGPU(e){e.glTexture||e.glTextureFragments||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'}))),this.output||(this.output=new o.default([],[e.glTextureShape.reduce((e,t)=>e*t,1)]),this.output.createGLTexture({type:'2d',format:'float'})),e.glTextureFragments?(e.convert2DRowFragmentedGLTextureToColStack(),gS.webgl2.runProgram({program:this.flattenFragmentsProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.output.glTextureShape[1],type:'int',name:'outputSize'},{value:e.glTextureShape[0],type:'int',name:'inputRows'},{value:e.glTextureShape[1],type:'int',name:'inputCols'}],supportsTextureFragments:!0}),e.removeGLTextureFragmentsAsColStack()):gS.webgl2.runProgram({program:this.flattenProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.output.glTextureShape[1],type:'int',name:'outputSize'},{value:e.glTextureShape[1],type:'int',name:'inputCols'}],supportsTextureFragments:!0}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=n});se(kP);var EP=uo,MP=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(EP),o=a(hS),n=a(IS),s=a(ES);class i extends o.default{constructor(e={}){super(e),this.layerClass='Reshape';const{target_shape:t=[]}=e;this.targetShape=t,this.description=`target shape: ${JSON.stringify(this.targetShape)}`,this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.targetShape.reduce((e,t)=>e*t,1)!==e.tensor.size&&this.throwError('The total size of new array must be unchanged in reshape layer.'),this.output=new n.default([],this.targetShape),this.output.replaceTensorData(e.tensor.data)}_createIndexMap(){if(!this.indexMap){const e=new n.default([],this.inputShape,{type:Int32Array}),t=new n.default([],this.inputShape,{type:Int32Array}),a=new n.default([],this.inputShape,{type:Int32Array});if(2===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)s.default.assigns(t.tensor.pick(e,null),e);else if(3===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)for(let a=0;a<this.inputShape[1];a++)s.default.assigns(t.tensor.pick(e,a,null),e*this.inputShape[1]+a);else if(4===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)for(let a=0;a<this.inputShape[1];a++)for(let r=0;r<this.inputShape[2];r++)s.default.assigns(t.tensor.pick(e,a,r,null),e*this.inputShape[1]*this.inputShape[2]+a*this.inputShape[2]+r);for(let e=0;e<(0,r.default)(this.inputShape);e++)s.default.assigns(a.tensor.pick(...Array(this.inputShape.length-1).fill(null),e),e);s.default.muls(e.tensor,t.tensor,(0,r.default)(this.inputShape)),s.default.addeq(e.tensor,a.tensor),this.indexMap=new n.default([],this.targetShape,{type:Int32Array}),this.indexMap.replaceTensorData(new Int32Array(e.tensor.data)),2<this.targetShape.length&&this.indexMap.reshapeTo2D(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){e.glTexture?e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:this.inputShape=e.tensor.shape:(this.inputShape=e.tensor.shape,2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'}))),this._createIndexMap(),this.output||(this.output=new n.default([],this.targetShape),2<this.targetShape.length&&this.output.reshapeTo2D(),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=i});se(MP);var DP=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(EP),o=a(vS),n=a(Ox),i=a(hS),s=a(IS),u=a(ES);class l extends i.default{constructor(e={}){super(e),this.layerClass='Permute';const{dims:t=[]}=e;this.description=`${JSON.stringify(t)}`,this.dims=t.map((e)=>e-1),this.gpu&&(this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'))}call(e){return 1>=e.tensor.shape.length||(0,n.default)((0,o.default)(e.tensor.shape.length),this.dims)?(this.output=e,this.output):(this.gpu?this._callGPU(e):this._callCPU(e),this.output)}_callCPU(e){this.dims.length!==e.tensor.shape.length&&this.throwError('The specified dims permutation must match the number of dimensions.');const t=this.dims.map((t)=>e.tensor.shape[t]);this.output=new s.default([],t),u.default.assign(this.output.tensor,e.tensor.transpose(...this.dims))}_createIndexMap(){if(!this.indexMap){const e=new s.default([],this.inputShape,{type:Int32Array}),t=new s.default([],this.inputShape,{type:Int32Array}),a=new s.default([],this.inputShape,{type:Int32Array});if(2===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)u.default.assigns(t.tensor.pick(e,null),e);else if(3===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)for(let a=0;a<this.inputShape[1];a++)u.default.assigns(t.tensor.pick(e,a,null),e*this.inputShape[1]+a);else if(4===this.inputShape.length)for(let e=0;e<this.inputShape[0];e++)for(let a=0;a<this.inputShape[1];a++)for(let r=0;r<this.inputShape[2];r++)u.default.assigns(t.tensor.pick(e,a,r,null),e*this.inputShape[1]*this.inputShape[2]+a*this.inputShape[2]+r);for(let e=0;e<(0,r.default)(this.inputShape);e++)u.default.assigns(a.tensor.pick(...Array(this.inputShape.length-1).fill(null),e),e);u.default.muls(e.tensor,t.tensor,(0,r.default)(this.inputShape)),u.default.addeq(e.tensor,a.tensor);const o=this.dims.map((e)=>this.inputShape[e]);this.indexMap=new s.default([],o,{type:Int32Array}),u.default.assign(this.indexMap.tensor,e.tensor.transpose(...this.dims)),2<o.length&&this.indexMap.reshapeTo2D(),this.indexMap.createGLTexture({type:'2d',format:'int'})}}_callGPU(e){if(e.glTexture?e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:this.inputShape=e.tensor.shape:(this.inputShape=e.tensor.shape,2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'}))),this._createIndexMap(),!this.output){const e=this.dims.map((e)=>this.inputShape[e]);this.output=new s.default([],e),2<e.length&&this.output.reshapeTo2D(),this.output.createGLTexture({type:'2d',format:'float'})}gS.webgl2.runProgram({program:this.mapInputProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.indexMap,name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=l});se(DP);var IP=32,AP=IP,RP=2147483647,LP=-1<<IP-1,OP=function(e){return(0<e)-(0>e)},jP=function(e){var t=e>>IP-1;return(e^t)-t},zP=function(e,t){return t^(e^t)&-(e<t)},GP=function(e,t){return e^(e^t)&-(e<t)},NP=function(e){return!(e&e-1)&&!!e},UP=function(e){var t,a;return t=(65535<e)<<4,e>>>=t,a=(255<e)<<3,e>>>=a,t|=a,a=(15<e)<<2,e>>>=a,t|=a,a=(3<e)<<1,e>>>=a,t|=a,t|e>>1},qP=function(e){return 1e9<=e?9:1e8<=e?8:1e7<=e?7:1e6<=e?6:1e5<=e?5:1e4<=e?4:1e3<=e?3:100<=e?2:10<=e?1:0},BP=function(e){return e-=1431655765&e>>>1,e=(858993459&e)+(858993459&e>>>2),16843009*(252645135&e+(e>>>4))>>>24},VP=lo,HP=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e+1},WP=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e-(e>>>1)},XP=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,e&=15,1&27030>>>e},YP=Array(256);(function(e){for(var t=0;256>t;++t){var a=t,o=t,r=7;for(a>>>=1;a;a>>>=1)o<<=1,o|=1&a,--r;e[t]=255&o<<r}})(YP);var $P=function(e){return YP[255&e]<<24|YP[255&e>>>8]<<16|YP[255&e>>>16]<<8|YP[255&e>>>24]},KP=function(e,t){return e&=65535,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t&=65535,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1},ZP=function(e,t){return e=1431655765&e>>>t,e=858993459&(e|e>>>1),e=252645135&(e|e>>>2),e=16711935&(e|e>>>4),e=65535&(e|e>>>16),e<<16>>16},QP=function(e,t,a){return e&=1023,e=4278190335&(e|e<<16),e=251719695&(e|e<<8),e=3272356035&(e|e<<4),e=1227133513&(e|e<<2),t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),e|=t<<1,a&=1023,a=4278190335&(a|a<<16),a=251719695&(a|a<<8),a=3272356035&(a|a<<4),a=1227133513&(a|a<<2),e|a<<2},JP=function(e,t){return e=1227133513&e>>>t,e=3272356035&(e|e>>>2),e=251719695&(e|e>>>4),e=4278190335&(e|e>>>8),e=1023&(e|e>>>16),e<<22>>22},ew=function(e){var a=e|e-1;return a+1|(~a&-~a)-1>>>lo(e)+1},tw={INT_BITS:AP,INT_MAX:RP,INT_MIN:LP,sign:OP,abs:jP,min:zP,max:GP,isPow2:NP,log2:UP,log10:qP,popCount:BP,countTrailingZeros:VP,nextPow2:HP,prevPow2:WP,parity:XP,reverse:$P,interleave2:KP,deinterleave2:ZP,interleave3:QP,deinterleave3:JP,nextCombination:ew},aw=go,rw=ue(function(e,t){function a(e){if(e){var t=e.length||e.byteLength,a=tw.log2(t);_[a].push(e)}}function r(e){var e=tw.nextPow2(e),t=tw.log2(e),a=_[t];return 0<a.length?a.pop():new ArrayBuffer(e)}function o(e){return new Uint8Array(r(e),0,e)}function i(e){return new Uint16Array(r(2*e),0,e)}function s(e){return new Uint32Array(r(4*e),0,e)}function u(e){return new Int8Array(r(e),0,e)}function l(e){return new Int16Array(r(2*e),0,e)}function p(e){return new Int32Array(r(4*e),0,e)}function d(e){return new Float32Array(r(4*e),0,e)}function c(e){return new Float64Array(r(8*e),0,e)}function g(e){return m?new Uint8ClampedArray(r(e),0,e):o(e)}function h(e){return new DataView(r(e),0,e)}function f(e){e=tw.nextPow2(e);var t=tw.log2(e),a=y[t];return 0<a.length?a.pop():new Buffer(e)}ji.__TYPEDARRAY_POOL||(ji.__TYPEDARRAY_POOL={UINT8:aw([32,0]),UINT16:aw([32,0]),UINT32:aw([32,0]),INT8:aw([32,0]),INT16:aw([32,0]),INT32:aw([32,0]),FLOAT:aw([32,0]),DOUBLE:aw([32,0]),DATA:aw([32,0]),UINT8C:aw([32,0]),BUFFER:aw([32,0])});var m='undefined'!=typeof Uint8ClampedArray,n=ji.__TYPEDARRAY_POOL;n.UINT8C||(n.UINT8C=aw([32,0])),n.BUFFER||(n.BUFFER=aw([32,0]));var _=n.DATA,y=n.BUFFER;t.free=function(e){if(Buffer.isBuffer(e))y[tw.log2(e.length)].push(e);else{if('[object ArrayBuffer]'!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,a=0|tw.log2(t);_[a].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){a(e.buffer)},t.freeArrayBuffer=a,t.freeBuffer=function(e){y[tw.log2(e.length)].push(e)},t.malloc=function(e,t){return void 0===t||'arraybuffer'===t?r(e):'uint8'===t?o(e):'uint16'===t?i(e):'uint32'===t?s(e):'int8'===t?u(e):'int16'===t?l(e):'int32'===t?p(e):'float'===t||'float32'===t?d(e):'double'===t||'float64'===t?c(e):'uint8_clamped'===t?g(e):'buffer'===t?f(e):'data'===t||'dataview'===t?h(e):null},t.mallocArrayBuffer=r,t.mallocUint8=o,t.mallocUint16=i,t.mallocUint32=s,t.mallocInt8=u,t.mallocInt16=l,t.mallocInt32=p,t.mallocFloat32=t.mallocFloat=d,t.mallocFloat64=t.mallocDouble=c,t.mallocUint8Clamped=g,t.mallocDataView=h,t.mallocBuffer=f,t.clearCache=function(){for(var e=0;32>e;++e)n.UINT8[e].length=0,n.UINT16[e].length=0,n.UINT32[e].length=0,n.INT8[e].length=0,n.INT16[e].length=0,n.INT32[e].length=0,n.FLOAT[e].length=0,n.DOUBLE[e].length=0,n.UINT8C[e].length=0,_[e].length=0,y[e].length=0}}),ow=ho,nw=fo,iw=mo,sw=_o,uw=yo,lw=xo,pw={clone:ow,malloc:nw,free:iw,zeros:sw,ones:uw,eye:lw},dw=vo,cw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(TT),i=a(dw);class s extends r.default{constructor(e={}){super(e),this.layerClass='RepeatVector';const{n:t=1}=e;this.n=t,this.description=`n = ${t}`,this.gpu&&(this.program=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(x, vec2(outTex.x, 0));\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){1!==e.tensor.shape.length&&this.throwError('Only 1D tensor inputs allowed.'),this.output=new o.default([],[this.n,e.tensor.shape[1]]),this.output.tensor=(0,i.default)((0,n.default)(e.tensor,0),[this.n,1])}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.output||(this.output=new o.default([],[this.n,e.glTextureShape[1]]),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=s});se(cw);var gw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Dense',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Activation',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'Dropout',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'SpatialDropout1D',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'SpatialDropout2D',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'SpatialDropout3D',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'Flatten',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'Reshape',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'Permute',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'RepeatVector',{enumerable:!0,get:function(){return c.default}});var r=a(SP),o=a(TP),n=a(PP),i=a(wP),s=a(CP),u=a(FP),l=a(kP),p=a(MP),d=a(DP),c=a(cw)});se(gw);var hw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='Embedding';const{input_dim:t=1,output_dim:a=1,input_length:r=0,mask_zero:o=!1}=e;this.description=`output dimensions: ${a}`,this.inputDim=t,this.outputDim=a,this.inputLength=r,this.maskZero=o,this.params=['embeddings'],this.gpu&&(this.program=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D embeddings;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 x_size = textureSize(x, 0);\n  ivec2 embeddings_size = textureSize(embeddings, 0);\n  int out_x = int(float(embeddings_size[0]) * outTex.x);\n  int out_y = int(float(x_size[0]) * outTex.y);\n\n  int index = int(texelFetch(x, ivec2(out_y, 0), 0).r);\n  outColor = texelFetch(embeddings, ivec2(out_x, index), 0);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.output=new o.default([],[e.tensor.shape[0],this.weights.embeddings.tensor.shape[1]]);for(let t=0,a=e.tensor.shape[0];t<a;t++)n.default.assign(this.output.tensor.pick(t,null),this.weights.embeddings.tensor.pick(e.tensor.get(t),null))}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.output||(this.output=new o.default([],[e.glTextureShape[1],this.weights.embeddings.glTextureShape[1]]),this.output.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:e,name:'x'},{input:this.weights.embeddings,name:'embeddings'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});se(hw);var fw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Embedding',{enumerable:!0,get:function(){return a.default}});var a=function(e){return e&&e.__esModule?e:{default:e}}(hw)});se(fw);var mw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(vS),o=a(Ox),n=a(hS),i=a(IS);class s extends n.default{constructor(e={}){super(e),this.layerClass='_Merge',this.isMergeLayer=!0}call(e){if(this.gpu)this._callGPU(e);else{const t=this._validateInputs(e);t||this.throwError('Invalid inputs to call method.'),this._callCPU(e)}return this.output}_validateInputs(e){const t=e.map((e)=>e.tensor.shape.slice());if(-1<['sum','diff','mul','ave','max','min'].indexOf(this.mode)&&!t.every((e)=>(0,o.default)(e,t[0]))&&this.throwError(`All input shapes must be the same for mode ${this.mode}.`),'dot'===this.mode)2!==e.length&&this.throwError(`Exactly 2 inputs required for mode ${this.mode}.`),0>this.dotAxes[0]&&(this.dotAxes[0]=t[0].length+this.dotAxes[0]),0>this.dotAxes[1]&&(this.dotAxes[1]=t[1].length+this.dotAxes[1]),t[0][this.dotAxes[0]]!==t[1][this.dotAxes[1]]&&this.throwError('Dimensions incompatibility using dot mode.');else if('concat'===this.mode){let e=t.slice(),a=0>this.concatAxis?e[0].length+this.concatAxis:this.concatAxis;0===this.concatAxis&&(a=0),(0,r.default)(e.length).forEach((t)=>{e[t].splice(a,1)}),e.every((t)=>(0,o.default)(t,e[0]))||this.throwError('In concat mode, all shapes must be the same except along the concat axis.')}return!0}_callCPU(){}_callGPU(e){e.forEach((e)=>{e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})}),this.output||(this.output=new i.default([],e[0].glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e[0].is1D?this.output.is1D=e[0].is1D:(e[0].is2DReshaped||e[0].is2DSquareReshaped)&&(e[0].is2DReshaped?this.output.is2DReshaped=e[0].is2DReshaped:e[0].is2DSquareReshaped&&(this.output.is2DSquareReshaped=e[0].is2DSquareReshaped),this.output.originalShape=e[0].originalShape.slice(),this.output.indicesForReshaped=e[0].indicesForReshaped)),gS.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:e.map((e,t)=>({input:e,name:`inputs[${t}]`})),supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=s});se(mw);var _w=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(mw),o=a(IS),n=a(mT),s=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='Add',this.mode='sum'}_callCPU(e){const t=e[0].tensor.shape.slice();this.output=new o.default([],t);for(let t=0;t<e.length;t++)s.default.addeq(this.output.tensor,e[t].tensor)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('add',e.length,t);this.mergeProgram=gS.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=i});se(_w);var yw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(mw),o=a(IS),n=a(mT),i=a(ES);class s extends r.default{constructor(e={}){super(e),this.layerClass='Subtract',this.mode='diff'}_callCPU(e){2!==e.length&&this.throwError('Inputs should be an array of 2 Tensors.');const t=e[0].tensor.shape.slice();this.output=new o.default([],t),i.default.sub(this.output.tensor,e[0].tensor,e[1].tensor)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('subtract',e.length,t);this.mergeProgram=gS.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=s});se(yw);var xw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(mw),o=a(IS),n=a(mT),s=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='Multiply',this.mode='mul'}_callCPU(e){const t=e[0].tensor.shape.slice();this.output=new o.default([],t),s.default.assigns(this.output.tensor,1);for(let t=0;t<e.length;t++)s.default.muleq(this.output.tensor,e[t].tensor)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('multiply',e.length,t);this.mergeProgram=gS.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=i});se(xw);var vw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(mw),o=a(IS),n=a(mT),s=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='Average',this.mode='ave'}_callCPU(e){const t=e[0].tensor.shape.slice();this.output=new o.default([],t);for(let t=0;t<e.length;t++)s.default.addeq(this.output.tensor,e[t].tensor);s.default.divseq(this.output.tensor,e.length)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('average',e.length,t);this.mergeProgram=gS.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=i});se(vw);var bw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(mw),o=a(IS),n=a(mT),s=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='Maximum',this.mode='max'}_callCPU(e){const t=e[0].tensor.shape.slice();this.output=new o.default([],t),s.default.assign(this.output.tensor,e[0].tensor);for(let t=1;t<e.length;t++)s.default.maxeq(this.output.tensor,e[t].tensor)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('maximum',e.length,t);this.mergeProgram=gS.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=i});se(bw);var Sw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(mw),o=a(IS),n=a(mT),s=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='Minimum',this.mode='min'}_callCPU(e){const t=e[0].tensor.shape.slice();this.output=new o.default([],t),s.default.assign(this.output.tensor,e[0].tensor);for(let t=1;t<e.length;t++)s.default.mineq(this.output.tensor,e[t].tensor)}_callGPU(e){if(!this.mergeProgram){const t=e[0].glTextureFragments?e[0].glTextureFragmentShape:e[0].glTextureShape,a=(0,n.default)('minimum',e.length,t);this.mergeProgram=gS.webgl2.compileProgram(a)}super._callGPU(e)}}t.default=i});se(Sw);var Tw=bo,Pw=So,ww={dtype:'double'},Cw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(sT),o=a(mw),n=a(IS),i=a(mT),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(MS),u=a(Pw);class l extends o.default{constructor(e={}){super(e),this.layerClass='Concatenate',this.mode='concat';const{axis:t=-1}=e;this.concatAxis=0>=t?t:t-1}_callCPU(e){const t=e[0].tensor.shape.slice(),a=0>this.concatAxis?t.length+this.concatAxis:this.concatAxis;if(e.slice(1,e.length).forEach((e)=>{const r=e.tensor.shape.slice()[a];t[a]+=r}),this.output=new n.default([],t),0===a)(0,u.default)(this.output.tensor,e.map((e)=>e.tensor));else{let t=[a];for(let r=0;r<e[0].tensor.shape.length;r++)r!==a&&t.push(r);(0,u.default)(this.output.tensor.transpose(...t),e.map((e)=>e.tensor.transpose(...t)))}}_callGPU(e){e.forEach((e)=>{e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})});const t=e[0].glTextureShape.slice();let a=1;if(e[0].is2DReshaped?-1===this.concatAxis||this.concatAxis===e[0].originalShape.length-1?a=1:this.throwError('specified axis not supported for now.'):-1===this.concatAxis||1===this.concatAxis?a=1:-2===this.concatAxis||0===this.concatAxis?a=0:this.throwError('specified axis not supported for now.'),t[a]=(0,r.default)(e.map((e)=>e.glTextureShape[a])),!this.output)if(this.output=new n.default([],t),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:1==a}),e[0].is1D)this.output.is1D=e[0].is1D;else if(e[0].is2DReshaped){this.output.is2DReshaped=e[0].is2DReshaped,this.output.originalShape=e[0].originalShape.slice();const t=0>this.concatAxis?this.output.originalShape.length+this.concatAxis:this.concatAxis;this.output.originalShape[t]=(0,r.default)(e.map((e)=>e.originalShape[t])),this.output.indicesForReshaped=s.createIndicesFor2DReshaped(this.output.originalShape,!1,t)}if(!this.mergeProgram){const t=this.output.glTextureFragments?this.output.glTextureFragmentShape:this.output.glTextureShape,r=(0,i.default)('concatenate',e.length,e.map((e)=>e.glTextureShape),t,a);this.mergeProgram=gS.webgl2.compileProgram(r)}gS.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:e.map((e,t)=>({input:e,name:`inputs[${t}]`})),supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=l});se(Cw);var Fw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(mw),o=a(IS),n=a(xT),s=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='Dot',this.mode='dot';const{axes:t=-1,normalize:a=!1}=e;this.dotAxes=Array.isArray(t)?[0>=t[0]?t[0]:t[0]-1,0>=t[1]?t[1]:t[1]-1]:[0>=t?t:t-1,0>=t?t:t-1],this.normalize=a,this.gpu&&(this.mergeProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D input1;\nuniform sampler2D input2;\nuniform int rows;\nuniform int cols;\nuniform int dotAxis1;\nuniform int dotAxis2;\nuniform int commonDim;\nuniform bool normalize;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(cols) * outTex.x);\n  int out_y = int(float(rows) * outTex.y);\n\n  float sum = 0.;\n  float a = 0.;\n  float b = 0.;\n  float norm1 = 0.;\n  float norm2 = 0.;\n\n  for (int i = 0; i < commonDim; ++i) {\n    if (dotAxis1 == 0 && dotAxis2 == 0) {\n      a = texelFetch(input1, ivec2(out_y, i), 0).r;\n      b = texelFetch(input2, ivec2(out_x, i), 0).r;\n    } else if (dotAxis1 == 1 && dotAxis2 == 1) {\n      a = texelFetch(input1, ivec2(i, out_y), 0).r;\n      b = texelFetch(input2, ivec2(i, out_x), 0).r;\n    }\n\n    sum += a * b;\n\n    if (normalize) {\n      norm1 += a * a;\n      norm2 += b * b;\n    }\n  }\n\n  if (normalize) {\n    sum /= sqrt(norm1) * sqrt(norm2);\n  }\n\n  outColor = vec4(sum);\n}\n'))}_calcOutputShape(e){let t=e[0].slice(),a=e[1].slice();t.splice(this.dotAxes[0],1),a.splice(this.dotAxes[1],1),this.outputShape=t.concat(a),1===this.outputShape.length&&this.outputShape.push(1)}_callCPU(e){if(this._calcOutputShape([e[0].tensor.shape,e[1].tensor.shape]),this.output=new o.default([],this.outputShape),2!==e[0].tensor.shape.length||2!==e[1].tensor.shape.length)this.throwError('dot mode for 3+ dim tensors not yet implemented.');else if(0===this.dotAxes[0]&&0===this.dotAxes[1]){if(this.normalize){for(let t=0;t<e[0].tensor.shape[1];t++)s.default.divseq(e[0].tensor.pick(null,t),s.default.norm2(e[0].tensor.pick(null,t)));for(let t=0;t<e[1].tensor.shape[1];t++)s.default.divseq(e[1].tensor.pick(null,t),s.default.norm2(e[1].tensor.pick(null,t)))}(0,n.default)(this.output.tensor,e[0].tensor.transpose(1,0),e[1].tensor)}else if(1===this.dotAxes[0]&&1===this.dotAxes[1]){if(this.normalize){for(let t=0;t<e[0].tensor.shape[0];t++)s.default.divseq(e[0].tensor.pick(t,null),s.default.norm2(e[0].tensor.pick(t,null)));for(let t=0;t<e[1].tensor.shape[0];t++)s.default.divseq(e[1].tensor.pick(t,null),s.default.norm2(e[1].tensor.pick(t,null)))}(0,n.default)(this.output.tensor,e[0].tensor,e[1].tensor.transpose(1,0))}}_callGPU(e){e.forEach((e)=>{e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float'})}),this._calcOutputShape([e[0].glTextureShape,e[1].glTextureShape]),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'}));const t=e[0].glTextureShape[this.dotAxes[0]];gS.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:[{input:e[0],name:'input1'},{input:e[1],name:'input2'}],uniforms:[{value:this.output.glTextureShape[0],type:'int',name:'rows'},{value:this.output.glTextureShape[1],type:'int',name:'cols'},{value:this.dotAxes[0],type:'int',name:'dotAxis1'},{value:this.dotAxes[1],type:'int',name:'dotAxis2'},{value:t,type:'int',name:'commonDim'},{value:+this.normalize,type:'bool',name:'normalize'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});se(Fw);var kw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Add',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Subtract',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'Multiply',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'Average',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'Maximum',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'Minimum',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'Concatenate',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'Dot',{enumerable:!0,get:function(){return p.default}});var r=a(_w),o=a(yw),n=a(xw),i=a(vw),s=a(bw),u=a(Sw),l=a(Cw),p=a(Fw)});se(kw);var Ew=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hS);class r extends a.default{constructor(e={}){super(e),this.layerClass='GaussianDropout';const{rate:t=0.5}=e;this.rate=vn(bn(0,t),1)}call(e){return this.output=e,this.output}}t.default=r});se(Ew);var Mw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(hS);class r extends a.default{constructor(e={}){super(e),this.layerClass='GaussianNoise';const{stddev:t=0}=e;this.stddev=t}call(e){return this.output=e,this.output}}t.default=r});se(Mw);var Dw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'GaussianDropout',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'GaussianNoise',{enumerable:!0,get:function(){return o.default}});var r=a(Ew),o=a(Mw)});se(Dw);var Iw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='BatchNormalization';const{epsilon:t=1e-3,axis:a=-1,center:r=!0,scale:o=!0}=e;this.epsilon=t,this.center=r,this.scale=o,this.axis=a,this.axisNormalized=!1,this.params=[],this.scale&&this.params.push('gamma'),this.center&&this.params.push('beta'),this.params=this.params.concat(['moving_mean','moving_variance']),this.gpu&&(this.program=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D X;\nuniform isampler2D normAxisIndexMap;\nuniform sampler2D gamma;\nuniform sampler2D beta;\nuniform sampler2D mean;\nuniform sampler2D std;\nuniform float epsilon;\nuniform bool scale;\nuniform bool center;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(X, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\nint normAxisIndex = texelFetch(normAxisIndexMap, ivec2(out_x, out_y), 0).r;\n\n  float _x = texelFetch(X, ivec2(out_x, out_y), 0).r;\n  float _mean = texelFetch(mean, ivec2(normAxisIndex, 0), 0).r;\n  float _std = texelFetch(std, ivec2(normAxisIndex, 0), 0).r;\n\n  float _gamma = 1.0;\n  if (scale) {\n    _gamma = texelFetch(gamma, ivec2(normAxisIndex, 0), 0).r;\n  }\n\n  float _beta = 0.0;\n  if (center) {\n    _beta = texelFetch(beta, ivec2(normAxisIndex, 0), 0).r;\n  }\n\n  float sum = _beta + _gamma * (_x - _mean) / sqrt(_std + epsilon);\n\n  outColor = vec4(sum);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.axisNormalized||(this.axis=0>this.axis?e.tensor.shape.length+this.axis:this.axis-1,this.axisNormalized=!0);let t=[];for(let a=0;a<e.tensor.shape.length;a++)a===this.axis?t.push(1):t.push(null);let a=new o.default([],e.tensor.shape),r=new o.default([],e.tensor.shape);for(let o=0;o<e.tensor.shape[this.axis];o++)t[this.axis]=o,this.scale&&n.default.assigns(a.tensor.pick(...t),this.weights.gamma.tensor.get(o)),this.center&&n.default.assigns(r.tensor.pick(...t),this.weights.beta.tensor.get(o));let s=new o.default([],e.tensor.shape),u=new o.default([],e.tensor.shape);for(let a=0;a<e.tensor.shape[this.axis];a++)t[this.axis]=a,n.default.assigns(s.tensor.pick(...t),this.weights.moving_mean.tensor.get(a)),n.default.assigns(u.tensor.pick(...t),this.weights.moving_variance.tensor.get(a)+this.epsilon);n.default.sqrteq(u.tensor),this.output=new o.default(e.tensor.data,e.tensor.shape),n.default.subeq(this.output.tensor,s.tensor),n.default.diveq(this.output.tensor,u.tensor),this.scale&&n.default.muleq(this.output.tensor,a.tensor),this.center&&n.default.addeq(this.output.tensor,r.tensor)}_createIndexMap(e,t){if(!this.normAxisIndexMap){const a=new o.default([],this.inputShape,{type:Int32Array});this.normAxisIndexMap=new o.default([],e,{type:Int32Array});const r=Array(this.inputShape.length).fill(null);for(let e=0;e<this.inputShape[this.axis];e++)r[this.axis]=e,n.default.assigns(a.tensor.pick(...r),e);if(t)for(let e=0;e<t.data.length;e++)this.normAxisIndexMap.tensor.data[t.data[e]]=a.tensor.data[e];else this.normAxisIndexMap=a;this.normAxisIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}}_callGPU(e){this.axisNormalized||(this.inputShape=e.is2DReshaped||e.is2DSquareReshaped?e.originalShape:e.tensor.shape,this.axis=0>this.axis?this.inputShape.length+this.axis:this.axis-1,this.axisNormalized=!0),e.glTexture||e.glTextureFragments||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}))),this._createIndexMap(e.glTextureShape,e.indicesForReshaped),this.output||(this.output=new o.default([],e.glTextureShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),e.is1D?this.output.is1D=e.is1D:(e.is2DReshaped||e.is2DSquareReshaped)&&(e.is2DReshaped?this.output.is2DReshaped=e.is2DReshaped:e.is2DSquareReshaped&&(this.output.is2DSquareReshaped=e.is2DSquareReshaped),this.output.originalShape=e.originalShape,this.output.indicesForReshaped=e.indicesForReshaped));const t=[{input:e,name:'X'},{input:this.normAxisIndexMap,name:'normAxisIndexMap'}];this.scale&&t.push({input:this.weights.gamma,name:'gamma'}),this.center&&t.push({input:this.weights.beta,name:'beta'}),t.push({input:this.weights.moving_mean,name:'mean'}),t.push({input:this.weights.moving_variance,name:'std'});const a=[{value:this.epsilon,type:'float',name:'epsilon'},{value:+this.scale,type:'bool',name:'scale'},{value:+this.center,type:'bool',name:'center'}];gS.webgl2.runProgram({program:this.program,output:this.output,inputs:t,uniforms:a,supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=i});se(Iw);var Aw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'BatchNormalization',{enumerable:!0,get:function(){return a.default}});var a=function(e){return e&&e.__esModule?e:{default:e}}(Iw)});se(Aw);var Rw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='_Pooling1D';const{pool_size:t=2,strides:a=null,padding:r='valid'}=e;this.poolSize=t,this.strides=null===a?this.poolSize:a,this.padding=r,this.poolingFunc='max',this.description=`pool size ${this.poolSize}`,this.description+=1<this.strides?`, striding ${this.strides} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.gpu&&(this.poolingProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(textureSize(poolIndexMap, 0)[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    if (poolIndex != -1) {\n      float val2 = texelFetch(x, ivec2(out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'),this.poolingFragmentsProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(poolIndexMap, 0);\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    int fragmentIndex = int(floor(float(poolIndex) / float(inputSize[1])));\n    if (poolIndex != -1) {\n      poolIndex = int(mod(float(poolIndex), float(inputSize[1])));\n      float val2 = texelFetch(x, ivec2(fragmentIndex * channels + out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t='valid'===this.padding?_n((e.tensor.shape[0]-this.poolSize+this.strides)/this.strides):_n((e.tensor.shape[0]+this.strides-1)/this.strides);this.output=new o.default([],[t,e.tensor.shape[1]]);const a=new o.default([],[e.tensor.shape[1]]);let r='valid'===this.padding?0:vn(0,yn((e.tensor.shape[0]-(t-1)*this.strides-this.poolSize)/2));for(let o=0;o<t;o++){let t=bn(0,r),i=this.poolSize+vn(0,r);n.default.assign(a.tensor,e.tensor.pick(t,null));let s=1;for(let r=1;r<i&&!(t+r>e.tensor.shape[0]-1);r++)'max'===this.poolingFunc?n.default.maxeq(a.tensor,e.tensor.pick(t+r,null)):'average'===this.poolingFunc&&n.default.addeq(a.tensor,e.tensor.pick(t+r,null)),s+=1;'average'===this.poolingFunc&&n.default.divseq(a.tensor,s),n.default.assign(this.output.tensor.pick(o,null),a.tensor),r+=this.strides}}_createIndexMap(){if(this.poolIndexMap)return;const e='valid'===this.padding?_n((this.inputShape[0]-this.poolSize+this.strides)/this.strides):_n((this.inputShape[0]+this.strides-1)/this.strides);this.outputShape=[e,this.inputShape[1]],this.poolIndexMap=new o.default([],[e,this.poolSize],{type:Int32Array}),n.default.assigns(this.poolIndexMap.tensor,-1);let t='valid'===this.padding?0:vn(0,yn((this.inputShape[0]-(e-1)*this.strides-this.poolSize)/2));for(let a=0;a<e;a++){let e=bn(0,t),r=this.poolSize+vn(0,t),o=e;this.poolIndexMap.tensor.set(a,0,o);for(let t=1;t<r&&(o=e+t,o<=this.inputShape[0]-1);t++)this.poolIndexMap.tensor.set(a,t,o);t+=this.strides}this.poolIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_callGPU(e){e.glTexture||e.glTextureFragments||e.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.inputShape=e.tensor.shape,this._createIndexMap(),this.output||(this.output=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}));const t='max'===this.poolingFunc,a=[{value:this.output.glTextureShape[1],type:'int',name:'channels'},{value:this.poolSize,type:'int',name:'poolSize'},{value:+t,type:'bool',name:'isMaxPooling'}];e.glTextureFragments?(e.convert2DRowFragmentedGLTextureToColStack(),gS.webgl2.runProgram({program:this.poolingFragmentsProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:a,supportsTextureFragments:!0}),e.removeGLTextureFragmentsAsColStack()):gS.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:a,supportsTextureFragments:!0}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});se(Rw);var Lw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Rw);class r extends a.default{constructor(e={}){super(e),this.layerClass='MaxPooling1D',this.poolingFunc='max'}}t.default=r});se(Lw);var Ow=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(MS),s=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='_Pooling2D';const{pool_size:t=[2,2],strides:a=null,padding:r='valid',data_format:o='channels_last'}=e;this.poolSize=Array.isArray(t)?t:[t,t],this.strides=Array.isArray(a)?a:null===a?this.poolSize:[a,a],this.padding=r,this.dataFormat=o,this.poolingFunc='max',this.description=`pool size ${this.poolSize.join('x')}`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.gpu&&(this.poolingProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(textureSize(poolIndexMap, 0)[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    if (poolIndex != -1) {\n      float val2 = texelFetch(x, ivec2(out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'),this.poolingFragmentsProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(poolIndexMap, 0);\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    int fragmentIndex = int(floor(float(poolIndex) / float(inputSize[1])));\n    if (poolIndex != -1) {\n      poolIndex = int(mod(float(poolIndex), float(inputSize[1])));\n      float val2 = texelFetch(x, ivec2(fragmentIndex * channels + out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_calcOutputShape(e){if(!(this.outputShape&&this.inputPadding)){const[t,a,r]=e,[o,n]=this.poolSize,i='same'===this.padding?_n((t+this.strides[0]-1)/this.strides[0]):_n((t-o+this.strides[0])/this.strides[0]),s='same'===this.padding?_n((a+this.strides[1]-1)/this.strides[1]):_n((a-n+this.strides[1])/this.strides[1]),u='same'===this.padding?bn(0,_n((i-1)*this.strides[0]+o-t)):0,l='same'===this.padding?bn(0,_n((s-1)*this.strides[1]+n-a)):0,p=_n(u/2),d=_n(l/2);this.outputShape=[i,s,r],this.inputPadding=[p,u-p,d,l-d]}}_padInput(e){if('same'===this.padding){const[t,a,r]=e.tensor.shape,[n,i,u,l]=this.inputPadding,p=new o.default([],[t+n+i,a+u+l,r]);return'max'===this.poolingFunc&&s.default.assigns(p.tensor,Number.NEGATIVE_INFINITY),s.default.assign(p.tensor.hi(t+n,a+u,r).lo(n,u,0),e.tensor),p}return e}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this._calcOutputShape(e.tensor.shape),e=this._padInput(e);const[t,a,r]=e.tensor.shape,[n,u]=this.poolSize;this.output=new o.default([],this.outputShape);const l=new o.default([],[n,u,r]),[p,d,c,g]=this.inputPadding;for(let o=0,i=0,h;o<=t-n;o+=this.strides[0],i++){h=0,o<p?h=p-o:o+n>t-d&&(h=o+n-(t-d));for(let t=0,p=0,d;t<=a-u;t+=this.strides[1],p++){d=0,t<c?d=c-t:t+u>a-g&&(d=t+u-(a-g));const f=(n-h)*(u-d);s.default.assign(l.tensor,e.tensor.hi(o+n,t+u,r).lo(o,t,0));for(let e=0;e<r;e++)'max'===this.poolingFunc?this.output.tensor.set(i,p,e,s.default.sup(l.tensor.pick(null,null,e))):'average'===this.poolingFunc&&this.output.tensor.set(i,p,e,s.default.sum(l.tensor.pick(null,null,e))/f)}}'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1))}_im2col(e){const[t,a,r]=e.tensor.shape;this.tiledInput||(this.tiledInput=new o.default([],[t*a,r]));const n=new o.default([],[t,a]),i=new o.default([],[t*a]);for(let t=0;t<r;t++)s.default.assign(n.tensor,e.tensor.pick(null,null,t)),i.replaceTensorData(n.tensor.data),s.default.assign(this.tiledInput.tensor.pick(null,t),i.tensor);return this.tiledInput}_createIndexMap(){if(this.poolIndexMap)return;let e=this.inputShape[0],t=this.inputShape[1];const a=new o.default([],[e,t]);let r=0;for(let o=0;o<e;o++)for(let e=0;e<t;e++)a.tensor.set(o,e,r),r+=1;if('same'===this.padding){const[r,n,i,u]=this.inputPadding;e=e+r+n,t=t+i+u;const l=new o.default([],[e,t]);s.default.assigns(l.tensor,-1),s.default.assign(l.tensor.hi(this.inputShape[0]+r,this.inputShape[1]+i).lo(r,i),a.tensor),a.tensor=l.tensor}const[n,u]=this.poolSize,i=this.outputShape[0],l=this.outputShape[1];this.poolIndexMap=new o.default([],[i*l,n*u],{type:Int32Array});const p=new o.default([],[n,u]);let d=0;for(let r=0,o=e-n;r<=o;r+=this.strides[0])for(let e=0,o=t-u;e<=o;e+=this.strides[1])s.default.assign(p.tensor,a.tensor.hi(r+n,e+u).lo(r,e)),this.poolIndexMap.tensor.data.set(p.tensor.data,d),d+=n*u;this.poolIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_callGPU(e){if(e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,this._im2col(e),this.tiledInput.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})),this._calcOutputShape(this.inputShape),this._createIndexMap(),!this.output){const[e,t,a]=this.outputShape;this.output=new o.default([],[e*t,a]),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=n.createIndicesFor2DReshaped(this.outputShape,!1,-1)}const t=e.is2DReshaped||e.is2DSquareReshaped?e:this.tiledInput,a=this.poolSize[0]*this.poolSize[1],r='max'===this.poolingFunc,i=[{value:this.output.glTextureShape[1],type:'int',name:'channels'},{value:a,type:'int',name:'poolSize'},{value:+r,type:'bool',name:'isMaxPooling'}];t.glTextureFragments?(t.convert2DRowFragmentedGLTextureToColStack(),gS.webgl2.runProgram({program:this.poolingFragmentsProgram,output:this.output,inputs:[{input:t,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:i,supportsTextureFragments:!0}),t.removeGLTextureFragmentsAsColStack()):gS.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:t,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:i,supportsTextureFragments:!0}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(2,0,1)))}}t.default=i});se(Ow);var jw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Ow);class r extends a.default{constructor(e={}){super(e),this.layerClass='MaxPooling2D',this.poolingFunc='max'}}t.default=r});se(jw);var zw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(MS),s=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='_Pooling3D';const{pool_size:t=[2,2,2],strides:a=null,padding:r='valid',data_format:o='channels_last'}=e;this.poolSize=Array.isArray(t)?t:[t,t,t],this.strides=Array.isArray(a)?a:null===a?this.poolSize:[a,a,a],this.padding=r,this.dataFormat=o,this.poolingFunc='max',this.description=`pool size ${this.poolSize.join('x')}`,this.description+=this.strides.some((e)=>1<e)?`, ${this.strides.join('x')} striding`:'',this.description+='valid'===this.padding?`, no border padding`:', pad to same borders',this.gpu&&(this.poolingProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(textureSize(poolIndexMap, 0)[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    if (poolIndex != -1) {\n      float val2 = texelFetch(x, ivec2(out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'),this.poolingFragmentsProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D poolIndexMap;\nuniform int channels;\nuniform int poolSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 inputSize = textureSize(x, 0);\n  ivec2 outputSize = textureSize(poolIndexMap, 0);\n  int out_x = int(float(channels) * outTex.x);\n  int out_y = int(float(outputSize[1]) * outTex.y);\n\n  float val = 0.;\n  int count = 0;\n  for (int i = 0; i < poolSize; ++i) {\n    int poolIndex = texelFetch(poolIndexMap, ivec2(i, out_y), 0).r;\n    int fragmentIndex = int(floor(float(poolIndex) / float(inputSize[1])));\n    if (poolIndex != -1) {\n      poolIndex = int(mod(float(poolIndex), float(inputSize[1])));\n      float val2 = texelFetch(x, ivec2(fragmentIndex * channels + out_x, poolIndex), 0).r;\n      if (isMaxPooling) {\n        if (count == 0 || val2 > val) {\n          val = val2;\n        }\n      } else {\n        val += val2;\n      }\n      count += 1;\n    }\n  }\n\n  if (!isMaxPooling) {\n    val /= float(count);\n  }\n\n  outColor = vec4(val);\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_calcOutputShape(e){if(!(this.outputShape&&this.inputPadding)){const[t,a,r,o]=e,[n,i,s]=this.poolSize,u='same'===this.padding?_n((t+this.strides[0]-1)/this.strides[0]):_n((t-n+this.strides[0])/this.strides[0]),l='same'===this.padding?_n((a+this.strides[1]-1)/this.strides[1]):_n((a-i+this.strides[1])/this.strides[1]),p='same'===this.padding?_n((r+this.strides[2]-1)/this.strides[2]):_n((r-s+this.strides[2])/this.strides[2]),d='same'===this.padding?bn(0,_n((u-1)*this.strides[0]+n-t)):0,c='same'===this.padding?bn(0,_n((l-1)*this.strides[1]+i-a)):0,g='same'===this.padding?bn(0,_n((p-1)*this.strides[2]+s-r)):0,h=_n(d/2),f=_n(c/2),m=_n(g/2);this.outputShape=[u,l,p,o],this.inputPadding=[h,d-h,f,c-f,m,g-m]}}_padInput(e){if('same'===this.padding){const[t,a,r,n]=e.tensor.shape,[i,u,l,p,d,c]=this.inputPadding,g=new o.default([],[t+i+u,a+l+p,r+d+c,n]);return'max'===this.poolingFunc&&s.default.assigns(g.tensor,Number.NEGATIVE_INFINITY),s.default.assign(g.tensor.hi(t+i,a+l,r+d,n).lo(i,l,d,0),e.tensor),g}return e}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this._calcOutputShape(e.tensor.shape),e=this._padInput(e);const[t,a,r,n]=e.tensor.shape,[u,l,p]=this.poolSize;this.output=new o.default([],this.outputShape);let d=new o.default([],[u,l,p,n]);const[c,g,h,f,m,_]=this.inputPadding;for(let o=0,i=0,y;o<=t-u;o+=this.strides[0],i++){y=0,o<c?y=c-o:o+u>t-g&&(y=o+u-(t-g));for(let t=0,g=0,c;t<=a-l;t+=this.strides[1],g++){c=0,t<h?c=h-t:t+l>a-f&&(c=t+l-(a-f));for(let a=0,h=0,f;a<=r-p;a+=this.strides[2],h++){f=0,a<m?f=m-a:a+p>r-_&&(f=a+p-(r-_));const x=(u-y)*(l-c)*(p-f);s.default.assign(d.tensor,e.tensor.hi(o+u,t+l,a+p,n).lo(o,t,a,0));for(let e=0;e<n;e++)'max'===this.poolingFunc?this.output.tensor.set(i,g,h,e,s.default.sup(d.tensor.pick(null,null,null,e))):'average'===this.poolingFunc&&this.output.tensor.set(i,g,h,e,s.default.sum(d.tensor.pick(null,null,null,e))/x)}}}'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2))}_vol2col(e){const[t,a,r,n]=e.tensor.shape;this.tiledInput||(this.tiledInput=new o.default([],[t*a*r,n]));const i=new o.default([],[t,a,r]),u=new o.default([],[t*a*r]);for(let t=0;t<n;t++)s.default.assign(i.tensor,e.tensor.pick(null,null,null,t)),u.replaceTensorData(i.tensor.data),s.default.assign(this.tiledInput.tensor.pick(null,t),u.tensor);return this.tiledInput}_createIndexMap(){if(this.poolIndexMap)return;let e=this.inputShape[0],t=this.inputShape[1],a=this.inputShape[2];const r=new o.default([],[e,t,a]);let n=0;for(let o=0;o<e;o++)for(let e=0;e<t;e++)for(let t=0;t<a;t++)r.tensor.set(o,e,t,n),n+=1;if('same'===this.padding){const[n,i,u,l,p,d]=this.inputPadding;e=e+n+i,t=t+u+l,a=a+p+d;const c=new o.default([],[e,t,a]);s.default.assigns(c.tensor,-1),s.default.assign(c.tensor.hi(this.inputShape[0]+n,this.inputShape[1]+u,this.inputShape[2]+p).lo(n,u,p),r.tensor),r.tensor=c.tensor}const[u,l,p]=this.poolSize,i=this.outputShape[0],d=this.outputShape[1],c=this.outputShape[2];this.poolIndexMap=new o.default([],[i*d*c,u*l*p],{type:Int32Array});const g=new o.default([],[u,l,p]);let h=0;for(let o=0,n=e-u;o<=n;o+=this.strides[0])for(let e=0,n=t-l;e<=n;e+=this.strides[1])for(let t=0,n=a-p;t<=n;t+=this.strides[2])s.default.assign(g.tensor,r.tensor.hi(o+u,e+l,t+p).lo(o,e,t)),this.poolIndexMap.tensor.data.set(g.tensor.data,h),h+=u*l*p;this.poolIndexMap.createGLTexture({type:'2d',format:'int',supportsTextureFragments:!0})}_callGPU(e){if(e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,this._vol2col(e),this.tiledInput.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0})),this._calcOutputShape(this.inputShape),this._createIndexMap(),!this.output){const[e,t,a,r]=this.outputShape;this.output=new o.default([],[e*t*a,r]),this.output.createGLTexture({type:'2d',format:'float',supportsTextureFragments:!0}),this.output.is2DReshaped=!0,this.output.originalShape=this.outputShape,this.output.indicesForReshaped=n.createIndicesFor2DReshaped(this.outputShape,!1,-1)}const t=e.is2DReshaped||e.is2DSquareReshaped?e:this.tiledInput,a=this.poolSize[0]*this.poolSize[1]*this.poolSize[2],r='max'===this.poolingFunc,i=[{value:this.output.glTextureShape[1],type:'int',name:'channels'},{value:a,type:'int',name:'poolSize'},{value:+r,type:'bool',name:'isMaxPooling'}];t.glTextureFragments?(t.convert2DRowFragmentedGLTextureToColStack(),gS.webgl2.runProgram({program:this.poolingFragmentsProgram,output:this.output,inputs:[{input:t,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:i,supportsTextureFragments:!0}),t.removeGLTextureFragmentsAsColStack()):gS.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:t,name:'x'},{input:this.poolIndexMap,name:'poolIndexMap'}],uniforms:i}),0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.reshapeFrom2D(),'channels_first'===this.dataFormat&&(this.output.tensor=this.output.tensor.transpose(3,0,1,2)))}}t.default=i});se(zw);var Gw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(zw);class r extends a.default{constructor(e={}){super(e),this.layerClass='MaxPooling3D',this.poolingFunc='max'}}t.default=r});se(Gw);var Nw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Rw);class r extends a.default{constructor(e={}){super(e),this.layerClass='AveragePooling1D',this.poolingFunc='average'}}t.default=r});se(Nw);var Uw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Ow);class r extends a.default{constructor(e={}){super(e),this.layerClass='AveragePooling2D',this.poolingFunc='average'}}t.default=r});se(Uw);var qw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(zw);class r extends a.default{constructor(e={}){super(e),this.layerClass='AveragePooling3D',this.poolingFunc='average'}}t.default=r});se(qw);var Bw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='_GlobalPooling1D';const{data_format:t='channels_last'}=e;this.dataFormat=t,this.poolingFunc='max',this.gpu&&(this.poolingProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int channelDataSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (isMaxPooling) {\n    // GlobalMaxPooling\n    float maxval = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      if (j == 0 || val > maxval) {\n        maxval = val;\n      }\n    }\n    outColor = vec4(maxval);\n  } else {\n    // GlobalAveragePooling\n    float sum = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      sum += val;\n    }\n    outColor = vec4(sum / float(channelDataSize));\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const[t,a]=e.tensor.shape;this.output=new o.default([],[a]);for(let r=0;r<a;r++)'max'===this.poolingFunc?this.output.tensor.set(r,n.default.sup(e.tensor.pick(null,r))):'average'===this.poolingFunc&&this.output.tensor.set(r,n.default.sum(e.tensor.pick(null,r))/t)}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputShape=e.tensor.shape,this.output||(this.output=new o.default([],[this.inputShape[1]]),this.output.createGLTexture({type:'2d',format:'float'}));const t='max'===this.poolingFunc;gS.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.inputShape[0],type:'int',name:'channelDataSize'},{value:+t,type:'bool',name:'isMaxPooling'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});se(Bw);var Vw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Bw);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalMaxPooling1D',this.poolingFunc='max'}}t.default=r});se(Vw);var Hw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='_GlobalPooling2D';const{data_format:t='channels_last'}=e;this.dataFormat=t,this.poolingFunc='max',this.gpu&&(this.poolingProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int channelDataSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (isMaxPooling) {\n    // GlobalMaxPooling\n    float maxval = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      if (j == 0 || val > maxval) {\n        maxval = val;\n      }\n    }\n    outColor = vec4(maxval);\n  } else {\n    // GlobalAveragePooling\n    float sum = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      sum += val;\n    }\n    outColor = vec4(sum / float(channelDataSize));\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0));const[t,a,r]=e.tensor.shape;this.output=new o.default([],[r]);for(let o=0;o<r;o++)'max'===this.poolingFunc?this.output.tensor.set(o,n.default.sup(e.tensor.pick(null,null,o))):'average'===this.poolingFunc&&this.output.tensor.set(o,n.default.sum(e.tensor.pick(null,null,o))/(t*a))}_callGPU(e){e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,0)),this.inputShape=e.tensor.shape,e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'})),this.output||(this.output=new o.default([],[this.inputShape[2]]),this.output.createGLTexture({type:'2d',format:'float'}));const t='max'===this.poolingFunc;gS.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.inputShape[0]*this.inputShape[1],type:'int',name:'channelDataSize'},{value:+t,type:'bool',name:'isMaxPooling'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});se(Hw);var Ww=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Hw);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalMaxPooling2D',this.poolingFunc='max'}}t.default=r});se(Ww);var Xw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES);class i extends r.default{constructor(e={}){super(e),this.layerClass='_GlobalPooling3D';const{data_format:t='channels_last'}=e;this.dataFormat=t,this.poolingFunc='max',this.gpu&&(this.poolingProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int channelDataSize;\nuniform bool isMaxPooling;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (isMaxPooling) {\n    // GlobalMaxPooling\n    float maxval = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      if (j == 0 || val > maxval) {\n        maxval = val;\n      }\n    }\n    outColor = vec4(maxval);\n  } else {\n    // GlobalAveragePooling\n    float sum = 0.0;\n    for (int j = 0; j < size[1]; ++j) {\n      float val = texelFetch(x, ivec2(out_x, j), 0).r;\n      sum += val;\n    }\n    outColor = vec4(sum / float(channelDataSize));\n  }\n}\n'))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){'channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0));const[t,a,r,s]=e.tensor.shape;this.output=new o.default([],[s]);for(let o=0;o<s;o++)'max'===this.poolingFunc?this.output.tensor.set(o,n.default.sup(e.tensor.pick(null,null,null,o))):'average'===this.poolingFunc&&this.output.tensor.set(o,n.default.sum(e.tensor.pick(null,null,null,o))/(t*a*r))}_callGPU(e){e.is2DReshaped||e.is2DSquareReshaped?this.inputShape=e.originalShape:('channels_first'===this.dataFormat&&(e.tensor=e.tensor.transpose(1,2,3,0)),this.inputShape=e.tensor.shape,e.reshapeTo2D(),e.createGLTexture({type:'2d',format:'float'})),this.output||(this.output=new o.default([],[this.inputShape[3]]),this.output.createGLTexture({type:'2d',format:'float'}));const t='max'===this.poolingFunc;gS.webgl2.runProgram({program:this.poolingProgram,output:this.output,inputs:[{input:e,name:'x'}],uniforms:[{value:this.inputShape[0]*this.inputShape[1]*this.inputShape[2],type:'int',name:'channelDataSize'},{value:+t,type:'bool',name:'isMaxPooling'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=i});se(Xw);var Yw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Xw);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalMaxPooling3D',this.poolingFunc='max'}}t.default=r});se(Yw);var $w=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Bw);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalAveragePooling1D',this.poolingFunc='average'}}t.default=r});se($w);var Kw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Hw);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalAveragePooling2D',this.poolingFunc='average'}}t.default=r});se(Kw);var Zw=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var a=function(e){return e&&e.__esModule?e:{default:e}}(Xw);class r extends a.default{constructor(e={}){super(e),this.layerClass='GlobalAveragePooling3D',this.poolingFunc='average'}}t.default=r});se(Zw);var Qw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'MaxPooling1D',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'MaxPooling2D',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'MaxPooling3D',{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,'AveragePooling1D',{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,'AveragePooling2D',{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,'AveragePooling3D',{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,'GlobalMaxPooling1D',{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,'GlobalMaxPooling2D',{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,'GlobalMaxPooling3D',{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,'GlobalAveragePooling1D',{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,'GlobalAveragePooling2D',{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,'GlobalAveragePooling3D',{enumerable:!0,get:function(){return h.default}});var r=a(Lw),o=a(jw),n=a(Gw),i=a(Nw),s=a(Uw),u=a(qw),l=a(Vw),p=a(Ww),d=a(Yw),c=a($w),g=a(Kw),h=a(Zw)});se(Qw);var Jw=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(KS),n=a(IS),i=a(hS),s=a(ES),u=a(NS),l=r(bT);class p extends i.default{constructor(e={}){super(e),Object.defineProperty(this,'_combine',{configurable:!0,enumerable:!0,writable:!0,value:(0,u.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=t+a+r}})}),this.layerClass='SimpleRNN';const{units:t=1,activation:a='tanh',use_bias:r=!0,return_sequences:n=!1,go_backwards:i=!1,stateful:s=!1}=e;this.units=t,this.activation=a,this.activationFunc=o[a],this.use_bias=r,this.returnSequences=n,this.goBackwards=i,this.stateful=s,this.params=this.use_bias?['kernel','recurrent_kernel','bias']:['kernel','recurrent_kernel'],this.description=`output dimensions: ${this.units}`,this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.description+=this.returnSequences?`, return sequences`:'',this.description+=this.goBackwards?`, backward direction`:'',this.description+=this.stateful?`, stateful`:'',this.gpu&&(this.copyTextureProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),this.matMulProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=gS.webgl2.compileProgram(l[this.activation]),this.gateSummationProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(bias, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n  float bias_val = texelFetch(bias, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val + t2_val + bias_val);\n}\n'),this.timestepReadProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, index), 0).r);\n}\n'),this.timestepWriteProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D y;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(y, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_y == index) {\n    outColor = vec4(texelFetch(x, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = vec4(texelFetch(y, ivec2(out_x, out_y), 0).r);\n  }\n}\n'))}setWeights(e){super.setWeights(e),this.use_bias||(this.weights.bias=new n.default([],[this.units]),this.gpu&&this.weights.bias.createGLTexture({type:'2d',format:'float'}))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t=this.units,a=this.stateful&&this.currentHiddenState?this.currentHiddenState:new n.default([],[t]),r=new n.default([],[t]),o=new n.default([],[t]),i=new n.default([],[t]);this.hiddenStateSequence=new n.default([],[e.tensor.shape[0],t]);const u=new n.default([],[e.tensor.shape[1]]),l=()=>{s.default.assign(i.tensor,a.tensor),(0,bP.gemv)(1,this.weights.kernel.tensor.transpose(1,0),u.tensor,1,r.tensor),(0,bP.gemv)(1,this.weights.recurrent_kernel.tensor.transpose(1,0),i.tensor,1,o.tensor),this._combine(a.tensor,r.tensor,o.tensor,this.weights.bias.tensor),this.activationFunc(a)};for(let t=0,n=e.tensor.shape[0];t<n;t++){const i=this.goBackwards?n-t-1:t;s.default.assign(u.tensor,e.tensor.pick(i,null));[r,o].forEach((e)=>s.default.assigns(e.tensor,0)),l(),this.returnSequences&&s.default.assign(this.hiddenStateSequence.tensor.pick(t,null),a.tensor)}this.output=this.returnSequences?this.hiddenStateSequence:a,this.stateful&&(this.currentHiddenState=a)}_stepGPU(){gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousHiddenState,inputs:[{input:this.currentHiddenState,name:'source'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempXH,inputs:[{input:this.currentX,name:'A'},{input:this.weights.kernel,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempHH,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.recurrent_kernel,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentHiddenStatePreactiv,inputs:[{input:this.tempXH,name:'t1'},{input:this.tempHH,name:'t2'},{input:this.weights.bias,name:'bias'}]}),'linear'===this.activation?this.currentHiddenState=this.currentHiddenStatePreactiv:gS.webgl2.runProgram({program:this.activationProgram,output:this.currentHiddenState,inputs:[{input:this.currentHiddenStatePreactiv,name:'x'}]})}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});const t=this.units;this.currentHiddenState&&this.stateful||(this.currentHiddenState=new n.default([],[t]),this.currentHiddenState.createGLTexture({type:'2d',format:'float'})),this.currentHiddenStatePreactiv||(this.currentHiddenStatePreactiv=new n.default([],[t]),this.currentHiddenStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXH||(this.tempXH=new n.default([],[t]),this.tempXH.createGLTexture({type:'2d',format:'float'})),this.tempHH||(this.tempHH=new n.default([],[t]),this.tempHH.createGLTexture({type:'2d',format:'float'})),this.previousHiddenState||(this.previousHiddenState=new n.default([],[t]),this.previousHiddenState.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequence||(this.hiddenStateSequence=new n.default([],[e.glTextureShape[0],t]),this.hiddenStateSequence.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequenceCopy||(this.hiddenStateSequenceCopy=new n.default([],[e.glTextureShape[0],t]),this.hiddenStateSequenceCopy.createGLTexture({type:'2d',format:'float'})),this.currentX||(this.currentX=new n.default([],[e.glTextureShape[1]]),this.currentX.createGLTexture({type:'2d',format:'float'}));for(let t=0,a=e.glTextureShape[0];t<a;t++){const r=this.goBackwards?a-t-1:t;gS.webgl2.runProgram({program:this.timestepReadProgram,output:this.currentX,inputs:[{input:e,name:'x'}],uniforms:[{value:r,type:'int',name:'index'}]}),this._stepGPU(),this.returnSequences&&(gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.hiddenStateSequenceCopy,inputs:[{input:this.hiddenStateSequence,name:'source'}]}),gS.webgl2.runProgram({program:this.timestepWriteProgram,output:this.hiddenStateSequence,inputs:[{input:this.currentHiddenState,name:'x'},{input:this.hiddenStateSequenceCopy,name:'y'}],uniforms:[{value:t,type:'int',name:'index'}]}))}this.output=this.returnSequences?this.hiddenStateSequence:this.currentHiddenState,0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=p});se(Jw);var eC=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(KS),n=a(IS),i=a(hS),s=a(ES),u=a(NS),l=r(bT);class p extends i.default{constructor(e={}){super(e),Object.defineProperty(this,'_combine',{configurable:!0,enumerable:!0,writable:!0,value:(0,u.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=t+a+r}})}),Object.defineProperty(this,'_update',{configurable:!0,enumerable:!0,writable:!0,value:(0,u.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=e*a+t*r}})}),this.layerClass='LSTM';const{units:t=1,activation:a='tanh',use_bias:r=!0,recurrent_activation:n='hard_sigmoid',return_sequences:i=!1,go_backwards:s=!1,stateful:p=!1}=e;this.units=t,this.activation=a,this.recurrentActivation=n,this.activationFunc=o[a],this.recurrentActivationFunc=o[n],this.use_bias=r,this.returnSequences=i,this.goBackwards=s,this.stateful=p,this.params=this.use_bias?['kernel','recurrent_kernel','bias']:['kernel','recurrent_kernel'],this.description=`output dimensions: ${this.units}`,this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.description+='linear'===this.recurrentActivation?'':`, ${this.recurrentActivation} recurrent activation`,this.description+=this.returnSequences?`, return sequences`:'',this.description+=this.goBackwards?`, backward direction`:'',this.description+=this.stateful?`, stateful`:'',this.gpu&&(this.copyTextureProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),this.matMulProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=gS.webgl2.compileProgram(l[this.activation]),this.recurrentActivationProgram=gS.webgl2.compileProgram(l[this.recurrentActivation]),this.gateSummationProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(bias, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n  float bias_val = texelFetch(bias, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val + t2_val + bias_val);\n}\n'),this.gateProductProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(t1, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val * t2_val);\n}\n'),this.timestepReadProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, index), 0).r);\n}\n'),this.timestepWriteProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D y;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(y, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_y == index) {\n    outColor = vec4(texelFetch(x, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = vec4(texelFetch(y, ivec2(out_x, out_y), 0).r);\n  }\n}\n'),this.updateProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D c;\nuniform sampler2D ctm1;\nuniform sampler2D i;\nuniform sampler2D f;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(c, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float c_val = texelFetch(c, ivec2(out_x, out_y), 0).r;\n  float ctm1_val = texelFetch(ctm1, ivec2(out_x, out_y), 0).r;\n  float i_val = texelFetch(i, ivec2(out_x, out_y), 0).r;\n  float f_val = texelFetch(f, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(c_val * i_val + ctm1_val * f_val);\n}\n'))}setWeights(e){super.setWeights(e);const t=this.weights.kernel.tensor.shape;this.weights.W_i=new n.default([],[t[0],this.units]),this.weights.W_f=new n.default([],[t[0],this.units]),this.weights.W_c=new n.default([],[t[0],this.units]),this.weights.W_o=new n.default([],[t[0],this.units]),s.default.assign(this.weights.W_i.tensor,this.weights.kernel.tensor.hi(t[0],this.units).lo(0,0)),s.default.assign(this.weights.W_f.tensor,this.weights.kernel.tensor.hi(t[0],2*this.units).lo(0,this.units)),s.default.assign(this.weights.W_c.tensor,this.weights.kernel.tensor.hi(t[0],3*this.units).lo(0,2*this.units)),s.default.assign(this.weights.W_o.tensor,this.weights.kernel.tensor.hi(t[0],4*this.units).lo(0,3*this.units));const a=this.weights.recurrent_kernel.tensor.shape;if(this.weights.U_i=new n.default([],[a[0],this.units]),this.weights.U_f=new n.default([],[a[0],this.units]),this.weights.U_c=new n.default([],[a[0],this.units]),this.weights.U_o=new n.default([],[a[0],this.units]),s.default.assign(this.weights.U_i.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],this.units).lo(0,0)),s.default.assign(this.weights.U_f.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],2*this.units).lo(0,this.units)),s.default.assign(this.weights.U_c.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],3*this.units).lo(0,2*this.units)),s.default.assign(this.weights.U_o.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],4*this.units).lo(0,3*this.units)),this.weights.b_i=new n.default([],[this.units]),this.weights.b_f=new n.default([],[this.units]),this.weights.b_c=new n.default([],[this.units]),this.weights.b_o=new n.default([],[this.units]),this.use_bias&&(s.default.assign(this.weights.b_i.tensor,this.weights.bias.tensor.hi(this.units).lo(0)),s.default.assign(this.weights.b_f.tensor,this.weights.bias.tensor.hi(2*this.units).lo(this.units)),s.default.assign(this.weights.b_c.tensor,this.weights.bias.tensor.hi(3*this.units).lo(2*this.units)),s.default.assign(this.weights.b_o.tensor,this.weights.bias.tensor.hi(4*this.units).lo(3*this.units))),this.gpu){['W_i','W_f','W_c','W_o','U_i','U_f','U_c','U_o','b_i','b_f','b_c','b_o'].forEach((e)=>{this.weights[e].createGLTexture({type:'2d',format:'float'})})}}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t=this.weights.b_i.tensor.shape[0],a=this.weights.b_c.tensor.shape[0],r=this.weights.b_f.tensor.shape[0],o=this.weights.b_o.tensor.shape[0],i=new n.default([],[t]),u=new n.default([],[t]),l=new n.default([],[t]),p=new n.default([],[r]),d=new n.default([],[r]),c=new n.default([],[r]),g=new n.default([],[o]),h=new n.default([],[o]),f=new n.default([],[o]),m=new n.default([],[a]),_=new n.default([],[a]),y=new n.default([],[a]),x=this.stateful&&this.previousCandidate?this.previousCandidate:new n.default([],[a]),v=this.stateful&&this.currentHiddenState?this.currentHiddenState:new n.default([],[a]),b=new n.default([],[a]);this.hiddenStateSequence=new n.default([],[e.tensor.shape[0],a]);const S=new n.default([],[e.tensor.shape[1]]),T=()=>{s.default.assign(b.tensor,v.tensor),(0,bP.gemv)(1,this.weights.W_i.tensor.transpose(1,0),S.tensor,1,u.tensor),(0,bP.gemv)(1,this.weights.U_i.tensor.transpose(1,0),b.tensor,1,l.tensor),this._combine(i.tensor,u.tensor,l.tensor,this.weights.b_i.tensor),this.recurrentActivationFunc(i),(0,bP.gemv)(1,this.weights.W_f.tensor.transpose(1,0),S.tensor,1,d.tensor),(0,bP.gemv)(1,this.weights.U_f.tensor.transpose(1,0),b.tensor,1,c.tensor),this._combine(p.tensor,d.tensor,c.tensor,this.weights.b_f.tensor),this.recurrentActivationFunc(p),(0,bP.gemv)(1,this.weights.W_o.tensor.transpose(1,0),S.tensor,1,h.tensor),(0,bP.gemv)(1,this.weights.U_o.tensor.transpose(1,0),b.tensor,1,f.tensor),this._combine(g.tensor,h.tensor,f.tensor,this.weights.b_o.tensor),this.recurrentActivationFunc(g),(0,bP.gemv)(1,this.weights.W_c.tensor.transpose(1,0),S.tensor,1,_.tensor),(0,bP.gemv)(1,this.weights.U_c.tensor.transpose(1,0),b.tensor,1,y.tensor),this._combine(m.tensor,_.tensor,y.tensor,this.weights.b_c.tensor),this.activationFunc(m),this._update(m.tensor,x.tensor,i.tensor,p.tensor),s.default.assign(x.tensor,m.tensor),this.activationFunc(m),s.default.mul(v.tensor,g.tensor,m.tensor)};for(let t=0,a=e.tensor.shape[0];t<a;t++){const r=this.goBackwards?a-t-1:t;s.default.assign(S.tensor,e.tensor.pick(r,null));[u,l,d,c,h,f,_,y].forEach((e)=>s.default.assigns(e.tensor,0)),T(),s.default.assign(this.hiddenStateSequence.tensor.pick(t,null),v.tensor)}this.output=this.returnSequences?this.hiddenStateSequence:v,this.stateful&&(this.previousCandidate=x,this.currentHiddenState=v)}_stepGPU(){gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousHiddenState,inputs:[{input:this.currentHiddenState,name:'source'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempXI,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_i,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempHI,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_i,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentInputGateStatePreactiv,inputs:[{input:this.tempXI,name:'t1'},{input:this.tempHI,name:'t2'},{input:this.weights.b_i,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentInputGateState=this.currentInputGateStatePreactiv:gS.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentInputGateState,inputs:[{input:this.currentInputGateStatePreactiv,name:'x'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempXF,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_f,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempHF,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_f,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentForgetGateStatePreactiv,inputs:[{input:this.tempXF,name:'t1'},{input:this.tempHF,name:'t2'},{input:this.weights.b_f,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentForgetGateState=this.currentForgetGateStatePreactiv:gS.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentForgetGateState,inputs:[{input:this.currentForgetGateStatePreactiv,name:'x'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempXO,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_o,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempHO,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_o,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentOutputGateStatePreactiv,inputs:[{input:this.tempXO,name:'t1'},{input:this.tempHO,name:'t2'},{input:this.weights.b_o,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentOutputGateState=this.currentOutputGateStatePreactiv:gS.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentOutputGateState,inputs:[{input:this.currentOutputGateStatePreactiv,name:'x'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempXC,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_c,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempHC,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_c,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentCandidatePreactiv,inputs:[{input:this.tempXC,name:'t1'},{input:this.tempHC,name:'t2'},{input:this.weights.b_c,name:'bias'}]}),'linear'===this.activation?this.currentCandidate=this.currentCandidatePreactiv:gS.webgl2.runProgram({program:this.activationProgram,output:this.currentCandidate,inputs:[{input:this.currentCandidatePreactiv,name:'x'}]}),gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentCandidateCopy,inputs:[{input:this.currentCandidate,name:'source'}]}),gS.webgl2.runProgram({program:this.updateProgram,output:this.currentCandidate,inputs:[{input:this.currentCandidateCopy,name:'c'},{input:this.previousCandidate,name:'ctm1'},{input:this.currentInputGateState,name:'i'},{input:this.currentForgetGateState,name:'f'}]}),gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousCandidate,inputs:[{input:this.currentCandidate,name:'source'}]}),gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentCandidatePreactiv,inputs:[{input:this.currentCandidate,name:'source'}]}),'linear'===this.activation?this.currentCandidate=this.currentCandidatePreactiv:gS.webgl2.runProgram({program:this.activationProgram,output:this.currentCandidate,inputs:[{input:this.currentCandidatePreactiv,name:'x'}]}),gS.webgl2.runProgram({program:this.gateProductProgram,output:this.currentHiddenState,inputs:[{input:this.currentOutputGateState,name:'t1'},{input:this.currentCandidate,name:'t2'}]})}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});const t=this.weights.b_i.glTextureShape[1],a=this.weights.b_c.glTextureShape[1],r=this.weights.b_f.glTextureShape[1],o=this.weights.b_o.glTextureShape[1];this.currentInputGateState||(this.currentInputGateState=new n.default([],[t]),this.currentInputGateState.createGLTexture({type:'2d',format:'float'})),this.currentInputGateStatePreactiv||(this.currentInputGateStatePreactiv=new n.default([],[t]),this.currentInputGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXI||(this.tempXI=new n.default([],[t]),this.tempXI.createGLTexture({type:'2d',format:'float'})),this.tempHI||(this.tempHI=new n.default([],[t]),this.tempHI.createGLTexture({type:'2d',format:'float'})),this.currentForgetGateState||(this.currentForgetGateState=new n.default([],[r]),this.currentForgetGateState.createGLTexture({type:'2d',format:'float'})),this.currentForgetGateStatePreactiv||(this.currentForgetGateStatePreactiv=new n.default([],[r]),this.currentForgetGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXF||(this.tempXF=new n.default([],[r]),this.tempXF.createGLTexture({type:'2d',format:'float'})),this.tempHF||(this.tempHF=new n.default([],[r]),this.tempHF.createGLTexture({type:'2d',format:'float'})),this.currentOutputGateState||(this.currentOutputGateState=new n.default([],[o]),this.currentOutputGateState.createGLTexture({type:'2d',format:'float'})),this.currentOutputGateStatePreactiv||(this.currentOutputGateStatePreactiv=new n.default([],[o]),this.currentOutputGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXO||(this.tempXO=new n.default([],[o]),this.tempXO.createGLTexture({type:'2d',format:'float'})),this.tempHO||(this.tempHO=new n.default([],[o]),this.tempHO.createGLTexture({type:'2d',format:'float'})),this.currentCandidate||(this.currentCandidate=new n.default([],[a]),this.currentCandidate.createGLTexture({type:'2d',format:'float'})),this.currentCandidateCopy||(this.currentCandidateCopy=new n.default([],[a]),this.currentCandidateCopy.createGLTexture({type:'2d',format:'float'})),this.currentCandidatePreactiv||(this.currentCandidatePreactiv=new n.default([],[a]),this.currentCandidatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXC||(this.tempXC=new n.default([],[a]),this.tempXC.createGLTexture({type:'2d',format:'float'})),this.tempHC||(this.tempHC=new n.default([],[a]),this.tempHC.createGLTexture({type:'2d',format:'float'})),this.previousCandidate&&this.stateful||(this.previousCandidate=new n.default([],[a]),this.previousCandidate.createGLTexture({type:'2d',format:'float'})),this.currentHiddenState&&this.stateful||(this.currentHiddenState=new n.default([],[a]),this.currentHiddenState.createGLTexture({type:'2d',format:'float'})),this.previousHiddenState||(this.previousHiddenState=new n.default([],[a]),this.previousHiddenState.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequence||(this.hiddenStateSequence=new n.default([],[e.glTextureShape[0],a]),this.hiddenStateSequence.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequenceCopy||(this.hiddenStateSequenceCopy=new n.default([],[e.glTextureShape[0],a]),this.hiddenStateSequenceCopy.createGLTexture({type:'2d',format:'float'})),this.currentX||(this.currentX=new n.default([],[e.glTextureShape[1]]),this.currentX.createGLTexture({type:'2d',format:'float'}));for(let t=0,a=e.glTextureShape[0];t<a;t++){const r=this.goBackwards?a-t-1:t;gS.webgl2.runProgram({program:this.timestepReadProgram,output:this.currentX,inputs:[{input:e,name:'x'}],uniforms:[{value:r,type:'int',name:'index'}]}),this._stepGPU(),this.returnSequences&&(gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.hiddenStateSequenceCopy,inputs:[{input:this.hiddenStateSequence,name:'source'}]}),gS.webgl2.runProgram({program:this.timestepWriteProgram,output:this.hiddenStateSequence,inputs:[{input:this.currentHiddenState,name:'x'},{input:this.hiddenStateSequenceCopy,name:'y'}],uniforms:[{value:t,type:'int',name:'index'}]}))}this.output=this.returnSequences?this.hiddenStateSequence:this.currentHiddenState,0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=p});se(eC);var tC=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(KS),n=a(IS),i=a(hS),s=a(ES),u=a(NS),l=r(bT);class p extends i.default{constructor(e={}){super(e),Object.defineProperty(this,'_combine',{configurable:!0,enumerable:!0,writable:!0,value:(0,u.default)({args:['array','array','array','array'],body:function(e,t,a,r){e=t+a+r}})}),Object.defineProperty(this,'_update',{configurable:!0,enumerable:!0,writable:!0,value:(0,u.default)({args:['array','array','array'],body:function(e,t,a){e=e*(1-a)+t*a}})}),this.layerClass='GRU';const{units:t=1,activation:a='tanh',use_bias:r=!0,recurrent_activation:n='hard_sigmoid',return_sequences:i=!1,go_backwards:s=!1,stateful:p=!1}=e;this.units=t,this.activation=a,this.recurrentActivation=n,this.activationFunc=o[a],this.recurrentActivationFunc=o[n],this.use_bias=r,this.returnSequences=i,this.goBackwards=s,this.stateful=p,this.params=this.use_bias?['kernel','recurrent_kernel','bias']:['kernel','recurrent_kernel'],this.description=`output dimensions: ${this.units}`,this.description+='linear'===this.activation?'':`, ${this.activation} activation`,this.description+='linear'===this.recurrentActivation?'':`, ${this.recurrentActivation} recurrent activation`,this.description+=this.returnSequences?`, return sequences`:'',this.description+=this.goBackwards?`, backward direction`:'',this.description+=this.stateful?`, stateful`:'',this.gpu&&(this.copyTextureProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),this.matMulProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D A;\nuniform sampler2D B;\nuniform sampler2D C;\nuniform bool addC;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 A_size = textureSize(A, 0);\n  ivec2 B_size = textureSize(B, 0);\n  int out_x = int(float(B_size[0]) * outTex.x);\n  int out_y = int(float(A_size[1]) * outTex.y);\n  int commonDim = A_size[0];\n\n  float sum = 0.;\n  for (int i = 0; i < commonDim; ++i) {\n    float a = texelFetch(A, ivec2(i, out_y), 0).r;\n    float b = texelFetch(B, ivec2(out_x, i), 0).r;\n    sum += a * b;\n  }\n\n  if (addC) {\n    sum += texelFetch(C, ivec2(out_x, 0), 0).r;\n  }\n\n  outColor = vec4(sum);\n}\n'),this.activationProgram=gS.webgl2.compileProgram(l[this.activation]),this.recurrentActivationProgram=gS.webgl2.compileProgram(l[this.recurrentActivation]),this.gateSummationProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nuniform sampler2D bias;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(bias, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n  float bias_val = texelFetch(bias, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val + t2_val + bias_val);\n}\n'),this.gateProductProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D t1;\nuniform sampler2D t2;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(t1, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float t1_val = texelFetch(t1, ivec2(out_x, out_y), 0).r;\n  float t2_val = texelFetch(t2, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(t1_val * t2_val);\n}\n'),this.timestepReadProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, index), 0).r);\n}\n'),this.timestepWriteProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform sampler2D y;\nuniform int index;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(y, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_y == index) {\n    outColor = vec4(texelFetch(x, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = vec4(texelFetch(y, ivec2(out_x, out_y), 0).r);\n  }\n}\n'),this.updateProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D h;\nuniform sampler2D htm1;\nuniform sampler2D z;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(h, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float h_val = texelFetch(h, ivec2(out_x, out_y), 0).r;\n  float htm1_val = texelFetch(htm1, ivec2(out_x, out_y), 0).r;\n  float z_val = texelFetch(z, ivec2(out_x, out_y), 0).r;\n\n  outColor = vec4(h_val * (float(1.0) - z_val) + htm1_val * z_val);\n}\n'))}setWeights(e){super.setWeights(e);const t=this.weights.kernel.tensor.shape;this.weights.W_z=new n.default([],[t[0],this.units]),this.weights.W_r=new n.default([],[t[0],this.units]),this.weights.W_h=new n.default([],[t[0],this.units]),s.default.assign(this.weights.W_z.tensor,this.weights.kernel.tensor.hi(t[0],this.units).lo(0,0)),s.default.assign(this.weights.W_r.tensor,this.weights.kernel.tensor.hi(t[0],2*this.units).lo(0,this.units)),s.default.assign(this.weights.W_h.tensor,this.weights.kernel.tensor.hi(t[0],3*this.units).lo(0,2*this.units));const a=this.weights.recurrent_kernel.tensor.shape;if(this.weights.U_z=new n.default([],[a[0],this.units]),this.weights.U_r=new n.default([],[a[0],this.units]),this.weights.U_h=new n.default([],[a[0],this.units]),s.default.assign(this.weights.U_z.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],this.units).lo(0,0)),s.default.assign(this.weights.U_r.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],2*this.units).lo(0,this.units)),s.default.assign(this.weights.U_h.tensor,this.weights.recurrent_kernel.tensor.hi(a[0],3*this.units).lo(0,2*this.units)),this.weights.b_z=new n.default([],[this.units]),this.weights.b_r=new n.default([],[this.units]),this.weights.b_h=new n.default([],[this.units]),this.use_bias&&(s.default.assign(this.weights.b_z.tensor,this.weights.bias.tensor.hi(this.units).lo(0)),s.default.assign(this.weights.b_r.tensor,this.weights.bias.tensor.hi(2*this.units).lo(this.units)),s.default.assign(this.weights.b_h.tensor,this.weights.bias.tensor.hi(3*this.units).lo(2*this.units))),this.gpu){['W_z','W_r','W_h','U_z','U_r','U_h','b_z','b_r','b_h'].forEach((e)=>{this.weights[e].createGLTexture({type:'2d',format:'float'})})}}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t=this.weights.b_z.tensor.shape[0],a=this.weights.b_r.tensor.shape[0],r=this.weights.b_h.tensor.shape[0],o=new n.default([],[t]),u=new n.default([],[t]),l=new n.default([],[t]),i=new n.default([],[a]),p=new n.default([],[a]),d=new n.default([],[a]),c=this.stateful&&this.currentHiddenState?this.currentHiddenState:new n.default([],[r]),g=new n.default([],[r]),h=new n.default([],[r]),f=new n.default([],[r]);this.hiddenStateSequence=new n.default([],[e.tensor.shape[0],r]);const m=new n.default([],[e.tensor.shape[1]]),_=()=>{s.default.assign(f.tensor,c.tensor),(0,bP.gemv)(1,this.weights.W_z.tensor.transpose(1,0),m.tensor,1,u.tensor),(0,bP.gemv)(1,this.weights.U_z.tensor.transpose(1,0),f.tensor,1,l.tensor),this._combine(o.tensor,u.tensor,l.tensor,this.weights.b_z.tensor),this.recurrentActivationFunc(o),(0,bP.gemv)(1,this.weights.W_r.tensor.transpose(1,0),m.tensor,1,p.tensor),(0,bP.gemv)(1,this.weights.U_r.tensor.transpose(1,0),f.tensor,1,d.tensor),this._combine(i.tensor,p.tensor,d.tensor,this.weights.b_r.tensor),this.recurrentActivationFunc(i),s.default.muleq(i.tensor,f.tensor),(0,bP.gemv)(1,this.weights.W_h.tensor.transpose(1,0),m.tensor,1,g.tensor),(0,bP.gemv)(1,this.weights.U_h.tensor.transpose(1,0),i.tensor,1,h.tensor),this._combine(c.tensor,g.tensor,h.tensor,this.weights.b_h.tensor),this.activationFunc(c),this._update(c.tensor,f.tensor,o.tensor)};for(let t=0,a=e.tensor.shape[0];t<a;t++){const r=this.goBackwards?a-t-1:t;s.default.assign(m.tensor,e.tensor.pick(r,null));[u,l,p,d,g,h].forEach((e)=>s.default.assigns(e.tensor,0)),_(),this.returnSequences&&s.default.assign(this.hiddenStateSequence.tensor.pick(t,null),c.tensor)}this.output=this.returnSequences?this.hiddenStateSequence:c,this.stateful&&(this.currentHiddenState=c)}_stepGPU(){gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.previousHiddenState,inputs:[{input:this.currentHiddenState,name:'source'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempXZ,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_z,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempHZ,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_z,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentUpdateGateStatePreactiv,inputs:[{input:this.tempXZ,name:'t1'},{input:this.tempHZ,name:'t2'},{input:this.weights.b_z,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentUpdateGateState=this.currentUpdateGateStatePreactiv:gS.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentUpdateGateState,inputs:[{input:this.currentUpdateGateStatePreactiv,name:'x'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempXR,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_r,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempHR,inputs:[{input:this.previousHiddenState,name:'A'},{input:this.weights.U_r,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentResetGateStatePreactiv,inputs:[{input:this.tempXR,name:'t1'},{input:this.tempHR,name:'t2'},{input:this.weights.b_r,name:'bias'}]}),'linear'===this.recurrentActivation?this.currentResetGateState=this.currentResetGateStatePreactiv:gS.webgl2.runProgram({program:this.recurrentActivationProgram,output:this.currentResetGateState,inputs:[{input:this.currentResetGateStatePreactiv,name:'x'}]}),gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentResetGateStateCopy,inputs:[{input:this.currentResetGateState,name:'source'}]}),gS.webgl2.runProgram({program:this.gateProductProgram,output:this.currentResetGateState,inputs:[{input:this.currentResetGateStateCopy,name:'t1'},{input:this.previousHiddenState,name:'t2'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempXH,inputs:[{input:this.currentX,name:'A'},{input:this.weights.W_h,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.matMulProgram,output:this.tempHH,inputs:[{input:this.currentResetGateState,name:'A'},{input:this.weights.U_h,name:'B'}],uniforms:[{value:0,type:'bool',name:'addC'}]}),gS.webgl2.runProgram({program:this.gateSummationProgram,output:this.currentHiddenStatePreactiv,inputs:[{input:this.tempXH,name:'t1'},{input:this.tempHH,name:'t2'},{input:this.weights.b_h,name:'bias'}]}),'linear'===this.activation?this.currentHiddenState=this.currentHiddenStatePreactiv:gS.webgl2.runProgram({program:this.activationProgram,output:this.currentHiddenState,inputs:[{input:this.currentHiddenStatePreactiv,name:'x'}]}),gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.currentHiddenStateCopy,inputs:[{input:this.currentHiddenState,name:'source'}]}),gS.webgl2.runProgram({program:this.updateProgram,output:this.currentHiddenState,inputs:[{input:this.currentHiddenStateCopy,name:'h'},{input:this.previousHiddenState,name:'htm1'},{input:this.currentUpdateGateState,name:'z'}]})}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'});const t=this.weights.b_z.glTextureShape[1],a=this.weights.b_r.glTextureShape[1],r=this.weights.b_h.glTextureShape[1];this.currentHiddenState&&this.stateful||(this.currentHiddenState=new n.default([],[r]),this.currentHiddenState.createGLTexture({type:'2d',format:'float'})),this.currentHiddenStateCopy||(this.currentHiddenStateCopy=new n.default([],[r]),this.currentHiddenStateCopy.createGLTexture({type:'2d',format:'float'})),this.currentHiddenStatePreactiv||(this.currentHiddenStatePreactiv=new n.default([],[r]),this.currentHiddenStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.currentUpdateGateState||(this.currentUpdateGateState=new n.default([],[t]),this.currentUpdateGateState.createGLTexture({type:'2d',format:'float'})),this.currentUpdateGateStatePreactiv||(this.currentUpdateGateStatePreactiv=new n.default([],[t]),this.currentUpdateGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXZ||(this.tempXZ=new n.default([],[t]),this.tempXZ.createGLTexture({type:'2d',format:'float'})),this.tempHZ||(this.tempHZ=new n.default([],[t]),this.tempHZ.createGLTexture({type:'2d',format:'float'})),this.currentResetGateState||(this.currentResetGateState=new n.default([],[a]),this.currentResetGateState.createGLTexture({type:'2d',format:'float'})),this.currentResetGateStateCopy||(this.currentResetGateStateCopy=new n.default([],[a]),this.currentResetGateStateCopy.createGLTexture({type:'2d',format:'float'})),this.currentResetGateStatePreactiv||(this.currentResetGateStatePreactiv=new n.default([],[a]),this.currentResetGateStatePreactiv.createGLTexture({type:'2d',format:'float'})),this.tempXR||(this.tempXR=new n.default([],[a]),this.tempXR.createGLTexture({type:'2d',format:'float'})),this.tempHR||(this.tempHR=new n.default([],[a]),this.tempHR.createGLTexture({type:'2d',format:'float'})),this.tempXH||(this.tempXH=new n.default([],[r]),this.tempXH.createGLTexture({type:'2d',format:'float'})),this.tempHH||(this.tempHH=new n.default([],[r]),this.tempHH.createGLTexture({type:'2d',format:'float'})),this.previousHiddenState||(this.previousHiddenState=new n.default([],[r]),this.previousHiddenState.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequence||(this.hiddenStateSequence=new n.default([],[e.glTextureShape[0],r]),this.hiddenStateSequence.createGLTexture({type:'2d',format:'float'})),this.hiddenStateSequenceCopy||(this.hiddenStateSequenceCopy=new n.default([],[e.glTextureShape[0],r]),this.hiddenStateSequenceCopy.createGLTexture({type:'2d',format:'float'})),this.currentX||(this.currentX=new n.default([],[e.glTextureShape[1]]),this.currentX.createGLTexture({type:'2d',format:'float'}));for(let t=0,a=e.glTextureShape[0];t<a;t++){const r=this.goBackwards?a-t-1:t;gS.webgl2.runProgram({program:this.timestepReadProgram,output:this.currentX,inputs:[{input:e,name:'x'}],uniforms:[{value:r,type:'int',name:'index'}]}),this._stepGPU(),this.returnSequences&&(gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.hiddenStateSequenceCopy,inputs:[{input:this.hiddenStateSequence,name:'source'}]}),gS.webgl2.runProgram({program:this.timestepWriteProgram,output:this.hiddenStateSequence,inputs:[{input:this.currentHiddenState,name:'x'},{input:this.hiddenStateSequenceCopy,name:'y'}],uniforms:[{value:t,type:'int',name:'index'}]}))}this.output=this.returnSequences?this.hiddenStateSequence:this.currentHiddenState,0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=p});se(tC);var aC=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'SimpleRNN',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'LSTM',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'GRU',{enumerable:!0,get:function(){return n.default}});var r=a(Jw),o=a(eC),n=a(tC)});se(aC);var rC=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(iC);class s extends r.default{constructor(e={}){super(e),this.layerClass='TimeDistributed';const{layer:t}=e;t||this.throwError('wrapped layer is undefined.');const a=Object.assign({},t.config,{gpu:e.gpu});this.wrappedLayer=new i[t.class_name](a),this.wrappedLayer.outbound=[null],this.gpu&&(this.copyTextureProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),this.mapInputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform isampler2D indexMap;\nuniform int inputCols;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(indexMap, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(inputCols)));\n    int colIndex = int(mod(float(index), float(inputCols)));\n    float val = texelFetch(x, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = vec4(0.0);\n  }\n}\n'),this.selectSliceProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D x;\nuniform int t;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(x, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n\n  outColor = vec4(texelFetch(x, ivec2(out_x, t), 0).r);\n}\n'),this.copySliceOutputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D outputCopy;\nuniform sampler2D sliceOutput;\nuniform int t;\nuniform int timesteps;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(sliceOutput, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(timesteps) * outTex.y);\n\n  if (t == out_y) {\n    outColor = vec4(texelFetch(sliceOutput, ivec2(out_x, 0), 0).r);\n  } else {\n    outColor = texelFetch(outputCopy, ivec2(out_x, out_y), 0);\n  }\n}\n'),this.mapSliceOutputProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\nprecision highp isampler2D;\n\nin vec2 outTex;\nuniform sampler2D outputCopy;\nuniform sampler2D sliceOutput;\nuniform isampler2D indexMap;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(outputCopy, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  int index = texelFetch(indexMap, ivec2(out_x, out_y), 0).r;\n\n  if (index != -1) {\n    int rowIndex = int(floor(float(index) / float(textureSize(sliceOutput, 0)[0])));\n    int colIndex = int(mod(float(index), float(textureSize(sliceOutput, 0)[0])));\n    float val = texelFetch(sliceOutput, ivec2(colIndex, rowIndex), 0).r;\n    outColor = vec4(val);\n  } else {\n    outColor = texelFetch(outputCopy, ivec2(out_x, out_y), 0);\n  }\n}\n'))}setWeights(e){this.wrappedLayer.setWeights(e)}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){const t=[...e.tensor.shape.slice(1)],a=new o.default([],t);n.default.assign(a.tensor,e.tensor.pick(0,...Array(t.length).fill(null)));let r=this.wrappedLayer.call(a);const s=r.tensor.shape.slice();this.output=new o.default([],[e.tensor.shape[0],...s]),n.default.assign(this.output.tensor.pick(0,...Array(s.length).fill(null)),r.tensor);for(let o=1,i=e.tensor.shape[0];o<i;o++)n.default.assign(a.tensor,e.tensor.pick(o,...Array(t.length).fill(null))),r=this.wrappedLayer.call(a),n.default.assign(this.output.tensor.pick(o,...Array(s.length).fill(null)),r.tensor)}_createIndexMap(e){if(!this.indexMaps){const a=new o.default(e.data,e.shape,{type:Int32Array});this.indexMaps=[];const r=this.inputShape[0],i=this.inputShape.slice(1);for(let e=0;e<r;e++){const t=new o.default([],i,{type:Int32Array});n.default.assign(t.tensor,a.tensor.pick(e,...Array(i.length).fill(null))),t.reshapeTo2DSquare(),t.createGLTexture({type:'2d',format:'int'}),this.indexMaps.push(t)}}}_createOutputIndexMap(e){if(!this.outputIndexMaps){const a=new o.default(e.data,e.shape,{type:Int32Array});this.outputIndexMaps=[];const r=this.outputShape[0],i=this.outputShape.slice(1);for(let e=0;e<r;e++){const t=new o.default([],this.outputShape,{type:Int32Array});n.default.assigns(t.tensor,-1),n.default.assign(t.tensor.pick(e,...Array(i.length).fill(null)),a.tensor),t.reshapeTo2DSquare(),t.createGLTexture({type:'2d',format:'int'}),this.outputIndexMaps.push(t)}}}_callGPU(e){this.inputShape=e.is2DReshaped||e.is2DSquareReshaped?e.originalShape:e.tensor.shape,e.glTexture||(2>=e.tensor.shape.length?e.createGLTexture({type:'2d',format:'float'}):2<e.tensor.shape.length&&!e.is2DReshaped&&(e.reshapeTo2DSquare(),e.createGLTexture({type:'2d',format:'float'}))),2<this.inputShape.length&&this._createIndexMap(e.indicesForReshaped);const t=this.inputShape[0],a=this.inputShape.slice(1);this.slice||(this.slice=new o.default([],a),2>=a.length?this.slice.createGLTexture({type:'2d',format:'float'}):(this.slice.reshapeTo2DSquare(),this.slice.createGLTexture({type:'2d',format:'float'}))),2>=this.inputShape.length?gS.webgl2.runProgram({program:this.selectSliceProgram,output:this.slice,inputs:[{input:e,name:'x'}],uniforms:[{value:0,type:'int',name:'t'}]}):gS.webgl2.runProgram({program:this.mapInputProgram,output:this.slice,inputs:[{input:e,name:'x'},{input:this.indexMaps[0],name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),this.wrappedLayer._callGPU(this.slice),this.sliceOutput=this.wrappedLayer.output,this.output||(2>=this.inputShape.length?(this.outputShape=[t,this.sliceOutput.glTextureShape[1]],this.output=new o.default([],this.outputShape),this.outputCopy=new o.default([],this.outputShape),this.output.createGLTexture({type:'2d',format:'float'}),this.outputCopy.createGLTexture({type:'2d',format:'float'})):(this.outputShape=[t,...this.sliceOutput.originalShape],this.output=new o.default([],this.outputShape),this.outputCopy=new o.default([],this.outputShape),this.output.reshapeTo2DSquare(),this.outputCopy.reshapeTo2DSquare(),this.output.createGLTexture({type:'2d',format:'float'}),this.outputCopy.createGLTexture({type:'2d',format:'float'}),this._createOutputIndexMap(this.sliceOutput.indicesForReshaped))),gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.outputCopy,inputs:[{input:this.output,name:'source'}]}),2>=this.inputShape.length?gS.webgl2.runProgram({program:this.copySliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'}],uniforms:[{value:0,type:'int',name:'t'},{value:t,type:'int',name:'timesteps'}]}):gS.webgl2.runProgram({program:this.mapSliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'},{input:this.outputIndexMaps[0],name:'indexMap'}]});for(let a=1;a<t;a++)2>=this.inputShape.length?gS.webgl2.runProgram({program:this.selectSliceProgram,output:this.slice,inputs:[{input:e,name:'x'}],uniforms:[{value:a,type:'int',name:'t'}]}):gS.webgl2.runProgram({program:this.mapInputProgram,output:this.slice,inputs:[{input:e,name:'x'},{input:this.indexMaps[a],name:'indexMap'}],uniforms:[{value:e.glTextureShape[1],type:'int',name:'inputCols'}]}),this.wrappedLayer._callGPU(this.slice),this.sliceOutput=this.wrappedLayer.output,gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.outputCopy,inputs:[{input:this.output,name:'source'}]}),2>=this.inputShape.length?gS.webgl2.runProgram({program:this.copySliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'}],uniforms:[{value:a,type:'int',name:'t'},{value:t,type:'int',name:'timesteps'}]}):gS.webgl2.runProgram({program:this.mapSliceOutputProgram,output:this.output,inputs:[{input:this.outputCopy,name:'outputCopy'},{input:this.sliceOutput,name:'sliceOutput'},{input:this.outputIndexMaps[a],name:'indexMap'}]});0===this.outbound.length&&(this.output.transferFromGLTexture(),this.output.is2DReshaped?this.output.reshapeFrom2D():this.output.is2DSquareReshaped&&this.output.reshapeFrom2DSquare())}}t.default=s});se(rC);var oC=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(hS),o=a(IS),n=a(ES),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(aC);class s extends r.default{constructor(e={}){super(e),this.layerClass='Bidirectional';const{layer:t,merge_mode:a='concat'}=e;t||this.throwError('wrapped layer is undefined.'),['SimpleRNN','GRU','LSTM'].includes(t.class_name)||this.throwError(`cannot wrap ${t.class_name} layer.`),['concat','sum','mul','ave'].includes(a)||this.throwError(`merge_mode ${a} not supported.`);const r=Object.assign({},t.config,{gpu:e.gpu}),o=Object.assign({},t.config,{gpu:e.gpu});o.go_backwards=!o.go_backwards,this.forwardLayer=new i[t.class_name](r),this.backwardLayer=new i[t.class_name](o),this.forwardLayer.outbound=[null],this.backwardLayer.outbound=[null],this.mergeMode=a,this.returnSequences=t.config.return_sequences,this.gpu&&(this.copyTextureProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D source;\nout vec4 outColor;\n\nvoid main(void) {\n  outColor = texture(source, vec2(outTex.x, outTex.y));\n}\n'),'concat'===this.mergeMode?this.mergeProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0] * 2) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  if (out_x >= 0 && out_x < size[0]) {\n    outColor = vec4(texelFetch(forward, ivec2(out_x, out_y), 0).r);\n  } else {\n    outColor = vec4(texelFetch(backward, ivec2(out_x - size[0], size[1] - out_y - 1), 0).r);\n  }\n}\n'):'sum'===this.mergeMode?this.mergeProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float forward_val = texelFetch(forward, ivec2(out_x, out_y), 0).r;\n  float backward_val = texelFetch(backward, ivec2(out_x, size[1] - out_y - 1), 0).r;\n\n  outColor = vec4(forward_val + backward_val);\n}\n'):'mul'===this.mergeMode?this.mergeProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float forward_val = texelFetch(forward, ivec2(out_x, out_y), 0).r;\n  float backward_val = texelFetch(backward, ivec2(out_x, size[1] - out_y - 1), 0).r;\n\n  outColor = vec4(forward_val * backward_val);\n}\n'):'ave'===this.mergeMode&&(this.mergeProgram=gS.webgl2.compileProgram('#version 300 es\nprecision highp float;\n\nin vec2 outTex;\nuniform sampler2D forward;\nuniform sampler2D backward;\nout vec4 outColor;\n\nvoid main() {\n  ivec2 size = textureSize(forward, 0);\n  int out_x = int(float(size[0]) * outTex.x);\n  int out_y = int(float(size[1]) * outTex.y);\n\n  float forward_val = texelFetch(forward, ivec2(out_x, out_y), 0).r;\n  float backward_val = texelFetch(backward, ivec2(out_x, size[1] - out_y - 1), 0).r;\n\n  outColor = vec4(0.5 * (forward_val + backward_val));\n}\n')))}setWeights(e){this.forwardLayer.setWeights(e.slice(0,e.length/2)),this.backwardLayer.setWeights(e.slice(e.length/2))}call(e){return this.gpu?this._callGPU(e):this._callCPU(e),this.output}_callCPU(e){this.forwardLayer._callCPU(new o.default(e.tensor.data,e.tensor.shape)),this.backwardLayer._callCPU(new o.default(e.tensor.data,e.tensor.shape));const t=this.forwardLayer.output,a=this.backwardLayer.output;this.returnSequences&&(a.tensor=a.tensor.step(-1));const r=t.tensor.shape.slice();'concat'===this.mergeMode&&(r[r.length-1]+=a.tensor.shape[r.length-1]),this.output=new o.default([],r),'concat'===this.mergeMode?this.returnSequences?(n.default.assign(this.output.tensor.hi(r[0],t.tensor.shape[1]).lo(0,0),t.tensor),n.default.assign(this.output.tensor.hi(r[0],r[1]).lo(0,t.tensor.shape[1]),a.tensor)):(n.default.assign(this.output.tensor.hi(t.tensor.shape[0]).lo(0),t.tensor),n.default.assign(this.output.tensor.hi(r[0]).lo(t.tensor.shape[0]),a.tensor)):'sum'===this.mergeMode?(n.default.addeq(this.output.tensor,t.tensor),n.default.addeq(this.output.tensor,a.tensor)):'mul'===this.mergeMode?(n.default.assigns(this.output.tensor,1),n.default.muleq(this.output.tensor,t.tensor),n.default.muleq(this.output.tensor,a.tensor)):'ave'===this.mergeMode&&(n.default.addeq(this.output.tensor,t.tensor),n.default.addeq(this.output.tensor,a.tensor),n.default.divseq(this.output.tensor,2))}_callGPU(e){e.glTexture||e.createGLTexture({type:'2d',format:'float'}),this.inputCopy||(this.inputCopy=new o.default([],e.glTextureShape),this.inputCopy.createGLTexture({type:'2d',format:'float'})),gS.webgl2.runProgram({program:this.copyTextureProgram,output:this.inputCopy,inputs:[{input:e,name:'source'}]}),this.forwardLayer._callGPU(e),this.backwardLayer._callGPU(this.inputCopy);const t=this.forwardLayer.output,a=this.backwardLayer.output,r=t.glTextureShape.slice();'concat'===this.mergeMode&&(r[1]+=a.glTextureShape[1]),this.output||(this.output=new o.default([],r),this.output.createGLTexture({type:'2d',format:'float'}),!this.returnSequences&&(this.output.is1D=!0)),gS.webgl2.runProgram({program:this.mergeProgram,output:this.output,inputs:[{input:t,name:'forward'},{input:a,name:'backward'}]}),0===this.outbound.length&&this.output.transferFromGLTexture()}}t.default=s});se(oC);var nC=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'TimeDistributed',{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,'Bidirectional',{enumerable:!0,get:function(){return o.default}});var r=a(rC),o=a(oC)});se(nC);var iC=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0});var a={InputLayer:!0};Object.defineProperty(t,'InputLayer',{enumerable:!0,get:function(){return r.default}});var r=function(e){return e&&e.__esModule?e:{default:e}}(AS);Object.keys(tT).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return tT[e]}})}),Object.keys(jT).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return jT[e]}})}),Object.keys(gw).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return gw[e]}})}),Object.keys(fw).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return fw[e]}})}),Object.keys(kw).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return kw[e]}})}),Object.keys(Dw).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return Dw[e]}})}),Object.keys(Aw).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return Aw[e]}})}),Object.keys(Qw).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return Qw[e]}})}),Object.keys(aC).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return aC[e]}})}),Object.keys(nC).forEach(function(e){'default'===e||'__esModule'===e||Object.prototype.hasOwnProperty.call(a,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return nC[e]}})})});se(iC);var sC=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var r=a(IS),o=a(ES),n=a(xT),i=a(mT);t.default=class{constructor(e={}){if(this.modelLayersMap=e.modelLayersMap,this.gpu=e.gpu,!this.modelLayersMap)throw new Error(`[CAM] modelLayersMap is required`)}initialize(){if(this.modelLayersMap.forEach((e)=>{'GlobalAveragePooling2D'===e.layerClass&&(this.enabled=!0,this.poolLayer=e)}),this.enabled&&!this.data){this.featureMaps=this.modelLayersMap.get(this.poolLayer.inbound[0]).output;let e=this.poolLayer;for(e.outbound.length||(this.weights=this.poolLayer.output);e.outbound.length;)e=this.modelLayersMap.get(e.outbound[0]),this.weights=e.weights.kernel?e.weights.kernel:this.poolLayer.output;if(this.inputShape=this.featureMaps.is2DReshaped?this.featureMaps.originalShape.slice(0,2):this.featureMaps.tensor.shape.slice(0,2),1===this.weights.tensor.shape.length)this.shape=this.inputShape;else{const e=this.weights.tensor.shape[1];this.shape=[...this.inputShape,e]}this.data=new Float32Array(this.shape.reduce((e,t)=>e*t,1))}}update(){if(this.enabled){this.featureMaps=this.modelLayersMap.get(this.poolLayer.inbound[0]).output,this.gpu?this._updateGPU():this._updateCPU();const e=o.default.inf(this.output.tensor),t=o.default.sup(this.output.tensor);o.default.divseq(o.default.subseq(this.output.tensor,e),t-e),this.data=this.output.tensor.data}}_updateCPU(){if(this.featureMaps.is2DReshaped||this.featureMaps.reshapeTo2D(),1===this.weights.tensor.shape.length){this.output||(this.output=new r.default([],this.shape));const e=new r.default([],[this.shape[0]*this.shape[1]]);(0,bP.gemv)(1,this.featureMaps.tensor,this.weights.tensor,1,e.tensor),this.output.replaceTensorData(e.tensor.data)}else this.output||(this.output=new r.default([],this.shape)),this.output.reshapeTo2D(),(0,n.default)(this.output.tensor,this.featureMaps.tensor,this.weights.tensor,1,1),this.output.reshapeFrom2D();o.default.maxseq(this.output.tensor,0),this.featureMaps.is2DReshaped&&this.featureMaps.reshapeFrom2D()}_updateGPU(){this.output||(this.output=new r.default([],this.shape));const e=this.weights.is1D;!this.output.glTexture&&e?this.output.createGLTexture({type:'2d',format:'float'}):(this.output.reshapeTo2D(),this.output.createGLTexture({type:'2d',format:'float'}));const t=e?this.weights.glTextureShape[1]:this.weights.glTextureShape[0];if(!this.program){const a=(0,i.default)('cam',this.output.glTextureShape,t,e);this.program=gS.webgl2.compileProgram(a)}gS.webgl2.runProgram({program:this.program,output:this.output,inputs:[{input:this.featureMaps,name:'featureMaps'},{input:this.weights,name:'weights'}]}),this.output.transferFromGLTexture(),this.output.is2DReshaped&&this.output.reshapeFrom2D()}}});se(sC);var uC=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'CAM',{enumerable:!0,get:function(){return a.default}});var a=function(e){return e&&e.__esModule?e:{default:e}}(sC)});se(uC);var lC=To,pC=ue(function(e,t){var a=t;a.length=function(e){var t=e.length;if(!t)return 0;for(var a=0;1<--t%4&&'='===e.charAt(t);)++a;return yn(3*e.length)/4-a};for(var r=Array(64),o=Array(123),n=0;64>n;)o[r[n]=26>n?n+65:52>n?n+71:62>n?n-4:43|n-59]=n++;a.encode=function(e,a,o){for(var n=null,s=[],u=0,i=0,l,t;a<o;)t=e[a++],0==i?(s[u++]=r[t>>2],l=(3&t)<<4,i=1):1==i?(s[u++]=r[l|t>>4],l=(15&t)<<2,i=2):2==i?(s[u++]=r[l|t>>6],s[u++]=r[63&t],i=0):void 0,8191<u&&((n||(n=[])).push(pn.apply(String,s)),u=0);return i&&(s[u++]=r[l],s[u++]=61,1==i&&(s[u++]=61)),n?(u&&n.push(pn.apply(String,s.slice(0,u))),n.join('')):pn.apply(String,s.slice(0,u))};var s='invalid encoding';a.decode=function(e,a,r){for(var n=r,u=0,l=0,i,t;l<e.length&&(t=e.charCodeAt(l++),!(61===t&&1<u));){if(void 0===(t=o[t]))throw Error(s);0==u?(i=t,u=1):1==u?(a[r++]=i<<2|(48&t)>>4,i=t,u=2):2==u?(a[r++]=(15&i)<<4|(60&t)>>2,i=t,u=3):3==u?(a[r++]=(3&i)<<6|t,u=0):void 0}if(1==u)throw Error(s);return r-n},a.test=function(e){return /^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}),dC=Po;Po.prototype.on=function(e,t,a){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:a||this}),this},Po.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var a=this._listeners[e],r=0;r<a.length;)a[r].fn===t?a.splice(r,1):++r;return this},Po.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var a=[],r=1;r<arguments.length;)a.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,a)}return this};var cC=wo(wo),gC=Mo,hC=ue(function(e,t){var a=t;a.length=function(e){for(var t=0,a=0,r=0;r<e.length;++r)a=e.charCodeAt(r),128>a?t+=1:2048>a?t+=2:55296==(64512&a)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},a.read=function(e,a,r){var o=r-a;if(1>o)return'';for(var n=null,s=[],u=0,i;a<r;)i=e[a++],128>i?s[u++]=i:191<i&&224>i?s[u++]=(31&i)<<6|63&e[a++]:239<i&&365>i?(i=((7&i)<<18|(63&e[a++])<<12|(63&e[a++])<<6|63&e[a++])-65536,s[u++]=55296+(i>>10),s[u++]=56320+(1023&i)):s[u++]=(15&i)<<12|(63&e[a++])<<6|63&e[a++],8191<u&&((n||(n=[])).push(pn.apply(String,s)),u=0);return n?(u&&n.push(pn.apply(String,s.slice(0,u))),n.join('')):pn.apply(String,s.slice(0,u))},a.write=function(e,t,a){for(var r=a,o=0,n,i;o<e.length;++o)n=e.charCodeAt(o),128>n?t[a++]=n:2048>n?(t[a++]=192|n>>6,t[a++]=128|63&n):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(o+1)))?(n=65536+((1023&n)<<10)+(1023&i),++o,t[a++]=240|n>>18,t[a++]=128|63&n>>12,t[a++]=128|63&n>>6,t[a++]=128|63&n):(t[a++]=224|n>>12,t[a++]=128|63&n>>6,t[a++]=128|63&n);return a-r}}),fC=Do,mC=Io,_C=Io.zero=new Io(0,0);_C.toNumber=function(){return 0},_C.zzEncode=_C.zzDecode=function(){return this},_C.length=function(){return 1};var yC=Io.zeroHash='\0\0\0\0\0\0\0\0';Io.fromNumber=function(e){if(0===e)return _C;var t=0>e;t&&(e=-e);var a=e>>>0,r=(e-a)/4294967296>>>0;return t&&(r=~r>>>0,a=~a>>>0,4294967295<++a&&(a=0,4294967295<++r&&(r=0))),new Io(a,r)},Io.from=function(e){if('number'==typeof e)return Io.fromNumber(e);if(vC.isString(e))if(vC.Long)e=vC.Long.fromString(e);else return Io.fromNumber(parseInt(e,10));return e.low||e.high?new Io(e.low>>>0,e.high>>>0):_C},Io.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,a=~this.hi>>>0;return t||(a=a+1>>>0),-(t+4294967296*a)}return this.lo+4294967296*this.hi},Io.prototype.toLong=function(e){return vC.Long?new vC.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var xC=mn.charCodeAt;Io.fromHash=function(e){return e===yC?_C:new Io((xC.call(e,0)|xC.call(e,1)<<8|xC.call(e,2)<<16|xC.call(e,3)<<24)>>>0,(xC.call(e,4)|xC.call(e,5)<<8|xC.call(e,6)<<16|xC.call(e,7)<<24)>>>0)},Io.prototype.toHash=function(){return pn(255&this.lo,255&this.lo>>>8,255&this.lo>>>16,this.lo>>>24,255&this.hi,255&this.hi>>>8,255&this.hi>>>16,this.hi>>>24)},Io.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Io.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Io.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,a=this.hi>>>24;return 0==a?0==t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>a?9:10};var vC=ue(function(e,t){function a(e,t,a){for(var r=Object.keys(t),o=0;o<r.length;++o)void 0!==e[r[o]]&&a||(e[r[o]]=t[r[o]]);return e}function r(e){function t(e,r){return this instanceof t?void(Object.defineProperty(this,'message',{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,'stack',{value:new Error().stack||''}),r&&a(this,r)):new t(e,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,'name',{get:function(){return e}}),t.prototype.toString=function(){return this.name+': '+this.message},t}var o=t;o.asPromise=lC,o.base64=pC,o.EventEmitter=dC,o.float=cC,o.inquire=gC,o.utf8=hC,o.pool=fC,o.LongBits=mC,o.emptyArray=Object.freeze?Object.freeze([]):[],o.emptyObject=Object.freeze?Object.freeze({}):{},o.isNode=!!(ji.process&&ji.process.versions&&ji.process.versions.node),o.isInteger=Number.isInteger||function(e){return'number'==typeof e&&isFinite(e)&&_n(e)===e},o.isString=function(e){return'string'==typeof e||e instanceof String},o.isObject=function(e){return e&&'object'==typeof e},o.isset=o.isSet=function(e,t){var a=e[t];return null!=a&&e.hasOwnProperty(t)&&('object'!=typeof a||0<(Array.isArray(a)?a.length:Object.keys(a).length))},o.Buffer=function(){try{var e=o.inquire('buffer').Buffer;return e.prototype.utf8Write?e:null}catch(t){return null}}(),o._Buffer_from=null,o._Buffer_allocUnsafe=null,o.newBuffer=function(e){return'number'==typeof e?o.Buffer?o._Buffer_allocUnsafe(e):new o.Array(e):o.Buffer?o._Buffer_from(e):'undefined'==typeof Uint8Array?e:new Uint8Array(e)},o.Array='undefined'==typeof Uint8Array?Array:Uint8Array,o.Long=ji.dcodeIO&&ji.dcodeIO.Long||o.inquire('long'),o.key2Re=/^true|false|0|1$/,o.key32Re=/^-?(?:0|[1-9][0-9]*)$/,o.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,o.longToHash=function(e){return e?o.LongBits.from(e).toHash():o.LongBits.zeroHash},o.longFromHash=function(e,t){var a=o.LongBits.fromHash(e);return o.Long?o.Long.fromBits(a.lo,a.hi,t):a.toNumber(!!t)},o.merge=a,o.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},o.newError=r,o.ProtocolError=r('ProtocolError'),o.oneOfGetter=function(e){for(var t={},a=0;a<e.length;++a)t[e[a]]=1;return function(){for(var e=Object.keys(this),a=e.length-1;-1<a;--a)if(1===t[e[a]]&&this[e[a]]!==void 0&&null!==this[e[a]])return e[a]}},o.oneOfSetter=function(e){return function(t){for(var a=0;a<e.length;++a)e[a]!==t&&delete this[e[a]]}},o.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},o._configure=function(){var e=o.Buffer;return e?void(o._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,a){return new e(t,a)},o._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):void(o._Buffer_from=o._Buffer_allocUnsafe=null)}}),bC=Oo,SC=vC.LongBits,TC=vC.base64,PC=vC.utf8,wC;Oo.create=vC.Buffer?function(){return(Oo.create=function(){return new wC})()}:function(){return new Oo},Oo.alloc=function(e){return new vC.Array(e)},vC.Array!==Array&&(Oo.alloc=vC.pool(Oo.alloc,vC.Array.prototype.subarray)),Oo.prototype._push=function(e,t,a){return this.tail=this.tail.next=new Ao(e,t,a),this.len+=t,this},Go.prototype=Object.create(Ao.prototype),Go.prototype.fn=zo,Oo.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Go(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},Oo.prototype.int32=function(e){return 0>e?this._push(No,10,SC.fromNumber(e)):this.uint32(e)},Oo.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Oo.prototype.uint64=function(e){var t=SC.from(e);return this._push(No,t.length(),t)},Oo.prototype.int64=Oo.prototype.uint64,Oo.prototype.sint64=function(e){var t=SC.from(e).zzEncode();return this._push(No,t.length(),t)},Oo.prototype.bool=function(e){return this._push(jo,1,e?1:0)},Oo.prototype.fixed32=function(e){return this._push(Uo,4,e>>>0)},Oo.prototype.sfixed32=Oo.prototype.fixed32,Oo.prototype.fixed64=function(e){var t=SC.from(e);return this._push(Uo,4,t.lo)._push(Uo,4,t.hi)},Oo.prototype.sfixed64=Oo.prototype.fixed64,Oo.prototype.float=function(e){return this._push(vC.float.writeFloatLE,4,e)},Oo.prototype.double=function(e){return this._push(vC.float.writeDoubleLE,8,e)};var CC=vC.Array.prototype.set?function(e,t,a){t.set(e,a)}:function(e,t,a){for(var r=0;r<e.length;++r)t[a+r]=e[r]};Oo.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(jo,1,0);if(vC.isString(e)){var a=Oo.alloc(t=TC.length(e));TC.decode(e,a,0),e=a}return this.uint32(t)._push(CC,t,e)},Oo.prototype.string=function(e){var t=PC.length(e);return t?this.uint32(t)._push(PC.write,t,e):this._push(jo,1,0)},Oo.prototype.fork=function(){return this.states=new Lo(this),this.head=this.tail=new Ao(Ro,0,0),this.len=0,this},Oo.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ao(Ro,0,0),this.len=0),this},Oo.prototype.ldelim=function(){var e=this.head,t=this.tail,a=this.len;return this.reset().uint32(a),a&&(this.tail.next=e.next,this.tail=t,this.len+=a),this},Oo.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),a=0;e;)e.fn(e.val,t,a),a+=e.len,e=e.next;return t},Oo._configure=function(e){wC=e};var FC=qo;(qo.prototype=Object.create(bC.prototype)).constructor=qo;var kC=vC.Buffer;qo.alloc=function(e){return(qo.alloc=vC._Buffer_allocUnsafe)(e)};var EC=kC&&kC.prototype instanceof Uint8Array&&'set'===kC.prototype.set.name?function(e,t,a){t.set(e,a)}:function(e,t,a){if(e.copy)e.copy(t,a,0,e.length);else for(var r=0;r<e.length;)t[a++]=e[r++]};qo.prototype.bytes=function(e){vC.isString(e)&&(e=vC._Buffer_from(e,'base64'));var t=e.length>>>0;return this.uint32(t),t&&this._push(EC,t,e),this},qo.prototype.string=function(e){var t=kC.byteLength(e);return this.uint32(t),t&&this._push(Bo,t,e),this};var MC=Ho,DC=vC.LongBits,IC=vC.utf8,AC='undefined'==typeof Uint8Array?function(e){if(Array.isArray(e))return new Ho(e);throw Error('illegal buffer')}:function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ho(e);throw Error('illegal buffer')},RC;Ho.create=vC.Buffer?function(e){return(Ho.create=function(e){return vC.Buffer.isBuffer(e)?new RC(e):AC(e)})(e)}:AC,Ho.prototype._slice=vC.Array.prototype.subarray||vC.Array.prototype.slice,Ho.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Vo(this,10);return e}}(),Ho.prototype.int32=function(){return 0|this.uint32()},Ho.prototype.sint32=function(){var e=this.uint32();return 0|e>>>1^-(1&e)},Ho.prototype.bool=function(){return 0!==this.uint32()},Ho.prototype.fixed32=function(){if(this.pos+4>this.len)throw Vo(this,4);return Xo(this.buf,this.pos+=4)},Ho.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Vo(this,4);return 0|Xo(this.buf,this.pos+=4)},Ho.prototype.float=function(){if(this.pos+4>this.len)throw Vo(this,4);var e=vC.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Ho.prototype.double=function(){if(this.pos+8>this.len)throw Vo(this,4);var e=vC.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Ho.prototype.bytes=function(){var e=this.uint32(),t=this.pos,a=this.pos+e;if(a>this.len)throw Vo(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,a):t===a?new this.buf.constructor(0):this._slice.call(this.buf,t,a)},Ho.prototype.string=function(){var e=this.bytes();return IC.read(e,0,e.length)},Ho.prototype.skip=function(e){if('number'==typeof e){if(this.pos+e>this.len)throw Vo(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Vo(this);while(128&this.buf[this.pos++]);return this},Ho.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:do{if(4==(e=7&this.uint32()))break;this.skipType(e)}while(!0);break;case 5:this.skip(4);break;default:throw Error('invalid wire type '+e+' at offset '+this.pos);}return this},Ho._configure=function(e){RC=e;var t=vC.Long?'toLong':'toNumber';vC.merge(Ho.prototype,{int64:function(){return Wo.call(this)[t](!1)},uint64:function(){return Wo.call(this)[t](!0)},sint64:function(){return Wo.call(this).zzDecode()[t](!1)},fixed64:function(){return Yo.call(this)[t](!0)},sfixed64:function(){return Yo.call(this)[t](!1)}})};var LC=$o;($o.prototype=Object.create(MC.prototype)).constructor=$o,vC.Buffer&&($o.prototype._slice=vC.Buffer.prototype.slice),$o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=vn(this.pos+e,this.len))};var OC=Ko;(Ko.prototype=Object.create(vC.EventEmitter.prototype)).constructor=Ko,Ko.prototype.rpcCall=function e(t,a,r,o,n){if(!o)throw TypeError('request must be specified');var i=this;if(!n)return vC.asPromise(e,i,t,a,r,o);if(!i.rpcImpl)return void setTimeout(function(){n(Error('already ended'))},0);try{return i.rpcImpl(t,a[i.requestDelimited?'encodeDelimited':'encode'](o).finish(),function(e,a){if(e)return i.emit('error',e,t),n(e);if(null===a)return void i.end(!0);if(!(a instanceof r))try{a=r[i.responseDelimited?'decodeDelimited':'decode'](a)}catch(e){return i.emit('error',e,t),n(e)}return i.emit('data',a,t),n(null,a)})}catch(e){return i.emit('error',e,t),void setTimeout(function(){n(e)},0)}},Ko.prototype.end=function(e){return this.rpcImpl&&(!e&&this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit('end').off()),this};var jC=ue(function(e,t){t.Service=OC}),zC={},GC=ue(function(e,t){function a(){r.Reader._configure(r.BufferReader),r.util._configure()}var r=t;r.build='minimal',r.Writer=bC,r.BufferWriter=FC,r.Reader=MC,r.BufferReader=LC,r.util=vC,r.rpc=jC,r.roots=zC,r.configure=a,r.Writer._configure(r.BufferWriter),a()}),NC=GC,UC=ue(function(e,t){Object.defineProperty(t,'__esModule',{value:!0}),t.default=t.Model=t.Weights=void 0;var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}(NC);const r=a.Reader,o=a.Writer,n=a.util,s=a.roots['default']||(a.roots['default']={});t.default=s;const i=s.Weights=(()=>{function e(e){if(this.shape=[],e)for(let t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.layerName='',e.prototype.weightName='',e.prototype.shape=n.emptyArray,e.prototype.type='',e.prototype.data=n.newBuffer([]),e.prototype.quantizeMin=0,e.prototype.quantizeMax=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=o.create()),null!=e.layerName&&e.hasOwnProperty('layerName')&&t.uint32(10).string(e.layerName),null!=e.weightName&&e.hasOwnProperty('weightName')&&t.uint32(18).string(e.weightName),null!=e.shape&&e.shape.length){t.uint32(26).fork();for(let a=0;a<e.shape.length;++a)t.uint32(e.shape[a]);t.ldelim()}return null!=e.type&&e.hasOwnProperty('type')&&t.uint32(34).string(e.type),null!=e.data&&e.hasOwnProperty('data')&&t.uint32(42).bytes(e.data),null!=e.quantizeMin&&e.hasOwnProperty('quantizeMin')&&t.uint32(53).float(e.quantizeMin),null!=e.quantizeMax&&e.hasOwnProperty('quantizeMax')&&t.uint32(61).float(e.quantizeMax),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof r||(e=r.create(e));let a=void 0===t?e.len:e.pos+t,o=new s.Weights;for(;e.pos<a;){let t=e.uint32();switch(t>>>3){case 1:o.layerName=e.string();break;case 2:o.weightName=e.string();break;case 3:if(o.shape&&o.shape.length||(o.shape=[]),2==(7&t))for(let t=e.uint32()+e.pos;e.pos<t;)o.shape.push(e.uint32());else o.shape.push(e.uint32());break;case 4:o.type=e.string();break;case 5:o.data=e.bytes();break;case 6:o.quantizeMin=e.float();break;case 7:o.quantizeMax=e.float();break;default:e.skipType(7&t);}}return o},e.decodeDelimited=function(e){return e instanceof r||(e=new r(e)),this.decode(e,e.uint32())},e.verify=function(e){if('object'!=typeof e||null===e)return'object expected';if(null!=e.layerName&&e.hasOwnProperty('layerName')&&!n.isString(e.layerName))return'layerName: string expected';if(null!=e.weightName&&e.hasOwnProperty('weightName')&&!n.isString(e.weightName))return'weightName: string expected';if(null!=e.shape&&e.hasOwnProperty('shape')){if(!Array.isArray(e.shape))return'shape: array expected';for(let t=0;t<e.shape.length;++t)if(!n.isInteger(e.shape[t]))return'shape: integer[] expected'}return null!=e.type&&e.hasOwnProperty('type')&&!n.isString(e.type)?'type: string expected':null!=e.data&&e.hasOwnProperty('data')&&!(e.data&&'number'==typeof e.data.length||n.isString(e.data))?'data: buffer expected':null!=e.quantizeMin&&e.hasOwnProperty('quantizeMin')&&'number'!=typeof e.quantizeMin?'quantizeMin: number expected':null!=e.quantizeMax&&e.hasOwnProperty('quantizeMax')&&'number'!=typeof e.quantizeMax?'quantizeMax: number expected':null},e.fromObject=function(e){if(e instanceof s.Weights)return e;let t=new s.Weights;if(null!=e.layerName&&(t.layerName=e.layerName+''),null!=e.weightName&&(t.weightName=e.weightName+''),e.shape){if(!Array.isArray(e.shape))throw TypeError('.Weights.shape: array expected');t.shape=[];for(let a=0;a<e.shape.length;++a)t.shape[a]=e.shape[a]>>>0}return null!=e.type&&(t.type=e.type+''),null!=e.data&&('string'==typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.quantizeMin&&(t.quantizeMin=+e.quantizeMin),null!=e.quantizeMax&&(t.quantizeMax=+e.quantizeMax),t},e.toObject=function(e,t){t||(t={});let a={};if((t.arrays||t.defaults)&&(a.shape=[]),t.defaults&&(a.layerName='',a.weightName='',a.type='',a.data=t.bytes===String?'':[],a.quantizeMin=0,a.quantizeMax=0),null!=e.layerName&&e.hasOwnProperty('layerName')&&(a.layerName=e.layerName),null!=e.weightName&&e.hasOwnProperty('weightName')&&(a.weightName=e.weightName),e.shape&&e.shape.length){a.shape=[];for(let t=0;t<e.shape.length;++t)a.shape[t]=e.shape[t]}return null!=e.type&&e.hasOwnProperty('type')&&(a.type=e.type),null!=e.data&&e.hasOwnProperty('data')&&(a.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),null!=e.quantizeMin&&e.hasOwnProperty('quantizeMin')&&(a.quantizeMin=t.json&&!isFinite(e.quantizeMin)?e.quantizeMin+'':e.quantizeMin),null!=e.quantizeMax&&e.hasOwnProperty('quantizeMax')&&(a.quantizeMax=t.json&&!isFinite(e.quantizeMax)?e.quantizeMax+'':e.quantizeMax),a},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e})();t.Weights=i;const u=s.Model=(()=>{function e(e){if(this.modelWeights=[],e)for(let t=Object.keys(e),a=0;a<t.length;++a)null!=e[t[a]]&&(this[t[a]]=e[t[a]])}return e.prototype.id='',e.prototype.name='',e.prototype.kerasVersion='',e.prototype.backend='',e.prototype.modelConfig='',e.prototype.modelWeights=n.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=o.create()),null!=e.id&&e.hasOwnProperty('id')&&t.uint32(10).string(e.id),null!=e.name&&e.hasOwnProperty('name')&&t.uint32(18).string(e.name),null!=e.kerasVersion&&e.hasOwnProperty('kerasVersion')&&t.uint32(26).string(e.kerasVersion),null!=e.backend&&e.hasOwnProperty('backend')&&t.uint32(34).string(e.backend),null!=e.modelConfig&&e.hasOwnProperty('modelConfig')&&t.uint32(42).string(e.modelConfig),null!=e.modelWeights&&e.modelWeights.length)for(let a=0;a<e.modelWeights.length;++a)s.Weights.encode(e.modelWeights[a],t.uint32(50).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof r||(e=r.create(e));let a=void 0===t?e.len:e.pos+t,o=new s.Model;for(;e.pos<a;){let t=e.uint32();switch(t>>>3){case 1:o.id=e.string();break;case 2:o.name=e.string();break;case 3:o.kerasVersion=e.string();break;case 4:o.backend=e.string();break;case 5:o.modelConfig=e.string();break;case 6:o.modelWeights&&o.modelWeights.length||(o.modelWeights=[]),o.modelWeights.push(s.Weights.decode(e,e.uint32()));break;default:e.skipType(7&t);}}return o},e.decodeDelimited=function(e){return e instanceof r||(e=new r(e)),this.decode(e,e.uint32())},e.verify=function(e){if('object'!=typeof e||null===e)return'object expected';if(null!=e.id&&e.hasOwnProperty('id')&&!n.isString(e.id))return'id: string expected';if(null!=e.name&&e.hasOwnProperty('name')&&!n.isString(e.name))return'name: string expected';if(null!=e.kerasVersion&&e.hasOwnProperty('kerasVersion')&&!n.isString(e.kerasVersion))return'kerasVersion: string expected';if(null!=e.backend&&e.hasOwnProperty('backend')&&!n.isString(e.backend))return'backend: string expected';if(null!=e.modelConfig&&e.hasOwnProperty('modelConfig')&&!n.isString(e.modelConfig))return'modelConfig: string expected';if(null!=e.modelWeights&&e.hasOwnProperty('modelWeights')){if(!Array.isArray(e.modelWeights))return'modelWeights: array expected';for(let t=0,a;t<e.modelWeights.length;++t)if(a=s.Weights.verify(e.modelWeights[t]),a)return'modelWeights.'+a}return null},e.fromObject=function(e){if(e instanceof s.Model)return e;let t=new s.Model;if(null!=e.id&&(t.id=e.id+''),null!=e.name&&(t.name=e.name+''),null!=e.kerasVersion&&(t.kerasVersion=e.kerasVersion+''),null!=e.backend&&(t.backend=e.backend+''),null!=e.modelConfig&&(t.modelConfig=e.modelConfig+''),e.modelWeights){if(!Array.isArray(e.modelWeights))throw TypeError('.Model.modelWeights: array expected');t.modelWeights=[];for(let a=0;a<e.modelWeights.length;++a){if('object'!=typeof e.modelWeights[a])throw TypeError('.Model.modelWeights: object expected');t.modelWeights[a]=s.Weights.fromObject(e.modelWeights[a])}}return t},e.toObject=function(e,t){t||(t={});let a={};if((t.arrays||t.defaults)&&(a.modelWeights=[]),t.defaults&&(a.id='',a.name='',a.kerasVersion='',a.backend='',a.modelConfig=''),null!=e.id&&e.hasOwnProperty('id')&&(a.id=e.id),null!=e.name&&e.hasOwnProperty('name')&&(a.name=e.name),null!=e.kerasVersion&&e.hasOwnProperty('kerasVersion')&&(a.kerasVersion=e.kerasVersion),null!=e.backend&&e.hasOwnProperty('backend')&&(a.backend=e.backend),null!=e.modelConfig&&e.hasOwnProperty('modelConfig')&&(a.modelConfig=e.modelConfig),e.modelWeights&&e.modelWeights.length){a.modelWeights=[];for(let r=0;r<e.modelWeights.length;++r)a.modelWeights[r]=s.Weights.toObject(e.modelWeights[r],t)}return a},e.prototype.toJSON=function(){return this.constructor.toObject(this,a.util.toJSONOptions)},e})();t.Model=u});se(UC);var qC={},BC=Object.freeze({default:qC}),VC=BC&&qC||BC,HC=ue(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.default=void 0;var o=r(g_),n=r(Ox),i=r(Rv),s=r(zv),u=r(tb),l=r(Eb),p=r(Mb),d=r(pS),c=r(dS),g=a(iC),h=a(uC),f=r(IS),m=r(UC);const _=d.default.CancelToken.source();t.default=class{constructor(e={}){const{filepath:t=null,headers:a={},filesystem:r=!1,gpu:o=!1,transferLayerOutputs:n=!1,pauseAfterLayerCalls:i=!1,visualizations:s=[]}=e;if(!t)throw new Error('[Model] path to protobuf-serialized model definition file is missing.');this.filepath=t,this.headers=a,this.filesystem=!('undefined'!=typeof window)&&r,this.events=new cS.EventEmitter,this.id=null,this.name=null,this.kerasVersion=null,this.backend=null,this.modelConfig={},this.modelWeights=[],this.gpu='undefined'!=typeof window&&gS.webgl2.isSupported&&o,this.transferLayerOutputs=n,this.pauseAfterLayerCalls=i,this.modelLayersInfo=[],this.modelLayersMap=new Map,this.inputTensorsMap=new Map,this.inputLayerNames=[],this.outputLayerNames=[],this.finishedLayerNames=[],this.isRunning=!1,this.runningProgress=0,this.predictStats={},this.visMap=new Map,s.forEach((e)=>{if(e in h){const t=new h[e]({modelLayersMap:this.modelLayersMap,gpu:this.gpu});this.visMap.set(e,t)}}),this._ready=this._initialize()}checkGPUSupport(){return gS.webgl2.isSupported}ready(){return this._ready}_interrupt(){_.cancel()}async _initialize(){this.events.emit('loadingProgress',0);try{const e=this.filesystem?this._dataRequestFS():this._dataRequestHTTP(this.headers);await e}catch(e){console.log(e),this._interrupt()}this.events.emit('loadingProgress',100),this._buildDAG(),this.inputLayerNames.forEach((e)=>{const t=this.modelLayersMap.get(e);t.call(this.inputTensorsMap.get(e)),t.hasOutput=!0,t.visited=!0});const e=this.pauseAfterLayerCalls;return this.pauseAfterLayerCalls=!0,this.runningProgress=0,this.events.emit('initProgress',0),await this._traverseDAG(this.inputLayerNames,'initProgress'),this.pauseAfterLayerCalls=e,this.finishedLayerNames=[],this.modelLayersMap.forEach((e)=>{e.hasOutput=!1,e.visited=!1}),this.visMap.forEach((e)=>{e.initialize()}),this.events.emit('initProgress',100),!0}async _dataRequestHTTP(e={}){try{const t=await d.default.get(this.filepath,{responseType:'arraybuffer',headers:e,onDownloadProgress:(t)=>{if(t.lengthComputable){const e=xn(100*t.loaded/t.total);this.events.emit('loadingProgress',e)}},cancelToken:_.token});this._decodeProtobuf(new Uint8Array(t.data))}catch(e){if(d.default.isCancel(e))console.log('[Model] Data request canceled',e.message);else throw e}}async _dataRequestFS(){const e=p.default.promisify(VC.readFile);try{const t=await e(this.filepath);this._decodeProtobuf(t)}catch(e){throw e}}_decodeProtobuf(e){const t=m.default.Model.verify(e);if(t)throw new Error(`[Model] Invalid model - check protobuf serialization: {err}`);const a=m.default.Model.decode(e);this.id=a.id,this.name=a.name,this.kerasVersion=a.kerasVersion,this.backend=a.backend,this.modelConfig=JSON.parse(a.modelConfig),this.modelWeights=a.modelWeights}toggleGPU(e){this.gpu='undefined'==typeof e?!this.gpu:e,this.modelLayersMap.forEach((e)=>{e.toggleGPU(this.gpu)}),this.visMap.forEach((e)=>{e.gpu=this.gpu}),this.resetInputTensors()}resetInputTensors(){this.inputLayerNames.forEach((e)=>{const t=this.modelLayersMap.get(e);this.inputTensorsMap.set(e,new f.default([],t.shape))})}_buildDAG(){const e=this.modelConfig.class_name;let t=[];if('Sequential'===e?t=this.modelConfig.config:'Model'===e&&(t=this.modelConfig.config.layers),!(Array.isArray(t)&&t.length))throw new Error('[Model] Model configuration does not contain any layers.');t.forEach((a,r)=>{const o=a.class_name,n=a.config;if('Model'===e&&'Sequential'===o)n.forEach((e,t)=>{const r=e.class_name,o=e.config,i=0===t?a.inbound_nodes[0].map((e)=>e[0]):[n[t-1].config.name];this._createLayer(r,o,i)});else if(!(o in g))throw new Error(`[Model] Layer ${o} specified in model configuration is not implemented!`);else{if('Sequential'===e&&0===r){const e='input',t=n.batch_input_shape.slice(1),a=new g.InputLayer({name:e,shape:t,gpu:this.gpu});this.modelLayersMap.set(e,a),this.inputTensorsMap.set(e,new f.default([],t)),this.inputLayerNames.push(e)}else if('Model'===e&&'InputLayer'===o){const e=n.batch_input_shape.slice(1);this.inputTensorsMap.set(n.name,new f.default([],e)),this.inputLayerNames.push(n.name)}let i=[];if('Sequential'===e)i=0===r?['input']:[t[r-1].config.name];else if('Model'===e){const e=a.inbound_nodes;e&&e.length&&(i=e[0].map((e)=>e[0]))}this._createLayer(o,n,i)}}),this.modelLayersMap.forEach((e)=>{this.modelLayersInfo.push((0,l.default)(e,['name','description','layerClass','inbound','outbound'])),0===e.outbound.length&&this.outputLayerNames.push(e.name)}),this.inputLayerNames.sort(),this.outputLayerNames.sort()}_createLayer(e,t,a){const r=new g[e](Object.assign({},t,{gpu:this.gpu}));let o=[];if('Bidirectional'===e){const e=r.forwardLayer.params.map((e)=>`${t.name}/forward_${t.layer.config.name}/${e}`),a=r.backwardLayer.params.map((e)=>`${t.name}/backward_${t.layer.config.name}/${e}`);o=e.concat(a)}else o='TimeDistributed'===e?r.layer.params.map((e)=>`${t.name}/${e}`):r.params.map((e)=>`${t.name}/${e}`);if(o&&o.length){const e=o.map((e)=>{const t=(0,u.default)(this.modelWeights,(t)=>{const a=new RegExp(`^.*${e}`);return a.test(t.weightName)});if(!t)throw new Error(`[Model] error loading weights.`);const{data:a,shape:r,type:o}=t,n=new ArrayBuffer(a.byteLength),i=new Uint8Array(n);if(i.set(new Uint8Array(a.buffer,a.byteOffset,a.byteLength)),'uint8'===o){const{quantizeMin:e,quantizeMax:a}=t,o=new Float32Array(i);for(let t=0,r=o.length;t<r;t++)o[t]*=(a-e)/255,o[t]+=e;return new f.default(o,r)}return new f.default(new Float32Array(n),r)});r.setWeights(e)}this.modelLayersMap.set(t.name,r),a.forEach((e)=>{this.modelLayersMap.get(t.name).inbound.push(e),this.modelLayersMap.get(e).outbound.push(t.name)})}async _traverseDAG(e,t){if(0===e.length)return this.runningProgress=100,this.events.emit(t,100),!0;if(1===e.length){const a=e[0],r=this.modelLayersMap.get(a);if('InputLayer'===r.layerClass)this.finishedLayerNames.push(this.modelLayersMap.get(a).name);else{const e=this.modelLayersMap.get(a);if(e.visited)return!1;const t=e.inbound.map((e)=>this.modelLayersMap.get(e));if(!(0,s.default)((0,i.default)(t,'hasOutput')))return!1;e.isMergeLayer?e.call((0,i.default)(t,'output')):e.call(t[0].output),e.hasOutput=!0,e.visited=!0,this.finishedLayerNames.push(e.name),this.pauseAfterLayerCalls&&(await p.default.delay(0))}this.runningProgress+=100/this.modelLayersMap.size,this.events.emit(t,this.runningProgress),await this._traverseDAG(r.outbound,t)}else await p.default.all(e.map((e)=>this._traverseDAG([e],t)))}_maybeTransferIntermediateOutputs(){this.gpu&&this.transferLayerOutputs&&this.modelLayersMap.forEach((e)=>{e.output&&e.output.glTexture&&(gS.webgl2.bindOutputTexture(e.output.glTexture,e.output.glTextureShape),e.output.transferFromGLTexture(),e.output.is2DReshaped&&e.output.reshapeFrom2D())})}loadData(e){this.inputLayerNames.forEach((t)=>{const a=this.modelLayersMap.get(t);this.inputTensorsMap.get(t).replaceTensorData(e[t]),a.call(this.inputTensorsMap.get(t)),a.hasOutput=!0,a.visited=!0})}async predict(e){if(this.isRunning=!0,this.runningProgress=0,this.events.emit('predictProgress',0),!(0,n.default)((0,o.default)(e).sort(),this.inputLayerNames))throw this.isRunning=!1,new Error('[Model] predict() must take an object where the keys are the named inputs of the model: '+JSON.stringify(this.inputLayerNames));if(!(0,s.default)(this.inputLayerNames,(t)=>e[t]instanceof Float32Array))throw this.isRunning=!1,new Error('[Model] predict() must take an object where the values are the flattened data as Float32Array.');this.finishedLayerNames=[],this.modelLayersMap.forEach((e)=>{e.hasOutput=!1,e.visited=!1});let t=(0,c.default)();this.loadData(e),this.predictStats.loadData=(0,c.default)()-t,t=(0,c.default)(),await this._traverseDAG(this.inputLayerNames,'predictProgress'),this.predictStats.forwardPass=(0,c.default)()-t,this._maybeTransferIntermediateOutputs();const a=this.modelConfig.class_name,r={};if('Sequential'===a){const e=this.modelLayersMap.get(this.outputLayerNames[0]);r.output=e.output.tensor.data}else'Model'===a&&this.outputLayerNames.forEach((e)=>{const t=this.modelLayersMap.get(e);r[e]=t.output.tensor.data});return t=(0,c.default)(),this.visMap.forEach((e)=>{e.update()}),this.predictStats.visualizations=(0,c.default)()-t,this.isRunning=!1,this.events.emit('predictProgress',100),r}layerCall(e,t){if(!this.modelLayersMap.has(e))return;let a=t instanceof f.default?t:new f.default(t.data,t.shape);const r=this.modelLayersMap.get(e);return r.call(a)}cleanup(){gS.webgl2.clearRefs(),this.modelLayersMap.clear(),this.inputTensorsMap.clear(),this.visMap.clear(),delete this.modelWeights}}});se(HC);var WC=Nf.isFinite,XC=Zo,YC=1/0,$C=Qo,KC=NS({args:['array','scalar','index'],body:function(e,t,a){var r=t,o;for(o=0;o<a.length-1;++o)r=r[a[o]];r[a[a.length-1]]=e}}),ZC=function(e){var t=aw(e.shape);return KC(e,t),t},QC=ue(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),t.approxEquals=function(e,t,s=1e-4){const u=(0,o.default)((0,n.default)(e)),a=t;if(u.length!==a.length)return!1;for(let o=0;o<u.length;o++){if(!(0,r.default)(u[o]))return!1;if(u[o]<a[o]-s||u[o]>a[o]+s)return!1}return!0};var r=a(XC),o=a($C),n=a(ZC)});se(QC);var JC=ue(function(e,t){function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,a):{};r.get||r.set?Object.defineProperty(t,a,r):t[a]=e[a]}return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,'__esModule',{value:!0}),Object.defineProperty(t,'Model',{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,'Tensor',{enumerable:!0,get:function(){return n.default}}),t.testUtils=t.layers=t.activations=t.default=t.GPU_SUPPORT=void 0;var o=r(HC),n=r(IS),i=a(KS);t.activations=i;var s=a(iC);t.layers=s;var u=a(QC);t.testUtils=u;const l=gS.webgl2.isSupported;t.GPU_SUPPORT=l;const p={Model:o.default,Tensor:n.default,GPU_SUPPORT:l,activations:i,layers:s,testUtils:u};t.default=p}),eF=se(JC),tF=function(e,t,a,r){return new(a||(a=Promise))(function(o,n){function i(e){try{u(r.next(e))}catch(t){n(t)}}function s(e){try{u(r['throw'](e))}catch(t){n(t)}}function u(e){e.done?o(e.value):new a(function(t){t(e.value)}).then(i,s)}u((r=r.apply(e,t||[])).next())})},aF=!1;(function(){'undefined'!=typeof module&&module.exports&&(aF=!0)})();var rF=a('MODEL_PATH')||'/dist/model.bin',oF=new eF.Model({filepath:aF?__dirname+'/model.bin':rF,gpu:!1,filesystem:aF});(function(e){e[e.TD=0]='TD',e[e.IHS=1]='IHS',e[e.HS=2]='HS',e[e.TU=3]='TU',e[e.DT=4]='DT',e[e.DB=5]='DB'})(e.AvailablePatterns||(e.AvailablePatterns={}));class nF extends En{}nF.predictPattern=tn,nF.hasDoubleBottom=an,nF.hasDoubleTop=rn,nF.hasHeadAndShoulder=on,nF.hasInverseHeadAndShoulder=nn,nF.isTrendingUp=sn,nF.isTrendingDown=un;let iF=ln();e.getAvailableIndicators=ln,e.AvailableIndicators=iF,e.CandleData=wn,e.CandleList=Cn,e.sma=o,e.SMA=In,e.ema=n,e.EMA=An,e.wma=s,e.WMA=Rn,e.wema=u,e.WEMA=Ln,e.macd=p,e.MACD=On,e.rsi=g,e.RSI=Gn,e.bollingerbands=f,e.BollingerBands=qn,e.adx=y,e.ADX=Yn,e.atr=x,e.ATR=$n,e.truerange=_,e.TrueRange=Wn,e.roc=v,e.ROC=Kn,e.kst=b,e.KST=Zn,e.psar=S,e.PSAR=Qn,e.stochastic=T,e.Stochastic=Jn,e.williamsr=P,e.WilliamsR=ei,e.adl=w,e.ADL=ti,e.obv=C,e.OBV=ai,e.trix=F,e.TRIX=ri,e.forceindex=k,e.ForceIndex=oi,e.cci=M,e.CCI=ni,e.vwap=D,e.VWAP=ii,e.averagegain=d,e.AverageGain=jn,e.averageloss=c,e.AverageLoss=zn,e.sd=h,e.SD=Un,e.renko=I,e.HeikinAshi=ui,e.heikinashi=A,e.bullish=H,e.bearish=J,e.abandonedbaby=ee,e.doji=G,e.bearishengulfingpattern=W,e.bullishengulfingpattern=L,e.darkcloudcover=te,e.downsidetasukigap=U,e.dragonflydoji=ae,e.gravestonedoji=re,e.bullishharami=O,e.bearishharami=X,e.bullishharamicross=z,e.bearishharamicross=Y,e.eveningdojistar=$,e.eveningstar=K,e.morningdojistar=N,e.morningstar=R,e.bullishmarubozu=q,e.bearishmarubozu=Z,e.piercingline=B,e.bullishspinningtop=oe,e.bearishspinningtop=ne,e.threeblackcrows=Q,e.threewhitesoldiers=V,e.fibonacciretracement=ie,e.predictPattern=tn,e.PatternDetector=nF,e.hasDoubleBottom=an,e.hasDoubleTop=rn,e.hasHeadAndShoulder=on,e.hasInverseHeadAndShoulder=nn,e.isTrendingUp=sn,e.isTrendingDown=un,e.setConfig=t,e.getConfig=a})(this.window=this.window||{});
//# sourceMappingURL=browser.es6.js.map
